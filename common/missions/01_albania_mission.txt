01_albania = {
    header = "mission_image_scythian"
    icon = cde_indo_greek_port_city

    repeatable = no
    chance = 1000

    potential = {
        tag = ALB
        NOT = { has_variable = mission_cooldown_var }
    }

    abort = {
		ai_mission_back_out_trigger = yes
	}

    on_start = {
        start_mission_ai_effect = yes
        set_variable = albania_properity_counting #Used for Generic Svalues
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {
		complete_mission_effect = yes
	}
    
    01_albania_task_1 = { # The Sons of Arhan 
        icon = "task_heracles"
        allow = {                                 
            current_ruler = {
                popularity >= 65
            }
            has_deity_in_pantheon = deity:omen_arhan
            hidden:deity:omen_arhan = {
                has_holy_site = yes
            }
            trigger_if = {
                limit = {
                    exists = job_holder:office_high_priest
                }
                job_holder:office_high_priest = {
                    loyalty >= 75
                    zeal >= 8
                }
            }
            trigger_else = {
                NOT = { office_is_empty = office_high_priest }
            }
        }

        highlight = {
	
		}

        on_completion = {
            add_centralization = 15
            custom_tooltip = 01_albania_task_1_tt
            hidden_effect = {
                area:artshak_area = {
                    add_provincial_claim_effect = yes
                }
                area:arran_area = {
                    add_provincial_claim_effect = yes
                }
                area:kahetia_area = {
                    add_provincial_claim_effect = yes
                }
            }
            trigger_event = {
                id = me_albania.1
            }
            add_country_modifier = {
                name = albanian_heritage
                duration = 3600
            }
        }
    }

    01_albania_task_2 = { # Albanian Lands
        icon = "task_expansion"

        requires = { 01_albania_task_1 }

        prevented_by = {01_albania_task_13}

        highlight = {
			scope:province = {
				OR = {
					is_in_area = kahetia_area
					is_in_area = arran_area
                    is_in_area = artshak_area
				}
			}
		}

        allow = { 
            OR = {
                AND = {
                    owns_or_subject_owns_area = area:kahetia_area
                    owns_or_subject_owns_area = area:arran_area
                }
                AND = {
                    hidden:p:1612.state.governor_or_ruler = {
                        is_friend = root.current_ruler
                    }
                    p:1612.state.governor_or_ruler = {
                        loyalty <= 33
                    }
                }
            }
            OR = {
                owns_or_subject_owns_area = area:artshak_area
                AND = {
                    hidden:p:1667.state.governor_or_ruler = {
                        is_friend = root.current_ruler
                    }
                    p:1667.state.governor_or_ruler = {
                        loyalty <= 33
                    }
                }
            }
        }

        on_completion = {
            add_centralization = 10
            add_treasury = -150
            add_political_influence = -30
            add_aggressive_expansion = 15
            add_military_experience = 10
            area:kahetia_area = { formable_area_conquest_effect = yes }
			area:arran_area = { formable_area_conquest_effect = yes }
            area:artshak_area = { formable_area_conquest_effect = yes }
            trigger_event = {
                id = me_albania.2
            }
        }
    }

    01_albania_task_3 = { # Catalog the Twenty Six Tongues
        icon = "task_happiness"
        duration = 180

        highlight = {
			scope:province = {
				OR = {
					province_id = 1636
				}
			}
		}

        requires = { 01_albania_task_2}

        prevented_by = {01_albania_task_13}
        
        allow = { 
            hidden:capital_scope = { 
                has_city_status = yes
                num_of_library_building >= 3
                has_no_ongoing_construction = yes
            }
            has_law = increased_council_powers      
        }
        on_completion = {
            trigger_event = {
                id = me_albania.3
            }
            add_centralization = 15
            add_country_modifier = {
                name = pleased_albanian_linguists_mod
                duration = -1
            }
            #every_holding_owners = {
            #    add_prominence = 50
            #    add_popularity = 5
            #}
            hidden_effect = {
                while = { 
                    count = 2
                    every_owned_province = {
                        limit = {
                            has_city_status = yes
                        }
                        define_pop = {
                            type = nobles
                            culture = root.culture
                            religion = root.religion
                        }
                    }
                }
            }  
        }
    }

    01_albania_task_4 = { # Greater Albania
        icon = "task_expansion"
    
        requires = { 01_albania_task_3}
    
        prevented_by = {01_albania_task_13}
    
        highlight = {
			scope:province = {
				OR = {
					is_in_area = kahetia_area
					is_in_area = arran_area
                    is_in_area = artshak_area
                    is_in_area = paytankert_area
                    is_in_area = caucasian_albania_area
                    is_in_area = scythia_trans_montem_area
                    is_in_area = sarmatia_hyrcania_area
				}
			}
		}
        
        allow = { 
            owns_or_subject_owns_area = area:kahetia_area
            owns_or_subject_owns_area = area:arran_area
            owns_or_subject_owns_area = area:artshak_area
            owns_or_subject_owns_area = area:paytankert_area
            owns_or_subject_owns_area = area:caucasian_albania_area
            owns_or_subject_owns_area = area:scythia_trans_montem_area
            owns_or_subject_owns_area = area:sarmatia_hyrcania_area
        }
        on_completion = {
            trigger_event = { 
                id = me_albania.4
            }
            add_centralization = 30
            change_country_name = GREATER_ALBANIA # a minor formable, if you will
		    current_ruler = {
			    add_trait = brave
			    add_trait = disciplined
			    add_trait = secure
            }
            add_political_influence = 100
            current_ruler = {
                add_popularity = 10
            }
            add_country_modifier = {
                name = albanian_nationalism
                duration = 1200
            }
        }
    }

    01_albania_task_5 = { # Secure The Kura-Araxes Trade
        icon = "task_economical"

        requires = { 01_albania_task_3}

        prevented_by = {01_albania_task_13}

        highlight = {

		}

        allow = {
            custom_tooltip = {
                text = 01_albania_task_5_tt
                01_albania_task_5_forts_current >= 4
            }
        }
        on_completion = {
            trigger_event = {
                id = me_albania.5
            }
            add_country_modifier = {
                name = secure_trade
                duration = -1
            }
            capital_scope = {
                add_province_modifier = {
                    name = economic_boom_in_the_capital_mod
                    duration = 3650
                }
            }
        }
    }

    01_albania_task_6 = { # King of the Albanians
        icon = "task_artemis"

        requires = {01_albania_task_4}

        bypass = {
            has_variable = completed_albania_task_7_var
        }

        prevented_by = { 01_albania_task_13}

        highlight = {

		}

        allow = {
            idea = idea_origin_myth
            invention = agressive_expansion_impact_inv_5
            stability >= 55 
        }

        on_completion = {
            custom_tooltip = 01_albania_task_7_tt
            set_variable = completed_albania_task_6_var
            change_government = aristocratic_monarchy
            add_country_modifier = {
                name = rally_around_the_throne
                duration = 1200
            } 
            
            trigger_event = {
                id = me_albania.6
            }
            show_as_tooltip = {

            }
        }
    }

    01_albania_task_7 = { # Leaders of Albania
        icon = "task_apollo"

        requires = {01_albania_task_4}

        bypass = {
            has_variable = completed_albania_task_6_var
        }

        prevented_by = { 01_albania_task_13}

        highlight = {
			
		}

        allow = {
            idea = idea_land_appropriation
            invention = change_governor_policy_inv
            invention = agressive_expansion_impact_inv_3
            stability >= 60
        }

        on_completion = {
            custom_tooltip = 01_albania_task_7_tt
            set_variable = completed_albania_task_7_var
            change_government = plutocratic_republic
            trigger_event = {
                id = me_albania.7
            }
            add_country_modifier = {
                name = country_of_the_few
                duration = 2400
            }
            show_as_tooltip = {

            }
            hidden_effect = {
                if = {
                    limit = {
                        stability <= 55 
                    }
                    trigger_event = {
                        id = me_albania.8 # Unrest / Annoyance
                        days = 120
                    }
                }
                else_if = {
                    limit = { 
                        tyranny >= 35
                    }
                    trigger_event = {
                        id = me_albania.10 # Rebellion for Democratic Republic
                        days = 120
                    }
                }
                else = {
                    trigger_event = {
                        id = me_albania.9 # Rebellion for Monarchy
                        days = 120
                    }
                }
            }
        }
    }

    01_albania_task_8 = { # Hegemon of the Kura-Araxes
        icon = "task_battle"

        requires = {01_albania_task_4 01_albania_task_5}

        prevented_by = {01_albania_task_13}

        allow = {
            c:IBR = { 
                OR = {
                    has_land = no
                    is_subject_of = root
                }
            }
            c:ARM = { 
                OR = {
                    has_land = no
                    is_subject_of = root
                }
            }
            owns_or_subject_owns_area = arran_area
            owns_or_subject_owns_area = artshak_area
            owns_or_subject_owns_area = syunik_area
            owns_or_subject_owns_area = ayrarat_area
            owns_or_subject_owns_area = kahetia_area
            owns_or_subject_owns_area = caucasian_iberia_area
            owns_or_subject_owns_area = gugark_area
            owns_or_subject_owns_area = syracene_area
        }

        highlight = {
			scope:province = {
				OR = {
					is_in_area = kahetia_area
					is_in_area = arran_area
                    is_in_area = artshak_area
                    is_in_area = gugark_area
                    is_in_area = caucasian_iberia_area
                    is_in_area = ayrarat_area
                    is_in_area = syunik_area
                    is_in_area = syracene_area
				}
			}
		}

        on_completion = {
            add_political_influence = 50
            add_military_experience = 40
            current_ruler = {
                add_prominence = 50
                add_trait = ambitious
            }
            add_country_modifier = {
                name = caucasian_hegemon
                duration = -1
            }
            trigger_event = { 
                id = me_albania.18
            }
        }
    }

    01_albania_task_9 = { # Legacy of the Albanian People
        icon = "task_atlas"

        requires = { 01_albania_task_6 01_albania_task_7 01_albania_task_8 }
        
        final = yes

        prevented_by = {01_albania_task_13}

        allow = {
            legitimacy >= 90
            stability >= 65
            custom_tooltip = {
                text = 01_albania_task_9_tt
                01_albania_task_9_metropolis_current >= 4
            }
            invention =  global_cohort_recruit_speed_inv
            invention = assimilate_pop_cost_modifier_inv_1
            invention = oratory_tech_investment_inv_1
            invention = stability_inv_3
        }

        on_completion = {
            current_ruler = {
                add_finesse = 2
                add_charisma = 2
                add_martial = 2
                add_zeal = 2
            }
            add_innovation = 4
            add_8_free_province_investments = yes
            add_country_modifier = {
                name = albanian_legacy
                duration = -1
            }
            trigger_event = {
                id = me_albania.19
            }
            show_as_tooltip = {

            }
        }
    }

    01_albania_task_10 = { # The Eastern Caucasian Tribes
        icon = "task_diplomatic"

        requires = {01_albania_task_2 01_albania_task_13}

        highlight = {
			scope:province = {
				has_owner = yes
				owner = {
					THIS = c:LGA
				}
			}
		}

        allow = { 
            political_influence >= 25
            treasury >= 25
            hidden:c:LGA = {
                opinion = {
                    target = root
                    value >= 170
                }
            }
            current_ruler = {
                is_friend = c:LGA.current_ruler
            }
        }

        bypass = {
            NOT = { exists = c:LGA }
        }

        on_completion = {
            add_treasury = -25
            add_political_influence = -25
            trigger_event = {
                id = me_albania.20
            }
            make_subject = {
                type = feudatory
                target = c:LGA
            }
        }
    }

    01_albania_task_11 = { # The Albanian Sea
        icon = "task_expansion"

        requires = {01_albania_task_10}

        allow = {
            hidden:p:5866 = { owned_or_subject_owned = ROOT }
            hidden:p:5877 = { owned_or_subject_owned = ROOT }
            hidden:p:8050 = { owned_or_subject_owned = ROOT }
            hidden:p:3254 = { owned_or_subject_owned = ROOT }
            hidden:p:5499 = { owned_or_subject_owned = ROOT }
            hidden:p:5493 = { owned_or_subject_owned = ROOT }
            hidden:p:5467 = { owned_or_subject_owned = ROOT }
            hidden:p:5462 = { owned_or_subject_owned = ROOT }
            hidden:p:5425 = { owned_or_subject_owned = ROOT }
            hidden:p:6811 = { owned_or_subject_owned = ROOT }
        }

        highlight = {
			scope:province = {
				OR = {
					province_id = 5866
                    province_id = 5877
                    province_id = 8050
                    province_id = 3245
                    province_id = 5499
                    province_id = 5493
                    province_id = 5467
                    province_id = 5462
                    province_id = 5425
                    province_id = 6811
				}
			}
		}
    
        on_completion = {
            add_country_modifier = {
                name = albanian_ports
                duration = -1
            }
            add_country_modifier = {
                name = albanian_shipping
                duration = 1200
            }
            p:7633 = {
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = root.culture
                }
            }
            p:7604 = {
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = root.culture
                }
            }
            p:7603 = {
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = root.culture
                }
            }
            p:1642 = {
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = root.culture
                }
            }
            p:1633 = {
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = root.culture
                }
            }
            p:1647 = {
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = root.culture
                }
            }
            trigger_event = {
                id = me_albania.21
            }
        }
    }

    01_albania_task_12 = { # A Distant Chorasmian Threat
        icon = "task_conquest"

        requires = {01_albania_task_11}

        highlight = {
			scope:province = {
				OR = {
					is_in_area = scythia_prima_area
					is_in_area = kharesmia_area
                    is_in_area = oxiana_ultima_area
					is_in_area = kharesmia_superior
				}
			}
		}

        allow = {
            custom_tooltip = {
				text = formable_not_kharesmia_exists
				NOT = {
					any_country = {
						tag = KRZ
					}
				}
			}
            owns_or_subject_owns_area = area:scythia_prima_area
            owns_or_subject_owns_area = area:kharesmia_area
            owns_or_subject_owns_area = area:oxiana_ultima_area
            owns_or_subject_owns_area = area:kharesmia_superior
        }

        on_completion = {
            p:6805 = {
                if = {
                    limit = {
                        has_city_status = yes
                    }
                    set_city_status = city_metropolis
                }
                else = {
                    found_city_effect = yes
                }
                define_pop = {
                    type = nobles
                    religion = root.religion
                    culture = culture:albanian
                }
                define_pop = {
                    type = nobles
                    religion = root.religion
                    culture = culture:albanian
                }
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = culture:albanian
                }
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = culture:albanian
                }
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = culture:albanian
                }
                define_pop = {
                    type = freemen
                    religion = root.religion
                    culture = culture:albanian
                }
                define_pop = {
                    type = freemen
                    religion = root.religion
                    culture = culture:albanian
                }
                define_pop = {
                    type = freemen
                    religion = root.religion
                    culture = culture:albanian
                }
            }
            add_country_modifier = {
                name = glory_over_khorasmia
                duration = 3500
            }
            trigger_event = {
                id = me_albania.22
            }
        }
    }

    01_albania_task_13 = { # The Achaemenid Remnant
        icon = "task_political"

        requires = {01_albania_task_1}

        prevented_by = {01_albania_task_2}

        highlight = {
			scope:province = {
				province_id = 1646
			}
		}

        allow = {
            manpower >= 10 
            treasury >= 100
            hidden:p:1646 = {
                has_city_status = yes
                has_building = fortress_building
                has_building = court_building
            }
        }

        on_completion = {
            add_centralization = 20
            current_ruler = {
                add_gold = -100
                add_trait = wise
                add_loyal_veterans = 10
            }
            if = {
                limit = {
                    exists = current_heir
                }
                current_heir = {
                    add_trait = ambitious
                    add_loyal_veterans = 5
                }
            }
            add_manpower = -10
            add_treasury = -100
            add_political_influence = 50
            add_4_free_province_investments = yes
            add_innovation = 4
            p:1646 = {
                add_permanent_province_modifier = {
                    name = satrapy_capital
                    duration = -1
                }
                define_pop = {
                    type = nobles
                    religion = religion:zoroaster
                    culture = culture:pasargadi
                }
                define_pop = {
                    type = nobles
                    religion = religion:zoroaster
                    culture = culture:pasargadi
                }
                define_pop = {
                    type = nobles
                    religion = religion:zoroaster
                    culture = culture:albanian
                }
                define_pop = {
                    type = citizen
                    religion = religion:zoroaster
                    culture = culture:pasargadi
                }
                define_pop = {
                    type = citizen
                    religion = religion:zoroaster
                    culture = culture:median
                }
                define_pop = {
                    type = citizen
                    religion = religion:zoroaster
                    culture = culture:albanian
                }
            }
            trigger_event = {
                id = me_albania.23
            }
        }
    }

    01_albania_task_14 = { # Achaemenid-Style Governance
        icon = "task_political"

        requires = {01_albania_task_13}

        prevented_by = {01_albania_task_2}

        allow = {
            centralization >= 50
            political_influence >= 80
            custom_tooltip = {
                text = 01_albania_task_14_tt
                any_country_culture = {
                    is_culture = pasargadi
                    is_integrated = yes
                }
            }
        }

        on_completion = {
            current_ruler = {
                add_finesse = 1
            }
            add_political_influence = -80
            add_stability = 15
            change_government = aristocratic_monarchy
            change_law = work_for_the_best
            add_country_modifier = {
                name = albanian_achaemenid_governance
                duration = -1
            }
            trigger_event = {
                id = me_albania.24
            }
            set_variable = free_religion_conversion # for the next task so the conversion doens't cost 200 PI
        }
    }

    01_albania_task_15 = { # Iranian Gods
        icon = "task_religion"

        requires = {01_albania_task_14}

        prevented_by = {01_albania_task_2}
 
        allow = { #ADD CUSTOM LOC
            custom_tooltip = {
                text = 01_albania_task_15_tt_a
                any_pantheon_deity = {
                    count >= 1
                    deity_religion = root.religion
                }
                OR = {
                    any_pantheon_deity = {
                        count >= 2
                        deity_religion = mithra_religion
                    }
                    any_pantheon_deity = {
                        count >= 2
                        deity_religion = zoroaster
                    }
                }
            }
            
            custom_tooltip = {
                text = 01_albania_task_15_tt
                01_albania_task_15_temples_current >= 3
            }
        }

        on_completion = { # CUSTOM LOC !!!! MAKE MORE PEOPLE SWITCH TO NEW RELIGION!!!!!!!
            if = {
                limit = {
                    any_pantheon_deity = {
                        count >= 2
                        deity_religion = mithra_religion
                    }
                }
                add_political_influence = -50 # 1/4 the normal cost of conversion
                add_stability = -10
                change_religion_effect = {
                    RELIGION = mithra_religion
                }
            }
            else_if = {
                limit = {
                    any_pantheon_deity = {
                        count >= 2
                        deity_religion = zoroaster
                    }
                }
                add_political_influence = -50
                add_stability = -10
                change_religion_effect = {
                    RELIGION = zoroaster
                }
            }
            else = {
                add_political_influence = -50
                add_stability = -10
                change_religion_effect = {
                    RELIGION = caucasian_religion
                }
            }
            trigger_event = {
                id = me_albania.25
            }
        }
    }

    01_albania_task_16 = { # Albanian-Iranian Arms
        icon = "task_battle"

        requires = {01_albania_task_14}

        prevented_by = {01_albania_task_2}

        allow = {
            custom_tooltip = {
                text = albania_mission_01_task_16_tooltip
                albania_mission_task_16_have_10_military_buildings_current >= albania_mission_task_16_have_10_military_buildings_total
            }
            military_experience >= 60 
        }

        highlight = {
			scope:province = {
				is_in_area = caucasian_albania_area
			}
		}

        on_completion = {
            custom_tooltip = albania_mission_01_task_16_a_tooltip
            add_military_experience = -60
            add_treasury = 250
            add_country_modifier = {
                name = albanian_iranian_army
                duration = 7300 # 20 years
            }
            hidden_effect = {
				set_variable = persian_cap_persia_mil_trads_var
				while = {
					count = 2
					every_owned_province = {
						limit = {
							has_city_status = yes
						}
						define_pop = {
							type = nobles
							culture = pasargadi
							religion = zoroaster
						}
					}
					every_owned_province = {
						limit = {
							has_city_status = no
						}
						define_pop = {
							type = citizen
							culture = pasargadi
							religion = zoroaster
						}
					}
				}
			}
            trigger_event = {
                id = me_albania.26
            }
        }
    }

    01_albania_task_17 = { # Palace Centers
        icon = "task_political"

        requires = {01_albania_task_15}

        prevented_by = {01_albania_task_2}

        allow = {
            p:1646 = {
                owner = root
                has_province_rank = city_metropolis
                num_of_academy_building = 3
                num_of_library_building >= 3
                has_building = fortress_building
                has_building = temple_building
                has_building = theathre_building
                has_no_ongoing_construction = yes
            }
            p:1610 = {
                owner = root
                has_province_rank = city_metropolis
                num_of_academy_building = 3
                num_of_library_building >= 3
                has_building = fortress_building
                has_building = temple_building
                has_building = theathre_building
                has_no_ongoing_construction = yes
            }
            p:1677 = {
                owner = root
                has_province_rank = city_metropolis
                num_of_academy_building = 3
                num_of_library_building >= 3
                has_building = fortress_building
                has_building = temple_building
                has_building = theathre_building
                has_no_ongoing_construction = yes
            }
        }

        highlight = {
			scope:province = {
				OR = {
					province_id = 1646
                    province_id = 1677
                    province_id = 1610
				}
			}
		}

        on_completion = {
            add_political_influence = 50
            add_innovation = 4
            add_stability = 5
            p:1677 = { add_road_towards = p:1686 }
            p:1686 = { add_road_towards = p:1610 }
            p:1610 = { add_road_towards = p:1607 }
            p:1607 = { add_road_towards = p:1608 }
            p:1608 = { add_road_towards = p:1646 }
            custom_tooltip = albania_mission_01_task_17_tooltip

            trigger_event = {
                id = me_albania.28
            }
        }
    }

    01_albania_task_18 = { # Securing the Achaemenid North
        icon = "task_expansion"

        requires = {01_albania_task_16}

        prevented_by = {01_albania_task_2}

        allow = {
            owns_or_subject_owns_area = media_atropatene_area
            owns_or_subject_owns_area = media_area
            owns_or_subject_owns_area = parskahayk_area
            owns_or_subject_owns_area = paytankert_area
            owns_or_subject_owns_area = kadousioi_area
            owns_or_subject_owns_area = amardioi_area
            owns_or_subject_owns_area = media_choromithrene
            owns_or_subject_owns_area = kossioi_area
            owns_or_subject_owns_area = ecbatana_area
            custom_tooltip = {
                text = albania_mission_01_task_18_tooltip
                any_owned_province = { 
                    is_in_area = media_atropatene_area
                    num_of_fortress_building >= 1
                    has_construction = no
                }
                any_owned_province = { 
                    is_in_area = media_area
                    num_of_fortress_building >= 1
                    has_construction = no
                }
                any_owned_province = { 
                    is_in_area = parskahayk_area
                    num_of_fortress_building >= 1
                    has_construction = no
                }
                any_owned_province = { 
                    is_in_area = paytankert_area
                    num_of_fortress_building >= 1
                    has_construction = no
                }
                any_owned_province = { 
                    is_in_area = kadousioi_area
                    num_of_fortress_building >= 1
                    has_construction = no
                }
                any_owned_province = {
                    is_in_area = amardioi_area
                    num_of_fortress_building >= 1
                    has_construction = no
                }
                any_owned_province = {
                    is_in_area = media_choromithrene
                    num_of_fortress_building >= 1
                    has_construction = no
                }
                any_owned_province = {
                    is_in_area = kossioi_area
                    num_of_fortress_building >= 1
                    has_construction = no
                }
                any_owned_province = { 
                    is_in_area = ecbatana_area
                    num_of_fortress_building >= 1
                    has_construction = no
                }
            }
            
        }

        highlight = {
			scope:province = {
				OR = {
					is_in_area = media_atropatene_area
					is_in_area = media_area
					is_in_area = parskahayk_area
                    is_in_area = paytankert_area
                    is_in_area = kadousioi_area
                    is_in_area = amardioi_area
                    is_in_area = media_choromithrene
                    is_in_area = kossioi_area
                    is_in_area = ecbatana_area
				}
			}
		}

        on_completion = {
            add_stability = 10
            current_ruler = {
                add_popularity = 10
                add_trait = conqueror
            }
            add_country_modifier = {
                name = albania_northern_iran_forts
                duration = -1
            }
            area:persepolis_area = {
				add_provincial_claim_effect = yes
			}
            area:media_felix_area = {
				add_provincial_claim_effect = yes
			}
            area:susiana_area = {
				add_provincial_claim_effect = yes
			}
            trigger_event = {
                id = me_albania.27
            }
        }
    }

    01_albania_task_19 = { # Albanian Satrapies
        icon = "task_calm"

        requires = {01_albania_task_17}

        prevented_by = {01_albania_task_2}

        highlight = {
			scope:province = {
				OR = {
					is_in_region = armenia_region
                    is_in_region = colchis_region
                    is_in_region = media_region
				}
			}
		}

        allow = {
            owns_or_subject_owns_region = armenia_region
            p:1570 = {
                has_province_rank = city_metropolis
                has_building = court_building
                has_building = theathre_building
                is_holy_site = yes
                has_no_ongoing_construction = yes
            }
            owns_or_subject_owns_region = colchis_region
            p:1720 = {
                has_province_rank = city_metropolis
                has_building = court_building
                has_building = theathre_building
                is_holy_site = yes
                has_no_ongoing_construction = yes
            }
            owns_or_subject_owns_region = media_region
            p:1595 = {
                has_province_rank = city_metropolis
                has_building = court_building
                has_building = theathre_building
                is_holy_site = yes
                has_no_ongoing_construction = yes
            }
            political_influence >= 50 
            invention = subject_opinions_inv_1
            oratory_tech >= 8
        }

        on_completion = {
            custom_tooltip = albania_mission_01_task_19_d_tooltip
            trigger_event = {
                id = me_albania.29
            }
        }
    }

    01_albania_task_20 = { # An Albanian Empire
        icon = "task_atlas"

        requires = {01_albania_task_17 01_albania_task_18}

        final = yes

        prevented_by = {01_albania_task_2}

        allow = {
            legitimacy >= 90
            hidden:p:4799 = {
                owner = root
                has_province_rank = city_metropolis
            }
            political_influence >= 100
            treasury >= 400
            stability >= 65
            civic_tech >= 10
            has_law = royal_bureaucracy
            has_law = public_notaries_law
            has_law = elevate_monarch_monarchy
            has_law = king_of_kings
            invention = tribute_income_modifier_inv_2
            invention = monthly_character_loyalty_inv_3
            invention = omen_duration_inv_4
            invention = citizen_promotion_cost_modifier_inv
        }

        on_completion = {
            change_government = imperium
            change_country_name = ALBANIAN_EMPIRE # a minor formable, if you will
            change_country_flag = GREATEST_ALBANIA_FLAG
            change_country_color = ferrari_orange
		    current_ruler = {
			    force_add_trait = great_builder
			    force_add_trait = founder
			    force_add_trait = intelligent
            }
            add_political_influence = -75
            add_stability = -15
            current_ruler = {
                add_popularity = 25
                add_gold = 250
            }
            add_treasury = 300
            trigger_event = {
                id = me_albania.30
            }
        }
    }

    # SIDE BRANCH 
    01_albania_task_21 = { # A Step on the Road of Trade
        icon = "task_economical"

        allow = {
            treasury >= 100
            political_influence >= 50
            hidden:capital_scope.state = {
                trade_good_surplus = {
                    target = wood
                    value >= 2
                }
            }
        }
        
        on_completion = {
            add_treasury = -100
            add_political_influence = -50
            add_country_modifier = {
                name = albanian_trade
                duration = -1
            }
            p:1646 = { add_road_towards = p:1637 }
            p:1637 = { add_road_towards = p:1635 }
            p:1635 = { add_road_towards = p:1636 }
            p:1635 = { add_road_towards = p:1655 }
            p:1655 = { add_road_towards = p:1651 }
            
            add_innovation = 2
            
            trigger_event = {
                id = me_albania.31
            }
        }
    }

    01_albania_task_22 = { # Hyrcanian Sea Trade
        icon = "task_economical"

        requires = {01_albania_task_21}

        allow = {
            hidden:p:1642 = {
                has_building = basic_settlement_infratructure_building
                has_no_ongoing_construction = yes
            }
            hidden:p:1633 = {
                has_city_status = yes
                num_of_commerce_building >= 2
                has_no_ongoing_construction = yes
            }
        }

        highlight = {
			scope:province = {
				OR = {
					province_id = 1642
					province_id = 1633
				}
			}
		}

        on_completion = {
            p:1633 = {
                add_building_level = foundry_building
                add_building_level = town_hall_building
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = root.culture
                }
                define_pop = {
                    type = citizen
                    religion = religion:zoroaster
                    culture = culture:median
                }
                define_pop = {
                    type = citizen
                    religion = religion:zoroaster
                    culture = culture:bactrian
                }
                define_pop = {
                    type = freemen
                    religion = religion:indo_iranian_religion
                    culture = culture:derbiccan
                }
            }
            p:1651 = { add_road_towards = p:1644 }
            p:1644 = { add_road_towards = p:1647 }
            p:1644 = { add_road_towards = p:1642 }
            p:1642 = { add_road_towards = p:1633 }
            p:1642 = { add_road_towards = p:7603 }

            add_country_modifier = {
                name = albanian_seamanship
                duration = -1
            }

            add_4_free_province_investments = yes

            trigger_event = {
                id = me_albania.32
            }
        }
    }

    01_albania_task_23 = { # A Capital in Khabala
        icon = "task_political"
       
        requires = {01_albania_task_21}

        allow = { 
            hidden:p:1636 = {
                has_building = fortress_building
                has_no_ongoing_construction = yes
            }
            manpower > 6 
            political_influence > 35
        }

        highlight = {
			scope:province = {
				OR = {
					province_id = 1636
				}
			}
		}

        on_completion = {
            add_manpower = -6
            add_political_influence = -35
            add_country_modifier = {
                name = rising_capital
                duration = 1000
            }
            p:1636 = {
                found_city_effect = yes
                define_pop = {
                    type = nobles
                    religion = root.religion
                    culture = root.culture
                }
                define_pop = {
                    type = nobles
                    religion = root.religion
                    culture = root.culture
                }
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = root.culture
                }
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = root.culture
                }
                define_pop = {
                    type = freemen
                    religion = root.religion
                    culture = root.culture
                }
            }
            trigger_event = {
                id = me_albania.33
            }
        }
    }

    01_albania_task_24 = { # Albanian Steeds
        icon = "task_artemis"

        requires = {01_albania_task_23}

        allow = {
            manpower > 3
            hidden:p:1644 = {
                has_building = latifundia_building
                has_no_ongoing_construction = yes
            }
            hidden:p:1651 = {
                has_building = latifundia_building
                has_no_ongoing_construction = yes
            }
            hidden:p:1652 = {
                has_building = latifundia_building
                has_no_ongoing_construction = yes
            }
            hidden:p:1672 = {
                has_building = latifundia_building
                has_no_ongoing_construction = yes
            }
        }

        highlight = {
			scope:province = {
				OR = {
					province_id = 1644
					province_id = 1651
					province_id = 1652
					province_id = 1672
				}
			}
		}

        on_completion = {
            add_manpower = -3
            add_country_modifier = {
                name = albanian_horsemen
                duration = -1
            }
            p:1644 = {
                add_permanent_province_modifier = {
                    name = albanian_stables
                }
            }
            p:1651 = {
                add_permanent_province_modifier = {
                    name = albanian_stables
                }
            }
            p:1652 = {
                add_permanent_province_modifier = {
                    name = albanian_stables
                }
            }
            p:1672 = {
                add_permanent_province_modifier = {
                    name = albanian_stables
                }
            }
            trigger_event = {
                id = me_albania.34
            }
        }
    }

    01_albania_task_25 = { # The Caspians
        icon = "task_diplomatic"

        requires = {01_albania_task_23}

        highlight = {
			scope:province = {
				is_in_area = paytankert_area
			}
		}

        allow = {
            owns_or_subject_owns_area = area:paytankert_area
            custom_tooltip = {
                text = 01_albania_task_25_tt
                OR = {
                    any_country_culture = {
                        is_culture = caspian
                        is_integrated = yes
                        has_country_culture_modifier = patronizing_literature 
                    } 
                    OR = {
                        any_country_culture = {
                            is_culture = caspian
                            OR = {
                                has_pop_type_right = tribesmen
                                has_pop_type_right = slaves
                            }
                        }
                    }
                }
            }
        }

        on_completion = {
            if = {
                limit = {
                    any_country_culture = {
                        is_culture = caspian
                        is_integrated = yes
                    }
                }
                trigger_event = {
                    id = me_albania.36
                    days = 120
                }
            }
            else = {
                trigger_event = {
                    id = me_albania.37
                    days = 120
                }
            }
        }
    }

    01_albania_task_26 = { # Defending the Darband Pass
        icon = "task_expansion"

        requires = {01_albania_task_23}

        allow = {
            manpower > 5
            treasury >= 150
            hidden:p:7603 = {
                has_building = fortress_building
                has_no_ongoing_construction = yes
            }
        }

        highlight = {
			scope:province = {
				OR = {
					province_id = 7603
				}
			}
		}

        on_completion = {
            add_manpower = -5
            add_treasury = -150
            add_country_modifier = {
                name = albanian_fort_defense
                duration = -1
            }
            p:7603 = {
                found_city_effect = yes
                add_permanent_province_modifier = {
                    name = darband_gate
                }
                define_pop = {
                    type = citizen
                    religion = religion:caucasian_religion
                    culture = culture:albanian
                }
                define_pop = {
                    type = freemen
                    religion = religion:caucasian_religion
                    culture = culture:albanian
                }
                define_pop = {
                    type = freemen
                    religion = religion:zoroaster
                    culture = culture:albanian
                }
                define_pop = {
                    type = freemen
                    religion = religion:caucasian_religion
                    culture = culture:legian
                }
                define_pop = {
                    type = freemen
                    religion = religion:caucasian_religion
                    culture = culture:legian
                }
            }
            p:1642 = { add_road_towards = p:7603 }
            p:7603 = { add_road_towards = p:7604 }
            p:7604 = { add_road_towards = p:7621 }

            add_2_free_province_investments = yes

            trigger_event = {
                id = me_albania.35
            }
        }
    }

    01_albania_task_27 = { # A Growing Population
        icon = "task_zeus_cornucopia"

        requires = {01_albania_task_25}

        allow = {
            political_influence > 30
            treasury > 50
            hidden:p:1635 = {
                has_building = basic_settlement_infratructure_building
                has_no_ongoing_construction = yes
            }
            hidden:p:1637 = {
                has_building = basic_settlement_infratructure_building
                has_no_ongoing_construction = yes
            }
            hidden:p:1645 = {
                has_building = basic_settlement_infratructure_building
                has_no_ongoing_construction = yes
            }
            hidden:p:1661 = {
                has_building = basic_settlement_infratructure_building
                has_no_ongoing_construction = yes
            }
            hidden:capital_scope.state = {
                trade_good_surplus = {
                    target = honey
                    value >= 2
                }
            }
        }

        highlight = {
			scope:province = {
				OR = {
					province_id = 1635
					province_id = 1637
					province_id = 1645
					province_id = 1661
				}
			}
		}

        on_completion = {
            add_political_influence = -30
            add_treasury = -50
            add_country_modifier = {
                name = growing_albanians
                duration = 1200
            }
            p:1635 = {
                add_permanent_province_modifier = {
                    name = albanian_farms
                }
            }
            p:1637 = {
                add_permanent_province_modifier = {
                    name = albanian_farms
                }
            }
            p:1645 = {
                add_permanent_province_modifier = {
                    name = albanian_farms
                }
            }
            p:1661 = {
                add_permanent_province_modifier = {
                    name = albanian_farms
                }
            }
            trigger_event = {
                id = me_albania.38
            }
        }
    }

    01_albania_task_28 = { # Trade From the Steppes
        icon = "task_economical"

        requires = {01_albania_task_26}

        allow = {
            stability >= 55
            OR = {
                diplomatic_stance = trading_stance
                diplomatic_stance = neutral_stance
            }
            idea = idea_trading_posts 
            custom_tooltip = {
                text = 01_albania_task_28_tt
                any_country = {
                    count >= 2
                    root = {
                        in_diplomatic_range = PREV
                    }
                    is_subject = no
                    OR = {
                        country_culture_group = scythian_east
                        country_culture_group = scythia
                    }
                    NOR = {
                        THIS = root
                        war_with = root
                    }
                    opinion = {
                        target = root
                        value >= 75
                    }
                }
            }
        }

        on_completion = {
            add_manpower = 4
            add_political_influence = -25
            capital_scope = {
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:alani
                }
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:alani
                }
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:sarmatian
                }
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:sarmatian
                }
            }
            random_owned_province = {
                limit = {
                    NOT = { has_province_rank = city }
                }
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:alani
                }
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:sarmatian
                }
            }
            random_owned_province = {
                limit = {
                    NOT = { has_province_rank = city }
                }
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:alani
                }
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:sarmatian
                }
            }
            random_owned_province = {
                limit = {
                    NOT = { has_province_rank = city }
                }
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:alani
                }
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:sarmatian
                }
            }
            random_owned_province = {
                limit = {
                    NOT = { has_province_rank = city }
                }
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:alani
                }
                define_pop = {
                    type = tribesmen
                    religion = religion:indo_iranian_religion
                    culture = culture:sarmatian
                }
            }
            trigger_event = { 
                id = me_albania.39
            }
        }
    }

    01_albania_task_29 = { # Mystery of the Matiene
        icon = "task_political"

        requires = {01_albania_task_25 01_albania_task_6}

        prevented_by = {01_albania_task_13}

        final = yes

        allow = {
            owns_or_subject_owns_area = media_atropatene_area
            owns_or_subject_owns_area = media_area
            owns_or_subject_owns_area = parskahayk_area
            invention = stability_inv_2
            religious_tech >= 10
        }

        highlight = {
			scope:province = {
				OR = {
					is_in_area = media_atropatene_area
					is_in_area = media_area
					is_in_area = parskahayk_area
				}
			}
		}

        on_completion = {
            custom_tooltip = albania_mission_01_task_29_tooltip
            trigger_event = {
                id = me_albania.40
            }
        }
    }

    # Hidden Tasks

    01_albania_task_30 = { # City of the Lupenii
        icon = "task_political"

        potential = {
            has_variable = lupenian_task_var
		}

        requires = {01_albania_task_3}


        allow = {
            p:1634 = {
                OR = {
                    has_city_status = yes
                    has_province_rank = city_metropolis
                }
                has_building = court_building
                has_building = forum_building
                has_building = library_building
                has_no_ongoing_construction = yes
            }
            invention = global_unrest_inv_2
            invention = oratory_tech_investment_inv_1
        }

        highlight = {
			scope:province = {
				OR = {
					province_id = 1634
				}
			}
		}

        on_completion = { 
            p:1634 = {
                if = {
                    limit = {
                        free_building_slots = 1
                    }
                    add_building_level = academy_building
                }
                else_if = {
                    limit = {
                        free_building_slots > 1
                    }
                    add_building_level = theathre_building
                    add_building_level = academy_building
                }
                define_pop = {
                    type = nobles
                    religion = root.religion
                    culture = root.culture
                }
                define_pop = {
                    type = nobles
                    religion = root.religion
                    culture = root.culture
                }
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = root.culture
                }
                define_pop = {
                    type = citizen
                    religion = root.religion
                    culture = root.culture
                }
            }
            trigger_event = {
                id = me_albania.41
            }
        }
    }
}