carthaginian_rome_expansion_mission = {
    header = "mission_image_carthage"
    icon = "carthage_1"

    repeatable = no

    chance = {
        factor = 5 # Special missions more likely
    }

    potential = {
        NOT = { has_variable = carthaginian_mission_06_rome }
        has_dlc = "The Punic Wars"
    	tag = CAR
    	exists = c:ROM
    	c:ROM = {
    		owns = 1
            OR = {
                rank = major_power
                rank = great_power
            }
    	}
		owns = 3256
        OR = {
            rank = major_power
            rank = great_power
        }
        OR = {
            has_completed_mission = carthaginian_magna_graecia_expansion_mission
            any_neighbour_country = {
                tag = ROM
            }
            any_owned_province = {
                OR = {
                    is_in_area = neapolis_area
                    is_in_area = heraclea_area
                    AND = {
                        is_in_region = central_italy_region
                        NOR = {
                            is_in_area = sardinia_meridionalis
                            is_in_area = sardinia_septentrionalis
                            is_in_area = corsica_area
                        }
                    }
                    is_in_region = cisalpine_gaul_region
                }
            }
        }
        is_subject = no
        has_civil_war = no
    }

    abort = {
        ai_mission_back_out_trigger = yes
    }

    on_start = {
        start_mission_ai_effect = yes
        root = { save_scope_as = mission_country }
        c:ROM = { save_scope_as = rome_country }
        p:3551 = { save_scope_as = taurinorum_province }
        p:3584 = { save_scope_as = verona_province }
        p:146 = { save_scope_as = bononia_province }
        p:3598 = { save_scope_as = altinon_province }
        p:3549 = { save_scope_as = genua_province }
    }

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = carthaginian_mission_06_rome
            days = 7300
        }
    }

    on_completion = {
        complete_mission_effect = yes
    }

    carthaginian_rome_expansion_mission_task_1 = { # Mare Punicum
        icon = "task_expansion"

        allow = {
        	custom_tooltip = {
        		text = carthaginian_rome_expansion_mission_task_1_tt
	        	any_country_sub_unit = {
	        		count >= carthaginian_rome_expansion_mare_punicum_max_svalue
	        		OR = {
	        			sub_unit_type = liburnian
	        			sub_unit_type = trireme
	        			sub_unit_type = tetrere
	        			sub_unit_type = hexere
	        			sub_unit_type = octere
	        			sub_unit_type = mega_galley
	        		}
	        	}
        	}
        }

        on_completion = {
        	add_country_modifier = {
        		name = carthage_mission_rome_naval_supremacy_modifier
        		duration = 3650
        	}
        }
    }

    carthaginian_rome_expansion_mission_task_2 = { # Naval Decisiveness
        icon = "task_conquest"

    	requires = { carthaginian_rome_expansion_mission_task_1 }

        potential = {
            scope:rome_country = {
                any_owned_province = {
                    count >= carthaginian_rome_expansion_naval_decisiviness_max_svalue
                    is_port = yes
                }
            }
        }

        highlight = {
			scope:province = {
				is_port = yes
				owner = scope:rome_country
				NOT = { controller = scope:mission_country }
			}
        }

        allow = {
        	custom_tooltip = {
        		text = carthaginian_rome_expansion_mission_task_2_tt
	        	scope:rome_country = {
	        		any_owned_province = {
	        			count >= carthaginian_rome_expansion_naval_decisiviness_max_svalue
	        			is_port = yes
	        			controller = {
	        				this = root
	        			}
	        		}
	        	}
        	}
        }

        on_completion = {
        	scope:rome_country = {
        		add_country_modifier = {
        			name = carthage_mission_rome_naval_destruction_modifier
        			duration = 3650
        		}
        	}
        }
    }

    carthaginian_rome_expansion_mission_task_3 = { # Roman Inventions
        icon = "task_economical"

    	requires = { carthaginian_rome_expansion_mission_task_2 }

        potential = {
            OR = {
                has_completed_mission_task = carthaginian_rome_expansion_mission_task_2
                scope:rome_country = {
                    any_owned_province = {
                        count >= carthaginian_rome_expansion_naval_decisiviness_max_svalue
                        is_port = yes
                    }
                }
            }
        }

        allow = {
        	treasury >= 100
        }

        on_completion = {
        	add_treasury = -100
        	custom_tooltip = carthaginian_rome_expansion_mission_task_3_tt
        }
    }

    carthaginian_rome_expansion_mission_task_4 = { # Northern Approach
        icon = "task_diplomatic"

    	requires = { carthaginian_rome_expansion_mission_task_13 }

    	prevented_by = { carthaginian_rome_expansion_mission_task_5 }

    	duration = 180

        potential = {
        	OR = {
	        	any_country = {
	    			any_owned_province = {
	    				is_in_region = cisalpine_gaul_region
	    			}
	    			is_tribal = yes
	    			OR = {
	    				is_subject = no
	    				is_subject_of = scope:rome_country
	    			}
	        	}
	        	scope:rome_country = {
	        		any_owned_province = {
	        			is_in_region = cisalpine_gaul_region
	        		}
	        	}
        	}
        }

        highlight = {
			scope:province = {
				is_in_region = cisalpine_gaul_region
				owner = scope:rome_country
			}
        }

        allow = {
        	treasury >= 300
        }

        bypass = {
        	OR = {
                has_completed_mission_task = carthaginian_rome_expansion_mission_task_5
        		NOT = { exists = scope:rome_country }
        		scope:rome_country = {
        			has_land = no
        		}
                has_variable = carthaginian_mission_task_southern_approach
        	}
        }

        on_start = {
        	add_treasury = -300
            set_variable = carthaginian_mission_task_northern_approach
        }

        on_completion = {
        	if = {
        	    limit = {
        			scope:rome_country = {
        				any_owned_province = {
        					is_in_region = cisalpine_gaul_region
        				}
        			}
        	    }
        		scope:rome_country = {
        			every_country_state = {
        				limit = {
        					any_state_province = {
        						is_in_region = cisalpine_gaul_region
        					}
        				}
        				custom = carthaginian_rome_expansion_mission_task_4_rome_modifier
        				add_state_modifier = {
        					name = carthage_mission_cisalpine_gaul_modifier
        					duration = 1825
        				}
        			}
        			trigger_event = {
        				id = me_carthage_rome.1
        			}
        		}
        	}
        	if = {
        	    limit = {
        			any_country = {
        				is_tribal = yes
        				any_owned_province = {
        					is_in_region = cisalpine_gaul_region
        				}
        			}
        	    }
        	    custom_tooltip = carthaginian_rome_expansion_mission_task_4_carthaginian_ally_tt
        	    custom_tooltip = carthaginian_rome_expansion_mission_task_4_gallic_opinion_tt
        	    hidden_effect = {
	        		every_country = {
	        			limit = {
	        				is_tribal = yes
	        				any_owned_province = {
	        					is_in_region = cisalpine_gaul_region
	        				}
	        			}
	        			add_opinion = {
	        				modifier = mission_carthaginian_mission_roman_oppressor_opinion
	        				target = scope:rome_country
	        			}
	        			add_opinion = {
	        				modifier = mission_carthaginian_mission_carthaginian_ally_opinion
	        				target = scope:mission_country
	        			}
	        		}
        		}
        	}
        	if = {
        	    limit = {
        			scope:rome_country = {
        				any_subject = {
        					is_tribal = yes
	        				any_owned_province = {
	        					is_in_region = cisalpine_gaul_region
	        				}
        				}
        			}
        	    }
        		scope:rome_country = {
        			every_subject = {
        				limit = {
        					is_tribal = yes
        					any_owned_province = {
        						is_in_region = cisalpine_gaul_region
        					}
        				}
        				custom = carthaginian_rome_expansion_mission_task_4_disloyal_subject_modifier
        				add_country_modifier = {
        					name = carthage_mission_rome_disloyal_subjects_modifier
        					duration = 1825
        				}
        			}
        		}
        	}
        }
    }

    carthaginian_rome_expansion_mission_task_5 = { # Southern Approach
        icon = "task_diplomatic"

    	requires = { carthaginian_rome_expansion_mission_task_13 }

    	prevented_by = { carthaginian_rome_expansion_mission_task_4 }

    	duration = 180

        potential = {
        	OR = {
	        	any_country = {
	    			any_owned_province = {
	    				is_in_region = magna_graecia_region
	    			}
	    			OR = {
	    				primary_culture = italiotian
	    				primary_culture = syracusan
	    			}
	    			OR = {
	    				is_subject = no
	    				is_subject_of = scope:rome_country
	    			}
	        	}
	        	scope:rome_country = {
	        		any_owned_province = {
	        			is_in_region = magna_graecia_region
	        		}
	        	}
        	}
        }

        highlight = {
			scope:province = {
				is_in_region = magna_graecia_region
				owner = scope:rome_country
			}
        }

        allow = {
        	treasury >= 300
        }

        bypass = {
        	OR = {
                has_completed_mission_task = carthaginian_rome_expansion_mission_task_4
        		NOT = { exists = scope:rome_country }
        		scope:rome_country = {
        			has_land = no
        		}
                has_variable = carthaginian_mission_task_northern_approach
        	}
        }

        on_start = {
        	add_treasury = -300
            set_variable = carthaginian_mission_task_southern_approach
        }

        on_completion = {
        	if = {
        	    limit = {
        			scope:rome_country = {
        				any_owned_province = {
        					is_in_region = magna_graecia_region
        				}
        			}
        	    }
        		scope:rome_country = {
        			every_country_state = {
        				limit = {
        					any_state_province = {
        						is_in_region = magna_graecia_region
        					}
        				}
        				custom = carthaginian_rome_expansion_mission_task_5_rome_modifier
        				add_state_modifier = {
        					name = carthage_mission_magna_graecia_state_modifier
        					duration = 1825
        				}
        			}
        		}
        	}
        	if = {
        	    limit = {
        			any_country = {
        				OR = {
        					primary_culture = italiotian
        					primary_culture = syracusan
        				}
        				any_owned_province = {
        					is_in_region = magna_graecia_region
        				}
        			}
        	    }
        	    custom_tooltip = carthaginian_rome_expansion_mission_task_5_carthaginian_ally_tt
        	    custom_tooltip = carthaginian_rome_expansion_mission_task_5_greek_opinion_tt
        	    hidden_effect = {
	        		every_country = {
	        			limit = {
	        				OR = {
	        					primary_culture = italiotian
	        					primary_culture = syracusan
	        				}
	        				any_owned_province = {
	        					is_in_region = magna_graecia_region
	        				}
	        			}
	        			add_opinion = {
	        				modifier = mission_carthaginian_mission_roman_oppressor_opinion
	        				target = scope:rome_country
	        			}
	        			add_opinion = {
	        				modifier = mission_carthaginian_mission_carthaginian_ally_opinion
	        				target = scope:mission_country
	        			}
	        		}
        		}
        	}
        	if = {
        	    limit = {
        			scope:rome_country = {
        				any_subject = {
        					OR = {
	        					primary_culture = italiotian
	        					primary_culture = syracusan
	        				}
	        				any_owned_province = {
	        					is_in_region = magna_graecia_region
	        				}
        				}
        			}
        	    }
        		scope:rome_country = {
        			every_subject = {
        				limit = {
        					OR = {
	        					primary_culture = italiotian
	        					primary_culture = syracusan
	        				}
        					any_owned_province = {
        						is_in_region = magna_graecia_region
        					}
        				}
        				custom = carthaginian_rome_expansion_mission_task_5_disloyal_subject_modifier
        				add_country_modifier = {
        					name = carthage_mission_rome_disloyal_subjects_modifier
        					duration = 1825
        				}
        			}
        		}
        	}
        }
    }

    carthaginian_rome_expansion_mission_task_6 = { # An End to the Roman Arrogance
        icon = "task_political"

    	requires = {carthaginian_rome_expansion_mission_task_4 carthaginian_rome_expansion_mission_task_5 }

        highlight = {
			scope:province = {
				owner = scope:rome_country
			}
        }

        allow = {
        	war_with = scope:rome_country
        }

        bypass = {
        	OR = {
        		NOT = { exists = scope:rome_country }
        		scope:rome_country = {
        			has_land = no
        		}
        	}
        }

        on_completion = {
        	current_ruler = {
        		add_popularity = popularity_large
        	}
        	add_country_modifier = {
        		name = carthage_mission_rome_rival_modifier
        		duration = 3650
        	}
        }
    }

    carthaginian_rome_expansion_mission_task_7 = { # Freedom to Gaul
        icon = "task_conquest"

    	requires = { carthaginian_rome_expansion_mission_task_4 }

        prevented_by = { carthaginian_rome_expansion_mission_task_5 }

        potential = {
            scope:rome_country = {
                OR = {
                    owns = 3551
                    owns = 3584
                    owns = 146
                    owns = 3598
                    owns = 3549
                }
            }
            NOT = { has_truce_with = scope:rome_country }
        }

        bypass = {
            has_variable = carthaginian_mission_task_southern_approach
        }

        highlight = {
			scope:province = {
				OR = {
					AND = {
						province_id = 3551
						owner = scope:rome_country
					}
					AND = {
						province_id = 3584
						owner = scope:rome_country
					}
					AND = {
						province_id = 146
						owner = scope:rome_country
					}
					AND = {
						province_id = 3598
						owner = scope:rome_country
					}
					AND = {
						province_id = 3549
						owner = scope:rome_country
					}
				}
			}
        }

        allow = {
        	OR = {
        		trigger_if = {
        			limit = {
        				scope:rome_country = { owns = 3551 }
        			}
        			custom_tooltip = {
	        			text = carthaginian_rome_expansion_mission_task_7_augusta_taurionorum_tt
	        			p:3551 = {
                            exists = owner
		        			owner = scope:rome_country
		        			controller = scope:mission_country
		        		}
	        		}
        		}
        		trigger_if = {
        			limit = {
        				scope:rome_country = { owns = 3584 }
        			}
        			custom_tooltip = {
	        			text = carthaginian_rome_expansion_mission_task_7_verona_tt
	        			p:3584 = {
                            exists = owner
		        			owner = scope:rome_country
		        			controller = scope:mission_country
		        		}
	        		}
        		}
        		trigger_if = {
        			limit = {
        				scope:rome_country = { owns = 146 }
        			}
        			custom_tooltip = {
	        			text = carthaginian_rome_expansion_mission_task_7_bononia_tt
	        			p:146 = {
                            exists = owner
		        			owner = scope:rome_country
		        			controller = scope:mission_country
		        		}
	        		}
        		}
        		trigger_if = {
        			limit = {
        				scope:rome_country = { owns = 3598 }
        			}
        			custom_tooltip = {
	        			text = carthaginian_rome_expansion_mission_task_7_altinon_tt
	        			p:3598 = {
                            exists = owner
		        			owner = scope:rome_country
		        			controller = scope:mission_country
		        		}
	        		}
        		}
        		trigger_if = {
        			limit = {
        				scope:rome_country = { owns = 3549 }
        			}
        			custom_tooltip = {
	        			text = carthaginian_rome_expansion_mission_task_7_genua_tt
	        			p:3549 = {
                            exists = owner
		        			owner = scope:rome_country
		        			controller = scope:mission_country
		        		}
	        		}
        		}
        	}
        }

        on_bypass = {
            if = {
                limit = {
                    has_variable = carthaginian_mission_task_southern_approach
                }
                remove_variable = carthaginian_mission_task_southern_approach
            }
        }

        on_completion = {
        	scope:rome_country = {
        		trigger_event = {
					id = me_carthage_rome.3
				}
        	}
        	custom_tooltip = "carthaginian_rome_expansion_mission_task_7_effect_tt"
        	p:3551 = {
        		carthaginian_rome_expansion_mission_task_7_effect = yes
        	}
        	p:3584 = {
        		carthaginian_rome_expansion_mission_task_7_effect = yes
        	}
        	p:146 = {
        		carthaginian_rome_expansion_mission_task_7_effect = yes
        	}
        	p:3598 = {
        		carthaginian_rome_expansion_mission_task_7_effect = yes
        	}
        	p:3549 = {
        		carthaginian_rome_expansion_mission_task_7_effect = yes
        	}
        }
    }

    carthaginian_rome_expansion_mission_task_8 = { # Freedom to Magna Graecia
        icon = "task_conquest"

    	requires = { carthaginian_rome_expansion_mission_task_5 }

        prevented_by = { carthaginian_rome_expansion_mission_task_4 }

        potential = {
            scope:rome_country = {
            	OR = {
            		owns = 56
                    owns = 6
                    owns = 54
                    owns = 78
                    owns = 38
            	}
            }
        }

        bypass = {
            has_variable = carthaginian_mission_task_northern_approach
        }

        highlight = {
			scope:province = {
				OR = {
					AND = {
						province_id = 56
						owner = scope:rome_country
					}
					AND = {
						province_id = 6
						owner = scope:rome_country
					}
					AND = {
						province_id = 54
						owner = scope:rome_country
					}
					AND = {
						province_id = 78
						owner = scope:rome_country
					}
					AND = {
						province_id = 38
						owner = scope:rome_country
					}
				}
            }
        }

        allow = {
        	OR = {
        		trigger_if = {
        			limit = {
        				scope:rome_country = { owns = 56 }
        			}
        			custom_tooltip = {
	        			text = carthaginian_rome_expansion_mission_task_8_tarentum_tt
	        			p:56 = {
                            exists = owner
		        			owner = scope:rome_country
		        			controller = scope:mission_country
		        		}
	        		}
        		}
        		trigger_if = {
        			limit = {
        				scope:rome_country = { owns = 6 }
        			}
        			custom_tooltip = {
	        			text = carthaginian_rome_expansion_mission_task_8_capua_tt
	        			p:6 = {
                            exists = owner
		        			owner = scope:rome_country
		        			controller = scope:mission_country
		        		}
	        		}
        		}
        		trigger_if = {
        			limit = {
        				scope:rome_country = { owns = 54 }
        			}
        			custom_tooltip = {
	        			text = carthaginian_rome_expansion_mission_task_8_heraclea_tt
	        			p:54 = {
                            exists = owner
		        			owner = scope:rome_country
		        			controller = scope:mission_country
		        		}
	        		}
        		}
        		trigger_if = {
        			limit = {
        				scope:rome_country = { owns = 78 }
        			}
        			custom_tooltip = {
	        			text = carthaginian_rome_expansion_mission_task_8_croton_tt
	        			p:78 = {
                            exists = owner
		        			owner = scope:rome_country
		        			controller = scope:mission_country
		        		}
	        		}
        		}
        		trigger_if = {
        			limit = {
        				scope:rome_country = { owns = 38 }
        			}
        			custom_tooltip = {
	        			text = carthaginian_rome_expansion_mission_task_8_sipontum_tt
	        			p:38 = {
                            exists = owner
		        			owner = scope:rome_country
		        			controller = scope:mission_country
		        		}
	        		}
        		}
        	}
        }

        on_bypass = {
            if = {
                limit = {
                    has_variable = carthaginian_mission_task_northern_approach
                }
                remove_variable = carthaginian_mission_task_northern_approach
            }
        }

        on_completion = {
        	custom_tooltip = "carthaginian_rome_expansion_mission_task_8_effect_tt"
            scope:rome_country = {
                trigger_event = {
                    id = me_carthage_rome.4
                }
            }
        	p:56 = {
        		carthaginian_rome_expansion_mission_task_8_effect = yes
        	}
        	p:6 = {
        		carthaginian_rome_expansion_mission_task_8_effect = yes
        	}
        	p:54 = {
        		carthaginian_rome_expansion_mission_task_8_effect = yes
        	}
        	p:78 = {
        		carthaginian_rome_expansion_mission_task_8_effect = yes
        	}
        	p:38 = {
        		carthaginian_rome_expansion_mission_task_8_effect = yes
        	}
        }
    }

    carthaginian_rome_expansion_mission_task_9 = { # Roman Marble
        icon = "task_conquest"

    	requires = { carthaginian_rome_expansion_mission_task_6 }

    	prevented_by = { carthaginian_rome_expansion_mission_task_10 }

        allow = {
        	OR = {
                custom_tooltip = {
                    text = carthaginian_rome_expansion_mission_task_9_trigger_tt
                    scope:rome_country = {
                        any_owned_province = {
                            count >= carthaginian_rome_expansion_roman_marble_occupation_max_svalue
                            controller = scope:mission_country
                        }
                    }
                }
                custom_tooltip = {
                    text = carthaginian_rome_expansion_mission_task_9_trigger_tt_2
    	        	any_owned_province = {
    	        		count >= carthaginian_rome_expansion_roman_marble_pops_max_svalue
    	        		dominant_province_culture = roman
    	        	}
                }
        	}
        }

        bypass = {
        	OR = {
                has_completed_mission_task = carthaginian_rome_expansion_mission_task_10
        		NOT = { exists = scope:rome_country }
        		scope:rome_country = {
        			has_land = no
        		}
        	}
        }

        on_completion = {
        	add_country_modifier = {
        		name = carthage_mission_roman_building_materials_modifier
        		duration = 3650
        	}
        	capital_scope = {
        		add_permanent_province_modifier = {
        			name = carthage_mission_roman_ingenuity_modifier
        			duration = -1
        		}
        	}
        }
    }

    carthaginian_rome_expansion_mission_task_10 = { # Roman Blood
        icon = "task_expansion"

    	requires = { carthaginian_rome_expansion_mission_task_6 }

    	prevented_by = { carthaginian_rome_expansion_mission_task_9 }

        allow = {
            custom_tooltip = {
                text = carthaginian_rome_expansion_mission_task_10_trigger_tt
                capital_scope = {
                    any_pops_in_province = {
                        count >= carthaginian_rome_expansion_roman_blood_max_svalue
                        pop_culture = roman
                        pop_type = slaves
                    }
                }
            }
        }

        bypass = {
        	OR = {
                has_completed_mission_task = carthaginian_rome_expansion_mission_task_9
        		NOT = { exists = scope:rome_country }
        		scope:rome_country = {
        			has_land = no
        		}
        	}
        }

        on_completion = {
        	add_country_modifier = {
        		name = carthage_mission_roman_slaves_modifier
        		duration = 3650
        	}
        }
    }

    carthaginian_rome_expansion_mission_task_11 = { # The Eternal City
        icon = "task_conquest"

    	requires = { carthaginian_rome_expansion_mission_task_9 carthaginian_rome_expansion_mission_task_10 }

        highlight = {
			scope:province = {
				OR = {
                    province_id = 1
                    AND = {
                        OR = {
                            is_in_region = central_italy_region
                            is_in_region = magna_graecia_region
                        }
                        has_owner = yes
                        owner = scope:rome_country
                    }
                }
			}
        }

        allow = {
        	owns = 1
			hidden:scope:rome_country = {
				OR = {
					is_subject_of = scope:mission_country
					custom_tooltip = {
                        text = carthaginian_rome_expansion_mission_task_11_tt
                        region:magna_graecia_region = {
                            NOT = {
                                any_region_province = { owner = scope:rome_country }
                            }
                        }
                        region:central_italy_region = {
                            NOT = {
                                any_region_province = { owner = scope:rome_country }
                            }
                        }
                    }
				}
			}
        }

        on_completion = {
            add_2_free_province_investments = yes
        }
    }

    carthaginian_rome_expansion_mission_task_12 = { # Carthaginian Ostia
        icon = "task_economical"

    	requires = { carthaginian_rome_expansion_mission_task_11 }

        highlight = {
			scope:province = {
				province_id = 15
			}
        }

        allow = {
        	owns = 15
        	p:15.state = {
        		incoming_trade_routes >= 5
        	}
        }

        on_completion = {
        	p:15 = {
        		add_province_modifier = {
	        		name = punic_mission_ostia_integrated_modifier
	        		duration = 7300
	        	}
        	}
        }
    }

    carthaginian_rome_expansion_mission_task_13 = { # Duel of the West
        icon = "task_political"

    	duration = 180

        highlight = {
			scope:province = {
				province_id = 1
			}
        }

    	on_start = {
    		scope:rome_country = {
    			add_opinion = {
    				modifier = mission_carthaginian_roman_competitor_opinion
    				target = root
    			}
    		}
    	}

        on_completion = {
        	p:1 = {
        		add_claim = root
        	}
        	if = {
        		limit = {
        			is_republic = yes
        		}
        		custom_tooltip = carthaginian_rome_expansion_mission_task_13_tt
        	}
        }
    }

    carthaginian_rome_expansion_mission_task_final = { # Salt and Burn
        icon = "task_conquest"

    	requires = { carthaginian_rome_expansion_mission_task_11 }

        prevented_by = { carthaginian_rome_expansion_mission_task_final_2 carthaginian_rome_expansion_mission_task_final_3 }

    	final = yes

        highlight = {
			scope:province = {
				is_in_area = roma_area
			}
        }

    	allow = {
    		trigger_if = {
    			limit = {
    				NOT = { owns_area = roma_area }
    			}
    			owns_area = roma_area
    		}
    	}

    	on_completion = {
    		custom_tooltip = carthaginian_rome_expansion_mission_task_final_slaves_tt
    		trigger_event = {
    			id = me_carthage_rome.5
    		}
    		hidden_effect = {
	    		p:1 = {
		    		while = {
		    			count = carthaginian_rome_mission_salt_and_burn_calculation_svalue
		    			root = {
		    				random_owned_province = {
		    					limit = {
		    						total_population < population_cap
		    						NOT = { province_id = 1 }
                                    OR = {
                                        is_in_region = central_italy_region
                                        is_in_region = magna_graecia_region
                                        is_in_region = cisalpine_gaul_region
                                    }
		    					}
		    					weight = {
		    						modifier = {
		    							factor = 2
		    							is_capital = yes
		    						}
		    						modifier = {
		    							factor = 2 
		    							is_state_capital = yes
		    						}
		    						modifier = {
		    							factor = 2
		    							has_province_rank = city_metropolis
		    						}
                                    modifier = {
                                        factor = 5
                                        is_in_area = roma_area
                                    }
                                    modifier = {
                                        factor = 2
                                        is_in_region = central_italy_region
                                    }
                                    modifier = {
                                        factor = 0.2
                                        OR = {
                                            is_in_area = sardinia_meridionalis
                                            is_in_area = sardinia_septentrionalis
                                            is_in_area = corsica_area
                                        }
                                    }
		    					}
		    					save_scope_as = slave_destination
		    				}
		    			}
		    			random_pops_in_province = {
		    				move_pop = scope:slave_destination
		    			}
		    		}
	    		}
    		}
    		if = {
    			limit = {
    				p:1 = {
    					has_city_status = yes
    				}
    			}
    			p:1 = {
    				set_city_status = settlement
    			}
    		}
    		p:1 = {
    			if = {
	    			limit = {
	    				is_state_capital = yes
	    				root = {
	    					any_owned_province = {
	    						is_in_area = roma_area
	    						NOT = { province_id = 1 }
	    					}
	    				}
	    			}
	    			root = {
	    				ordered_owned_province = {
	    					order_by = total_population
	    					limit = {
	    						is_in_area = roma_area
	    						NOT = { province_id = 1 }
	    					}
	    					max = 1
	    					save_scope_as = new_state_capital_latium
	    				}
	    			}
	    			state = {
	    				set_state_capital = scope:new_state_capital_latium
	    			}
	    		}
    		}
    	}
    }

    carthaginian_rome_expansion_mission_task_final_2 = { # Carthaginian Latium
        icon = "task_economical"

    	requires = { carthaginian_rome_expansion_mission_task_11 }

        prevented_by = { carthaginian_rome_expansion_mission_task_final carthaginian_rome_expansion_mission_task_final_3 }

    	final = yes

        highlight = {
			scope:province = {
				is_in_area = roma_area
			}
        }

    	allow = {
    		trigger_if = {
    			limit = {
                    NOT = { owns_area = roma_area }
    			}
    			owns_area = roma_area
    		}
    	}

    	on_completion = {
    		trigger_event = {
    			id = me_carthage_rome.7
    		}
    		random_country_state = {
    			limit = {
    				any_state_province = { is_in_area = roma_area }
    			}
    			ordered_state_province = {
    				order_by = total_population
    				limit = {

    				}
    				max = 2
    				custom_tooltip = "carthaginian_rome_expansion_mission_task_final_2_assimilation_tt"
    				hidden_effect = {
	    				ordered_pops_in_province = {
	    					order_by = pop_hapiness
	    					limit = {
	    						NOT = { pop_culture = carthaginian }
	    					}
	    					max = {
	    						value = total_population
	    						multiply = 0.2
	    					}
	    					set_pop_culture = carthaginian
	    				}
    				}
    			}
    			add_state_modifier = {
    				name = carthage_mission_punic_latium_modifier
    				duration = 10950
    			}
    		}
    	}
    }

    carthaginian_rome_expansion_mission_task_final_3 = { # Roman Subjugation
        icon = "task_political"

    	requires = { carthaginian_rome_expansion_mission_task_11 }

    	prevented_by = { carthaginian_rome_expansion_mission_task_final carthaginian_rome_expansion_mission_task_final_2 }

    	final = yes

        highlight = {
			scope:province = {
				province_id = 1
			}
        }

    	allow = {
    		trigger_if = {
    			limit = {
    				NOT = { owns = 1 }
    			}
    			owns = 1
    		}
    	}

    	on_completion = {
    		custom_tooltip = carthaginian_rome_expansion_mission_task_final_3_tt
    		hidden_effect = {
    			p:1 = {
    				if = {
    					limit = {
    						total_population > 20
    					}
						while = {
			    			count = carthaginian_rome_mission_enslave_parts_of_rome_svalue
			    			root = {
			    				random_owned_province = {
			    					limit = {
			    						total_population < population_cap
			    						NOT = { province_id = 1 }
			    					}
			    					weight = {
			    						modifier = {
			    							factor = 2
			    							is_capital = yes
			    						}
			    						modifier = {
			    							factor = 2 
			    							is_state_capital = yes
			    						}
			    						modifier = {
			    							factor = 2
			    							has_province_rank = city_metropolis
			    						}
			    					}
			    					save_scope_as = slave_destination
			    				}
			    			}
			    			random_pops_in_province = {
			    				if = {
			    					limit = {
			    						NOT = { pop_type = slaves }
			    					}
			    					set_pop_type = slaves
			    				}
			    				move_pop = scope:slave_destination
			    			}
			    		}
    				}
	    		}
	    		if = {
	    			limit = {
	    				owns = 16
	    			}
	    			p:16  = {
	    				if = {
		    				limit = {
		    					total_population > 10
		    				}
							while = {
				    			count = carthaginian_rome_mission_enslave_parts_of_vei_svalue
				    			limit = {
				    				root = {
					    				any_owned_province = {
					    					NOR = {
					    						province_id = 1
					    						province_id = 2
					    						province_id = 16
					    					}
					    					total_population < population_cap
					    				}
				    				}
				    			}
				    			root = {
				    				random_owned_province = {
				    					limit = {
				    						NOR = {
					    						province_id = 1
					    						province_id = 2
					    						province_id = 16
					    					}
					    					total_population < population_cap
				    					}
				    					weight = {
				    						modifier = {
				    							factor = 2
				    							is_capital = yes
				    						}
				    						modifier = {
				    							factor = 2 
				    							is_state_capital = yes
				    						}
				    						modifier = {
				    							factor = 2
				    							has_province_rank = city_metropolis
				    						}
				    					}
				    					save_scope_as = slave_destination
				    				}
				    			}
				    			random_pops_in_province = {
				    				if = {
				    					limit = {
				    						NOT = { pop_type = slaves }
				    					}
				    					set_pop_type = slaves
				    				}
				    				move_pop = scope:slave_destination
				    			}
				    		}
		    			}
		    			if = {
		    				limit = {
		    					has_city_status = yes
		    				}
		    				set_city_status = settlement 
		    			}
		    			set_trade_goods = grain
	    			}
	    		}
	    		if = {
	    			limit = {
	    				owns = 2
	    			}
	    			p:2  = {
	    				if = {
		    				limit = {
		    					total_population > 10
		    				}
							while = {
				    			count = carthaginian_rome_mission_enslave_parts_of_vei_svalue
				    			limit = {
				    				root = {
					    				any_owned_province = {
					    					NOR = {
					    						province_id = 1
					    						province_id = 2
					    						province_id = 16
					    					}
					    					total_population < population_cap
					    				}
				    				}
				    			}
				    			root = {
				    				random_owned_province = {
				    					limit = {
				    						NOR = {
					    						province_id = 1
					    						province_id = 2
					    						province_id = 16
					    					}
					    					total_population < population_cap
				    					}
				    					weight = {
				    						modifier = {
				    							factor = 2
				    							is_capital = yes
				    						}
				    						modifier = {
				    							factor = 2 
				    							is_state_capital = yes
				    						}
				    						modifier = {
				    							factor = 2
				    							has_province_rank = city_metropolis
				    						}
				    					}
				    					save_scope_as = slave_destination
				    				}
				    			}
				    			random_pops_in_province = {
				    				if = {
				    					limit = {
				    						NOT = { pop_type = slaves }
				    					}
				    					set_pop_type = slaves
				    				}
				    				move_pop = scope:slave_destination
				    			}
				    		}
		    			}
		    			if = {
		    				limit = {
		    					has_city_status = yes
		    				}
		    				set_city_status = settlement 
		    			}
	    			}
	    		}
	        	if = {
	        		limit = {
	        			any_subject = {
	        				is_ai = no
	        				tag = ROM		
	        			}
	        		}
	        		random_subject = {
	        			limit = {
	        				is_ai = no
	        				tag = ROM
	        			}
	        			save_scope_as = rome_scope
	        			change_country_flag = ROME_SUBJECT_FLAG
	        		}
	        	}
	        	else = {
					p:1 = {
						create_country = {
							name = {
								name = "ROME_NAME"
								adjective = "ROME_ADJECTIVE"
							}
							save_scope_as = rome_scope
							change_country_tag = ROM
							change_country_flag = ROME_SUBJECT_FLAG
							change_country_color = ocean_blue
							set_primary_culture = roman
							set_country_religion = roman_pantheon
							set_country_heritage = roman_heritage
							change_government = oligarchic_republic
							add_treasury = 50.0
						}
					}
				}
				every_owned_province = {
					limit = {
						OR = {
							province_id = 1
							province_id = 2
							province_id = 16
						}
					}
					set_conquered_by = scope:rome_scope
				}
				every_subject = {
					limit = {
						is_ai = yes
						any_owned_province = {
							count = all
							OR = {
								province_id = 1
								province_id = 2
								province_id = 16
							}
						}
					}
					every_unit = {
						limit = {
							has_commander = no
						}
						save_temporary_scope_as = current_unit
						root = {
							random_character = {
								limit = {
									char_is_unoccupied_trigger = yes
								}
								scope:current_unit = {
									set_as_commander = PREV
								}
							}
						}
					}
					every_unit = {
						limit = {
							has_commander = yes
						}
						commander = {
							move_country = scope:rome_scope
						}
					}
					every_owned_province = {
						limit = {
							OR = {
								province_id = 1
								province_id = 2
								province_id = 16
							}
						}
						set_owned_by = scope:rome_scope
					}
				}
				if = {
					limit = {
						NOT = { is_subject_of = root }
					}
					make_subject = { # Make Client State of Carthage
						target = scope:rome_scope
						type = feudatory
					}
				}
			}
			scope:rome_scope = {
				add_country_modifier = {
					name = carthage_mission_broken_roman_spirit_modifier
					duration = -1
				}
			}
			trigger_event = {
    			id = me_carthage_rome.6
    		}
    	}
    }
}