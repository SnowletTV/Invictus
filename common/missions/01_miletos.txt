miletos_mission = { # Mission for Miletos
	icon = cde_indo_greek_port_city
	header = mission_image_syracuse
	
	repeatable = no

    chance = {
		factor = 10
	}
	
	ai_chance = { factor = 10 }

	potential = { 
		tag = MLO
		# has_completed_mission = ionian_resurgence # enable for release
		NOT = {
			has_variable = miletos_mission_cooldown
		}
	}
	
	abort = {
        ai_mission_back_out_trigger = yes
    }

    on_start = {
    	start_mission_ai_effect = yes
		p:1734 = {
			add_to_list = miletos_colonies_list
		}
		p:255 = {
			add_to_list = miletos_colonies_list
		}
		p:252 = {
			add_to_list = miletos_colonies_list
		}
		p:220 = {
			add_to_list = miletos_colonies_list
		}
		p:310 = {
			add_to_list = miletos_colonies_list
		}
		p:261 = {
			add_to_list = miletos_colonies_list
		}
		p:256 = {
			add_to_list = miletos_colonies_list
		}
		p:245 = {
			add_to_list = miletos_colonies_list
		}
		p:1798 = {
			add_to_list = miletos_colonies_list
		}
		p:1795 = {
			add_to_list = miletos_colonies_list
		}
		p:350 = {
			add_to_list = miletos_colonies_list
		}
		p:209 = {
			add_to_list = miletos_colonies_list
		}
		p:208 = {
			add_to_list = miletos_colonies_list
		}
		p:206 = {
			add_to_list = miletos_colonies_list
		}
		# p:207 = { # HCP founded by Megara, not Miletos
		# 	add_to_list = miletos_colonies_list
		# }
		p:1720 = {
			add_to_list = miletos_colonies_list
		}
		p:7908 = {
			add_to_list = miletos_colonies_list
		}
		p:1741 = {
			add_to_list = miletos_colonies_list
		}
		p:4549 = {
			add_to_list = miletos_colonies_list
		}
		p:4563 = {
			add_to_list = miletos_colonies_list
		}
		p:4565 = {
			add_to_list = miletos_colonies_list
		}
		p:4538 = {
			add_to_list = miletos_colonies_list
		}
		p:4529 = {
			add_to_list = miletos_colonies_list
		}
		p:4525 = {
			add_to_list = miletos_colonies_list
		}
		p:4513 = {
			add_to_list = miletos_colonies_list
		}
		p:4255 = {
			add_to_list = miletos_colonies_list
		}
		p:4248 = {
			add_to_list = miletos_colonies_list
		}
		p:1743 = {
			add_to_list = miletos_colonies_list
		}
		p:1807 = {
			add_to_list = miletos_colonies_list
		}
		p:1812 = {
			add_to_list = miletos_colonies_list
		}
		p:4544 = {
			add_to_list = miletos_colonies_list
		}
		p:4557 = {
			add_to_list = miletos_colonies_list
		}
		p:482 = {
			add_to_list = miletos_colonies_list
		}
		p:480 = {
			add_to_list = miletos_colonies_list
		}
		p:4562 = {
			add_to_list = miletos_colonies_list
		}
    }

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = miletos_mission_cooldown
            days = 7300
        }
    }

    on_completion = {
    	complete_mission_effect = yes
		add_2_free_province_investments = yes
    }

	miletos_task_1 = {
		icon = "task_diplomatic"

		duration = 42 # bcs why not

		on_completion = {
			trigger_event = miletos_event.1
			custom_tooltip = miletos_path_choice_tt
			custom_tooltip = miletos_claims_tt
		}
	}

	miletos_task_2 = {
		icon = "task_diplomatic"

		allow = {
			owns = 350
			owns = 1453
		}

		highlight = {
			scope:province = {
				is_in_list = miletos_colonies_list
				OR = {
					is_in_area = europa_area
					is_in_area = bithynia_inferior_area
				}
			}
		}

		requires = { miletos_task_12 }

		on_completion = {
			trigger_event = miletos_event.4
			show_as_tooltip = {
				every_in_list = { 
					list = miletos_colonies_list
					limit = {
						OR = {
							is_in_area = europa_area
							is_in_area = bithynia_inferior_area
						}
						NOT = {
							has_province_modifier = miletos_positive_pmod
						}
					}
					save_scope_as = mil_colony_scope
					miletos_mission_reward_effect = {
						PROVINCE = mil_colony_scope
					}
				}
			}
			custom_tooltip = miletos_bosphorus_tt
		}
	}

	miletos_task_3 = {
		icon = "task_diplomatic"

		allow = {
			custom_tooltip = {
				text = miletos_pontus_own_tt
				pontus_asia_region_coast_svalue >= pontus_region_coast_svalue
			}
		}

		highlight = {
			scope:province = {
				is_in_list = miletos_colonies_list
				OR = {
					is_in_region = bithynia_region
					is_in_region = cappadocia_pontica_region
				}
				NOT = {
					province_id = 245
				}
			}
		}

		requires = { miletos_task_2 }

		on_completion = {
			trigger_event = miletos_event.5
			show_as_tooltip = {
				if = {
					limit = {
						has_variable = miletos_feudatory_path_var
					}
					custom_tooltip = miletos_pontus_feud_tt
				}
				else = {
					custom_tooltip = miletos_pontus_tt
					p:1812 = {
						save_scope_as = miletos_showcase_scope
						miletos_mission_reward_effect = {
							PROVINCE = miletos_showcase_scope
						}
					}
				}
				random_owned_province = {
					limit = {
						is_port = yes
					}
					owner = {
						create_unit = {
							navy = yes
							location = prev.prev
							add_subunit = octere
							add_subunit = hexere
							add_subunit = hexere
							add_subunit = trireme
							add_subunit = trireme
							add_subunit = trireme
							add_subunit = trireme
							add_subunit = liburnian
							add_subunit = liburnian
						}
					}
				}
			}
		}
	}

	miletos_task_4 = {
		icon = "task_diplomatic"

		allow = {
			owns = 1741
			owns = 1720
			owns = 1743
		}

		highlight = {
			scope:province = {
				is_in_list = miletos_colonies_list
				OR = {
					is_in_region = colchis_region
				}
			}
		}

		requires = { miletos_task_3 }

		on_completion = {
			trigger_event = miletos_event.6
			show_as_tooltip = {
				every_in_list = { 
					list = miletos_colonies_list
					limit = {
						OR = {
							is_in_region = colchis_region
						}
						NOT = {
							has_province_modifier = miletos_positive_pmod
						}
					}
					save_scope_as = mil_colony_scope
					miletos_mission_reward_effect = {
						PROVINCE = mil_colony_scope
					}
				}
			}
			hidden_effect = {
				treasure:treasure_golden_fleece_strand = {
					save_scope_as = fleece_treasure_scope
				}
			}
			custom_tooltip = miletos_golden_fleece_tt
		}
	}

	miletos_task_5 = {
		icon = "task_diplomatic"

		allow = {
			owns = 482
			owns = 4248
			owns = 480
			owns = 4513
			owns = 4255
		}

		highlight = {
			scope:province = {
				is_in_list = miletos_colonies_list
				OR = {
					is_in_region = thrace_region
					is_in_region = moesia_region
				}
				NOT = {
					province_id = 350
				}
			}
		}

		requires = { miletos_task_2 }

		on_completion = {
			trigger_event = miletos_event.8
			show_as_tooltip = {
				if = {
					limit = {
						has_variable = miletos_feudatory_path_var
					}
					custom_tooltip = miletos_thrace_feud_tt
				}
				else = {
					custom_tooltip = miletos_thrace_tt
					p:480 = {
						save_scope_as = miletos_showcase_scope
						miletos_mission_reward_effect = {
							PROVINCE = miletos_showcase_scope
						}
					}
				}
			}	
			custom_tooltip = miletos_thrace_extra_tt
		}
	}

	miletos_task_6 = { 
		icon = "task_diplomatic"

		duration = 30

		allow = {
			political_influence >= 25
			treasury >= 25
		}

		highlight = {
			scope:province = {
				province_id = 417
			}
		}

		requires = { miletos_task_16 }

		on_completion = {
			trigger_event = miletos_event.10
			show_as_tooltip = {
				add_political_influence = -25
				add_treasury = -25
				p:417 = {
					add_claim = root
				}
				random_owned_province = {
					limit = {
						is_port = yes
					}
					owner = {
						create_unit = {
							navy = yes
							location = prev.prev
							add_subunit = octere
							add_subunit = octere
							add_subunit = hexere
							add_subunit = hexere
							add_subunit = hexere
							add_subunit = trireme
							add_subunit = trireme
							add_subunit = trireme
							add_subunit = trireme
							add_subunit = liburnian
							add_subunit = liburnian
							add_subunit = liburnian
							add_subunit = liburnian
							add_subunit = liburnian
						}
					}
				}
			}
		}
	}

	miletos_task_7 = { 
		icon = "task_diplomatic"

		allow = {
			owns = 417
			hidden:p:417 = {
				has_building = fortress_building
				has_building = military_building
			}
		}

		requires = { miletos_task_6 }

		highlight = {
			scope:province = {
				province_id = 417
			}
		}

		on_completion = {
			trigger_event = miletos_event.11
			show_as_tooltip = {
				p:417 = {
					add_province_modifier = {
						name = megara_beachhead
						duration = 3650
					}
				}
				mission_claim_area_effect = { AREA = central_greece_area }
				mission_claim_area_effect = { AREA = boeotia_area }
				mission_claim_area_effect = { AREA = achaea_area }
				mission_claim_area_effect = { AREA = arcadia_area }
			}
		}
	}

	miletos_task_8 = { 
		icon = "task_diplomatic"

		allow = {
			owns = 416
			owns = 426
			owns = 418
			owns = 440
		}

		highlight = {
			scope:province = {
				OR = {
					province_id = 416
					province_id = 426
					province_id = 418
					province_id = 440
				}
			}
		}

		requires = { miletos_task_7 }

		on_completion = {
			trigger_event = miletos_event.12
			show_as_tooltip = {
				mission_claim_region_effect = { REGION = greece_region }
			}
			custom_tooltip = miletos_attica_extra_tt
		}
	}

	miletos_task_9 = { 
		icon = "task_diplomatic"

		allow = {}

		requires = { miletos_task_1 }

		on_completion = {}
	}

	miletos_task_10 = { 
		icon = "task_diplomatic"

		allow = {}

		requires = { miletos_task_9 }

		on_completion = {}
	}

	miletos_task_11 = { 
		icon = "task_diplomatic"

		allow = {}

		requires = { miletos_task_10 }

		on_completion = {}
	}

	miletos_task_12 = { 
		icon = "task_diplomatic"

		allow = {
			custom_tooltip = {
				text = miletos_own_asian_coast_tt
				owned_asia_region_coast_svalue >= asia_region_coast_svalue
			}
		}

		highlight = {
			scope:province = {
				is_in_region = asia_region
				is_coastal = yes
			}
		}

		requires = { miletos_task_1 }

		on_completion = {
			trigger_event = miletos_event.2
			show_as_tooltip = {
				add_treasury = 300
				add_aggressive_expansion = -10
				p:252 = {
					save_scope_as = miletos_showcase_scope
					miletos_mission_reward_effect = {
						PROVINCE = miletos_showcase_scope
					}
				}
			}
			custom_tooltip = miletos_asia_tt
		}
	}

	miletos_task_13 = { 
		icon = "task_diplomatic"

		allow = {
			owns_region = asia_region
		}

		highlight = {
			scope:province = {
				is_in_region = asia_region
				NOT = {
					owner = root
				}
			}
		}

		requires = { miletos_task_12 }

		on_completion = {
			trigger_event = miletos_event.3
			custom_tooltip = militos_asia_tt
		}
	}

	miletos_task_14 = { 
		icon = "task_diplomatic"

		allow = {
			owns = 4525
			owns = 4529
		}

		highlight = {
			scope:province = {
				is_in_list = miletos_colonies_list
				OR = {
					is_in_region = scythia_region
				}
			}
		}

		requires = { miletos_task_5 }

		on_completion = {
			trigger_event = miletos_event.7
			show_as_tooltip = {
				every_in_list = { 
					list = miletos_colonies_list
					limit = {
						OR = {
							is_in_region = scythia_region
						}
						NOT = {
							has_province_modifier = miletos_positive_pmod
						}
					}
					save_scope_as = mil_colony_scope
					miletos_mission_reward_effect = {
						PROVINCE = mil_colony_scope
					}
				}
			}
			custom_tooltip = miletos_scythia_extra_tt
		}
	}

	miletos_task_15 = { 
		icon = "task_diplomatic"

		final = yes

		allow = {
			custom_tooltip = {
				text = miletos_taurica_allow_tt
				owned_taurica_region_svalue >= taurica_region_svalue
			}
		}

		highlight = {
			scope:province = {
				is_in_list = miletos_colonies_list
				OR = {
					is_in_region = taurica_region
				}
			}
		}

		requires = { miletos_task_4 miletos_task_14 }

		on_completion = {
			trigger_event = miletos_event.9
			show_as_tooltip = {
				if = {
					limit = {
						has_variable = miletos_feudatory_path_var
					}
					custom_tooltip = miletos_taurica_feud_tt
				}
				else = {
					custom_tooltip = miletos_taurica_tt
					p:4549 = {
						save_scope_as = miletos_showcase_scope
						miletos_mission_reward_effect = {
							PROVINCE = miletos_showcase_scope
						}
					}
				}
				add_country_modifier = {
					name = dominion_over_the_pontos_euxinos
					duration = -1
				}
			}
		}
	}

	miletos_task_16 = { 
		icon = "task_diplomatic"

		allow = {
			owns_or_subject_owns_area = aegean_islands_area
		}

		highlight = {
			scope:province = {
				OR = {
					is_in_area = aegean_islands_area
				}
			}
		}

		requires = { miletos_task_1 }

		on_completion = {
			trigger_event = miletos_event.13
			show_as_tooltip = {
				# capital_scope = { # make a task for capital
				# 	state = {
				# 		add_state_modifier = {
				# 			name = trading_hub_smod
				# 			duration = -1
				# 		}
				# 	}
				# }
				p:263 = {
					state = {
						add_state_modifier = {
							name = trading_hub_smod
							duration = -1
						}
					}
				}
			}
		}
	}
}
