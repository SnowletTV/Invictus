01_sparta_missions_02_peloponnesus = {
    header = "mission_image_sparta"
    icon = "sparta_4"

    repeatable = no

    chance = {
    	factor = 5
    }

    potential = {
    	NOT = { has_variable = spartan_mission_02_peloponnesus }
    	OR = {
            tag = SPA
            has_variable = spa_unique_mech
        }
    	has_dlc = "Magna Graecia"
    	has_completed_mission = spartan_mission_01_laconia
        NOT = { has_completed_mission = spartan_mission_03_peloponnesian_league }
        is_subject = no
        has_civil_war = no
    }

    abort = {
        ai_mission_back_out_trigger = yes
    }

    on_start = {
        start_mission_ai_effect = yes
        save_scope_as = mission_country_scope
    	if = {
    		limit = {
    			NOT = { owns_or_subject_owns = 439 }
    		}
    		set_variable = olympia_unowned
    	}
    	if = {
    		limit = {
    			NOT = { owns_or_subject_owns = 440 }
    		}
    		set_variable = argos_unowned
    	}
    	if = {
    		limit = {
    			OR = {
    				NOT = { owns_or_subject_owns = 435 }
    				NOT = { owns_or_subject_owns = 436 }
    				NOT = { owns_or_subject_owns = 438 }
    				NOT = { owns_or_subject_owns = 448 }
    				NOT = { owns_or_subject_owns = 449 }
    				NOT = { owns_or_subject_owns = 7891 }
    			}
    		}
    		set_variable = arcadia_unowned
    	}
    	if = {
    		limit = {
    			OR = {
    				NOT = { owns_or_subject_owns = 434 }
		        	NOT = { owns_or_subject_owns = 444 }
		        	NOT = { owns_or_subject_owns = 7890 }
		        	NOT = { owns_or_subject_owns = 7893 }
    			}
    		}
    		set_variable = achaea_unowned
    	}
        if = {
            limit = {
                p:418 = {
                    NOT = { has_province_modifier = sparta_mission_peloponnesus_corinth_expanded_acropolis_modifier }
                }
            }
            set_variable = sparta_mission_02_corinth_expandable
        }
    }

    on_abort = {
    	custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = spartan_mission_02_peloponnesus
            days = 7300
        }
    	spartan_mission_02_variable_cleanup_effect = yes
    }

    on_completion = {
    	complete_mission_effect = yes
    	spartan_mission_02_variable_cleanup_effect = yes
    	trigger_event = me_spartan_02_peloponnesus.22
    	if = {
    		limit = {
    			any_owned_province = {
    				is_in_area = south_peleponnesos_area
    			}
    		}
    		random_owned_province = {
    			limit = {
    				is_in_area = south_peleponnesos_area
    			}
    			state = {
    				add_state_modifier = {
    					name = sparta_mission_protector_of_peloponnesus_modifier
    					duration = -1
    				}
    			}
    		}
    	}
    	if = {
    		limit = {
    			any_owned_province = {
    				is_in_area = achaea_area
    			}
    		}
    		random_owned_province = {
    			limit = {
    				is_in_area = achaea_area
    			}
    			state = {
    				add_state_modifier = {
    					name = sparta_mission_protector_of_peloponnesus_modifier
    					duration = -1
    				}
    			}
    		}
    	}
    	if = {
    		limit = {
    			any_owned_province = {
    				is_in_area = arcadia_area
    			}
    		}
    		random_owned_province = {
    			limit = {
    				is_in_area = arcadia_area
    			}
    			state = {
    				add_state_modifier = {
    					name = sparta_mission_protector_of_peloponnesus_modifier
    					duration = -1
    				}
    			}
    		}
    	}
    }

    01_sparta_missions_02_peloponnesus_task_1 = { # Elean Barbarians 
    	duration = 180

        icon = "task_diplomatic"

        potential = {
        	has_variable = olympia_unowned
        }

        highlight = {
        	scope:province = {
        		province_id = 439
        	}
        }

        allow = {
        	political_influence >= 10
        }

        bypass = {
        	owns = 439
        }

        on_start = {
        	trigger_event = me_spartan_02_peloponnesus.1
        	add_political_influence = -10
        }

        on_completion = {
        	trigger_event = me_spartan_02_peloponnesus.2
        	p:439 = { add_claim = root }
        }
    }

    01_sparta_missions_02_peloponnesus_task_2 = { # Liberating the Temple of Zeus
    	requires = { 01_sparta_missions_02_peloponnesus_task_1 }

        icon = "task_conquest"

        potential = {
        	has_variable = olympia_unowned
        }

        highlight = {
        	scope:province = {
        		province_id = 439
        	}
        }

        allow = {
        	owns_or_subject_owns = 439
        }

        on_completion = {
        	trigger_event = me_spartan_02_peloponnesus.3
        	add_country_modifier = {
        		name = sparta_mission_peloponnesus_olympia_modifier
        		duration = 7300
        	}
        }
    }

    01_sparta_missions_02_peloponnesus_task_3 = { # The Priests of Zeus
    	requires = { 01_sparta_missions_02_peloponnesus_task_2 01_sparta_missions_02_peloponnesus_task_13 }

        icon = "task_political"

        highlight = {
        	scope:province = {
        		province_id = 439
        	}
        }

        allow = {
        	trigger_if = {
        		limit = {
        			NOT = { owns = 439 }
        		}
        		owns = 439
        	}
        	political_influence >= 25
        }

        on_completion = {
        	trigger_event = me_spartan_02_peloponnesus.4
        	add_political_influence = -25
        	custom_tooltip = 01_sparta_missions_02_peloponnesus_task_3_effect_tt
        	hidden_effect = {
	        	p:439 = {
	        		create_country = {
	        			name = {
	        				name = OLYMPIA_FEUDATORY_NAME
	        				adjective = OLYMPIA_FEUDATORY_ADJECTIVE
	        			}
	    				change_country_color = olympian_white
	    				set_primary_culture = peloponnesian
	    				set_country_religion = roman_pantheon
	    				change_government = theocratic_republic
                        set_country_heritage = religious_enclave_heritage
	    				change_country_flag = OLYMPIA_FLAG
                        set_variable = olympia_feudatory
	    				save_scope_as = olympia_country_scope
	        		}
	        	}
	        	make_subject = {
	        		target = scope:olympia_country_scope
	        		type = temple_state
	        	}
        	}
            every_country = {
                limit = {  
                    NOT = { this = root }
                    OR = {
                        country_culture_group = hellenic
                        religion = roman_pantheon
                    }
                }
                trigger_event = me_spartan_02_peloponnesus.25
            }
            custom_tooltip = 01_sparta_missions_02_peloponnesus_task_3_effect_tt_2
            add_country_modifier = {
                name = spartan_mission_02_religious_olympia_modifier
                duration = -1
            }
        }
    }

    01_sparta_missions_02_peloponnesus_task_4 = { # Religious Backing
    	duration = 365

        icon = "task_political"

        potential = {
        	has_variable = argos_unowned
        }

        highlight = {
        	scope:province = {
        		province_id = 440
        	}
        }

        allow = {
        	treasury >= 100
        }

        bypass = {
        	owns_or_subject_owns = 440
        }

        on_start = {
        	trigger_event = me_spartan_02_peloponnesus.5
        	add_treasury = -100
        }

        on_completion = {
        	trigger_event = me_spartan_02_peloponnesus.7
        	p:440 = { add_claim = root }
        }
    }

    01_sparta_missions_02_peloponnesus_task_5 = { # The Rival in Argolis
    	requires = { 01_sparta_missions_02_peloponnesus_task_4 }

        icon = "task_expansion"

        potential = {
        	has_variable = argos_unowned
        }

        highlight = {
        	scope:province = {
        		province_id = 440
        	}
        }

        allow = {
        	owns_or_subject_owns = 440
        }

        on_completion = {
        	trigger_event = me_spartan_02_peloponnesus.8
        	if = {
        		limit = {
        			NOT = { owns = 440 }
        			owns_or_subject_owns = 440
        		}
        		p:440 = {
        			owner = {
                        trigger_event = me_spartan_02_peloponnesus.23
        				add_country_modifier = {
        					name = sparta_mission_peloponnesus_argos_country_modifier
        					duration = 3650
        				}
        			}
        		}
        	}
        	else = {
        		p:440 = {
        			add_province_modifier = {
        				name = sparta_mission_peloponnesus_argos_modifier
        				duration = 3650
        			}
        		}
        	}
        }
    }

    01_sparta_missions_02_peloponnesus_task_6 = { # Arcadian Hinterlands
    	duration = 180

        icon = "task_diplomatic"

        potential = {
        	has_variable = arcadia_unowned
        }

        highlight = {
        	scope:province = {
	        	OR = {
		        	province_id = 435
					province_id = 436
					province_id = 438
					province_id = 448
					province_id = 449
					province_id = 7891
				}
			}
        }

        allow = {
        	treasury >= 50
        }

        bypass = {
        	owns_or_subject_owns = 435
			owns_or_subject_owns = 436
			owns_or_subject_owns = 438
			owns_or_subject_owns = 448
			owns_or_subject_owns = 449
			owns_or_subject_owns = 7891
        }

        on_start = {
        	trigger_event = me_spartan_02_peloponnesus.9
        	add_treasury = -50
        }

        on_completion = {
        	trigger_event = me_spartan_02_peloponnesus.10
        	if = { # Hiraia
        		limit = {
        			NOT = { owns_or_subject_owns = 435 }
        		}
        		p:435 = { add_claim = root }
        	}
        	if = { # Megalopolis
        		limit = {
        			NOT = { owns_or_subject_owns = 436 }
        		}
        		p:436 = { add_claim = root }
        	}
        	if = { # Mantineia
        		limit = {
        			NOT = { owns_or_subject_owns = 438 }
        		}
        		p:438 = { add_claim = root }
        	}
        	if = { # Stymphalos
        		limit = {
        			NOT = { owns_or_subject_owns = 448 }
        		}
        		p:448 = { add_claim = root }
        	}
        	if = { # Kleitor
        		limit = {
        			NOT = { owns_or_subject_owns = 449 }
        		}
        		p:449 = { add_claim = root }
        	}
        	if = { # Tegea
        		limit = {
        			NOT = { owns_or_subject_owns = 7891 }
        		}
        		p:7891 = { add_claim = root }
        	}
        }
    }

    01_sparta_missions_02_peloponnesus_task_7 = { # Home of Pan
    	requires = { 01_sparta_missions_02_peloponnesus_task_6 }

        icon = "task_conquest"

        potential = {
        	has_variable = arcadia_unowned
        }

        highlight = {
        	scope:province = {
	        	OR = {
		        	province_id = 435
					province_id = 436
					province_id = 438
					province_id = 448
					province_id = 449
					province_id = 7891
				}
			}
        }

        allow = {
        	owns_or_subject_owns = 435
			owns_or_subject_owns = 436
			owns_or_subject_owns = 438
			owns_or_subject_owns = 448
			owns_or_subject_owns = 449
			owns_or_subject_owns = 7891
        }

        on_completion = {
        	trigger_event = me_spartan_02_peloponnesus.11
        	if = {
        		limit = {
        			OR = {
        				owns = 435
						owns = 436
						owns = 438
						owns = 448
						owns = 449
						owns = 7891
        			}
        		}
        		ordered_owned_province = {
        			order_by = total_population
        			limit = {
        				OR = {
				        	province_id = 435
							province_id = 436
							province_id = 438
							province_id = 448
							province_id = 449
							province_id = 7891
						}
        			}
        			max = 2
        			add_province_modifier = {
        				name = sparta_mission_peloponnesus_arcadia_modifier
        				duration = 7300
        			}
        		}
        	}
        	else_if = {
        		limit = {
        			any_subject = {
        				any_owned_province = {
        					OR = {
					        	province_id = 435
								province_id = 436
								province_id = 438
								province_id = 448
								province_id = 449
								province_id = 7891
							}
        				}
        			}
        		}
        		every_subject = {
        			limit = {
        				any_owned_province = {
        					OR = {
					        	province_id = 435
								province_id = 436
								province_id = 438
								province_id = 448
								province_id = 449
								province_id = 7891
							}
        				}
        			}
                    trigger_event = me_spartan_02_peloponnesus.24
        			add_country_modifier = {
        				name = sparta_mission_peloponnesus_arcadia_country_modifier
        				duration = 7300
        			}
        		}
        	}
        }
    }

    01_sparta_missions_02_peloponnesus_task_8 = { # Rebuilding Argos
    	requires = { 01_sparta_missions_02_peloponnesus_task_5 01_sparta_missions_02_peloponnesus_task_14 }

        icon = "task_economical"

        highlight = {
        	scope:province = {
        		province_id = 440
        	}
        }

        allow = {
        	treasury >= 100
        	trigger_if = {
        		limit = {
        			has_completed_mission_task = 01_sparta_missions_02_peloponnesus_task_5
        			NOT = { owns_or_subject_owns = 440 }
        		}
        		owns_or_subject_owns = 440
        	}
        	trigger_if = {
                limit = { is_ai = no }
                custom_tooltip = {
            		text = 01_sparta_missions_02_peloponnesus_task_8_trigger_tt_1
            		p:440 = {
            			has_city_status = yes
            		}
        	    }
                custom_tooltip = {
            		text = 01_sparta_missions_02_peloponnesus_task_8_trigger_tt_2
            		p:440 = {
            			total_population >= sparta_mission_02_peloponnesus_task_8_trigger_2_total
            		}
            	}
                custom_tooltip = {
                    text = 01_sparta_missions_02_peloponnesus_task_8_trigger_tt_3
                    p:440 = {
                        num_of_used_building_slots >= 3
                    }
                }
            }
            trigger_else = {
                OR = {
                    p:440 = { has_city_status = yes }
                    can_pay_price = price_found_city
                }
            }
            hidden:p:440 = {
                trigger_if = {
                    limit = {
                        has_construction = yes
                    }
                    custom_tooltip = {
                        text = ongoing_construction_trigger_tt
                        has_construction = no
                    }
                }
            }
        }

        on_completion = {
            ai_build_city_pay_price_effect = { CITY = p:440 }
            if = {
                limit = { is_ai = yes }
                p:440 = {
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = citizen
                }
            }
        	trigger_event = me_spartan_02_peloponnesus.12
        	add_treasury = -100
        	p:440 = {
        		add_permanent_province_modifier = {
        			name = sparta_mission_peloponnesus_argos_rebuilt_modifier
        		}
        	}
        }
    }

    01_sparta_missions_02_peloponnesus_task_9 = { # Honoring Asklepios
    	requires = { 01_sparta_missions_02_peloponnesus_task_8 }

        icon = "task_political"

        potential = {
            always = no
        }

        highlight = {
        	scope:province = {
        		province_id = 441
        	}
        }

        allow = {
        	trigger_if = {
        		limit = {
        			NOT = { owns_or_subject_owns = 441 }
        		}
        		owns_or_subject_owns = 441
        	}
        	treasury >= 100
        }

        on_completion = {
            add_treasury = -100
        	trigger_event = me_spartan_02_peloponnesus.13
        }
    }

    01_sparta_missions_02_peloponnesus_task_10 = { # The Northern Coastline
    	requires = { 01_sparta_missions_02_peloponnesus_task_5 01_sparta_missions_02_peloponnesus_task_7 01_sparta_missions_02_peloponnesus_task_14 01_sparta_missions_02_peloponnesus_task_15 }

        icon = "task_conquest"

        potential = {
        	has_variable = achaea_unowned
        }

        highlight = {
        	scope:province = {
        		OR = {
        			province_id = 434
        			province_id = 444
        			province_id = 7890
        			province_id = 7893
        		}
        	}
        }

        allow = {
        	owns_or_subject_owns = 434
        	owns_or_subject_owns = 444
        	owns_or_subject_owns = 7890
        	owns_or_subject_owns = 7893
        }

        on_completion = {
        	trigger_event = me_spartan_02_peloponnesus.14
        	area:achaea_area = {
        		ordered_area_province = {
        			order_by = total_population
        			limit = {
        				OR = {
        					province_id = 434
		        			province_id = 444
		        			province_id = 7890
		        			province_id = 7893
        				}
        			}
        			max = 1
        			if = {
        				limit = {
        					has_city_status = yes
        				}
        				add_province_modifier = {
        					name = sparta_mission_peloponnesus_achaea_modifier
        					duration = 7300
        				}
        			}
        			else = {
        				define_pop = {
        					type = freemen
        					religion = roman_pantheon
        					culture = peloponnesian
        				}
        				define_pop = {
        					type = freemen
        					religion = roman_pantheon
        					culture = peloponnesian
        				}
        				define_pop = {
        					type = freemen
        					religion = roman_pantheon
        					culture = peloponnesian
        				}
        			}
        		}
        	}
        }
    }

    01_sparta_missions_02_peloponnesus_task_11 = { # Civilizing the Valley
    	requires = { 01_sparta_missions_02_peloponnesus_task_7 01_sparta_missions_02_peloponnesus_task_15 }

        icon = "task_economical"

        highlight = {
        	scope:province = {
	        	OR = {
		        	province_id = 435
					province_id = 436
					province_id = 438
					province_id = 448
					province_id = 449
					province_id = 7891
				}
			}
        }

        potential = {
        	NOT = {
        		any_owned_province = {
        			has_province_modifier = sparta_mission_peloponnesus_arcadia_center_modifier
        		}
        	}
        }

        allow = {
        	trigger_if = {
        		limit = {
        			has_completed_mission_task = 01_sparta_missions_02_peloponnesus_task_7
        			OR = {
	    				NOT = { owns_or_subject_owns = 435 }
	    				NOT = { owns_or_subject_owns = 436 }
	    				NOT = { owns_or_subject_owns = 438 }
	    				NOT = { owns_or_subject_owns = 448 }
	    				NOT = { owns_or_subject_owns = 449 }
	    				NOT = { owns_or_subject_owns = 7891 }
	    			}
        		}
        		trigger_if = {
        			limit = {
        				NOT = { owns_or_subject_owns = 435 }
        			}
        			owns_or_subject_owns = 435
        		}
        		trigger_if = {
        			limit = {
        				NOT = { owns_or_subject_owns = 436}
        			}
        			owns_or_subject_owns = 436
        		}
        		trigger_if = {
        			limit = {
        				NOT = { owns_or_subject_owns = 438 }
        			}
        			owns_or_subject_owns = 438
        		}
        		trigger_if = {
        			limit = {
        				NOT = { owns_or_subject_owns = 448 }
        			}
        			owns_or_subject_owns = 448 
        		}
        		trigger_if = {
        			limit = {
        				NOT = { owns_or_subject_owns = 449 }
        			}
        			owns_or_subject_owns = 449
        		}
        		trigger_if = {
        			limit = {
        				NOT = { owns_or_subject_owns = 7891 }
        			}
        			owns_or_subject_owns = 7891
        		}
        	}
        	trigger_else = {
                custom_tooltip = {
	        		text = 01_sparta_missions_02_peloponnesus_task_11_trigger_tt
	        		any_owned_province = {
	        			owner = root
	        			OR = {
	        				province_id = 436
	        				province_id = 7891
	        				province_id = 438
	        				province_id = 435
	        				province_id = 449
	        				province_id = 448
	        			}
	        			trigger_if = {
                            limit = {
                                ROOT = { is_ai = no }
                            }
                            total_population >= 25
    	        			has_city_status = yes
    	        			civilization_value >= 50
                        }
                        trigger_else = {
                            OR = {
                                ROOT = { can_pay_price = price_found_city }
                                has_city_status = yes
                            }
                        }
                    }
        		}
        	}
        }

        on_completion = {
        	if = {
        		limit = {
        			any_owned_province = {
	        			owner = root
	        			OR = {
	        				province_id = 436
	        				province_id = 7891
	        				province_id = 438
	        				province_id = 435
	        				province_id = 449
	        				province_id = 448
	        			}
	        			trigger_if = {
                            limit = {
                                ROOT = { is_ai = no }
                            }
                            total_population >= 25
    	        			has_city_status = yes
    	        			civilization_value >= 50
                        }
                        trigger_else_if = {
                            limit = { has_city_status = no }
                            ROOT = { can_pay_price = price_found_city }
                        }
	        		}
        		}
        		random_owned_province = {
	        		limit = {
	        			owner = root
	        			OR = {
	        				province_id = 436
	        				province_id = 7891
	        				province_id = 438
	        				province_id = 435
	        				province_id = 449
	        				province_id = 448
	        			}
	        			trigger_if = {
                            limit = {
                                ROOT = { is_ai = no }
                            }
                            total_population >= 25
    	        			has_city_status = yes
    	        			civilization_value >= 50
                        }
                        trigger_else_if = {
                            limit = { has_city_status = yes }
                            ROOT = { has_city_status = yes }
                        }
	        		}
	        		save_scope_as = arcadia_urban_center_province
                    owner = {
                        ai_build_city_pay_price_effect = { CITY = scope:arcadia_urban_center_province }
                        if = {
                            limit = { is_ai = yes }
                            scope:arcadia_urban_center_province = {
                                create_state_pop = freemen
                                create_state_pop = freemen
                                create_state_pop = freemen
                                create_state_pop = citizen
                            }
                        }
                    }
	        		add_permanent_province_modifier = {
	        			name = sparta_mission_peloponnesus_arcadia_center_modifier
	        		}
	        	}
        	}
        	else = {
        		ordered_owned_province = {
        			order_by = total_population
        			limit = {
        				OR = {
	        				province_id = 436
	        				province_id = 7891
	        				province_id = 438
	        				province_id = 435
	        				province_id = 449
	        				province_id = 448
	        			}
        			}
        			max = 1
        			add_permanent_province_modifier = {
        				name = sparta_mission_peloponnesus_arcadia_center_modifier
        			}
        		}
        	}
        	trigger_event = me_spartan_02_peloponnesus.15
        }
    }

    01_sparta_missions_02_peloponnesus_task_12 = { # Fortifying Corinth
    	requires = { 01_sparta_missions_02_peloponnesus_task_10 01_sparta_missions_02_peloponnesus_task_16 }

        icon = "task_expansion"

        potential = {
        	has_variable = sparta_mission_02_corinth_expandable
        }

        highlight = {
        	scope:province = {
        		province_id = 418
        	}
        }

        allow = {
        	trigger_if = {
        		limit = {
        			NOT = { owns = 418 }
        		}
        		owns = 418
        	}
        	trigger_if = {
                limit = { is_ai = no }
                custom_tooltip = {
            		text = 01_sparta_missions_02_peloponnesus_task_12_trigger_tt_1
            		p:418 = { has_city_status = yes }
                }
                custom_tooltip = {
                    text = 01_sparta_missions_02_peloponnesus_task_12_trigger_tt_2
                    p:418.num_of_fortress_building >= 3
                }
            }
            trigger_else_if = {
                limit = {
                    p:418 = { has_city_status = no }
                }
                can_pay_price = price_found_city
            }
            hidden:p:418 = {
                trigger_if = {
                    limit = {
                        has_construction = yes
                    }
                    custom_tooltip = {
                        text = ongoing_construction_trigger_tt
                        has_construction = no
                    }
                }
            }
        }

        on_completion = {
            ai_build_city_pay_price_effect = { CITY = p:418 }
            if = {
                limit = {
                    is_ai = yes
                    p:418.num_of_fortress_building < 3
                }
                p:418 = {
                    while = {
                        limit = {
                            num_of_fortress_building < 3
                        }
                        if = {
                            limit = { free_building_slots < 1 }
                            destroy_building_effect = yes
                        }
                        add_building_level = fortress_building
                    }
                }
            }
        	trigger_event = me_spartan_02_peloponnesus.16
        	p:418 = {
        		add_permanent_province_modifier = {
        			name = sparta_mission_peloponnesus_corinth_expanded_acropolis_modifier
        		}
        	}
        }
    }

    01_sparta_missions_02_peloponnesus_task_13 = { # The Home of Zeus
        icon = "task_economical"

        potential = {
        	NOT = { has_variable = olympia_unowned }
        }

        highlight = {
        	scope:province = {
        		province_id = 439
        	}
        }

        allow = {
        	trigger_if = {
        		limit = {
        			NOT = { owns = 439 }
        		}
        		owns = 439
        	}
    		trigger_if = {
                limit = { is_ai = no }
                hidden:p:439 = { has_city_status = yes }
                custom_tooltip = {
        			text = 01_sparta_missions_02_peloponnesus_task_13_trigger_tt_1
        			p:439 = {
    	        		total_population >= sparta_mission_02_peloponnesus_task_13_total
    	        	}
                }
            	custom_tooltip = {
                    text = 01_sparta_missions_02_peloponnesus_task_13_trigger_tt_2
                    p:439 = {
                        num_of_temple_building >= sparta_mission_02_peloponnesus_task_13_2_total
                    }
                }
            }
            trigger_else = {
                OR = {
                    p:439 = { has_city_status = yes }
                    can_pay_price = price_found_city
                }
            }
            hidden:p:439 = {
                trigger_if = {
                    limit = {
                        has_construction = yes
                    }
                    custom_tooltip = {
                        text = ongoing_construction_trigger_tt
                        has_construction = no
                    }
                }
            }
        }

        on_completion = {
            ai_build_city_pay_price_effect = { CITY = p:439 }
        	trigger_event = me_spartan_02_peloponnesus.17
        	add_country_modifier = {
        		name = sparta_mission_peloponnesus_olympia_modifier
        		duration = 7300
        	}
        }
    }

    01_sparta_missions_02_peloponnesus_task_14 = { # Attending the Argives
        icon = "task_political"

        highlight = {
        	scope:province = {
        		province_id = 440
        	}
        }

        potential = {
        	NOT = { has_variable = argos_unowned }
        }

        allow = {
        	trigger_if = {
        		limit = {
        			NOT = { owns_or_subject_owns = 440 }
        		}
        		owns_or_subject_owns = 440
        	}
        	trigger_else = {
        		trigger_if = {
        			limit = {
        				owns = 440
        			}
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_14_trigger_tt
	        			p:440 = {
	        				state_loyalty >= sparta_mission_02_peloponnesus_task_14_total
	        			}
        			}
        		}
	        	trigger_else = {
	        		custom_tooltip = {
	        			text = 01_sparta_missions_02_peloponnesus_task_14_trigger_tt_2
		        		p:440 = {
		        			owner = {
		        				has_subject_loyalty >= sparta_mission_02_peloponnesus_task_14_2_total
		        			}
		        		}
	        		}
	        	}
        	}
        }

        on_completion = {
        	trigger_event = me_spartan_02_peloponnesus.18
        	if = {
        		limit = {
        			NOT = { owns = 440 }
        			owns_or_subject_owns = 440
        		}
        		p:440 = {
        			owner = {
                        trigger_event = me_spartan_02_peloponnesus.23
        				add_country_modifier = {
        					name = sparta_mission_peloponnesus_argos_country_modifier
        					duration = 3650
        				}
        			}
        		}
        	}
        	else = {
        		p:440 = {
        			add_province_modifier = {
        				name = sparta_mission_peloponnesus_argos_modifier
        				duration = 3650
        			}
        		}
        	}
        }
    }

    01_sparta_missions_02_peloponnesus_task_15 = { # Rural Arcadia
        icon = "task_economical"

        potential = {
        	NOT = { has_variable = arcadia_unowned }
        }

        highlight = {
        	scope:province = {
	        	OR = {
		        	province_id = 435
					province_id = 436
					province_id = 438
					province_id = 448
					province_id = 449
					province_id = 7891
				}
			}
        }

        allow = {
        	# Megalopolis
        	trigger_if = { # Megalopolis - Not Owned
        		limit = {
        			NOT = { owns_or_subject_owns = 436 }
        		}
        		owns_or_subject_owns = 436
        	}
        	trigger_else_if = { # Megalopolis - Owned
        		limit = {
        			owns = 436
        		}
        		hidden:p:436 = {
                    trigger_if = {
                        limit = {
                            has_construction = yes
                        }
                        custom_tooltip = {
                            text = ongoing_construction_trigger_tt
                            has_construction = no
                        }
                    }
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_1
        				num_of_used_building_slots >= 1
        			}
        		}
        	}
        	trigger_else_if = { # Megalopolis - Subject Owned
        		limit = {
        			p:436 = {
        				exists = owner
        				owner = {
        					is_subject_of = root
        				}
        			}
        		}
        		hidden:p:436 = {
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_2
        				owner = {
        					has_subject_loyalty >= 50
        				}
        			}
        		}
        	}
        	# Tegea
        	trigger_if = { # Tegea - Not Owned
        		limit = {
        			NOT = { owns_or_subject_owns = 7891 }
        		}
        		owns_or_subject_owns = 7891
        	}
        	trigger_else_if = { # Tegea - Owned
        		limit = {
        			owns = 7891
        		}
        		hidden:p:7891 = {
                    trigger_if = {
                        limit = {
                            has_construction = yes
                        }
                        custom_tooltip = {
                            text = ongoing_construction_trigger_tt
                            has_construction = no
                        }
                    }
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_1
        				num_of_used_building_slots >= 1
        			}
        		}
        	}
        	trigger_else_if = { # Tegea- Subject Owned
        		limit = {
        			p:7891 = {
        				exists = owner
        				owner = {
        					is_subject_of = root
        					NOT = { owns = 436 }
        				}
        			}
        		}
        		hidden:p:7891 = {
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_2
        				owner = {
        					has_subject_loyalty >= 50
        				}
        			}
        		}
        	}
        	# Mantineia 
        	trigger_if = { # Mantineia - Not Owned
        		limit = {
        			NOT = { owns_or_subject_owns = 438 }
        		}
        		owns_or_subject_owns = 438
        	}
        	trigger_else_if = { # Mantineia - Owned
        		limit = {
        			owns = 438
        		}
        		hidden:p:438 = {
                    trigger_if = {
                        limit = {
                            has_construction = yes
                        }
                        custom_tooltip = {
                            text = ongoing_construction_trigger_tt
                            has_construction = no
                        }
                    }
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_1
        				num_of_used_building_slots >= 1
        			}
        		}
        	}
        	trigger_else_if = { # Mantineia - Subject Owned
        		limit = {
        			p:438 = {
        				exists = owner
        				owner = {
        					is_subject_of = root
        					NOR = {
        						owns = 436
        						owns = 7891
        					}
        				}
        			}
        		}
        		hidden:p:438 = {
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_2
        				owner = {
        					has_subject_loyalty >= 50
        				}
        			}
        		}
        	}
        	# Hiraia 
        	trigger_if = { # Hiraia - Not Owned
        		limit = {
        			NOT = { owns_or_subject_owns = 435 }
        		}
        		owns_or_subject_owns = 435
        	}
        	trigger_else_if = { # Hiraia - Owned
        		limit = {
        			owns = 435
        		}
        		hidden:p:435 = {
                    trigger_if = {
                        limit = {
                            has_construction = yes
                        }
                        custom_tooltip = {
                            text = ongoing_construction_trigger_tt
                            has_construction = no
                        }
                    }
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_1
        				num_of_used_building_slots >= 1
        			}
        		}
        	}
        	trigger_else_if = { # Hiraia - Subject Owned
        		limit = {
        			p:435 = {
        				exists = owner
        				owner = {
        					is_subject_of = root
        					NOR = {
        						owns = 436
        						owns = 438
        						owns = 7891
        					}
        				}
        			}
        		}
        		hidden:p:435 = {
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_2
        				owner = {
        					has_subject_loyalty >= 50
        				}
        			}
        		}
        	}
        	# Kleitor 
        	trigger_if = { # Kleitor - Not Owned
        		limit = {
        			NOT = { owns_or_subject_owns = 449 }
        		}
        		owns_or_subject_owns = 449
        	}
        	trigger_else_if = { # Kleitor - Owned
        		limit = {
        			owns = 449
        		}
        		hidden:p:449 = {
                    trigger_if = {
                        limit = {
                            has_construction = yes
                        }
                        custom_tooltip = {
                            text = ongoing_construction_trigger_tt
                            has_construction = no
                        }
                    }
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_1
        				num_of_used_building_slots >= 1
        			}
        		}
        	}
        	trigger_else_if = { # Kleitor - Subject Owned
        		limit = {
        			p:449 = {
        				exists = owner
        				owner = {
        					is_subject_of = root
        					NOR = {
        						owns = 435
        						owns = 436
        						owns = 438
        						owns = 7891
        					}
        				}
        			}
        		}
        		hidden:p:449 = {
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_2
        				owner = {
        					has_subject_loyalty >= 50
        				}
        			}
        		}
        	}
        	# Stymphalos
        	trigger_if = { # Stymphalos - Not Owned
        		limit = {
        			NOT = { owns_or_subject_owns = 448 }
        		}
        		owns_or_subject_owns = 448
        	}
        	trigger_else_if = { # Stymphalos - Owned
        		limit = {
        			owns = 448
        		}
        		hidden:p:448 = {
                    trigger_if = {
                        limit = {
                            has_construction = yes
                        }
                        custom_tooltip = {
                            text = ongoing_construction_trigger_tt
                            has_construction = no
                        }
                    }
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_1
        				num_of_used_building_slots >= 1
        			}
        		}
        	}
        	trigger_else_if = { # Stymphalos - Subject Owned
        		limit = {
        			p:448 = {
        				exists = owner
        				owner = {
        					is_subject_of = root
        					NOR = {
        						owns = 435
        						owns = 436
        						owns = 438
        						owns = 449
        						owns = 7891
        					}
        				}
        			}
        		}
        		hidden:p:448 = {
        			custom_tooltip = {
        				text = 01_sparta_missions_02_peloponnesus_task_15_trigger_tt_2
        				owner = {
        					has_subject_loyalty >= 50
        				}
        			}
        		}
        	}
        }

        on_completion = {
        	trigger_event = me_spartan_02_peloponnesus.19
        	if = {
        		limit = {
        			OR = {
        				owns = 435
						owns = 436
						owns = 438
						owns = 448
						owns = 449
						owns = 7891
        			}
        		}
        		ordered_owned_province = {
        			order_by = total_population
        			limit = {
        				OR = {
				        	province_id = 435
							province_id = 436
							province_id = 438
							province_id = 448
							province_id = 449
							province_id = 7891
						}
        			}
        			max = 2
        			add_province_modifier = {
        				name = sparta_mission_peloponnesus_arcadia_modifier
        				duration = 7300
        			}
        		}
        	}
        	else_if = {
        		limit = {
        			any_subject = {
        				any_owned_province = {
        					OR = {
					        	province_id = 435
								province_id = 436
								province_id = 438
								province_id = 448
								province_id = 449
								province_id = 7891
							}
        				}
        			}
        		}
        		every_subject = {
        			limit = {
        				any_owned_province = {
        					OR = {
					        	province_id = 435
								province_id = 436
								province_id = 438
								province_id = 448
								province_id = 449
								province_id = 7891
							}
        				}
        			}
                    trigger_event = me_spartan_02_peloponnesus.24
        			add_country_modifier = {
        				name = sparta_mission_peloponnesus_arcadia_country_modifier
        				duration = 7300
        			}
        		}
        	}
        }
    }

    01_sparta_missions_02_peloponnesus_task_16 = { # Achaean Coastline
    	requires = { 01_sparta_missions_02_peloponnesus_task_5 01_sparta_missions_02_peloponnesus_task_7 01_sparta_missions_02_peloponnesus_task_14 01_sparta_missions_02_peloponnesus_task_15 }

        icon = "task_expansion"

        potential = {
        	NOT = { has_variable = achaea_unowned }
        }

        highlight = {
        	scope:province = {
        		OR = {
        			province_id = 434
        			province_id = 444
        			province_id = 7890
        			province_id = 7893
        		}
        	}
        }

        allow = {
        	custom_tooltip = {
        		text = 01_sparta_missions_02_peloponnesus_task_16_tt 
        		any_owned_province = {
        			OR = {
        				province_id = 434
        				province_id = 444
        				province_id = 7890
        				province_id = 7893
        			}
        			trigger_if = {
                        limit = { 
                            ROOT = { is_ai = no }
                        }
                        has_city_status = yes
                        total_population >= 15
                        num_of_used_building_slots >= 3
                    }
                    trigger_else = {
                        OR = {
                            has_city_status = yes
                            ROOT = { can_pay_price = price_found_city }
                        }
                    }
                    has_construction = no
        		}
        	}
        }

        bypass = {
        	any_owned_province = {
        		has_province_modifier = sparta_mission_peloponnesus_achaea_modifier
        	}
        }

        on_completion = {
        	area:achaea_area = {
        		ordered_area_province = {
        			order_by = total_population
        			limit = {
        				OR = {
        					province_id = 434
		        			province_id = 444
		        			province_id = 7890
		        			province_id = 7893
        				}
        				trigger_if = {
                            limit = {
                                ROOT = { is_ai = no }
                            }
                            has_city_status = yes
    	        			total_population >= 15
    	        			num_of_used_building_slots >= 3
                        }
                        trigger_else_if = { # if AI but a city already exists
                            limit = { has_city_status = yes }
                            has_city_status = yes
                        }
                        has_construction = no
        			}
        			max = 1
    				add_permanent_province_modifier = {
    					name = sparta_mission_peloponnesus_achaea_modifier
    				}
    				save_scope_as = achaean_coastline_province
        		}
                ai_build_city_pay_price_effect = { CITY = scope:achaean_coastline_province }
                if = {
                    limit = {
                        ROOT = { is_ai = yes }
                    }
                    scope:achaean_coastline_province = {
                        create_state_pop = freemen
                        create_state_pop = freemen
                        create_state_pop = citizen
                    }
                }
        	}
        	trigger_event = me_spartan_02_peloponnesus.20
        }
    }

    01_sparta_missions_02_peloponnesus_task_final = { # Protector of peloponnesus
    	requires = { 01_sparta_missions_02_peloponnesus_task_10 01_sparta_missions_02_peloponnesus_task_16 }

        icon = "task_diplomatic"

        final = yes

        on_completion = {
        	trigger_event = me_spartan_02_peloponnesus.21
        	current_ruler = {
        		add_popularity = 10
        	}
        	if = {
        		limit = {
        			is_monarchy = yes
        			legitimacy < 100
        		}
        		add_legitimacy = 10
        	}
        }
    }
}