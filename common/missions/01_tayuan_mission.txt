tayuan_mission_1 = {
	header = "mission_image_macedon"
	icon = "macedon_2"

	repeatable = no
	chance = {
		factor = 5
	}

	potential = {
        tag = TAY
    }

	abort = {
		ai_mission_back_out_trigger = yes
	}

	on_start = {
		start_mission_ai_effect = yes
		trigger_event = me_tayuan.1

		random_country_culture = {
            limit = {
                is_culture = tayuan
            }
            save_scope_as = ferghanan_culture_scope
        }
	}

	on_completion = {
		complete_mission_effect = yes
		trigger_event = me_tayuan.11
	}

	tayuan_task_start = {
		icon = "task_expansion"
		duration = 21

		 on_start = {
			hidden_effect = {
				create_character = {
					culture = root.culture
					religion = root.religion
					female = no
					age = 37
					no_traits = yes
					add_trait = explorer
					add_trait = vengeful
					add_trait = narrowminded
					first_name = "Perseus"
					add_martial = 4
					save_scope_as = tayuan_explorer
				}
			}
			trigger_event = {
				id = me_tayuan.2
			}
			add_treasury = -50
			add_manpower = -2
		 }

		 allow = { 
			treasury >= 50
			manpower >= 2
			war = no
		}

		 on_completion = {
			trigger_event = {
				id = me_tayuan.3
			}
		}
	}

	tayuan_task_1 = {
		icon = "task_diplomatic"
		duration = 14
		
		requires = { tayuan_task_start }
		
		allow = {
			trigger_if = {
				limit = {
					is_ai = no
				}
				invention = global_start_experience_inv_2
			}	
			trigger_else = { # for ai
				current_date >= 453.10.1
			}
			political_influence >=15
		}

		on_start = {
			add_political_influence = -15
		}

		on_completion = {
			trigger_event = {
				id = me_tayuan.5
			}
		}
	}

	tayuan_task_2 = {
		icon = "task_shiva"
		duration = 30

		requires = { tayuan_task_start } 

		allow = {
			treasury >= 50
			political_influence >= 20
		}

		on_start = {
			add_political_influence = -20
		}

		on_completion = {
			trigger_event = {
				id = me_tayuan.6
			}
		}
	}

	tayuan_task_3 = {
		icon = "task_battle"
		requires = { tayuan_task_1 tayuan_task_2 } 
		duration = 20

		allow = { 
			political_influence >= 8
			military_experience >= 3
		}

		on_start = {
			add_political_influence = -8
			add_military_experience = -3
		}

		on_completion = {
			trigger_event = {
				id = me_tayuan.7
			}
		}
	}

	tayuan_task_4 = {
		icon = "task_zeus_cornucopia"
		requires = { tayuan_task_3 }

		allow = {
			p:6703 = {
				num_of_used_building_slots >= 2
				OR = {
					has_building = forum_building
					has_building = aqueduct_building
					has_building = population_building
				}
			}
			hidden:p:6704 = {
					has_building = population_building
			}
		}

		highlight = {
            scope:province = {
                OR = {
                    province_id = 6703
                    province_id = 6704
                }
            }
        }    

		on_completion = {
			trigger_event = {
				id = me_tayuan.8
			}
            p:6704 = {
                    add_province_modifier = {
                        name = tayuan_citiesoftheconquerors
                    }
                }
            p:6703 = {
                    add_province_modifier = {
                        name = tayuan_citiesoftheconquerors
                    }
					if = {
                        limit = {
                            NOT = { has_road_towards = p:790 }
                        }
                        add_road_towards = p:6704
                    }
                }
		}
	}

	tayuan_task_5 = {
		icon = "task_calm"
		requires = { tayuan_task_3 }

		allow = {
			political_influence >= 30
		}

		on_completion = {
			custom_tooltip = "great_ionians_tt"
				trigger_event = {
					id = me_tayuan.9
				}
			
		}
	}

	tayuan_task_6 = {
		icon = "task_artemis"
		requires = { tayuan_task_3 }

		allow = {
            hidden:p:6773 = {
                has_building = fortress_building
                is_state_capital = yes
            }
        }

		highlight = {
            scope:province = {
                    province_id = 6773
            }
        }    

		on_completion = {
			trigger_event = {
				id = me_tayuan.10
			}
			custom_tooltip = tayuan_sogd_tt
			hidden_effect = {
				mission_claim_area_effect = { AREA = jaxartia_area }
			}
			
		
		}
	}

	tayuan_task_7 = {
		icon = "task_economical"
		requires = { tayuan_task_3 }

		allow = {
			stability >= 55
			OR = {
				p:6740 = {
					has_building = latifundia_building
				}
				p:6730 = {
					has_building = basic_settlement_infratructure_building
				}
			}

		}

		highlight = {
			scope:province = {
				OR = {
					province_id = 6740
					province_id = 6730
				}
			}
		}

		on_completion = {
			p:6740 = {
				add_province_modifier = {
					name = tayuan_silkprod
				}
			}
			area:ferghana_area = {
				random_area_province = {
					state = {
						add_state_modifier = {
							name = tayuan_breadbasket
							duration = -1
						}
					}
				}
			}
		}
		
	}

	tayuan_task_8 = {
		icon = "task_apollo"

		final = yes

		requires = {  tayuan_task_14 tayuan_task_13 tayuan_task_15 }

		allow = {
			owns_or_subject_owns = 6682
			owns_or_subject_owns = 6705
			owns_or_subject_owns = 6733
			owns_or_subject_owns = 6702
			owns_or_subject_owns = 6721
		}
		
		highlight = {
			scope:province = {
				OR = {
					province_id = 6682
					province_id = 6705
					province_id = 6733
					province_id = 6702
					province_id = 6721
				}
			}
		}

		on_completion = {
			trigger_event = {
				id = me_tayuan.12
			}
			custom_tooltip = macedonian_slaves_tt
			hidden_effect = {
				while = {
				count = 10
				random_owned_province = {
					limit = {
						is_in_area = ferghana_area
					}
					define_pop = {
						type = slaves
						religion = root.religion
						culture = culture:macedonian
					}
				}
			}
			}
			capital_scope = {
				state = {
					add_state_modifier = {
						name = tayuan_valley
					}
				}
			}
			p:6732 = {
				set_trade_goods = steppe_horses
			}
			add_innovation = 2
		}
		
	}

	tayuan_task_9 = {
		icon = "task_conquest"
		requires = { tayuan_task_6 tayuan_task_7 }

		allow = {
			OR = {
				hidden:c:SOG = {
					is_subject_of = ROOT
				}
				AND = {
					custom_tooltip = {
						text = sogdian_tay_tt
						c:SOG = {
							any_owned_province = {
								count = all
								controller = c:TAY
							}
						}
					}
					c:SOG = {
						has_land = no
					}
				}
			}
		}

		highlight = {
            scope:province = {
                owner = c:SOG
            }
        }

		on_completion = {
			custom_tooltip = tayuan_kindness_tt
			if = {
				limit = { 
					c:SOG = {
						is_subject_of = ROOT
					}
					trigger_event = me_tayuan.16
				}
			}

			else_if = {
				limit = {
					AND = {
					c:TAY = {
						owns = 7264
					}
					NOT = { exists = c:SOG }
				}
				}
				trigger_event = me_tayuan.17
			}

			else = {
				trigger_event = me_tayuan.25
			}

		}
		
	}

	tayuan_task_10 = {
		icon = "task_diplomatic"
		requires = { tayuan_task_4 tayuan_task_9 }

		allow = {
			diplomatic_stance = trading_stance
			p:6704.state = {
				incoming_trade_routes >= 6
				outgoing_trade_routes >= 4
			}
		}

		on_completion = {
			trigger_event = {
				id = me_tayuan.18
			}
			c:BAC = {
				add_truce = {
					target = TAY
					duration = 1827
				}
			}
			mission_claim_area_effect = { AREA = cyropolis_area }
			add_country_modifier = {
				name = tayuantraders
				duration = 1095
			}
		}
		
	}

	tayuan_task_11 = {
		icon = "task_heracles"
		requires = { tayuan_task_6 tayuan_task_7 }

		allow = {
			custom_tooltip = {
				text = tayuan_sakawar_tt
				any_current_war = {
					any_war_participant = { tag = TAY }
					any_war_participant = { 
						OR = {
							tag = WUS
							tag = SHU
						}
					}
					war_score = {
						target = ROOT
						value >= 20
					}
					save_scope_as = tayuan_saka_war
				}
			}
		}

		highlight = {
            scope:province = {
				OR = {
					AND = {
						has_owner = yes
						owner = c:WUS
					}
					AND = {
						has_owner = yes
						owner = c:SHU
					}
				}
            }
        }

		on_completion = {
			trigger_event = {
				id = me_tayuan.20
			}
			
			hidden_effect = {
				mission_claim_area_effect = { AREA = sirdarya_area }
			}
			
		}
		
	}

	tayuan_task_12 = {
		icon = "task_religion"
		duration = 30
		requires = { tayuan_task_5 }

		on_start = {
			hidden_effect = {
				create_character = {
					culture = root.culture
					religion = root.religion
					female = yes
					age = 52
					add_trait = energetic
					add_trait = eccentric
					first_name = "Phileia"
					save_scope_as = tayuan_artist
				}
			}
		 }

		allow = {
			treasury >= 80
		}

		on_completion = {
			trigger_event = {
				id = me_tayuan.19
			}
			add_treasury = -80
			custom_tooltip = tayuan_art_tt
		}
		
	}

	tayuan_task_13 = {
		icon = "task_happiness"
		requires = { tayuan_task_10 }

		allow = {
			trigger_if = {
                limit = { exists = scope:ferghanan_culture_scope }
			}
			scope:ferghanan_culture_scope = {
				has_country_culture_modifier = honor_guard
			}
			custom_tooltip = {
				text = ferghanan_office_tt
				any_character = {
					has_culture = tayuan
					OR = {
						has_any_military_office_trigger = yes
						has_any_admin_office_trigger = yes
						has_any_religious_office_trigger = yes
					}
				}
			}
		}

		on_completion = {
			trigger_event = {
				id = me_tayuan.21
			}
			show_as_tooltip = {
				random_country_culture = {
					limit = {
						is_culture = tayuan
					}
					add_country_culture_modifier = {
						name = ferghanan_happiness
						duration = 9125
					}
				}
			}
			add_country_modifier = {
				name = tayuan_manpower
				duration = 9125
			}
			hidden_effect = {
				p:6737 = {
				while = {
					count = 2
					ordered_pops_in_province = {
						limit = {
							pop_type = citizen
							pop_culture = ionian
						}
					set_pop_religion = vaksh_religion
					set_pop_culture = tayuan
					}
				}
			}
			p:6737 = {
				while = {
					count = 3
					ordered_pops_in_province = {
					limit = {
						pop_culture = ionian
						pop_type = freemen
					}
					set_pop_religion = vaksh_religion
					set_pop_culture = tayuan
				}
				}
			}
			}
		}

		
	}

	tayuan_task_14 = {
		icon = "task_battle"
		requires = { tayuan_task_10 }

		allow = {
			capital_scope.governorship = { has_legion_trigger = yes }
			custom_tooltip = {
				text = lochos_legion_tt
				any_legion = {
					any_legion_unit = {
						any_sub_unit = {
							count >= 5
							sub_unit_type = spearmen
						}
						any_sub_unit = {
							count >= 3
							OR = {
								sub_unit_type = horse_archers
								sub_unit_type = heavy_cavalry
							} 
						}
					}
				}
			}
			capital_scope = {
                OR = {
					is_importing_trade_good = horses
                	is_importing_trade_good = steppe_horses
				}
            }
		}

		on_completion = {
			trigger_event = {
				id = me_tayuan.22
			}
			add_country_modifier = {
				name = tayuan_ranks
			}
			hidden_effect = {
				mission_claim_area_effect = { AREA = cyropolis_area }
			}
		}
		
	}

	tayuan_task_15 = {
		icon = "task_expansion"
		requires = { tayuan_task_10 }

		allow = {
			hidden:p:6704.state = {
                state_improvement_civic_trigger = yes

            }
			stability >= 60 
			custom_tooltip = {
				text = tayuan_cityrequire_tt
				area:ferghana_area = {
					any_area_province = {
						count >= 3
						filter = {
							owner = ROOT
							has_city_status = yes
						}
						has_building = forum_building
					}
				}
			}
		}

		on_completion = {
			trigger_event = {
				id = me_tayuan.23
			}
			current_ruler = {
			    add_finesse = 2
			    add_trait = secure
            }
			custom_tooltip = tayuan_polises_tt
			hidden_effect = {
				capital_scope.area = {
					every_area_province = {
						add_province_modifier = {
							name = tayuan_polises
						}
					}
				}
			}
			add_country_modifier = {
				name = found_city
				duration = 7305
			}
		}
		
	}

	tayuan_task_16 = {
		icon = "task_artemis"
		requires = { tayuan_task_11 }

		allow = {
			owns_or_subject_owns_area = sirdarya_area
		}

		highlight = {
			scope:province = {
				is_in_area = sirdarya_area
				NOT = {
					owner = root
				}
			}
		}

		on_completion = {
			trigger_event = {
				id = me_tayuan.26
			}
			add_military_experience = 4
		}
		
	}
}