tayuan_mission_2 = { 
    icon = cde_indo_greek_port_city
    header = persian_civil_mission_header

    repeatable = no
    chance = {
		factor = 10
	}

    potential = {
        has_completed_mission = tayuan_mission_1
        NOT = {
            has_variable = tay2_mission_cooldown_var
        }
    }

    on_potential = {
        culture_points_setup_effect = {
            CULTURE = ionian
            STARTING_VALUE = 0
        }
        culture_points_setup_effect = {
            CULTURE = tayuan
            STARTING_VALUE = 0
        }
        culture_points_setup_effect = {
            CULTURE = qin
            STARTING_VALUE = 0
        }
        culture_points_setup_effect = {
            CULTURE = zhangzhung
            STARTING_VALUE = 0
        }
    }

    abort = {
		ai_mission_back_out_trigger = yes
	}

    on_start = {
        start_mission_ai_effect = yes

        random_province = {
            limit = {
                is_holy_site_of_deity = deity:omen_vakhsh
            }
            save_scope_as = tayuan_holysiteprovince
        }
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = tay2_mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {
		complete_mission_effect = yes
        show_as_tooltip = {
            custom_tooltip = culture_points_ionian_tt
            custom_tooltip = culture_points_huaxia_tt
            custom_tooltip = culture_points_ferghani_tt
            custom_tooltip = culture_points_buddhist_tt
        }
        custom_tooltip = armenia_end_bonus_tt
	}

    tayuan_ferghana_task_start = {
        icon = "task_expansion"
        requires = { }


        allow = {
            political_influence >= 50 
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.1
            }
            add_political_influence = -50
            custom_tooltip = tay_claim_shule
            hidden_effect = {
                area:tarim_area = {
                    every_area_province = { add_claim = root }
                }
            }
            p:6725 = {
                add_building_level = port_building
            }
        }
       
    }

    tayuan_ferghana_task_1 = {
        icon = "task_happiness"
        requires = { tayuan_ferghana_task_start }


        allow = {
            treasury >= 150
            p:6704 = {
                num_of_aqueduct_building >= 3 
            } 
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.2
            }
            p:6704 = {
                custom_tooltip = alextemperate_tt
                hidden_effect = {
                    change_climate = mild_winter
                }
            }
            mission_claim_area_effect = { AREA = oxiana_area }
        }
       
    }

    tayuan_ferghana_task_2 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_start }


        allow = {
            custom_tooltip = {
                text = tayuantarimpaths_tt
                owns_or_subject_owns_area = tarim_area
                OR = {
                    owns_or_subject_owns_area = north_tarim_area
                    owns_or_subject_owns_area = south_tarim_area
                }
            }
        }


        on_completion = {
            custom_tooltip = tayuantarimpaths2_tt
            trigger_event = {
                id = me_tayuan_ferghana.3
            }
        }
       
    }

    tayuan_ferghana_task_3 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_1 }


        allow = {
            invention = technology_cost_inv_1
            hidden:capital_scope.state = {
					trade_good_surplus = { target = wood value >= 3 }
			}
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.4
            }
            p:6731 = {
                set_trade_goods = wine
                add_province_modifier = {
                    name = tay_winemod
                }
            }
            p:6736 = {
                set_trade_goods = wine
                add_province_modifier = {
                    name = tay_winemod
                }
            }
            random_character = {
                limit = {
                    prominence >= 35
                }
                save_temporary_scope_as = holding_receiver
            }
            hidden_effect = {
                scope:holding_receiver = {
                    add_holding = p:6731
                    add_holding = p:6736
                }
            }
            custom_tooltip = tay_holdingwine_tt
        }
       
    }

    tayuan_ferghana_task_4 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_1 }


        allow = {
            custom_tooltip = {
                text = tayuan_grain_tt
                tayuan_grain_production_svalue >= 10
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.5
            }
            tayuan_culture_point_effect = yes
            hidden_effect = {
                p:6732 = {
                    random_pops_in_province = {
                        limit = {
                            pop_culture = macedonian
                        }
                        set_pop_culture = tayuan
                    }
                    define_pop = {
                        type = freemen
                        religion = vaksh_religion
                        culture = tayuan
                    }
                }
            }
        }
       
    }

    tayuan_ferghana_task_5 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_2 }


        allow = {
            custom_tooltip = { #Is importing food items from at least 2 different indian kingdoms 
                text = "tayincense_tt"
                any_country = {
                    count >= 1
                    capital_scope = {
                        OR = {
                            is_in_region = maru_region
                            is_in_region = gandhara_region
                            is_in_region = avanti_region
                            is_in_region = aparanta_region
                            is_in_region = madhyadesa_region
                            is_in_region = vindhyaprstha_region
                            is_in_region = karnata_region
                            is_in_region = dravida_region
                            is_in_region = pracya_region
                            is_in_region = burma_region
                        }
                    }
                    save_temporary_scope_as = ionia_importing_from_indian_country
                    ROOT = {
                        imports_from = scope:ionia_importing_from_indian_country
                    }
                }
                capital_scope = {
                    is_importing_trade_good = incense
                }
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.6
            }
        }
       
    }

    tayuan_ferghana_task_6 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_2 }


        allow = {
            p:7184 = {
                governor_policy = encourage_trade
            } 
            has_high_economic_policy = income_commerce
            has_treasury >= 80
        }


        on_completion = {
            add_treasury = -80
            if = {
                limit = {
                    has_variable = helped_zhang
                }
                trigger_event = me_tayuan_ferghana.7
            }
            else = {
                trigger_event = me_tayuan.ferghana.7001
            }
            custom_tooltip = tay_tarimtradeexpanded
            p:7184 = {
                hidden_effect = {
                    ordered_pops_in_province = {
                    limit = {
                        NOT = {
                            pop_culture = qin
                        }
                    }
                    order_by = pop_hapiness
                    max = 4
                    set_pop_culture = qin
                    set_pop_religion = chinese_religions
                }
                }
            }
            p:6744 = {
                hidden_effect = {
                    ordered_pops_in_province = {
                    limit = {
                        NOT = {
                            pop_culture = qin
                        }
                    }
                    order_by = pop_hapiness
                    max = 4
                    set_pop_culture = qin
                    set_pop_religion = chinese_religions
                }
                }
            }
            p:6753 = {
                hidden_effect = {
                    ordered_pops_in_province = {
                    limit = {
                        NOT = {
                            pop_culture = qin
                        }
                    }
                    order_by = pop_hapiness
                    max = 1
                    set_pop_culture = qin
                    set_pop_religion = chinese_religions
                }
                }
            }
        }
       
    }

    tayuan_ferghana_task_7 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_3 tayuan_ferghana_task_4 }


        allow = {


        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.8
            }
            add_country_modifier = {
                name = tayuan_spear_and
            }
        }
       
    }

    tayuan_ferghana_task_8 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_7 }


        allow = {
            custom_tooltip = {
                text = tayuan_own_passes_tt
                AND = {
                    owns_or_subject_owns_area = pamir_area
                    owns_or_subject_owns_area = gilgit_area
                }
            }
            custom_tooltip = {
                text = tayuan_own_aral_tt
                AND = {
                    owns_or_subject_owns_area = north_aral_area
                    owns_or_subject_owns_area = eastern_aral_area
                    owns_or_subject_owns_area = scythia_prima_area
                }
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.9
            }
        }
       
    }

    tayuan_ferghana_task_9 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_3 }

        potential = {
            has_variable = dawan_the_city
        }

        allow = {
            p:6735 = {
                num_of_academy_building >= 2
                num_of_library_building >= 2
                num_of_forum_building >= 1
                num_of_temple_building >= 1
            }
            hidden:p:4544.state = {
                custom_tooltip = {
                    text = "tayuan_needs_oratory_tt"
                    calc_true_if = {
                        amount >= 1
                        state_improvement_oratory_trigger = yes   
                    }
                }
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.10
            }
            set_capital = p:6735
            p:6735 = {
                set_city_status = city_metropolis
                add_province_modifier = {
                    name = great_bactrian_royal_city_modifier
                }
            }
        }
       
    }

    tayuan_ferghana_task_10 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_3 }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = oxiana_area
                    is_in_area = sogdiana_area
                    owner = c:BAC
                }
            }
        }

        allow = {
            owns_area = oxiana_area
            owns_area = sogdiana_area
            c:BAC = {
                has_land = no
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.11
            }
        }
       
    }

    tayuan_ferghana_task_11 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_6 }


        allow = {


        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.12
            }
        }
       
    }

    tayuan_ferghana_task_12 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_4 }


        allow = {
            any_character = {
                has_office = office_royal_tutor
                charisma >= 9
                is_culture = tayuan
            }
            political_influence >= 60 
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.13
            }
            tayuan_culture_point_effect = yes
            add_political_influence = -60
        }
    }

    tayuan_ferghana_task_13 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_12 }


        allow = {
            p:6784 = {
                num_goods_produced >= 3
                num_of_fortress_building >= 2
            }
            p:6784.state = {
                state_level_loyalty >= 80
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.14
            }
            tayuan_culture_point_effect = yes
            mission_claim_area_effect = { AREA = beishan_area }
            mission_claim_area_effect = { AREA = kapchagay_area }
            hidden_effect = {
                p:6784 = {
                    while = {
                        count = 5
                        define_pop = {
                            type = freemen
                            religion = vaksh_religion
                            culture = tayuan
                        }
                    }
                    while = {
                        count = 2
                        define_pop = {
                            type = freemen
                            religion = roman_pantheon
                            culture = ionian
                        }
                    }
                }
            }
        }
       
    }

    tayuan_ferghana_task_14 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_6 }


        allow = {
            

        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.15
            }
            p:6737 = {
                define_pop = {
                    type = citizen
                    religion = chinese_religions
                    culture = qin
                }
            }
        }
       
    }

    tayuan_ferghana_task_15 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_12 }


        allow = {
            custom_tooltip = {
                text = tayuan_ferghana_earthworks_tt
                any_owned_province = {
                    count >= 1
                    AND = {
                        is_in_area = ferghana_area
                        num_of_fortress_ramparts_building >= 1
                        total_population <= 20 
                    }
                }
            }
            custom_tooltip = {
                text = tayuan_talas_earthworks_tt
                p:6784 = {
                    num_of_fortress_ramparts_building >= 1
                }
            }
            custom_tooltip = {
                text = tayuan_sogdiana_earthworks_tt
                any_owned_province = {
                    count >= 1
                    AND = {
                        is_in_area = sogdiana_area
                        num_of_fortress_ramparts_building >= 1
                        total_population <= 20
                    }
                }
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.16
            }
            tayuan_culture_point_effect = yes
        }
       
    }

    tayuan_ferghana_task_16 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_13 tayuan_ferghana_task_15 }


        allow = {
            custom_tooltip = {
                text = tayuan_ershi_pops_tt
                p:6737 = {
                    dominant_province_culture = tayuan
                }
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.17
            }
            tayuan_culture_point_effect = yes
        }
       
    }

    tayuan_ferghana_task_17 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_16 }

        potential = {
            #NOT = {
             #   has_variable = tayuan_defeatedsogdia
            #}
            has_variable = tayuan_savedsogdia
        }

        allow = {


        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.18
            }
            tayuan_culture_point_effect = yes
        }
       
    }

    tayuan_ferghana_task_18 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_16 }

        potential = {
            #NOT = {
             #   has_variable = tayuan_savedsogdia
            #}
            has_variable = tayuan_defeatedsogdia
        }

        allow = {


        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.19
            }
        tayuan_culture_point_effect = yes
        }
       
    }

    tayuan_ferghana_task_19 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_16 }

        potential = {
            ##NOT = {
              #  has_variable = tayuan_defeatedsogdia
            #}
            has_variable = tayuan_savedsogdia
        }

        allow = {


        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.20
            }
            tayuan_culture_point_effect = yes
        }
       
    }

    tayuan_ferghana_task_20 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_16 }

        potential = {
            ## NOT = {
                #has_variable = tayuan_savedsogdia
            #}
            has_variable = tayuan_defeatedsogdia
        }

        allow = {


        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.21
            }
            tayuan_culture_point_effect = yes
        }
       
    }

    tayuan_ferghana_task_21 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_17 tayuan_ferghana_task_18 tayuan_ferghana_task_8 }

        

        allow = {
            p:6732 = {
                num_goods_produced >= 3 
            }

            p:7267 = {
                num_goods_produced >= 3 
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.22
            }
            p:6732 = {
                start_building_construction = latifundia_building
            }
            p:7267 = {
                start_building_construction = latifundia_building
            }
        }
       
    }

    tayuan_ferghana_task_22 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_19 tayuan_ferghana_task_20 }

        

        allow = {
            custom_tooltip = {
                text = tay_bacchamp_tt
                tay_bactrian_champion_owned_svalue = tay_bactrian_champion_svalue
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.23
            }
        }
       
    }

    tayuan_ferghana_task_23 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_21 tayuan_ferghana_task_22 }

        

        allow = {
            any_country_culture = {
                is_culture = tayuan
                has_pop_type_right = nobles
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.24
            }
        }
       
    }

    tayuan_ferghana_task_24 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_16 }

        

        allow = {
            
            # owns = #tayuan_holysiteprovince

            custom_tooltip = {
                text = tayuan_vakhsh_tt
                has_this_omen = deity:omen_vakhsh
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.25
            }
        }
       
    }

    tayuan_ferghana_task_25 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_10 }

        

        allow = {
            custom_tooltip = {
                    text = 1_culture_points_qin_tt
                    var:qin_culture_points >= 1
            }
            custom_tooltip = {
                    text = 1_culture_points_ferghani_tt
                    var:tayuan_culture_points >= 1
            }
            custom_tooltip = {
                    text = 1_culture_points_buddhist_tt
                    var:zhangzhung_culture_points >= 1
            }
            custom_tooltip = {
                text = tayuan_patron_of_arts
                has_country_modifier = patron_of_arts_button_modifier
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.26
            }
            ionian_culture_point_effect = yes

            capital_scope = {
                start_building_construction = academy_building
            }
        }
       
    }

    tayuan_ferghana_task_28 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_14 }

        

        allow = {
			custom_tooltip = {
				text = tayuanparthia_own_tt
				tayuan_owns_parthia_region_svalue >= 22
			}
        }


        on_completion = {
            custom_tooltip = tayuan_silk_road_outpost_tt
            trigger_event = {
                id = me_tayuan_ferghana.27
            }
        }
       
    }

    tayuan_ferghana_task_27 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_14 tayuan_ferghana_task_11 }

        

        allow = {
            custom_tooltip = {
					text = tay_rulerorator_tt
					current_ruler.charisma >= 7
			}
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.28
            }
        }
       
    }

    tayuan_ferghana_task_26 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_11 }

        

        allow = {
            
        }


        on_completion = {
            custom_tooltip = tay_tarimroad
            trigger_event = {
                id = me_tayuan_ferghana.29
            }
            hidden_effect = {
                p:7184 = {
				    add_road_towards = 7183
			    }
                p:7183 = {
				    add_road_towards = 5665
			    }
                p:5665 = {
				    add_road_towards = 8761
			    }
                p:8761 = {
				    add_road_towards = 8760
			    }
                p:8760 = {
				    add_road_towards = 6744
			    }
            }
        }
       
    }

    tayuan_ferghana_task_29 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_10 }

        

        allow = {
            custom_tooltip = {
                text = tay_disloyals_tt
                tayuan_disloyal_svalue >= 4
            }
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.30
            }
        }
       
    }

    tayuan_ferghana_task_30 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_5 }

        

        allow = {
            treasury >= 130
            
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.31
            }
            add_treasury = -130
            custom_tooltip = tay_monasteryspawn_tt
            random_owned_province = {
                limit = {
                    trade_goods = hemp
                }
                hidden_effect = {
                    add_province_modifier = {
                        name = tay_monasterymod
                        duration = -1
                    }
                    while = {
                        count = 6
                        random_pops_in_province = {
                            set_pop_religion = buddhism
                            set_pop_culture = kuru
                            set_pop_type = freemen
                        }
                    }
                    define_pop = {
								type = freemen
								culture = kuru
								religion = buddhism
					}
                    define_pop = {
								type = freemen
								culture = kuru
								religion = buddhism
					}
                    define_pop = {
								type = freemen
								culture = kuru
								religion = buddhism
					}
                }
            }
        }
       
    }

    tayuan_ferghana_task_31 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_5 }

        

        allow = {


        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.32
            }
        }
       
    }

    tayuan_ferghana_task_32 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_5 tayuan_ferghana_task_12 }

        

        allow = {
            custom_tooltip = {
                text = tayuan_import_papyrus_tt
                AND = {
                    area:cyropolis_area = {
                        any_area_province = {
                            is_importing_trade_good = papyrus
                        }
                    }
                    area:tarim_area = {
                        any_area_province = {
                            is_importing_trade_good = papyrus
                        }
                    }
                }
            }
            custom_tooltip = {
				any_character = {
					has_tech_office_of = religious_tech
					zeal >= 12
				}
				text = ferghani_religious_researcher_tt
			}
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.33
            }
        }
       
    }

    tayuan_ferghana_task_33 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_10 }

        

        allow = {
            
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.34
            }
            add_country_modifier = {
                name = tay_synechiai
            }
        }
       
    }

    tayuan_ferghana_task_34 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_31 }

        

        allow = {
            owns_or_subject_owns_area = gandhara_area
            owns_or_subject_owns_area = bamyan_area
            owns_or_subject_owns_area = suvarna_gotra_area
            owns_or_subject_owns_area = taxila_area
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.35
            }
        }
       
    }

    tayuan_ferghana_task_35 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_13 tayuan_ferghana_task_26 }

        

        allow = {
            any_subject = {
				count >= 2
				is_subject_type = vassal_tribe
                country_culture_group = sakan
			}
        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.36
            }
        }
       
    }

    tayuan_ferghana_task_36 = {
        icon = "task_diplomatic"
        requires = { tayuan_ferghana_task_28 }

        

        allow = {


        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.37
            }
        }
       
    }


    tayuan_ferghana_task_ = {
        icon = "task_diplomatic"
        requires = { }

        

        allow = {


        }


        on_completion = {
            trigger_event = {
                id = me_tayuan_ferghana.
            }
        }
       
    }

    
}