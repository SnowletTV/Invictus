turdetanian_mission_02_heirs_tartessia_inv = {
    header = "mission_image_generic_greek"
    icon = thrace_3

    repeatable = no
    chance = {
        factor = 10
    }
    ai_chance = { factor = 10 }

    potential = {
    	primary_culture = turdetanian
		NOT = { has_variable = turdetanian_mission_02_heirs_tartessia_cooldown }
		always = no
    }

    abort = {
		ai_mission_back_out_trigger = yes
	}
	
    on_start = {
        start_mission_ai_effect = yes
		trigger_event = me_turdetania_2_heirs_tartessia.1
    }
	
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = turdetanian_mission_02_heirs_tartessia_cooldown
            days = 7300
        }
		turdetanian_mission_02_heirs_tartessia_inv_variable_cleanup_effect = yes
    }

    on_completion = {
        complete_mission_effect = yes
        add_2_free_province_investments = yes
		hidden_effect = {
			turdetanian_mission_02_heirs_tartessia_inv_variable_cleanup_effect = yes
		}
    }
	
	turdetania_02_heirs_tartessia_inv_task_1 = { # A Greek Tale
		icon = task_diplomatic
		duration = 120

		requires = { }
		
		allow = {
			treasury >= 100
			custom_tooltip = {
                text = turdetania_02_heirs_tartessia_inv_task_1_tooltip
				any_country = {
                    NOT = { this = root }
                    country_culture_group = hellenic
				    in_diplomatic_range = ROOT
					opinion = {
						target = root
						value >= 35
					}
                }
            }
		}
		
		on_start = {
            add_treasury = -100
			trigger_event = me_turdetania_2_heirs_tartessia.2
        }
		
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.4
			show_as_tooltip = {
				random_country_culture = {
					limit = { THIS.culture = c:MAS.culture }
					add_country_culture_modifier = {
						name = "leyend_arganthonios_modifier"
						duration = 3650
					}
				}
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_2 = { # Tartessify the River
		icon = task_economical

		requires = { turdetania_02_heirs_tartessia_inv_task_1 }

		highlight = {
			scope:province = {
				OR = { 
					province_id = 1341
					province_id = 1342
					province_id = 1343
					province_id = 1353
					province_id = 1358
				}
			}
		}

		allow = {
			hidden:p:1341 = {
				civilization_value >= 40
				total_population >= 30
				owner = root
			}
			hidden:p:1342 = {
				civilization_value >= 40
				total_population >= 30
				owner = root
			}
			hidden:p:1343 = {
				civilization_value >= 40
				total_population >= 30
				owner = root
			}
			hidden:p:1353 = {
				civilization_value >= 40
				total_population >= 30
				owner = root
			}
			hidden:p:1358 = {
				civilization_value >= 40
				total_population >= 30
				owner = root
			}
		}

		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.5
			show_as_tooltip = {
				current_ruler = {
					add_popularity = 15
				}
				p:7665 = {
					change_province_name = "Sinus Tartessicus"
				}
				custom_tooltip = turdetania_02_heirs_tartessia_inv_task_2_tooltip_a
				custom_tooltip = turdetania_02_heirs_tartessia_inv_task_2_tooltip_b
				p:1341 = {
					add_permanent_province_modifier = {
						name = sinus_tartessicus_modifier
						duration = -1
					}
				}
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_3 = { # Worship of Arganthonios
		icon = task_religion

		requires = { turdetania_02_heirs_tartessia_inv_task_1 }
		
		highlight = {
			scope:province = { this = ROOT.capital_scope }
		}
		
		bypass = {
			has_variable = deity_unlocked_arganthonios
		}
		
		allow = {
			current_ruler = { popularity >= 80 }
			political_influence >= 100
			capital_scope = { has_building = temple_building }
		}
		
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.6
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_3_tooltip_b
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_3_tooltip_c
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_4 = { # The Silver Man
		icon = task_political
		final = yes
		
		requires = { turdetania_02_heirs_tartessia_inv_task_6 }
		duration = 90
		
		potential = {
			current_ruler = { is_minor_character = no }
		}

		allow = {
			political_influence >= 100
			current_ruler = { popularity >= 75 }
			current_ruler.family = { prestige >= 900 }
			has_deity_in_pantheon = deity:omen_arganthonios
		}

		on_start = {
			trigger_event = { id = me_turdetania_2_heirs_tartessia.7 }
		}

		on_completion = {
			trigger_event = { id = me_turdetania_2_heirs_tartessia.8 }
			show_as_tooltip = {
				current_ruler = {
	                deify_character = {
	                    deity = deity:omen_arganthonios
	                    country = ROOT
	                }
					add_nickname = NICKNAME_ARGANTHONIOS
				}
	        	current_ruler = {
					add_popularity = popularity_large
					family = { add_prestige = prestige_huge }
				}
				add_country_modifier = {
					name = turdetanian_ruler_deified_modifier
					duration = 1825 # 5 years
				}
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_5 = { # Legacy of Arganthonios
		requires = { turdetania_02_heirs_tartessia_inv_task_3 }
		icon = task_atlas

		highlight = {
			scope:province = { province_id = 285 }
		}
		
		allow = {
			owns = 285
			hidden:p:285 = {
				has_city_status = yes
				fort_level >= 3
			}
		}
		
		on_completion = {
			trigger_event = { id = me_turdetania_2_heirs_tartessia.9 }
			show_as_tooltip = {
				current_ruler = { add_popularity = popularity_medium }
				p:285 = {
					define_pop = {
						culture = turdetanian
						religion = animism
						type = citizen
					}
					define_pop = {
						culture = turdetanian
						religion = animism
						type = citizen
					}
					define_pop = {
						culture = massalian
						religion = roman_pantheon
						type = citizen
					}
					define_pop = {
						culture = massalian
						religion = roman_pantheon
						type = citizen
					}
					add_province_modifier = { name = turdetanian_phocaea_liberated_modifier duration = 3650 }
					add_permanent_province_modifier = { name = turdetanian_walls_of_arganthonios_modifier }
					change_province_name = "Phokaia"
				}
			}
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_5_tooltip
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_6 = { # The city of Arganthonios
		requires = { turdetania_02_heirs_tartessia_inv_task_3 }
		icon = task_religion

		highlight = {
			scope:province = { province_id = 1341 }
		}
		
		allow = {
			owns = 1341
			hidden:p:1341 = {
				has_city_status = yes
				has_building = temple_building
				free_building_slots < 1
				has_construction = no
			}
			hidden:deity:omen_arganthonios = {
				has_holy_site = yes
			}
		}
		
		on_completion = {
			trigger_event = { id = me_turdetania_2_heirs_tartessia.10 }
			show_as_tooltip = {
				current_ruler = {
					add_popularity = popularity_medium
					if = {
						limit = { number_of_traits <= 5 }
						add_trait = founder
					}
				}
				p:1341 = {
					change_province_name = "Arganthonia"
					add_permanent_province_modifier = { name = turdetanian_arganthonia_modifier }
				}
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_6 = { # The Blood of Arganthonios
		icon = task_political
		requires = { turdetania_02_heirs_tartessia_inv_task_3 }

		allow = {
			custom_tooltip = {
				text = turdetania_02_heirs_tartessia_inv_task_6_tooltip
				current_ruler = { has_trait = blood_of_arganthonios }
			}
		}
		
		bypass = {
			current_ruler = { 
				NOR = {
					has_trait = blood_of_arganthonios
					AND = {
						is_married = yes
						spouse = { has_trait = blood_of_arganthonios }
					}
					any_child = { has_trait = blood_of_arganthonios }
				}
			}
		}
		
		on_completion = {
			show_as_tooltip = {
				current_ruler = { add_popularity = popularity_large }
		        add_country_modifier = {
		            name = turdetanian_descendant_arganthonios
		            duration = 7300 # 20 years
		        }
			}
			trigger_event = { id = me_turdetania_2_heirs_tartessia.11 }
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_7 = { # Vineyards of Turdetania
		icon = task_artemis

		requires = { }
		
		highlight = {
			scope:province = {
				owner = root
				OR = {
					is_in_area = couneia_area
					is_in_area = turdetania_occidentalis_area
					is_in_area = baetica_hispalensis_area
					is_in_area = baetica_cordubensis_area
					is_in_area = gaditanus_area
					is_in_area = malacita_area
				}
				trade_goods = wine
			}
		}
		
		allow = {
            custom_tooltip = {
                text = turdetania_01_generic_inv_task_8_tooltip
                turdetania_02_heirs_tartessia_inv_task_7_owned_latifundia_current >= 6
            }
        }
		
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.12
			show_as_tooltip = {
				ordered_owned_province = {
					limit = {
						has_building = latifundia_building
					}
					order_by = total_population
					max = 8
					add_permanent_province_modifier = {
						name = turdetanian_vineyards
					}
				}
				add_country_modifier = {
		            name = turdetanian_cheap_libations
		            duration = 7300 # 20 years
		        }
			}
		}
	}
}