turdetanian_mission_02_heirs_tartessia_inv = {
    header = "mission_image_generic_greek"
    icon = thrace_3

    repeatable = no
    chance = {
        factor = 10
    }
    ai_chance = { factor = 10 }

    potential = {
    	primary_culture = turdetanian
		NOT = { has_variable = turdetanian_mission_02_heirs_tartessia_cooldown }
    }

    abort = {
		ai_mission_back_out_trigger = yes
	}
	
    on_start = {
        start_mission_ai_effect = yes
		trigger_event = me_turdetania_2_heirs_tartessia.1
    }
	
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = turdetanian_mission_02_heirs_tartessia_cooldown
            days = 7300
        }
		turdetanian_mission_02_heirs_tartessia_inv_variable_cleanup_effect = yes
    }

    on_completion = {
        complete_mission_effect = yes
        add_2_free_province_investments = yes
		hidden_effect = {
			turdetanian_mission_02_heirs_tartessia_inv_variable_cleanup_effect = yes
		}
    }
	
	turdetania_02_heirs_tartessia_inv_task_1 = { # A Greek Tale
		icon = task_diplomatic
		duration = 120

		requires = { }
		
		allow = {
			treasury >= 100
			custom_tooltip = {
                text = turdetania_02_heirs_tartessia_inv_task_1_tooltip
				any_country = {
                    NOT = { this = root }
                    country_culture_group = hellenic
				    in_diplomatic_range = ROOT
					opinion = {
						target = root
						value >= 35
					}
                }
            }
		}
		
		on_start = {
            add_treasury = -100
			trigger_event = me_turdetania_2_heirs_tartessia.2
        }
		
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.4
			show_as_tooltip = {
				random_country_culture = {
					limit = { THIS.culture = c:MAS.culture }
					add_country_culture_modifier = {
						name = "leyend_arganthonios_modifier"
						duration = 3650
					}
				}
				area:celticia_maoioris_area = {
					add_provincial_claim_effect = yes
				}
				area:turdulia_occidentalis_area = {
					add_provincial_claim_effect = yes
				}
				area:celticia_minoris_area = {
					add_provincial_claim_effect = yes
				}
				area:couneia_area = {
					add_provincial_claim_effect = yes
				}
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_2 = { # Tartessify the River
		icon = task_economical

		requires = { turdetania_02_heirs_tartessia_inv_task_1 }

		highlight = {
			scope:province = {
				OR = { 
					province_id = 1341
					province_id = 1342
					province_id = 1343
					province_id = 1353
					province_id = 1358
				}
			}
		}

		allow = {
			custom_tooltip = {
				text = turdetania_02_heirs_tartessia_inv_task_2_tooltip_c
				hidden:p:1341 = {
					civilization_value >= 40
					total_population >= 25
					owner = root
				}
				hidden:p:1342 = {
					civilization_value >= 40
					total_population >= 25
					owner = root
				}
				hidden:p:1343 = {
					civilization_value >= 40
					total_population >= 25
					owner = root
				}
				hidden:p:1353 = {
					civilization_value >= 40
					total_population >= 25
					owner = root
				}
				hidden:p:1358 = {
					civilization_value >= 40
					total_population >= 25
					owner = root
				}
			}
		}

		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.5
			show_as_tooltip = {
				current_ruler = {
					add_popularity = 15
				}
				p:7665 = {
					change_province_name = "Sinus Tartessicus"
				}
				custom_tooltip = turdetania_02_heirs_tartessia_inv_task_2_tooltip_a
				custom_tooltip = turdetania_02_heirs_tartessia_inv_task_2_tooltip_b
				p:1341 = {
					add_permanent_province_modifier = {
						name = sinus_tartessicus_modifier
						duration = -1
					}
				}
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_3 = { # Worship of Arganthonios
		icon = task_religion

		requires = { turdetania_02_heirs_tartessia_inv_task_2 }
		
		highlight = {
			scope:province = { this = ROOT.capital_scope }
		}
		
		bypass = {
			has_variable = deity_unlocked_arganthonios
		}
		
		allow = {
			current_ruler = { popularity >= 80 }
			political_influence >= 100
			capital_scope = { has_building = temple_building }
		}
		
		on_completion = {
			show_as_tooltip = {
				add_political_influence = -100
			}
			trigger_event = me_turdetania_2_heirs_tartessia.6
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_3_tooltip_b
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_3_tooltip_c
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_4 = { # The Silver Man
		icon = task_political
		final = yes
		
		requires = { turdetania_02_heirs_tartessia_inv_task_6 }
		duration = 90
		
		potential = {
			current_ruler = { is_minor_character = no }
		}

		allow = {
			political_influence >= 100
			current_ruler = { popularity >= 75 }
			current_ruler.family = { prestige >= 900 }
			has_deity_in_pantheon = deity:omen_arganthonios
		}

		on_start = {
			trigger_event = me_turdetania_2_heirs_tartessia.7
		}

		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.8
			show_as_tooltip = {
				current_ruler = {
	                deify_character = {
	                    deity = deity:omen_arganthonios
	                    country = ROOT
	                }
					add_nickname = NICKNAME_ARGANTHONIOS
				}
	        	current_ruler = {
					add_popularity = popularity_large
					family = { add_prestige = prestige_huge }
				}
				add_country_modifier = {
					name = turdetanian_ruler_deified_modifier
					duration = 1825 # 5 years
				}
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_5 = { # Legacy of Arganthonios
		requires = { turdetania_02_heirs_tartessia_inv_task_6 }
		icon = task_atlas

		highlight = {
			scope:province = { province_id = 285 }
		}
		
		allow = {
			owns = 285
			hidden:p:285 = {
				has_city_status = yes
				fort_level >= 3
			}
		}
		
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.9
			show_as_tooltip = {
				current_ruler = { add_popularity = popularity_medium }
				p:285 = {
					define_pop = {
						culture = turdetanian
						religion = animism
						type = citizen
					}
					define_pop = {
						culture = turdetanian
						religion = animism
						type = citizen
					}
					define_pop = {
						culture = massalian
						religion = roman_pantheon
						type = citizen
					}
					define_pop = {
						culture = massalian
						religion = roman_pantheon
						type = citizen
					}
					add_province_modifier = { name = turdetanian_phocaea_liberated_modifier duration = 3650 }
					add_permanent_province_modifier = { name = turdetanian_walls_of_arganthonios_modifier }
					change_province_name = "Phokaia"
				}
			}
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_5_tooltip
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_6 = { # The city of Arganthonios
		requires = { turdetania_02_heirs_tartessia_inv_task_3 }
		icon = task_religion

		highlight = {
			scope:province = { province_id = 1341 }
		}
		
		allow = {
			owns = 1341
			hidden:p:1341 = {
				has_city_status = yes
				is_holy_site = no
				has_building = temple_building
				free_building_slots < 1
				has_construction = no
			}
			hidden:deity:omen_arganthonios = {
				has_holy_site = no
			}
		}
		
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.10
			show_as_tooltip = {
				current_ruler = {
					add_popularity = popularity_medium
					if = {
						limit = { number_of_traits <= 5 }
						add_trait = founder
					}
				}
				p:1341 = {
					change_province_name = "Arganthonia"
					set_province_deity = deity:omen_arganthonios
					add_permanent_province_modifier = { name = turdetanian_arganthonia_modifier }
				}
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_7 = { # The Blood of Arganthonios
		icon = task_political
		requires = { turdetania_02_heirs_tartessia_inv_task_3 }

		allow = {
			custom_tooltip = {
				text = turdetania_02_heirs_tartessia_inv_task_7_tooltip
				current_ruler = { has_trait = blood_of_arganthonios }
			}
		}
		
		on_completion = {
			show_as_tooltip = {
				current_ruler = { add_popularity = popularity_large }
		        add_country_modifier = {
		            name = turdetanian_descendant_arganthonios
		            duration = 7300 # 20 years
		        }
			}
			trigger_event = me_turdetania_2_heirs_tartessia.11
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_8 = { # Vineyards of Turdetania
		icon = task_artemis

		requires = { }
		
		highlight = {
			scope:province = {
				owner = root
				OR = {
					is_in_area = couneia_area
					is_in_area = turdetania_occidentalis_area
					is_in_area = baetica_hispalensis_area
					is_in_area = baetica_cordubensis_area
					is_in_area = gaditanus_area
					is_in_area = malacita_area
				}
				trade_goods = wine
			}
		}
		
		allow = {
            custom_tooltip = {
                text = turdetania_02_heirs_tartessia_inv_task_8_tooltip
                turdetania_02_heirs_tartessia_inv_task_7_owned_latifundia_current >= 6
            }
        }
		
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.12
			show_as_tooltip = {
				ordered_owned_province = {
					limit = {
						has_building = latifundia_building
					}
					order_by = total_population
					max = 8
					add_permanent_province_modifier = {
						name = turdetanian_vineyards
					}
				}
				add_country_modifier = {
		            name = turdetanian_cheap_libations
		            duration = 7300 # 20 years
		        }
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_9 = { # Restore Tharsis Mines
		icon = task_economical
		duration = 60
		
		highlight = {
			scope:province = {
				province_id = 1415
			}
        }

		requires = { turdetania_02_heirs_tartessia_inv_task_8 }

		allow = {
			treasury >= 150
			civic_tech >= 4
			hidden:p:1415 = {
				has_building = slave_mine_building
				has_no_ongoing_construction = yes
			}
		}
		
		on_start = {
			trigger_event = me_turdetania_2_heirs_tartessia.13
			show_as_tooltip = {
				add_treasury = -100
			}
		}

		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.14
			show_as_tooltip = {
				add_treasury = -50
				p:1415 = {
					create_3_slaves_effect = yes
					add_permanent_province_modifier = {
						name = mines_of_tharsis_restored
					}
				}
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_10 = { # Codify Tartessian Laws
		icon = task_political
		duration = 60
		
		requires = { turdetania_02_heirs_tartessia_inv_task_9 }
		
		allow = {
			treasury >= 200
			political_influence >= 25
			hidden:capital_scope = {
				custom_tooltip = {
					text = turdetanian_generic_brings_base_metals_tooltip
					OR = {
						state = {
							any_state_province = {
								trade_goods = base_metals
							}
						}
						is_importing_trade_good = base_metals
					}
				}
			}
		}
		
		on_start = {
			trigger_event = me_turdetania_2_heirs_tartessia.15
			show_as_tooltip = {
				add_treasury = -100
				add_political_influence = -25
			}
		}
		
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.17
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_10_tooltip
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_11 = { # The Tin Road
		icon = task_economical
		duration = 365
		
		requires = { turdetania_02_heirs_tartessia_inv_task_13 }
		
		highlight = {
			scope:province = {
				OR = {
					province_id = 1377
					province_id = 1378
					province_id = 1446
					province_id = 1441
					province_id = 1404
					province_id = 1407
					province_id = 1436
				}
			}
        }

		allow = {
			treasury >= 100
			civic_tech >= 1
		}
		
		bypass = {
			has_global_variable = turdetanian_road_variable
		}
		
		on_start = {
			show_as_tooltip = {
				add_treasury = -100
			}
			trigger_event = me_turdetania_2_heirs_tartessia.18
		}	
		
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.20
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_11_tooltip
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_12 = { # Back to the North
		icon = task_conquest

		requires = { turdetania_02_heirs_tartessia_inv_task_1 }
		
		highlight = {
			scope:province = {
				OR = {
					is_in_area = turdulia_occidentalis_area
					is_in_area = celticia_maoioris_area
				}
				NOT = { owner = root }
			}
		}
		
		allow = {
			owns = 1436
			owns_percent_of_area = {
                PROVINCE = "p:1429"
                PERCENT = "0.75"
            }
            owns_percent_of_area = {
                PROVINCE = "p:1435"
                PERCENT = "0.75"
            }
		}
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.21
			show_as_tooltip = {
				add_country_modifier = {
					name = turdetanian_back_north_modifier
					duration = 5475
				}
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_13 = { # Resettle the Anas
		icon = task_expansion

		requires = { turdetania_02_heirs_tartessia_inv_task_12 }
		
		highlight = {
			scope:province = {
				province_id = 1436
			}
		}
		
		allow = {
			hidden:p:1436 = {
				has_city_status = yes
				is_state_capital = yes
				fort_level >= 1
				has_building = library_building
				has_building = commerce_building
			}
		}
		
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.22
			show_as_tooltip = {
				p:1436 = { 
					create_state_pop = citizen
					create_state_pop = citizen
					create_state_pop = citizen
					create_state_pop = freemen
					create_state_pop = freemen
					add_province_modifier = {
						name = turdetanian_settling_anas_modifier
						duration = 1825
					}
				}
			}
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_14 = { # The Temple of Astarte
		icon = task_religion
		duration = 365

		requires = { turdetania_02_heirs_tartessia_inv_task_13 }
		
		highlight = {
			scope:province = {
				province_id = 1407
			}
		}
		
		bypass = {
			OR = {
				AND = {
					has_variable = turdetania_02_heirs_tartessia_inv_task_14_bypass
					NOT = { owns = 1407 }
				}
				p:1407 = { is_holy_site = yes }
			}
		}
		
		on_bypass = {
			if = {
				limit = { has_variable = turdetania_02_heirs_tartessia_inv_task_14_bypass }
				trigger_event = me_turdetania_2_heirs_tartessia.27
			}
		}
		
		allow = {
			owns = 1407
			hidden:p:1407 = { is_holy_site = no }
			political_influence >= 100
			treasury >= 200
		}
		
		on_start = {
			show_as_tooltip = {
				add_political_influence = -100
				add_treasury = -200
			}
			set_variable = {
				name = turdetania_02_heirs_tartessia_inv_task_14_bypass
				days = 365
			}
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_14_tooltip_a
			trigger_event = me_turdetania_2_heirs_tartessia.23
		}
		
		on_completion = {
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_14_tooltip
			show_as_tooltip = {
				p:1407 = { set_province_deity = deity:omen_astarte_turdetani }
	        }
			trigger_event = me_turdetania_2_heirs_tartessia.26
			
		}
	}
	
	turdetania_02_heirs_tartessia_inv_task_15 = { # The Destroyed Temple
		icon = task_political
		duration = 120
		
		requires = { turdetania_02_heirs_tartessia_inv_task_13 }
		
		allow = {
			owns = 1436
			treasury >= 200
		}
		
		bypass = {
			has_variable = turdetania_02_heirs_tartessia_inv_task_15_bypass
		}
		
		on_bypass = {
			if = {
				limit = { has_variable = turdetania_02_heirs_tartessia_inv_task_15_bypass }
				trigger_event = me_turdetania_2_heirs_tartessia.33
			}
		}
		
		on_start = {
			trigger_event = me_turdetania_2_heirs_tartessia.28
			show_as_tooltip = {
				add_treasury = -200
			}
		}
		
		on_completion = {
			trigger_event = me_turdetania_2_heirs_tartessia.32
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_15_tooltip
			custom_tooltip = turdetania_02_heirs_tartessia_inv_task_15_tooltip_a
		}
	}
}