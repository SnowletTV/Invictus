atropatene_mission_01 = {
    header = "mission_image_general" # SPECIAL FIELD - Sets top picture for the mission
    icon = "general_2" # SPECIAL FIELD - Sets icon for the mission

    repeatable = no # SPECIAL FIELD - Sets if a mission can be done once or several times

    chance = {
        factor = 50000
    } # SPECIAL FIELD - Sets the chances of a mission appearing in your list of available missions

    potential = {
        NOT = { has_variable = atropatene_mission_cooldown }
        tag = MAP # TRIGGER FIELD - Sets the conditions for the mission to appear in your list
        is_subject = no # must not be a subject
    }

    abort = {
        ai_mission_back_out_trigger = yes
    }
    
    on_start = {
        trigger_event = me_atropatene.45
        save_scope_as = me_atropatene_scope
        start_mission_ai_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is started

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = atropatene_mission_cooldown
            days = 1 #7300
        }
    } # EFFECT FIELD - These effects are run when the mission is aborted

    on_completion = {
        complete_mission_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is completed


    atropatene_mission_01_task_01 = { # A State for the Medes
        icon = "task_expansion"

        allow = {
            custom_tooltip = {
                text = atropatene_mission_01_task_01_tt
                any_country_culture = {
                    is_culture = median
                    is_integrated = yes
                    OR = {
                        has_country_culture_modifier = trial_right
                        has_country_culture_modifier = land_protection
                        has_country_culture_modifier = citizenship_by_adoption
                    }
                }
            }
        }

        duration = 30

        on_completion = {
            trigger_event = { id = me_atropatene.1 }
            hidden_effect = {
                if = {
                    limit = {
                        char:24 = { # Seleucus I Nicator
                            is_alive = no
                        }
                    }
                    set_variable = bypass_atropatene_mission_01_task_03
                }
            }
            show_as_tooltip = {
                add_country_modifier = {
                    name = state_for_the_medes
                    duration = 3650
                }
            }
        }
    }

    atropatene_mission_01_task_02 = { # The Birthplace of Zoroaster
       icon = "task_religion"

        allow = {
            political_influence >= 50
            treasury >= 200
        }

        highlight = {
            scope:province = {
                province_id = 1627
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.2 }

            show_as_tooltip = {
                add_political_influence = -50
                add_treasury = -200
                p:1627 = {
                    set_city_status = city
                }
            }
        }
    }

    atropatene_mission_01_task_03 = { # Strengthen the Median Identity
        icon = "task_diplomatic"
        requires = { atropatene_mission_01_task_13 }

        allow = {
            custom_tooltip = {
                text = atropatene_mission_01_task_03_tt
                area:media_area = {
                    any_area_province = {
                        dominant_province_culture = root.culture
                        count >= 8
                    }
                }
                area:media_atropatene_area = {
                    any_area_province = {
                        dominant_province_culture = root.culture
                        count >= 8
                    }
                }
                area:parskahayk_area = {
                    any_area_province = {
                        dominant_province_culture = root.culture
                        count >= 8
                    }
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = media_area
                    is_in_area = media_atropatene_area
                    is_in_area = parskahayk_area
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.3 }
            show_as_tooltip = {
                add_country_modifier = {
                    name = the_median_identity
                    duration = 3650
                }
            }
        }

    }

    atropatene_mission_01_task_04 = { # Prosperity of Glittering Salt
        icon = "task_economical"
        requires = { atropatene_mission_01_task_01 }

        highlight = {
			scope:province = {
                OR = {
                    province_id = 1648
                    province_id = 1630
                    province_id = 4985
                    province_id = 4986
                }
			}
        }

        allow = {
            hidden:p:1648 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
            hidden:p:1630 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
            hidden:p:4985 = {
                has_construction = no
				has_building = population_building # Granary
            }
            hidden:p:4986 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.4 }

            show_as_tooltip = {
                p:1648 = {
                    add_province_modifier = {
                        name = prosperity_glittering_salt
                        duration = 3650
                    }
                }
                p:1630 = {
                    add_province_modifier = {
                        name = prosperity_glittering_salt
                        duration = 3650
                    }
                }
                p:4985 = {
                    add_province_modifier = {
                        name = prosperity_glittering_salt
                        duration = 3650
                    }
                }
                p:4986 = {
                    add_province_modifier = {
                        name = prosperity_glittering_salt
                        duration = 3650
                    }
                }
                area:parskahayk_area = {
                    add_provincial_claim_effect = yes
                }
                area:parsatunik_area = {
                    add_provincial_claim_effect = yes
                }
                area:hyrcania_area = {
                    add_provincial_claim_effect = yes
                }
                area:caucasian_albania_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }

    }

    atropatene_mission_01_task_05 = { # The Holy City of Ganzak
        icon = "task_religion"
        requires = { atropatene_mission_01_task_02 }

        allow = {
            stability >= 55
            religious_unity >= 0.90
            hidden:p:1515 = {
                has_building = temple_building
                has_building = theathre_building
                custom_tooltip = { 
                    text = atropatene_mission_01_task_05_tt_1                 
                    any_pops_in_province = {
                        pop_type = citizen
                        count >= 10
                    }
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 1515
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.5 }
            show_as_tooltip = {
                p:1515 = {
                    add_permanent_province_modifier = { #is this modifier actually giving bonuses?
                        name = the_holy_city
                        duration = -1
                    }
                }
                custom_tooltip = atropatene_mission_01_task_05_tt_2
            }
            hidden_effect = {
                region:armenia_region = {
                    every_region_province = {
                        add_claim = ROOT
                    }
                }
            }
        }
    }

    atropatene_mission_01_task_06 = { # Mystical Kashmar
        icon = "task_expansion"
        requires = { atropatene_mission_01_task_02 }

        allow = {
            treasury >= 400
            manpower >= 10 # how is 2 = 1000 in-game
            political_influence >= 75
            owns_or_subject_owns = 1571
            owns_or_subject_owns_area = parsatunik_area
            owns_or_subject_owns_area = soducene_area
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 1571 # chosen for the large population it has
                    is_in_area = parsatunik_area
                    is_in_area = soducene_area
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.6 }

            show_as_tooltip = {
                current_ruler = { add_popularity = popularity_medium }
                add_legitimacy = 10
            }
        }

    }

    atropatene_mission_01_task_07 = { # Reinstate the Magi
        icon = "task_happiness"
        requires = { atropatene_mission_01_task_02 }

        allow = {
            # TODO check omen power for 110%
			custom_tooltip = {
				text = atropatene_mission_01_task_07_tt
				trigger_if = {
					limit = {
						any_character = { has_office = office_high_priest_monarchy }
					}
					any_character = {
						has_office = office_high_priest_monarchy
						loyalty >= 70
					}
				}
			}
            treasury >= 300
            manpower >= 5 # how is this 1000
            political_influence >= 55
            invention = gw_effect_zeal_education_inv # Has the invention Theological Colleges
            invention = omen_power_inv_4 # Has the invention Proscribed Canon
            invention = omen_duration_inv_1 # Has the invention Grand Temples
        }

        on_completion = {
            trigger_event = { id = me_atropatene.7 }
            add_treasury = -300
            add_manpower = -5
            add_political_influence = -55
            current_ruler = {
                add_popularity = 5
            }
            show_as_tooltip = {
                add_country_modifier = {
                    name = reinstated_magi
                    duration = -1
                }
                custom_tooltip = atropatene_mission_01_task_07_tt2
            }
        }

    }

    atropatene_mission_01_task_08 = { # For My Son
        icon = "task_conquest"
        requires = { atropatene_mission_01_task_01 }

        allow = {
            custom_tooltip = atropatene_mission_01_task_08_tt
            hidden:char:24 = { # Seleucus I Nicator
                is_alive = no
            } 
        }
        bypass = {
            has_variable = bypass_atropatene_mission_01_task_03
        }

        on_completion = {
            trigger_event = { id = me_atropatene.8 }

            show_as_tooltip = {
                current_ruler = { 
                    add_popularity = popularity_large 
                    force_add_trait = ambitious 
                    family = {
                        add_prestige = 100
                    }
                }
                c:MAP = {
                    add_country_modifier = {
                        name = seleukid_unrest
                        duration = 1825
                    }
                }
                c:SEL = {
                    add_country_modifier = {
                        name = death_of_seleucus
                        duration = 1095
                    }
                }
            }
        }

    }

    atropatene_mission_01_task_09 = { # The Atropatene Treasury
        icon = "task_economical"
        requires = { atropatene_mission_01_task_04 atropatene_mission_01_task_05 }

        allow = {
            p:1515 = {
                num_of_academy_building >= 2 # academy
                num_of_library_building >= 2 # library
                num_of_commerce_building >= 3 # marketplace
                num_of_town_hall_building >= 3 # Tax office

                custom_tooltip = { 
                    text = atropatene_mission_01_task_09_tt_1
                    any_pops_in_province = {
                        pop_type = nobles
                        count >= 5
                    }
                }
                custom_tooltip = { 
                    text = atropatene_mission_01_task_09_tt_2
                    any_pops_in_province = {
                        count >= 45
                    }
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 1515
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.9 }

            show_as_tooltip = {
                add_4_free_province_investments = yes
                add_innovation = 4
                add_political_influence = 100

                p:1515 = {
                    add_permanent_province_modifier = {
                        name = treasury_of_ganzak
                    }
                }
            }
        }
    }

    atropatene_mission_01_task_10 = { # Hunt for the Avesta
        icon = "task_battle"
        requires = { atropatene_mission_01_task_05 }
        requires = { atropatene_mission_01_task_19 }
        requires = { atropatene_mission_01_task_40 }

        allow = {
            manpower >= 10
            owns_or_subject_owns_area = persepolis_area
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = persepolis_area
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.10 }
            add_country_modifier = {
                 name = the_royal_library
            }
        }
    }

    atropatene_mission_01_task_11 = { # Travels of the Royal Spirit
        icon = "task_happiness"
        requires = { atropatene_mission_01_task_06 }

        allow = {
            hidden:p:4985 = {
                has_building = temple_building
                has_building = forum_building

                custom_tooltip = { 
                    text = atropatene_mission_01_task_11_tt_1
                    any_pops_in_province = {
                        pop_type = nobles
                        count >= 4
                    }
                }
                custom_tooltip = { 
                    text = atropatene_mission_01_task_11_tt_2
                    any_pops_in_province = {
                        count >= 45
                    }
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 4985
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.11 }

            show_as_tooltip = {
                p:4985 = {
                    add_permanent_province_modifier = {
                        name = the_royal_spirit
                    }
                }
            }
        }
    }

    atropatene_mission_01_task_12 = { # The Faith of the Kadousioi
        icon = "task_religion"
        requires = { atropatene_mission_01_task_07 }

        allow = {
            has_law = heritage_tax_exemption
            area:kadousioi_area = {
                any_area_province = {
                    has_city_status = yes
                    has_building = temple_building
                    count >= 5  
                }
            }
            p:1627 = {
                treasure_count >=2
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 1627
                    is_in_area = kadousioi_area
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.12 }

            show_as_tooltip = {
                p:1627 = {
                    add_permanent_province_modifier = {
                        name = the_faith_of_kadousioi
                    }
                }
            }
        }
    }

    atropatene_mission_01_task_13 = { # Civilize the Cadusians
        icon = "task_diplomatic"
        requires = { atropatene_mission_01_task_08 }

        allow = {
            custom_tooltip = {
                text = atropatene_mission_01_task_13_tt
                any_owned_province = {
                    is_in_area = amardioi_area
                    dominant_province_culture = root.culture
                    count >=8
                }
                any_owned_province = {
                    is_in_area = kadousioi_area
                    dominant_province_culture = root.culture
                    count>=8
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = amardioi_area
                    is_in_area = kadousioi_area
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.13 }
            add_country_modifier = {
                name = medes_civilize_iranian_tribes_global
                duration = -1
            }
            area:amardioi_area = {
                every_area_province = {
                    limit = {
                        owner = root
                        has_city_status = yes
                    }
                    create_state_pop = citizen
                    create_state_pop = citizen
                }
            }
            area:kadousioi_area = {
                every_area_province = {
                    limit = {
                        owner = root
                        has_city_status = yes
                    }
                    create_state_pop = citizen
                    create_state_pop = citizen
                }
            }
            p:4985 = {
                add_permanent_province_modifier = {
                    name = medes_civilize_iranian_tribes
                }
                create_state_pop = nobles
                create_state_pop = nobles
            }
            p:1627 = {
                add_permanent_province_modifier = {
                    name = medes_civilize_iranian_tribes
                }
                create_state_pop = nobles
                create_state_pop = nobles
            }
        }
    }

    atropatene_mission_01_task_14 = { # Claim to Media
        icon = "task_expansion"
        requires = { atropatene_mission_01_task_03 }

        allow = {
            has_law = work_for_the_best # Royal Guard - Legion Law
            legitimacy >= 75
        }

        on_completion = {
            trigger_event = { id = me_atropatene.14 }
            show_as_tooltip = {
                custom_tooltip = atropatene_mission_01_task_14_tt
            }
        }
    }

    atropatene_mission_01_task_15 = { # Consolidate Lake Matiene
        icon = "task_expansion"
        requires = { atropatene_mission_01_task_04 }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = parskahayk_area
                    is_in_area = parsatunik_area
                }
            }
        }

        allow = {
            owns_or_subject_owns_area = parsatunik_area
            owns_or_subject_owns_area = parskahayk_area
            hidden:p:1502 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
            hidden:p:1505 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
            hidden:p:1506 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
            hidden:p:1517 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
            hidden:p:1518 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
            hidden:p:1519 = {
                has_construction = no
				has_building = basic_settlement_infratructure_building # farming settlement
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.15 }
            add_4_free_province_investments = yes
            p:1503 = {
                set_city_status = city
                add_permanent_province_modifier = {
                    name = lake_matiene
                }
                create_state_pop = nobles
                create_state_pop = citizen
                create_state_pop = freemen
                create_state_pop = slaves
                create_state_pop = slaves
            }
            p:1516 = {
                set_city_status = city
                add_permanent_province_modifier = {
                    name = lake_matiene
                }
                create_state_pop = nobles
                create_state_pop = citizen
                create_state_pop = freemen
                create_state_pop = slaves
                create_state_pop = slaves
            }
        }

    }

    atropatene_mission_01_task_16 = { # The Metropolis of Media
        icon = "task_calm"
        requires = { atropatene_mission_01_task_36 }

        allow = {
            owns = 1595
            hidden:p:1595 = {
                has_province_rank = city_metropolis
                # TODO
                # has_monthly_income >= 0.1

                custom_tooltip = { 
                    text = atropatene_mission_01_task_16_tt_2
                    any_pops_in_province = {
                        pop_type = nobles
                        count >= 10
                    }
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 1595
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.16 }

            show_as_tooltip = {
                add_innovation = 4
                add_8_free_province_investments = yes
                add_political_influence = 75
                add_country_modifier = {
                    name = metropolis_of_media
                }
            }
        }

    }

    atropatene_mission_01_task_17 = { # The Obscurity of Druj
        icon = "task_religion"
        requires = { atropatene_mission_01_task_11 }
        prevented_by = { atropatene_mission_01_task_18 }
        bypass = { 
            OR = {
                has_variable = the_light_of_asha_variable # me_atropatene.38
                has_variable = atropatene_good
            }
         }

        duration = 365

        on_start = {
            # todo event chain
        }

        on_completion = {
            set_variable = {
                name = atropatene_bad
                days = -1
            }

            trigger_event = { id = me_atropatene.17 }

            show_as_tooltip = {
                current_ruler = {
                    add_character_modifier = {
                        name = obscurity_of_druj
                        duration = -1
                    }
                }
            }

        }

    }

    atropatene_mission_01_task_18 = { # The Light of Asha
        icon = "task_religion"
        requires = { atropatene_mission_01_task_11 }
        prevented_by = { atropatene_mission_01_task_17 }
        bypass = { 
            OR = {
                has_variable = the_obscurity_of_druj_variable # me_atropatene.39
                has_variable = atropatene_good
            }
         }

        duration = 365

        on_start = {
            # todo event chain
        }

        on_completion = {
            set_variable = {
                name = atropatene_good
                days = -1
            }
            trigger_event = { id = me_atropatene.18 }

            show_as_tooltip = {
                current_ruler = {
                    add_character_modifier = {
                        name = light_of_asha
                        duration = -1
                    }
                }
            }
        }
    }

    atropatene_mission_01_task_19 = { # A Holy Metropolis
        icon = "task_atlas"
        requires = { atropatene_mission_01_task_12 }

        allow = {
            treasury >= 300
            political_influence >= 50

            hidden:p:1627 = {
                treasure_count = 3
                state = {
                    custom_tooltip = {
                        text = "have_4_religious_endowments_tooltip"
                        trigger_if = {
                            limit = {
                                has_variable = endowments_made
                            }
                            var:endowments_made >= 4
                        }
                        trigger_else = {
                            always = no
                        }
                    }
                }
                custom_tooltip = { 
                    text = atropatene_mission_01_task_19_tt
                    any_pops_in_province = {
                        count >= 80
                    }
                }
                custom_tooltip = { 
                    text = atropatene_mission_01_task_19_tt_2
                    any_pops_in_province = {
                        pop_type = nobles
                        count >= 12
                    }
                }
            }  
        }

        duration = 450

        highlight = {
            scope:province = {
                province_id = 1627
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.19 }

            show_as_tooltip = {
                add_treasury = -300
                add_political_influence = -50
                add_6_free_province_investments = yes
                add_innovation = 4
                p:1627 = {
                    set_city_status = city_metropolis
                    add_permanent_province_modifier = {
                        name = holy_metropolis_ardabil
                    }
                }
            }
        }

    }

    atropatene_mission_01_task_20 = { # Trade on the Mazandaran Sea
        icon = "task_expansion"
        requires = { atropatene_mission_01_task_15 }

        allow = {
            has_monthly_income >= 15
            AND = {
                owns = 4985
                hidden:p:4985 = { 
                    num_of_commerce_building >= 4
                    num_of_town_hall_building >= 3
                }
                owns = 4996
                hidden:p:4996 = { 
                    num_of_commerce_building >= 5
                }
                owns = 4997
                hidden:p:4997 = { 
                    num_of_commerce_building >= 4
                    num_of_town_hall_building >= 3
                }
                owns = 3434
                hidden:p:3434 = {
                    num_of_commerce_building >= 5
                    num_of_town_hall_building >= 2 
                }
                owns = 3435
                hidden:p:3435 = { 
                    num_of_commerce_building >= 4
                    num_of_town_hall_building >= 3
                }
                owns = 1644
                hidden:p:1644 = { 
                    num_of_commerce_building >= 2
                    num_of_town_hall_building >= 2
                }
                owns = 1633
                hidden:p:1633 = { 
                    num_of_commerce_building >= 5
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 4985
                    province_id = 4996
                    province_id = 4997
                    province_id = 3434
                    province_id = 3435
                    province_id = 1644
                    province_id = 1633
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.20 }

            #show_as_tooltip = {   # find a way to un-clutter this mess of a completion section.
                
            add_4_free_province_investments = yes
            show_as_tooltip = {
                custom_tooltip = atropatene_mission_01_task_20_tt_1
                custom_tooltip = atropatene_mission_01_task_20_tt_2
                p:4985 = { add_permanent_province_modifier = { name = mazandaran_migration }  }
            }
        }
    }

    atropatene_mission_01_task_21 = { # The Land of the Medes
        icon = "task_calm"
        requires = { atropatene_mission_01_task_14 }

        allow = {
            custom_tooltip = {
                text = atropatene_mission_01_task_29_tt
                tag = MEE # Formed Media
            }
            owns_region = media_region
            owns_area = hyrcania_area
            owns_area = parthia_komishene_area
            has_law = monarchy_religious_mandate_military
            has_law = public_notaries_law
        }

        duration = 365

        on_completion = {
            trigger_event = { id = me_atropatene.21 }
            declare_war_with_wargoal = {
                war_goal = imperial_conquest_wargoal
                target = SEL
            }
            show_as_tooltip = {

                add_political_influence = 75
                add_legitimacy = 15

                add_country_modifier = {
                    name = land_of_medes
                    duration = 3650
                }
                current_ruler = {
                    add_popularity = popularity_large 
                }
            }
        }
    }

    atropatene_mission_01_task_22 = { # Salty Success
        icon = "task_economical"
        requires = { atropatene_mission_01_task_15 }

        allow = {
            # 5 total province income in the parskayak and media atropatene provinces
            custom_tooltip = {
                text = atropatene_mission_01_task_22_tooltip
                atropatene_mission_01_task_22_money_current >= atropatene_mission_01_task_22_money_total
                atropatene_mission_01_task_22_unrest_current <= atropatene_mission_01_task_22_unrest_total
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.22 }

            show_as_tooltip = {
                add_6_free_province_investments = yes
                current_ruler = { add_popularity = popularity_medium }
                p:1515 = {
                    add_permanent_province_modifier = { name = salty_trade_routes }
                    create_state_pop = nobles
                    create_state_pop = nobles
                    create_state_pop = nobles
                    create_state_pop = nobles
                }
                area:parskahayk_area = {
                    every_area_province = {
                        limit = {
                            is_state_capital = yes
                        }
                        add_permanent_province_modifier = { name = salty_trade_routes }
                        create_state_pop = nobles
                        create_state_pop = nobles
                        create_state_pop = nobles
                        create_state_pop = nobles
                    }
                }
                area:kadousioi_area = {
                    every_area_province = {
                        limit = {
                            is_state_capital = yes
                        }
                        add_permanent_province_modifier = { name = salty_trade_routes }
                        create_state_pop = nobles
                        create_state_pop = nobles
                        create_state_pop = nobles
                        create_state_pop = nobles
                    }
                }
                area:amardioi_area = {
                    every_area_province = {
                        limit = {
                            is_state_capital = yes
                        }
                        add_permanent_province_modifier = { name = salty_trade_routes }
                        create_state_pop = nobles
                        create_state_pop = nobles
                        create_state_pop = nobles
                        create_state_pop = nobles
                    }
                }
            }
        }
    }

    atropatene_mission_01_task_23 = { # Penance
        icon = "task_happiness"
        requires = { atropatene_mission_01_task_17 }
        prevented_by = { atropatene_mission_01_task_18 }

        allow = {
            treasury >= 400
            political_influence >= 100

            # TODO Verify
			custom_tooltip = {
				text = atropatene_mission_01_task_23_tt
				trigger_if = {
					limit = {
						any_character = { has_office = office_bodyguard }
					}
					any_character = {
						has_office = office_bodyguard
						loyalty >= 80
					}
				}
			}
        }

        on_completion = {
            # TODO event chain
            trigger_event = { id = me_atropatene.23 }

            show_as_tooltip = {
                add_treasury = -400
                add_political_influence = -100
            }
        }

    }

    atropatene_mission_01_task_24 = { # Keeping The Faith
        icon = "task_atlas"
        requires = { atropatene_mission_01_task_18 }
        prevented_by = { atropatene_mission_01_task_17 }

        allow = {
            treasury >= 200
            political_influence >= 100
            stability >= 50
        }

        on_completion = {
            trigger_event = { id = me_atropatene.24 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = keeping_the_faith
                    duration = -1
                }
            }
        }

    }

    atropatene_mission_01_task_25 = { # The Median Highway
        icon = "task_political"
        requires = { atropatene_mission_01_task_21 }
        requires = { atropatene_mission_01_task_34 }

		allow = {
            has_monthly_income >= 20
			custom_tooltip = {
				text = atropatene_mission_01_task_25_tt
				num_of_commerce_building_total >= 60
			}
			custom_tooltip = {
				text = atropatene_mission_01_task_25_tt_1
				num_of_foundry_building_total >= 20
			}
			#p:1515.state = {                          ### Fix this with change to road-connection checks!!!!!!
            #    local_state_trade_routes >=5
			#	incoming_trade_routes >= 7
			#	outgoing_trade_routes >= 7
			#}
			#p:3386.state = {
			#	incoming_trade_routes >= 3
			#	outgoing_trade_routes >= 3			
			#}
			#p:1593.state = {
			#	incoming_trade_routes >= 3
			#	outgoing_trade_routes >= 3
			#}
			#p:4985.state = {
			#	incoming_trade_routes >= 3
			#	outgoing_trade_routes >= 3
			#}
			#p:6954.state = {
			#	incoming_trade_routes >= 3
			#	outgoing_trade_routes >= 3
			#}
			#p:1594.state = {
			#	incoming_trade_routes >= 3
			#	outgoing_trade_routes >= 3
			#}
			#p:1595.state = {
			#	incoming_trade_routes >= 3
			#	outgoing_trade_routes >= 3
			#}
			#p:4991.state = {
			#	incoming_trade_routes >= 3
			#	outgoing_trade_routes >= 3
			#}
			#p:4973.state = {
			#	incoming_trade_routes >= 3
			#	outgoing_trade_routes >= 3
			#}
		}

        #highlight = {
        #    scope:province = {
        #        OR = {
        #            is_in_area = media_atropatene_area
        #            is_in_area = media_area
        #            is_in_area = kadousioi_area
        #            is_in_area = amardioi_area
        #            is_in_area = media_choromithrene
        #            is_in_area = kossioi_area
        #            is_in_area = ecbatana_area
        #            is_in_area = rhagai_area
        #            is_in_area = aspadana_area
        #        }
        #    }
        #}

        on_completion = {
            trigger_event = { id = me_atropatene.25 } # Finish the event!!!!!!!!

            show_as_tooltip = {
                add_innovation = 4		
                current_ruler = {
                    force_add_trait = intelligent
                }
                add_country_modifier = {
                    name = atropatene_urbanization
                    duration = -1
                }
            }
        }

    }

    atropatene_mission_01_task_26 = { # The kingdom of Cyaxares
        icon = "task_battle"
        requires = { atropatene_mission_01_task_21 }

        allow = {
            custom_tooltip = {
                text = atropatene_mission_01_task_26_tt
                tag = GME # Formed Greater Media
            }
            owns_region = cappadocia_pontica_region
            owns_region = armenia_region
            owns_region = media_region
            owns_region = parthia_region
            owns_region = ariana_region
            owns_region = persis_region
            owns_area = garamig_area

            root.current_ruler = {
                popularity >= 90
            }
            legitimacy >= 90

            has_law = king_of_kings
            has_law = royal_bureaucracy # Might of Majesty
            
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_region = cappadocia_pontica_region
                    is_in_region = armenia_region
                    is_in_region = media_region
                    is_in_region = parthia_region
                    is_in_region = ariana_region
                    is_in_region = persis_region
                    is_in_area = garamig_area
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.26 }

            show_as_tooltip = {
                add_12_free_province_investments = yes
                add_innovation = 4
                add_political_influence = 50
            }
        }

    }

    atropatene_mission_01_task_27 = { # Redeemed Scholar
        icon = "task_political"
        requires = { atropatene_mission_01_task_23 }
        prevented_by = { atropatene_mission_01_task_18 }

        allow = {
			custom_tooltip = {
				text = atropatene_mission_01_task_27_tt
				num_of_academy_building_total >= 33
			}
			custom_tooltip = {
				text = atropatene_mission_01_task_27_tt_2
				num_of_library_building_total >= 40
			}
            # TODO has research efficiency of GTE 150
        }

        on_completion = {
            trigger_event = { id = me_atropatene.27 }
            show_as_tooltip = {
                # todo remove negative trait from current ruler
                add_country_modifier = {
                    name = redeemed_scholar
                    duration = -1
                }
            }
        }
    }

    atropatene_mission_01_task_28 = { # Holy Bazaars
        icon = "task_religion"
        requires = { atropatene_mission_01_task_24 }
        prevented_by = { atropatene_mission_01_task_17 }

        allow = {
            treasury >= 400
            manpower >= 100

            p:1627 = {
                num_of_commerce_building >= 5
            }
            p:1515 = {
                num_of_commerce_building >= 5
            }
            p:3444 = {
                num_of_commerce_building >= 5
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 1627
                    province_id = 1515
                    province_id = 3444
                }
            }
        }

        on_completion = {
            add_treasury = -300
            p:1627 = {
                create_state_pop = nobles
                create_state_pop = citizen
            }
            p:1515 = {
                create_state_pop = nobles
                create_state_pop = citizen
            }
            p:3444 = {
                create_state_pop = nobles
                create_state_pop = citizen
            }
            add_country_modifier = {
                name = holy_bazaars
            }
            add_6_free_province_investments = yes
            add_political_influence = 50 
        }

    }

    atropatene_mission_01_task_29 = { # A Median Legacy
        icon = "task_heracles"
        requires = { atropatene_mission_01_task_26 }
        final = yes

        allow = {
            owns = 958
            political_influence >= 100
        }

        duration = 365
        
        highlight = {
            scope:province = {
                OR = {
                    province_id = 958
                    province_id = 1595
                    province_id = 1515
                    province_id = 1593
                    province_id = 6954
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.29 }

            show_as_tooltip = {
                add_military_experience = 150
                add_stability = 25
                add_political_influence = 200

                add_country_modifier = {
                    name = median_legacy
                }
            }

            remove_variable = the_obscurity_of_druj_variable
            remove_variable = the_light_of_asha_variable
            remove_variable = atropatene_bad
            remove_variable = atropatene_good
        }

    }

    atropatene_mission_01_task_30 = { # Imperial Zoroaster
        icon = "task_battle"
        requires = { atropatene_mission_01_task_24 }
        prevented_by = { atropatene_mission_01_task_17 }

        allow = {
            stability >= 75
            political_influence >= 100
            num_of_cities >= 300
        }

        duration = 30

        on_completion = {
            trigger_event = { id = me_atropatene.30 }

            show_as_tooltip = {
                change_government = imperium
                add_treasury = 500
                add_innovation = 4
                add_legitimacy = 20
                current_ruler = {
                    add_popularity = popularity_large
                }
            }
        }
    }

    atropatene_mission_01_task_31 = { # The Red City
        icon = "task_religion"
        requires = { atropatene_mission_01_task_14 }

        allow = {
            p:4991 = {
                has_city_status = yes
                has_building = temple_building
                has_building = theathre_building
                num_of_fortress_building = 3
                state = {
                    custom_tooltip = {
                        text = "have_4_religious_endowments_tooltip"
                        trigger_if = {
                            limit = {
                                has_variable = endowments_made
                            }
                            var:endowments_made >= 4
                        }
                        trigger_else = {
                            always = no
                        }
                    }
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 4991 
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.31 }   MAKE THIS EVENT!!!!!!!

        }
    }

    atropatene_mission_01_task_32 = { # The City of Armies
        icon = "task_battle"
        requires = { atropatene_mission_01_task_14 }

        allow = {
            p:4973 = {
                has_city_status = yes
                has_building = foundry_building
                num_of_fortress_building = 3
                num_of_military_building = 3
                num_of_forum_building = 3
            }
        }

        highlight = {
            scope:province = {
                province_id = 4973
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.32 }   MAKE THIS EVENT!!!!!!!
            
        }
    }

    atropatene_mission_01_task_33 = { # The City of Solomon's Spring
        icon = "task_religion"
        requires = { atropatene_mission_01_task_14 }

        allow = {
            manpower >= 10
            treasury >= 500
            political_influence >= 100
            p:3392 = {
                has_city_status = yes
                has_building = foundry_building
                has_building = theathre_building
                num_of_aqueduct_building = 4
                num_of_population_building = 2
                num_of_forum_building = 3
                num_of_academy_building = 3
                num_of_library_building = 3
                num_of_workshop_building = 3
            }
        }

        highlight = {
            scope:province = {
                province_id = 3392
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.33 }   MAKE THIS EVENT!!!!!!!
            p:3392 = {
                change_province_name = "Kashan"
            }
        }
    }

    atropatene_mission_01_task_34 = { # The Median Triangle
        icon = "task_atlas"
        requires = { atropatene_mission_01_task_16 }
        requires = { atropatene_mission_01_task_31 }
        requires = { atropatene_mission_01_task_32 }
        requires = { atropatene_mission_01_task_33 }

        allow = {
            area:rhagai_area = {
                any_area_province = {
                    has_city_status = yes
                    count >=3
                }
            }
            area:ecbatana_area = {
                any_area_province = {
                    has_city_status = yes
                    count >=3
                }
            }
            area:aspadana_area = {
                any_area_province = {
                    has_city_status = yes
                    count >=3
                }
            }
            p:4976 = {
                Or = {
                    has_building = slave_mine_building
                    has_building = foundry_building
                }
            }
            p:4976 = {
                OR = {
                    has_building = workshop_building
                    has_building = population_building
                    has_building = basic_settlement_infratructure_building
                }
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.34 }   MAKE THIS EVENT!!!!!!!
            
        }
    }

    atropatene_mission_01_task_35 = { # The Oldest Ziggurat
        icon = "task_religion"
        requires = { atropatene_mission_01_task_33 }

        allow = {
            custom_tooltip = {
                text = atropatene_mission_01_task_35_tt_1
                has_variable = kashan_ziggurat_complete
            }
        }

        highlight = {
            scope:province = {
                province_id = 3392 
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.35 }   MAKE THIS EVENT!!!!!!!
            custom_tooltip = atropatene_mission_01_task_35_tt_2
            hidden_effect = {
                p:3392 = {
                    create_state_pop = nobles
                    create_state_pop = nobles
                    while = {
                        count = 3
                        define_pop = {
                            type = nobles
                            culture = elamite
                            religion = zoroaster
                        }
                    }
                    while = {
                        count = 2
                        define_pop = {
                            type = citizen
                            culture = elamite
                            religion = zoroaster
                        }
                    }
                    while = {
                        count = 2
                        define_pop = {
                            type = nobles
                            culture = babylonian
                            religion = zoroaster
                        }
                    }
                    while = {
                        count = 2
                        define_pop = {
                            type = citizen
                            culture = babylonian
                            religion = mesopotamian_religion
                        }
                    }
                    while = {
                        count = 1
                        define_pop = {
                            type = citizen
                            culture = elamite
                            religion = mesopotamian_religion
                        }
                    }
                    while = {
                        count = 1
                        define_pop = {
                            type = freemen
                            culture = median
                            religion = mesopotamian_religion
                        }
                    }
                    while = {
                        count = 1
                        define_pop = {
                            type = freemen
                            culture = pasargadi
                            religion = mesopotamian_religion
                        }
                    }
                    while = {
                        count = 1
                        define_pop = {
                            type = slaves
                            culture = macedonian
                            religion = mesopotamian_religion
                        }
                    }
                    while = {
                        count = 1
                        define_pop = {
                            type = slaves
                            culture = macedonian
                            religion = zoroaster
                        }
                    }
                }
            } 
        }
    }

    atropatene_mission_01_task_36 = { # The Gathering Place
        icon = "task_political"
        requires = { atropatene_mission_01_task_09 }

        allow = {
            p:1595 = {
                owner = root
                has_city_status = yes
                num_of_population_building = 3
                num_of_forum_building = 3
                has_road_towards = p:4963
                has_road_towards = p:4964
                has_road_towards = p:4982
                has_road_towards = p:6961
                has_road_towards = p:6962
                has_road_towards = p:6963
                has_road_towards = p:1596
            }
        }

        highlight = {
            scope:province = {
                province_id = 1595 
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.36 }   MAKE THIS EVENT!!!!!!!
            add_legitimacy = 5
                current_ruler = {
                    add_popularity = popularity_medium
                }
            show_as_tooltip = {
                p:1595 = {
                    add_province_modifier = {
                        name = ecbatana_gathering_place
                        duration = 3650
                    }
                    create_state_pop = nobles
                    create_state_pop = citizen
                    create_state_pop = freemen
                    create_state_pop = slaves
                }
            }  
        }
    }

    atropatene_mission_01_task_37 = { # The Treasury of Ecbatana
        icon = "task_economical"
        requires = { atropatene_mission_01_task_36 }

        allow = {
            manpower >= 10
            treasury >= 300
            p:1595 = {
                treasure_count >=3
                has_building = theathre_building
                has_building = temple_building
                calc_true_if = {
                    amount >= 4
                    is_importing_trade_good = precious_metals
                    is_importing_trade_good = dye
                    is_importing_trade_good = silk
                    is_importing_trade_good = papyrus
                    is_importing_trade_good = glass
                }
            }
            #area:ecbatana_area = {
            #    calc_true_if = {
            #        amount >= 4
            #        is_importing_trade_good = precious_metals
            #        is_importing_trade_good = dye
            #        is_importing_trade_good = silk
            #        is_importing_trade_good = papyrus
            #        is_importing_trade_good = glass
            #    }
            #}
        }

        highlight = {
            scope:province = {
                province_id = 1595
            }
        }

        on_completion = {
            add_treasury = -300
            add_manpower = -10
            add_political_influence = 30
            current_ruler = {
                add_popularity = 10
            }
            p:1595 = {
                create_state_pop = nobles
                create_state_pop = nobles
                create_state_pop = nobles
                create_state_pop = citizen
                create_state_pop = citizen
            }
            trigger_event = { id = me_atropatene.47 }
        }
    }

    atropatene_mission_01_task_38 = { # The Seven Citadels of Ecbatana
        icon = "task_conquest"
        requires = { atropatene_mission_01_task_37 }

        allow = {
            manpower >= 15
            political_influence >=100
            p:1595 = {
                num_of_fortress_building >= 7
                has_building = fortress_ramparts_building
                has_building = foundry_building
                is_importing_trade_good = precious_metals
                is_importing_trade_good = dye
                is_importing_trade_good = gems
                is_importing_trade_good = wood
                is_importing_trade_good = base_metals
                is_importing_trade_good = marble
                is_importing_trade_good = lapis
                is_importing_trade_good = glass
                is_importing_trade_good = stone
                is_importing_trade_good = silk
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.48 }
            add_manpower = -15
            add_political_influence = -100
            show_as_tooltip = {
                p:1595 = {
                    add_province_modifier = {
                        name = ecbatana_seven_citadels
                        duration = -1
                    }
                }
            }
        }
    }

    atropatene_mission_01_task_39 = { # Cyrus' Archive
        icon = "task_calm"
        requires = { atropatene_mission_01_task_37 }

        allow = {
            p:1595 = {
                num_of_academy_building = 3
                num_of_library_building >= 5
                num_of_court_building = 3
                custom_tooltip = { 
                    text = atropatene_mission_01_task_39_tt_1
                    any_pops_in_province = {
                        pop_type = nobles
                        count >= 20
                    }
                }
            }
            oratory_tech >= 10
            custom_tooltip = {
				text = atropatene_mission_01_task_39_tt_2
				trigger_if = {
					limit = {
						any_character = { has_office = office_philosopher }
					}
					any_character = {
						has_office = office_philosopher
						loyalty >= 70
                        zeal >= 10
					}
				}
			}
        }

        highlight = {
            scope:province = {
                province_id = 1595
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.49 } 
            show_as_tooltip = {
                add_country_modifier = {
                    name = ecbatana_archives
                    duration = 3500
                }
            }
        }
    }

    atropatene_mission_01_task_40 = { # The Problem of Persia
        icon = "task_religion"
        requires = { atropatene_mission_01_task_07 }

        allow = {
            owns_region = persis_region
            
            custom_tooltip = {
                text = atropatene_mission_01_task_40_tt_1
                any_integrated_culture = {
                    is_culture = pasargadi
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_atropatene.50 } 
            custom_tooltip = atropatene_mission_01_task_40_tt_2
            add_military_experience = 50
            add_political_influence = 50
        }
    }

    atropatene_mission_01_task_41 = { # Breeding Median Horses
        icon = "task_economical"
        requires = { atropatene_mission_01_task_05 }

        allow = {
            hidden:p:1516 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:1554 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:1558 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:4988 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:4989 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:6962 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:1594 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 1516
                    province_id = 1554
                    province_id = 1558
                    province_id = 4988
                    province_id = 4989
                    province_id = 6962
                    province_id = 1594
                }
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.51 } MAKE THIS EVENT! (horse territory modifier/claims on Bactria to breed camels)
            #trigger_event = { id = me_atropatene.52 } MAKE THIS EVENT! (selling horses to random country)
            show_as_tooltip = {
                custom_tooltip = atropatene_mission_01_task_41_tt
                p:1516 = { add_permanent_province_modifier = { name = median_horse_breeding }  }
            } 
        }
    }

    atropatene_mission_01_task_42 = { # Control in the East
        icon = "task_conquest"
        requires = { atropatene_mission_01_task_41 }

        allow = { #figure out what else to do with this mission task
            owns_area = margu_area
            owns_area = margiana_area
            owns_area = bactria_area
            owns_area = candara_area
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = margu_area
                    is_in_area = margiana_area
                    is_in_area = bactria_area
                    is_in_area = candara_area
                }
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.53 } 
            add_military_experience = 50
        }
    }

    atropatene_mission_01_task_43 = { # Breeding Bactrian Camels
        icon = "task_economical"
        requires = { atropatene_mission_01_task_42 }

        allow = {
            hidden:p:6960 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:4983 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:4975 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:6556 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:6664 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:6723 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
            hidden:p:6672 = {
                OR = {
                    has_building = foundry_building
                    num_of_workshop_building = 3
                    has_building = latifundia_building
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 6960
                    province_id = 4983
                    province_id = 4975
                    province_id = 6556
                    province_id = 6664
                    province_id = 6723
                    province_id = 6672
                }
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.51 } MAKE THIS EVENT! (horse territory modifier)
            #trigger_event = { id = me_atropatene.52 } MAKE THIS EVENT! (selling camels to random country)
            show_as_tooltip = {
                custom_tooltip = atropatene_mission_01_task_41_tt
                p:6960 = { add_permanent_province_modifier = { name = bactrian_camel_breeding }  }
            } 
        }
    }

    atropatene_mission_01_task_44 = { # Civilize the Amardi
        icon = "task_diplomatic"
        requires = { atropatene_mission_01_task_13 }

        allow = {
            custom_tooltip = {
                text = atropatene_mission_01_task_44_tt
                any_owned_province = {
                    is_in_area = rhagai_area
                    dominant_province_culture = root.culture
                    count >= 8
                }
                any_owned_province = {
                    is_in_area = hyrcania_area
                    dominant_province_culture = root.culture
                    count >= 8
                }
                any_owned_province = {
                    is_in_area = parthia_komishene_area
                    dominant_province_culture = root.culture
                    count >= 8
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = rhagai_area
                    is_in_area = hyrcania_area
                    is_in_area = parthia_komishene_area
                }
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.13 } learn some nomad/amardi stuff?
            add_country_modifier = {
                name = medes_civilize_iranian_tribes_global
                duration = -1
                mode = add
            }
            area:rhagai_area = {
                every_area_province = {
                    limit = {
                        owner = root
                        has_city_status = yes
                    }
                    create_state_pop = citizen
                    create_state_pop = citizen
                }
            }
            area:hyrcania_area = {
                every_area_province = {
                    limit = {
                        owner = root
                        has_city_status = yes
                    }
                    create_state_pop = citizen
                    create_state_pop = citizen
                }
            }
            area:parthia_komishene_area = {
                every_area_province = {
                    limit = {
                        owner = root
                        has_city_status = yes
                    }
                    create_state_pop = citizen
                    create_state_pop = citizen
                }
            }
            p:4991 = {
                add_permanent_province_modifier = {
                    name = medes_civilize_iranian_tribes
                }
                create_state_pop = nobles
                create_state_pop = nobles
            }
            p:4997 = {
                add_permanent_province_modifier = {
                    name = medes_civilize_iranian_tribes
                }
                create_state_pop = nobles
                create_state_pop = nobles
            }
            p:3439 = {
                add_permanent_province_modifier = {
                    name = medes_civilize_iranian_tribes
                }
                create_state_pop = nobles
                create_state_pop = nobles
            }
        }
    }

    atropatene_mission_01_task_45 = { # The Faith of the Amardi
        icon = "task_religion"
        requires = { atropatene_mission_01_task_12 }

        allow = {
            has_law = heritage_tax_exemption
            area:rhagai_area = {
                any_area_province = {
                    has_city_status = yes
                    has_building = temple_building
                    count >= 5  
                }
            }
            area:hyrcania_area = {
                any_area_province = {
                    has_city_status = yes
                    has_building = temple_building
                    count >= 5  
                }
            }
            p:4991 = {
                treasure_count >=2
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = rhagai_area
                    is_in_area = hyrcania_area
                }
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.12 } Make this !!!!

            show_as_tooltip = {
                p:4991 = {
                    add_permanent_province_modifier = {
                        name = the_faith_of_amardi
                    }
                }
            }
        }
    }

    atropatene_mission_01_task_46 = { # The Caucasian Gates
        icon = "task_conquest"
        requires = { atropatene_mission_01_task_05 }

        allow = { 
            owns_region = armenia_region
            owns_area = area:caucasian_albania_area
            owns_area = area:caucasian_iberia_area
            p:7603 = {
                has_building = fortress_building
            }
            p:1676 = {
                has_building = fortress_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = caucasian_albania_area
                    is_in_area = caucasian_iberia_area
                    is_in_region = armenia_region
                }
            }
        }

        on_completion = {
            #trigger_event = { id = me_atropatene.53 } 
            add_military_experience = 50
            p:7603 = {
                add_permanent_province_modifier = {
                    name = caucasian_gates
                }
            }
            p:1676 = {
                add_permanent_province_modifier = {
                    name = caucasian_gates
                }
            }
        }
    }

}