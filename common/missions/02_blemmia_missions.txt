blemmia_missions = {
    header = "kush_mission_header"
    icon = "cde_new_city_founded"

    repeatable = no
    chance = 1000

    potential = {
        primary_culture = blemmyan
        NOT = { has_variable = mission_cooldown_var }
    }

    abort = {
        ai_mission_back_out_trigger = yes
    }

    on_start = {
        start_mission_ai_effect = yes
        add_country_modifier = {
	        name = blemmyan_red_cities
	        duration = 3650 # 10 years
	    }
    }

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }

    on_completion = {
        complete_mission_effect = yes
        add_8_free_province_investments = yes
        add_innovation = 2
        current_ruler = {
       		add_finesse = 2
       	}
    }

    blemmia_missions_task_1 = { # Adabulian Obligations
        icon = "task_diplomatic"
        
        bypass = {
            c:ADA = {
                has_land = no
            }
        }

        allow = {
            c:ADA = {
                OR = {
                    is_subject_of = root
                    alliance_with = root
                }
                opinion = {
                    value >= 65
                    target = root
                }
                hidden:current_ruler = {
                    is_friend = root.current_ruler
                }
            }
        }

        highlight = {
			scope:province = {
				is_in_area = sinkat_area
			}
		}

        on_completion = { # add cultural modifier to make Adabulian assimilate quickly
            trigger_event = me_blemmia.1 
            add_country_modifier = {
                name = blemmyan_negotiations
                duration = -1
            }
            add_innovation = 1
        }
    }

    blemmia_missions_task_2 = { # Political Stratification
        icon = "task_political"

        allow = {
            has_law = absolute_authority
            has_law = coin_minting_law
            custom_tooltip = { 
                text = blemmia_missions_task_1_tt
                any_character = {
                    count = 8
                    has_any_office = yes
                    loyalty >= 65
                }
            }
        }

        on_completion = {
            trigger_event = me_blemmia.2 
            add_centralization = 30
            add_political_influence = 25
            add_2_free_province_investments = yes
            capital_scope = {
                while = {
                    count = 3 
                    define_pop = {
                        type = nobles
                        culture = root.culture
                        religion = root.religion
                    }
                }
            }
        }
    }

    blemmia_missions_task_3 = { # Mons Smaragdus
        icon = "task_economical"

        allow = {
            hidden:p:590.state.governor_or_ruler = {
                is_friend = root.current_ruler
            }
            p:590.state.governor_or_ruler = {
                loyalty <= 33
            }
            custom_tooltip = {
                text = blemmia_missions_task_3_tt
                any_country_culture = {
                    is_culture = blemmyan
                    has_country_culture_modifier = land_protection 
                } 
            }
        }

        highlight = {
			scope:province = {
				OR = {
					province_id = 8072
					province_id = 8071
					province_id = 584
                    province_id = 590
					province_id = 586
					province_id = 589
                    province_id = 588
					province_id = 578
				}
			}
		}

        on_completion = { 
            trigger_event = me_blemmia.3 
            p:8072 = { formable_province_conquest_effect = yes }
			p:8071 = { formable_province_conquest_effect = yes }
			p:584 = { formable_province_conquest_effect = yes }
			p:590 = { formable_province_conquest_effect = yes }
			p:586 = { formable_province_conquest_effect = yes }
            p:589 = { formable_province_conquest_effect = yes }
            p:588 = { formable_province_conquest_effect = yes }
            p:578 = { formable_province_conquest_effect = yes }
            add_2_free_province_investments = yes
            add_treasury = 150
            hidden_effect = {
                p:8089 = { add_road_towards = p:8090 }
			    p:8090 = { add_road_towards = p:7598 }
			    p:7598 = { add_road_towards = p:7597 }
                p:7597 = { add_road_towards = p:8071 }
			    p:8071 = { add_road_towards = p:584 }
			    p:584 = { add_road_towards = p:590 }
            }
        }
    }

    blemmia_missions_task_4 = { # Blemmyan Gold
        icon = "task_economical"

        allow = {
            hidden:p:8090 = {
                has_building = slave_mine_building
            }
            hidden:p:8082 = {
                has_building = slave_mine_building
            }
            hidden:p:8097 = {
                has_building = slave_mine_building
            }
            p:8090 = {
                governor_policy = encourage_trade
                hidden:state = {
                    trade_good_surplus = {
                        target = precious_metals
                        value >= 6
                    }
                }
                has_no_ongoing_construction = yes
            } 
        }

        highlight = {
			scope:province = {
				OR = {
					province_id = 8090
					province_id = 8082
					province_id = 8097
				}
			}
		}

        on_completion = {
            trigger_event = me_blemmia.4 
            p:8090 = {
                add_permanent_province_modifier = {
					name = blemmyan_gold_mining
					duration = -1
				}
            }
            p:8082 = {
                add_permanent_province_modifier = {
					name = blemmyan_gold_mining
					duration = -1
				}
            }
            p:8097 = {
                add_permanent_province_modifier = {
					name = blemmyan_gold_mining
					duration = -1
				}
            }
            add_country_modifier = {
                name = blemmyan_mine_construction
                duration = -1
            }
        }
    }

    blemmia_missions_task_5 = { # Recall the Medjay
        requires = {blemmia_missions_task_1}
        icon = "task_conquest"

        allow = {
            trigger_if = {
                limit = {
                    c:DOD = {
                        has_land = yes
                    }
                }
                hidden:c:DOD = {
                    opinion = {
                        value >= 30
                        target = root
                    }
                }
            }
            trigger_if = {
                limit = {
                    c:EGY = {
                        has_land = yes
                    }
                }
                hidden:c:EGY = {
                    opinion = {
                        value >= 40
                        target = root
                    }
                }
            }
            custom_tooltip = {
                text = blemmia_missions_task_5_tt1
                any_country_culture = {
                    is_culture = blemmyan
                    has_country_culture_modifier = citizenship_by_adoption
                } 
            }
            job_holder:office_bodyguard = {
                martial >= 8
                loyalty >= 70
            }
            political_influence >= 10
        }

        highlight = {
            scope:province = {
				OR = {
                    is_in_area = aswan_area
                    is_in_area = luxor_area
                }
                owner = {
                    NOT = {
                        this = root
                    }
                }
                any_pops_in_province = {
                    pop_culture = blemmyan
                }
			}    
        }

        on_completion = {
            trigger_event = me_blemmia.5 
            add_treasury = -25
            add_political_influence = -10
            add_manpower = 5
            add_country_modifier = {
                name = medjay_training
                duration = -1
            }
            custom_tooltip = blemmia_missions_task_5_tt2
            area:luxor_area = {
                add_provincial_claim_effect = yes
            }
            area:aswan_area = {
                add_provincial_claim_effect = yes
            }
            hidden_effect = {
                every_ownable_province = {
                    limit = {
                        OR = {
                            is_in_area = aswan_area
                            is_in_area = luxor_area
                        }
                        has_owner = yes
                    }
                    while = {
                        count = 2
                        every_pops_in_province = {
                            limit = {
                                culture = root.culture
                            }
                            move_pop = p:8089
                        }
                    }
                }
            }
        }
    }

    blemmia_missions_task_6 = { # Ties with the Megabaroi
        requires = {blemmia_missions_task_1}
        icon = "task_diplomatic"
        
        bypass = {
            c:BOR = {
                has_land = no
            }
        }
        
        allow = {
            c:BOR = {
                OR = {
                    is_subject_of = root
                    alliance_with = root
                }
                opinion = {
                    value >= 65
                    target = root
                }
                hidden:current_ruler = {
                    is_friend = root.current_ruler
                }
            }
            diplomatic_stance = vassaling_stance
            custom_tooltip = {
                text = colchis_missions_task_12_tt
                NOT = {
                    any_family = {
                        is_scorned = yes
                    }
                }
            }
            political_influence >= 50
        }

        highlight = {
            scope:province = {
                OR = {
                    AND = {
                        exists = c:BOR
                        exists = owner
                        owner = c:BOR
                    }
                }
            }
        }
        
        on_completion = {
            trigger_event = me_blemmia.6 
            add_treasury = -50
            add_political_influence = -50
            add_country_modifier = {
                name = blemmyan_negotiations
                duration = -1
                mode = add
            }
        }
    }

    blemmia_missions_task_7 = { # Segmented Rule
        requires = {blemmia_missions_task_2}
        icon = "task_heracles"

        allow = {
            has_law = tribal_centralized_laws_3
            p:8089 = {
                owner = root
                has_building = fortress_building
                has_building = court_building
                has_no_ongoing_construction = yes
                OR = {
                    has_city_status = yes
                    has_province_rank = city_metropolis 
                }
            }
            p:8096 = {
                owner = root
                has_building = fortress_building
                has_building = court_building
                has_no_ongoing_construction = yes
                OR = {
                    has_city_status = yes
                    has_province_rank = city_metropolis 
                }
            }
            p:7500 = {
                owner = root
                has_building = fortress_building
                has_building = court_building
                has_building = port_building
                has_no_ongoing_construction = yes
                OR = {
                    has_city_status = yes
                    has_province_rank = city_metropolis 
                }
            }
        }

        highlight = {
			scope:province = {
				OR = {
					province_id = 8089
					province_id = 8096
					province_id = 7500
				}
			}
		}

        on_completion = {
            trigger_event = me_blemmia.7 
            add_political_influence = 50
            current_ruler = {
                add_popularity = 5
                add_finesse = 1
                add_character_experience = 5
            }
            add_centralization = 20
            add_2_free_province_investments = yes
            add_country_modifier = {
                name = segmented_blemmyan_capitals
                duration = -1
            }
        }
    }

    blemmia_missions_task_8 = { # The All-Golden City
        requires = {blemmia_missions_task_2}    
        icon = "task_apollo"

        allow = {
            p:8089 = {
                owner = root
                has_building = court_building
                has_building = theathre_building
                has_building = library_building
                has_building = commerce_building
                has_building = population_building
                has_no_ongoing_construction = yes
                OR = {
                    has_city_status = yes
                    has_province_rank = city_metropolis 
                }
                governor_policy = encourage_trade
                state = {
                    trade_good_surplus = {
                        target = precious_metals
                        value >= 8
                    }
                }
                total_population >= 45
            }
        }

        highlight = {
			scope:province = {
				province_id = 8089
			}
		}

        on_completion = {
            trigger_event = me_blemmia.8
            add_treasury = 100
            add_political_influence = 50
            current_ruler = {
                add_popularity = 10
                add_finesse = 1
                add_charisma = 1
            }
            p:8089 = {
                while = {
                    count = 3
                    define_pop = {
                        type = nobles
                        culture = root.culture
                        religion = root.religion
                    }
                    define_pop = {
                        type = citizen
                        culture = root.culture
                        religion = root.religion
                    }
                }
                add_permanent_province_modifier = {
                    name = blemmyan_all_golden_city
                }
            }
        }
    }

    blemmia_missions_task_9 = { # The Emerald Trade
        requires = {blemmia_missions_task_3}
        icon = "task_zeus_cornucopia"

        allow = {
            political_influence >= 25
            invention = capital_trade_inv_2
            hidden:p:590 = {
                has_building = slave_mine_building
            }
            p:590 = {
                governor_policy = encourage_trade
                state = {
                    trade_good_surplus = {
                        target = gems
                        value >= 2
                    }
                }
                has_no_ongoing_construction = yes
            } 
        }

        highlight = {
			scope:province = {
				province_id = 590
			}
		}

        on_completion = {
            trigger_event = me_blemmia.9
            custom_tooltip = blemmia_missions_task_9_tt
            add_treasury = -100
            add_political_influence = -25
            add_manpower = -5
            p:590 = {
                while = {
                    count = 5
                    define_pop = {
                        type = slaves
                        culture = root.culture
                        religion = root.religion
                    }
                }
                add_permanent_province_modifier = {
                    name = blemmyan_emerald_mining
                }
            }
            hidden_effect = {
                p:7500 = { add_road_towards = p:7553 }
			    p:7553 = { add_road_towards = p:7552 }
			    p:7552 = { add_road_towards = p:7551 }
                p:7551 = { add_road_towards = p:7550 }
			    p:7550 = { add_road_towards = p:7503 }
			    p:7598 = { add_road_towards = p:7594 }
                p:7594 = { add_road_towards = p:7595 }
                p:7595 = { add_road_towards = p:7596 }
                p:7596 = { add_road_towards = p:7599 }
                p:7599 = { add_road_towards = p:7501 }
                p:7501 = { add_road_towards = p:7500 }
                every_ownable_province = {
                    limit = {
                        is_in_area = ichthyophagia_area
                        has_owner = no
                    }
                    while = {
                        count = 3
                        define_pop = {
                            type = tribesmen
                            culture = root.culture
                            religion = root.religion
                        }
                    }
                    set_owned_by = c:BMY
                }
            }
        }
    }

    blemmia_missions_task_10 = { # Red Land Networks
        requires = {blemmia_missions_task_4}
        icon = "task_economical"

        allow = {
            political_influence >= 50
            invention = global_tax_modifier_inv_1
            hidden:p:8089.state = {
				calc_true_if = {
					amount = 2   
					state_improvement_civic_trigger = yes
					state_improvement_oratory_trigger = yes      
				}
			}
            hidden:p:7500.state = {
				calc_true_if = {
					amount = 2   
					state_improvement_civic_trigger = yes
					state_improvement_oratory_trigger = yes      
				}
			}
            hidden:p:8096.state = {
				calc_true_if = {
					amount = 2   
					state_improvement_civic_trigger = yes
					state_improvement_oratory_trigger = yes      
				}
			}
            job_holder:office_magistrate = {
                finesse >= 10
                loyalty >= 70
            }
            diplomatic_stance = trading_stance
        }

        highlight = {
			scope:province = {
				OR = {
                    is_in_area = allaqi_area
                    is_in_area = gabgaba_area
                    is_in_area = ptolemais_area
                }
			}
		}

        on_completion = { # Make this tooltip more compact !!!!!!!!!!!!!!!!!!!
            trigger_event = me_blemmia.11 
            add_treasury = 250
            add_political_influence = -50
            p:583 = {
                add_claim = root
            }
            current_ruler = {
                add_trait = ambitious
            }
            p:8089.state = {
                add_state_modifier = {
                    name = red_lands_trade
                    duration = -1
                }
                add_state_food = 200
            }
            p:7500.state = {
                add_state_modifier = {
                    name = red_lands_trade
                    duration = -1
                }
                add_state_food = 200
            }
            p:8096.state = {
                add_state_modifier = {
                    name = red_lands_trade
                    duration = -1
                }
                add_state_food = 200
            }
        }
    }

    blemmia_missions_task_11 = { # Tabot Workshops
        requires = {blemmia_missions_task_4}
        icon = "task_economical"

        allow = {
            p:8608 = {
                owner = root
                has_building = foundry_building
                has_building = aqueduct_building
                num_of_commerce_building >= 2
                num_of_town_hall_building >= 2
                has_no_ongoing_construction = yes
                OR = {
                    has_city_status = yes
                    has_province_rank = city_metropolis 
                }
                governor_policy = encourage_trade
                state = {
                    trade_good_surplus = {
                        target = precious_metals
                        value >= 2
                    }
                    trade_good_surplus = {
                        target = gems
                        value >= 2
                    }
                }
                total_population >= 30
            }
        }

        highlight = {
			scope:province = {
				province_id = 8608
			}
		}

        on_completion = {
            trigger_event = me_blemmia.12 
            add_treasury = 50
            current_ruler = {
                add_gold = 50
                add_corruption = 5
            }
            p:8608.state = {
                set_state_capital = p:860
            }
            p:8608 = {
                add_permanent_province_modifier = {
                    name = tabot_workshops
                }
                while = {
                    count = 3
                    define_pop = {
                        type = freemen
                        culture = root.culture
                        religion = root.religion
                    }
                }
            }
            hidden_effect = {
                p:8608 = { add_road_towards = p:8610 }
			    p:8610 = { add_road_towards = p:8607 }
			    p:8607 = { add_road_towards = p:7599 }
                p:8607 = { add_road_towards = p:8606 }
			    p:8606 = { add_road_towards = p:7501 }
            }
        }
    }

    blemmia_missions_task_12 = { # Headless Men
        requires = {blemmia_missions_task_5}
        icon = "task_artemis"
        duration = 120

        allow = {
            military_experience >= 25
            political_influence >= 25
        }

        on_start = {
            trigger_event = me_blemmia.13
        }

        on_completion = {
            custom_tooltip = blemmia_missions_task_12_tt1
            add_political_influence = -25
            add_country_modifier = {
                name = headless_men_rumors
                duration = 5000
            }
            custom_tooltip = blemmia_missions_task_12_tt2
            p:5333 = {
                add_province_modifier = {
                    name = major_barbarian_spawn_place
                    duration = -1
                }
            }
            p:5334 = {
                add_province_modifier = {
                    name = major_barbarian_spawn_place
                    duration = -1
                }
            }
            p:5994 = {
                add_province_modifier = {
                    name = major_barbarian_spawn_place
                    duration = -1
                }
            }
            p:5341 = {
                add_province_modifier = {
                    name = major_barbarian_spawn_place
                    duration = -1
                }
            }
            p:8115 = {
                add_province_modifier = {
                    name = major_barbarian_spawn_place
                    duration = -1
                }
            }
            p:5294 = {
                add_province_modifier = {
                    name = major_barbarian_spawn_place
                    duration = -1
                }
            }
            p:5293 = {
                add_province_modifier = {
                    name = major_barbarian_spawn_place
                    duration = -1
                }
            }
        }
    }

    blemmia_missions_task_13 = { # The Trogodytes
        requires = {blemmia_missions_task_5}
        icon = "task_artemis"

        allow = {
            invention = global_start_experience_inv_2
            has_law = super_centralized_law_two 
            trigger_if = {
                limit = {
                    exists = job_holder:office_warchief
                }
                job_holder:office_warchief = {
                    loyalty >= 70
                    martial >= 10
                    corruption <= 10 
                }
            }
            trigger_if = {
                limit = {
                    exists = job_holder:office_elder
                }
                job_holder:office_elder = {
                    loyalty >= 70
                    charisma >= 9
                    corruption <= 10 
                }
            }
        }

        on_completion = {
            trigger_event = me_blemmia.20 
            add_country_modifier = {
                name = trogodyte_speed
                duration = -1
            }
        }
    }

    blemmia_missions_task_14 = { # Raiding Dodekaschoinos
        requires = {blemmia_missions_task_5 blemmia_missions_task_6}
        icon = "task_battle"

        allow = {
            trigger_if = {
                limit = {
                    is_tribal = yes
                }
                has_country_modifier = assemble_raiding_party_button_modifier
            }
            military_experience >= 10
            treasury >= 50
        }

        on_completion = {
            trigger_event = me_blemmia.21 
            add_aggressive_expansion = 15
            add_treasury = -50
            create_unit = {
                navy = no
                name = BLEMMYAN_RAIDERS
                location = p:8081
                hidden_effect = {
                add_subunit = light_infantry
                add_subunit = light_infantry
                add_subunit = light_infantry 
                add_subunit = light_infantry
                add_subunit = light_infantry 
                add_subunit = light_infantry
                add_subunit = light_infantry                                          
                add_food = 300
                add_morale = 2
                }
            }
        }
    }

    blemmia_missions_task_15 = { # The Blemmyan Kingdom
        requires = {blemmia_missions_task_7 blemmia_missions_task_8}
        icon = "task_atlas"

        allow = { 
            stability >= 75
            political_influence >= 50   
            diplomatic_stance = vassaling_stance  
            invention = royal_blemmyan_signature_inv                      
            p:8089.state = {
                custom_tooltip = {
                    text = "have_4_state_investments_tooltip"
                    trigger_if = {
                        limit = {
                            has_variable = num_state_investments
                        }
                        var:num_state_investments >= 4
                    } 
                    trigger_else = {
                        always = no
                    }
                }
            }
            current_ruler = {
                popularity >= 90 
            }
        }

        on_completion = {
            trigger_event = me_blemmia.22 
            add_political_influence = -50
            change_government = aristocratic_monarchy
            add_innovation = 4
            add_3_free_province_investments = yes
            area:napata_area = {
                add_provincial_claim_effect = yes
            }
            area:alana_area = {
                add_provincial_claim_effect = yes
            }
            capital_scope = {
                while = {
                    count = 5
                    define_pop = {
                        type = nobles
                        culture = root.culture
                        religion = root.religion
                    }
                }
            }
            change_country_name = BLEMMYAN_KINGDOM
            change_country_color = light_gold
        }
    }

    blemmia_missions_task_16 = { # Controlling Berenike
        requires = {blemmia_missions_task_9 blemmia_missions_task_10}
        icon = "task_political"

        bypass = {
            p:583 = {
                owner = root
            }
        }

        allow = {
            political_influence >= 35
            stability >= 60
            manpower >= 10
            treasury >= 100
            custom_tooltip = {
                text = blemmia_missions_task_16_tt 
                any_army = { 
                    exists = commander
                    is_moving = no
                    unit_size >= 10
                    in_combat = no
                }
            }
        }

        highlight = {
			scope:province = {
				province_id = 583
			}
		}

        on_completion = {
            trigger_event = me_blemmia.23 
            add_tyranny = 10
            add_aggressive_expansion = 5
            add_manpower = -5
            add_political_influence = -35
            add_military_experience = 20
            add_country_modifier = {
                name = subjugating_berenike
                duration = 2500
            }
        }
    }

    blemmia_missions_task_17 = { # The Camel Trade
        requires = {blemmia_missions_task_10}
        icon = "task_economical"

        allow = {
            OR = {
                diplomatic_stance = trading_stance
                diplomatic_stance = warmongering_stance
            }
            owns_or_subject_owns = 8072
            owns_or_subject_owns = 8084
            owns_or_subject_owns = 8091
            owns_or_subject_owns = 8615
            owns_or_subject_owns = 8079
            hidden:p:8072 = {
                has_building = hill_fort
            }
            hidden:p:8084 = {
                has_building = hill_fort
            }
            hidden:p:8091 = {
                has_building = hill_fort
            }
            hidden:p:8079 = {
                has_building = hill_fort
            }
        }

        highlight = {
            scope:province = {
				OR = {
                    province_id = 8072
                    province_id = 8084
                    province_id = 8091
                    province_id = 8615
                    province_id = 8079
                }
			}
        }

        on_completion = {
            trigger_event = me_blemmia.24 
            add_treasury = 100
            current_ruler = {
                add_gold =100
            }
            capital_scope = {
                state = {
                    add_state_food = 300
                }
            }
            if = {
                limit = {
                    diplomatic_stance = trading_stance
                }
                add_country_modifier = {
                    name = blemmyan_caravans
                    duration = -1
                }
            }
            if = {
                limit = {
                    diplomatic_stance = warmongering_stance
                }
                add_country_modifier = {
                    name = blemmyan_dromedary_cavalry
                    duration = -1
                }
            }
        }
    }

    blemmia_missions_task_18 = { # Blemmyan Slave Trade
        requires = {blemmia_missions_task_11}
        icon = "task_calm"

        allow = {
            custom_tooltip = {
                text = blemmia_missions_task_18_tt1
                any_country = {
                    OR = {
                        country_culture_group = south_levantine
				        country_culture_group = south_arabian
                    }
                    opinion = {
                        target = root
                        value >= 50
                    }
                    save_temporary_scope_as = blemmyan_arabian_friendly_nation
                }
                scope:blemmyan_arabian_friendly_nation = {
                    current_ruler = {
                        is_friend = root.current_ruler
                    }
                }
            }
            current_ruler = {
                popularity >= 65
                num_holdings_owned >= 1
                custom_tooltip = {
                    text = blemmia_missions_task_18_tt2
                    any_holdings = {
                        num_of_slaves >= 10
                        OR = {
                            has_building = latifundia_building
                            has_building = workshop_building
                        }
                        save_temporary_scope_as = blemmyan_slave_holding
                    }  
                }
            }
            custom_tooltip = {
                text = blemmia_missions_task_18_tt3
                any_country_culture = {
                    has_pop_type_right = slaves
                } 
            }
        }

        on_completion = {
            trigger_event = me_blemmia.25
            add_treasury = 200
            add_innovation = 2
            add_4_free_province_investments = yes
            add_country_modifier = {
                name = blemmyan_slave_trade
                duration = -1
            }
        }
    }

    blemmia_missions_task_19 = { # Raiding Thebes
        requires = {blemmia_missions_task_13}
        icon = "task_battle"

        allow = {
            trigger_if = {
                limit = {
                    is_tribal = yes
                }
                has_country_modifier = assemble_raiding_party_button_modifier
            }
            military_experience >= 15
            treasury >= 50
        }

        highlight = {
			scope:province = {
				is_in_area = luxor_area
			}
		}

        on_completion = {
            trigger_event = me_blemmia.26 
            add_aggressive_expansion = 15
            add_treasury = -50
            create_unit = {
                navy = no
                name = BLEMMYAN_WARBAND
                location = p:578
                hidden_effect = {
                add_subunit = light_infantry
                add_subunit = light_infantry
                add_subunit = light_infantry 
                add_subunit = light_infantry
                add_subunit = light_infantry 
                add_subunit = light_infantry
                add_subunit = light_infantry 
                add_subunit = supply_train     
                add_subunit = supply_train 
                add_subunit = supply_train 
                add_subunit = supply_train
                add_subunit = camels 
                add_subunit = camels
                add_subunit = camels
                add_subunit = camels
                add_subunit = camels
                add_subunit = camels
                add_food = 300
                add_morale = 2
                }
            }
        }
    }

    blemmia_missions_task_20 = { # Worship of Mandulis
        requires = {blemmia_missions_task_14}
        icon = "task_religion"

        allow = {
            has_deity_in_pantheon = deity:omen_mandulis
            hidden:deity:omen_mandulis = {
                has_holy_site = yes
                custom_tooltip = {
                    text = blemmia_missions_task_20_tt
                    holy_site = p:592
                }
            }
            has_this_omen = deity:omen_mandulis
            p:592 = {
                owner = root
                has_province_rank = city_metropolis
                treasure_count = 3
                has_building = theathre_building
                has_building = temple_building
                num_of_library_building >= 3
                governor_policy = social_mobility
                has_no_ongoing_construction = yes
                state = {
                    calc_true_if = {
                        amount = 1  
                        state_improvement_religious_trigger = yes      
                    }
                }
            }
        }

        highlight = {
            scope:province = {
				province_id = 592
			}
        }

        on_completion = {
            trigger_event = me_blemmia.27 
            while = {
                count = 3
                p:592 = {
                    define_pop = {
                        type = nobles
                        culture = root.culture
                        religion = root.religion
                    }
                }
            }
            p:572 = {
                add_permanent_province_modifier = {
                    name = mandulis_worship
                }
            }
            add_country_modifier = {
                name = mandulis_effect
                duration = -1
            }
            add_research = {
				technology = religious_tech
				value = 50
			}
        }
    }

    blemmia_missions_task_21 = { # The Final Island
        requires = {blemmia_missions_task_14}
        icon = "task_religion"

        allow = {
            p:591 = {
                owner = root
                is_state_capital = yes
                has_no_ongoing_construction = yes
                has_province_rank = city_metropolis
                treasure_count = 3
                has_building = theathre_building
                has_building = temple_building
                num_of_library_building >= 3
                has_building = academy_building
                has_building = court_building
            }
            invention = global_unrest_inv_2
            custom_tooltip = {
                text = blemmia_missions_task_21_tt
                any_integrated_culture = {
                    this.culture.culture_group = culture_group:meroitic_group
                }
                any_integrated_culture = {
                    this.culture.culture_group = culture_group:aksumite_group
                }
                any_integrated_culture = {
                    this.culture.culture_group = culture_group:north_african
                }
            } 
        }

        highlight = {
			scope:province = {
				province_id = 591
			}
		}

        on_completion = {
            trigger_event = me_blemmia.28 
            add_stability = 5
            add_political_influence = 50
            add_treasury = 150
            add_manpower = -15
            add_innovation = 2
            add_4_free_province_investments = yes
            p:591 = {
                add_permanent_province_modifier = {
                    name = philae_expansion
                }
                state = {
                    add_state_modifier = {
                        name = blemmyan_aswan
                        duration = -1
                    }
                }
            }
        }
    }

    blemmia_missions_task_22 = { # Ruling the Middle Nile
        requires = {blemmia_missions_task_14 blemmia_missions_task_15}
        icon = "task_expansion"

        allow = {
            owns_or_subject_owns_area = alana_area
            owns_or_subject_owns_area = napata_area
            owns_or_subject_owns_area = south_nubia_area
            owns_or_subject_owns_area = north_nubia_area
            owns_or_subject_owns_area = aswan_area
            owns_or_subject_owns_area = luxor_area
        }

        highlight = {
			scope:province = {
				OR = {
                    is_in_area = luxor_area
                    is_in_area = aswan_area
                    is_in_area = north_nubia_area
                    is_in_area = south_nubia_area
                    is_in_area = napata_area
                    is_in_area = alana_area
                }
			}
		}

        on_completion = {
            trigger_event = me_blemmia.29 
            current_ruler = {
                add_martial = 1
                add_popularity = 10
                add_trait = conqueror
            }
            add_military_experience = 50
            add_political_influence = 50
            add_treasury = 250
            add_aggressive_expansion = -30
        }
    }

    blemmia_missions_task_23 = { # The Golden Rule
        requires = {blemmia_missions_task_15 blemmia_missions_task_16}
        icon = "task_athena"

        allow = {
            p:577 = {
                owner = root
                has_city_status = yes
                num_of_commerce_building >= 3
                num_of_town_hall_building >= 3
                num_of_workshop_building >= 2
                has_building = court_building
                has_building = foundry_building
                has_no_ongoing_construction = yes
                governor_policy = encourage_trade
                state = {
                    trade_good_surplus = {
                        target = grain
                        value >= 2
                    }
                }
            }
        }

        highlight = {
			scope:province = {
				province_id = 577
			}
		}

        on_completion = {
            add_treasury = -100
            add_manpower = -10
            add_political_influence = 50
            trigger_event = me_blemmia.30 
            p:576 = {
                set_trade_goods = grain
            }
            p:577 = {
                if = {
                    limit = {
                        NOT = {has_province_rank = city_metropolis}
                    }
                    increase_province_rank_effect = yes
                }
                set_trade_goods = precious_metals
                while = {
                    count = 4
                    define_pop = {
                        type = nobles
                        culture = root.culture
                        religion = root.religion
                    }
                    define_pop = {
                        type = citizen
                        culture = root.culture
                        religion = root.religion
                    }
                }
                add_permanent_province_modifier = {
                    name = blemmyan_golden_rule
                }
            }
            hidden_effect = {
                p:8089 = { add_road_towards = p:8088 }
			    p:8088 = { add_road_towards = p:8086 }
			    p:8086 = { add_road_towards = p:8085 }
                p:8085 = { add_road_towards = p:8083 }
			    p:8083 = { add_road_towards = p:8081 }
                p:8081 = { add_road_towards = p:8079 }
                p:8079 = { add_road_towards = p:593 }
                p:593 = { add_road_towards = p:592 }
                p:592 = { add_road_towards = p:591 }
                p:591 = { add_road_towards = p:577 }
            }
        }
    }

    blemmia_missions_task_24 = { # A Blemmyan Empire
        requires = {blemmia_missions_task_22 blemmia_missions_task_23}
        icon = "task_atlas"
        final = yes

        allow = {
            stability >= 70
            political_influence >= 75
            current_ruler = {
                popularity >= 90
            }
            owns_or_subject_owns = p:8636
            owns_or_subject_owns = p:7500
            owns_or_subject_owns = p:632
            owns_or_subject_owns = p:645
            owns_or_subject_owns = p:613
            owns_or_subject_owns = p:600
            owns_or_subject_owns = p:591
            owns_or_subject_owns = p:569
            owns_or_subject_owns = p:552
            owns_or_subject_owns = p:650
            owns_or_subject_owns = p:583
            owns_or_subject_owns = p:8636
        }

        highlight = { 
			scope:province = {
                OR = {
                    province_id = 8636
                    province_id = 7500
                    province_id = 632
                    province_id = 645
                    province_id = 613
                    province_id = 600
                    province_id = 591
                    province_id = 569
                    province_id = 552
                    province_id = 650
                    province_id = 583
                    province_id = 8636
                }
			}
		}
        
        on_completion = {
            trigger_event = me_blemmia.31 
            current_ruler = {
                add_finesse = 2
            }
            add_innovation = 4
            add_8_free_province_investments = yes
            add_political_influence = -75
            change_government = imperial_cult
            change_country_name = BLEMMYAN_EMPIRE 
            area:meroe_area = {
                add_provincial_claim_effect = yes
            }
            area:awateib_area = {
                add_provincial_claim_effect = yes
            }
            area:aksum_area = {
                add_provincial_claim_effect = yes
            }
            area:ona_area = {
                add_provincial_claim_effect = yes
            }
            area:hema_nome_area = {
                add_provincial_claim_effect = yes
            }
            area:heptanomis_area = {
                add_provincial_claim_effect = yes
            }
            area:memphis_area = {
                add_provincial_claim_effect = yes
            }
            area:western_delta_area = {
                add_provincial_claim_effect = yes
            }
            area:central_delta_area = {
                add_provincial_claim_effect = yes
            }
            area:eastern_delta_area = {
                add_provincial_claim_effect = yes
            }
            hidden_effect = {
                change_country_color = cyan
            }
        }
    }
}