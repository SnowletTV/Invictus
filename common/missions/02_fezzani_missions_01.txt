fezzani_mission_01 = {
    header = "mission_image_general" # SPECIAL FIELD - Sets top picture for the mission
    icon = cde_greek_desert_march # SPECIAL FIELD - Sets icon for the mission

    repeatable = no # SPECIAL FIELD - Sets if a mission can be done once or several times

    chance = {
        factor = 50000
        } # SPECIAL FIELD - Sets the chances of a mission appearing in your list of available missions

    potential = {
        NOT = { has_variable = fezzani_mission_cooldown }
        OR = {
            tag = MKA # MAKAE
            tag = PSY # PSYLLI
            tag = NAS # NASAMONES
            tag = GAR # GARAMANTES
            tag = MHY # MACHYLES
            tag = PHZ # PHAZANI
        } # TRIGGER FIELD - Sets the conditions for the mission to appear in your list
    }
    on_start = {
        save_scope_as = me_fezzani_scope
        start_mission_ai_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is started

    abort = {
        ai_mission_back_out_trigger = yes
    }

    on_abort = {
        set_variable = {
            name = fezzani_mission_cooldown
            days = 7300 #20 years
        }
    }

    on_completion = {
        complete_mission_effect = yes
        add_country_modifier = {
            name = desert_rose
        }
    } # EFFECT FIELD - These effects are run when the mission is completed





    ########################################
    # Generic - for all tags
    ########################################

    fezzani_mission_01_task_01 = { # task 1 - The fezzan Crown - tribe to monarchy common to all
        icon = "task_political"

        allow = {
            trigger_if = {
                limit = { is_ai = no }

                stability >= 55
                centralization > 95
            }
            trigger_if = {
                limit = { is_ai = yes }
                
                # give the AI (garamantes) 30 years
                # maybe we will see kingdom of fezzan maybe we will see tribal fezzan
                current_date >= 480.1.1
            }
        }

        bypass = { is_monarchy = yes }

        on_completion = {
            trigger_event = { id = me_fezzani.1 }      

            show_as_tooltip = {
                add_country_modifier = {
                    name = king_of_fezzan
                }
                current_ruler = {
                    add_popularity = 20
                    add_trait = confident
                }
                add_political_influence = 100
            }
            
            
            ###     The following was taken directly from the tribal reform mission
            change_government = despotic_monarchy       
            switch_government_type_event_clearup_effect = yes
            hidden_effect = {
                current_ruler.family = {
                    save_scope_as = monarchy_family
                }
            }
            if = {
                limit = {
                    exists = scope:monarchy_family
                    scope:monarchy_family = {
                        any_family_member = {
                            is_adult = yes
                            trigger_if = {
                                limit = {
                                    root = {
                                        gender_equality = no
                                    }
                                }
                                is_male = yes
                            }
                            has_any_office = no
                        }
                    }
                }
                custom_tooltip = grant_offices_monarchy_reform_tt
                hidden_effect = {
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_foreign_minister
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = charisma
                                        }
                                    }
                                }
                                give_office = office_foreign_minister
                            }
                        }
                    }
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_marshal
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = martial
                                        }
                                    }
                                }
                                give_office = office_marshal
                            }
                        }
                    }
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_high_priest_monarchy
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = zeal
                                        }
                                    }
                                }
                                give_office = office_high_priest_monarchy
                            }
                        }
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_02 = { # task 2 - the people of fezzan common to all
        icon = "task_expansion"
        requires = {  }

        allow = {
            political_influence >= 50
        }

        on_completion = {
            trigger_event = { id = me_fezzani.2 }

            show_as_tooltip = {
                add_political_influence = -50
                add_2_free_province_investments = yes
                add_innovation = 1
                add_country_modifier = {
                    name = people_of_fezzan
                }
            }

        }
    }

    fezzani_mission_01_task_12 = { # fezzani subjects
        icon = "task_political"
        potential = { 
            OR = {
                tag = GAR
                tag = NAS
                tag = MHY
                tag = MKA
                tag = PHZ
            }
        }
        requires = { 
            fezzani_mission_01_task_07 # Garamantes
            fezzani_mission_01_task_202 # Nasamonians
            fezzani_mission_01_task_306 # Machylians
            fezzani_mission_01_task_401 # Makeans
            fezzani_mission_01_task_501 # Phazanians
        }

        allow = {
            political_influence >= 200
            stability >= 60
            custom_tooltip = {
                text = fezzani_mission_01_task_12_tt
                any_subject = {
                    count >= 1
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.12 }
            
            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_12_tt_a
                add_political_influence = -200
                add_country_modifier = {
                    name = garamantes_march
                }
                every_subject = {
                    add_country_modifier = {
                        name = subject_military_contribution
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_16 = { # the mines of Phazania
        icon = "task_calm"
        requires = { 
            fezzani_mission_01_task_13 # garamantes
            fezzani_mission_01_task_109 # Psyllia
            fezzani_mission_01_task_208 # Nasamonians
            fezzani_mission_01_task_308 # Machylians
            fezzani_mission_01_task_403 # Makeans
            fezzani_mission_01_task_501 # Phazania
        }

        allow = {
            owns = 8238
            hidden:p:8238 = {
                has_building = slave_mine_building
            }
            owns = 8229
            hidden:p:8229 = {
                has_building = slave_mine_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8238
                    province_id = 8229
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.16 }
            # event chain possibly to move the capital to the old nasamonian capitsl
            
            show_as_tooltip = {
                p:8238 = {
                    add_permanent_province_modifier = {
                        name = mines_phazania
                    }
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
                p:8229 = {
                    add_permanent_province_modifier = {
                        name = mines_phazania
                    }
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
            }
        }
    }

    fezzani_mission_01_task_18 = { # the ports of Psyllia
        icon = "task_expansion"
        potential = { 
            OR = {
                tag = GAR
                tag = MHY
                tag = PHZ
            }
        }
        requires = { 
            fezzani_mission_01_task_10 # GAR
            fezzani_mission_01_task_307 # MHY
            fezzani_mission_01_task_505 # MHY
        }


        allow = {
            owns = 3333
            hidden:p:3333 = {
                has_city_status = yes
                has_construction = no
                num_of_port_building >= 4
            }
            custom_tooltip = {
                text = fezzani_mission_01_task_18_tt
                any_navy = {
                    any_sub_unit = {
                        count >= 15
                    }
                    has_commander = yes
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 3333
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.18 }
            # check if BASE has_owner , if not colonize it for money
            
            show_as_tooltip = {
                add_country_modifier = {
                    name = ports_of_psyllia
                }
            }
        }
    }

    fezzani_mission_01_task_19 = { # encountering the greeks - colonize near nasamonia
        icon = "task_battle"
        requires = { 
            fezzani_mission_01_task_08 # garamantes
            fezzani_mission_01_task_110 # Psyllia
            fezzani_mission_01_task_209 # Nasamonians
            fezzani_mission_01_task_307 # Machylians
            fezzani_mission_01_task_406 # Makeans
            fezzani_mission_01_task_506 # Makeans
        }

        allow = {
            owns = 8129
            owns = 8132
            owns = 8133
            trigger_if = {
                limit = { is_ai = no }
                owns = 8134
                hidden:p:8134 = {
                    free_building_slots = 0
                }
                owns = 8130
                hidden:p:8130 = {
                    free_building_slots = 0
                }
            }
            trigger_if = { # AI Handholding
                limit = { is_ai = yes }
                p:8134 = {
                    OR = {
                        AND = {
                            is_uninhabitable = no
                            has_owner = no
                        }
                        owner = root
                    }
                }
                p:8130 = {
                    OR = {
                        AND = {
                            is_uninhabitable = no
                            has_owner = no
                        }
                        owner = root
                    }
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8134
                    province_id = 8130
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.19 }
            # event chain about meeting the greek ownwers of 3340
            
            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_19_tt
            }
        }
    }

    fezzani_mission_01_task_21 = { # the makean gold
        icon = "task_conquest"
        requires = { 
            fezzani_mission_01_task_17 # garamantes
            fezzani_mission_01_task_102 fezzani_mission_01_task_103 # psyllia
            fezzani_mission_01_task_205 # Nasamonians
            fezzani_mission_01_task_308 # Machylians
            fezzani_mission_01_task_402 # Makeans
            fezzani_mission_01_task_508 fezzani_mission_01_task_506 # Phazanians
        }
        allow = {
            owns = 8222
            hidden:p:8222 = {
                has_building = slave_mine_building
            }
            owns = 8209
            hidden:p:8209 = {
                has_building = slave_mine_building
            }
        }

        bypass = {
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8209
                    province_id = 8222
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.36 }

            show_as_tooltip = {
                p:8222 = {
                    add_permanent_province_modifier = {
                        name = makean_gold
                    }
                }
                p:8209 = {
                    add_permanent_province_modifier = {
                        name = makean_gold
                    }
                }
            }
        }
    }


    fezzani_mission_01_task_301 = { # the Machylian People
        icon = "task_conquest"
        potential = { 
            OR = {
                tag = MHY
                tag = MKA
            }
        }
        requires = {  }
        allow = { 
            political_influence >= 25
            stability >= 50
         }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.301 }

            show_as_tooltip = {

                add_innovation = 1
                add_centralization = 10

                add_country_modifier = {
                    name = macean_tribesmen
                }
            }
        }
    }


    ########################################
    # Garamantes Specific 3 - 100
    ########################################

    fezzani_mission_01_task_03 = { # The kingdom of Garamantes
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = {  }
        allow = {
            trigger_if = {
                limit = { is_ai = no }

                treasury >= 75
                stability >= 50
                political_influence >= 20
            }
            trigger_if = {
                limit = { is_ai = yes }
                
                treasury >= 75
                stability >= 40
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.3 }

            show_as_tooltip = {
                add_treasury = -75
                add_political_influence = -20
                add_military_experience = 10
                add_centralization = 20
                current_ruler = {
                    add_trait = ambitious
                    add_martial = 3
                }
                add_country_modifier = {
                    name = kingdom_of_garamantes
                }
            }
        }
    }

    fezzani_mission_01_task_04 = { # The Machylia
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_03 }
        allow = {
            political_influence >= 25
        }

        bypass = { # bypass if they are a subject of us already somehow or do not exist
            OR = {
                c:MHY = {
                    has_land = no
                }
                c:MHY = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8142
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.4 }
            # event chain to try to provoke them into declaring war
            custom_tooltip = fezzani_mission_01_task_04_tt

            show_as_tooltip = {
                add_political_influence = -25
                p:8142 = {
                    add_claim = ROOT
                }
            }
        }
    }

    fezzani_mission_01_task_05 = { # The desert capital
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            trigger_if = {
                limit = { is_ai = no }
                p:8168 = {
                    has_construction = no
                    free_building_slots = 0
                    hidden:p:8168.state = {
                        calc_true_if = {
                            amount >= 3
                            state_improvement_civic_trigger = yes
                            state_improvement_oratory_trigger = yes
                            state_improvement_religious_trigger = yes
                        }
                    }
                }
            }
            trigger_if = { # AI Handholding
                limit = { is_ai = yes }
                p:8168 = {
                    has_construction = no
                    free_building_slots = 0
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8168
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.5 }

            show_as_tooltip = {
                p:8168 = { 
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
                add_centralization = 20
            }
        }
    }

    fezzani_mission_01_task_06 = { # The desert breadbasket
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            hidden:p:8164 = { # grain
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            hidden:p:8175 = { # grain
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            hidden:p:8166 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            hidden:p:8156 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            hidden:p:8181 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            hidden:p:8182 = { # dates
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8164
                    province_id = 8175
                    province_id = 8166
                    province_id = 8156
                    province_id = 8181
                    province_id = 8182
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.6 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = desert_breadbasket
                }
                add_centralization = 15
            }
        }
    }

    fezzani_mission_01_task_07 = { # Strategic Planning
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_03 }
        allow = {
            treasury >= 100
            p:8149 = {
                free_building_slots >=1
            }
        }

        duration = 365

        highlight = {
            scope:province = {
                province_id = 8149
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.7 }

            show_as_tooltip = {
                add_military_experience = 25
                add_2_free_province_investments = yes
                add_country_modifier = {
                    name = strategic_planning
                }
                p:8149 = {
                    add_building_level = fortress_building
                }
            }
        }
    }

    fezzani_mission_01_task_08 = { # the nasamonians
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_04 }
        allow = {
            owns_or_subject_owns = 8142
            war = no
        }

        bypass = {
            OR = {
                c:NAS = {
                    has_land = no
                }
                c:NAS = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8128
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.8 }

            show_as_tooltip = {
                p:8128 = {
                    add_claim = ROOT
                }
            }
        }
    }

    fezzani_mission_01_task_09 = { # the city of waddan
        icon = "task_conquest"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_05 }
        allow = {
            owns = 8142
            hidden:p:8142 = {
                has_construction = no
                has_city_status = yes
                has_building = forum_building
                has_building = military_building
                has_building = commerce_building
                has_building = population_building
            }
        }

        highlight = {
            scope:province = {
                province_id = 8142
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.9 }

            show_as_tooltip = {
                add_centralization = 10

                p:8142 = {
                    add_permanent_province_modifier = {
                        name = waddan_glory
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_10 = { # The date trade
        icon = "task_political"
        potential = {
            OR = {
                tag = GAR
                tag = NAS
            }
        }
        requires = { 
            fezzani_mission_01_task_06 # Garamantes
            fezzani_mission_01_task_204 # Nasamonians
        }

        allow = { 
            treasury >= 150
            #At least 3 dates are being produced in the Fezzan region
            custom_tooltip = {
                text = fezzan_dates_produced_task24_tooltip
                fezzan_dates_produced_task24_current >= fezzan_dates_produced_task24_total
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.10 }
            show_as_tooltip = {
                add_country_modifier = {
                    name = fezzani_the_perfect_date
                    duration = -1
                }
                p:8168 = {
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
                add_innovation = 2
            }
        }
    }

    fezzani_mission_01_task_11 = { # The Makae
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_04 }

        allow = {
            owns_or_subject_owns = 8142
            war = no
        }

        bypass = {
            OR = {
                c:MKA = {
                    has_land = no
                }
                c:MKA = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8218
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.11 }
            
            show_as_tooltip = {
                p:8218 = {
                    add_claim = ROOT
                }
            }
        }
    }

    # 12 is a common task

    fezzani_mission_01_task_13 = { # the phazania
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_07 }

        allow = {
            trigger_if = {
                limit = { is_ai = no }
                hidden:p:8154 = {
                    #has_city_status = yes
                    has_building = fortress_building
                    #num_of_military_building >= 3
                }
                owns = 8214
                treasury >= 50
                war = no
            }
            trigger_if = { # AI Handholding
                limit = { is_ai = yes }
                owns = 8214
            }
        }

        bypass = {
            OR = {
                c:PHZ = {
                    has_land = no
                }
                c:PHZ = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 8233
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.13 }
            # event chain
            
            show_as_tooltip = {
                add_treasury = -50
                p:8233 = {
                    add_claim = ROOT
                }
                p:8154 = {
                    add_permanent_province_modifier = {
                        name = shatti_fortifications
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_14 = { # psyllia
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_08 fezzani_mission_01_task_11 }

        allow = {
            OR = {
                owns_or_subject_owns = 8137
                owns_or_subject_owns = 8197
            }
            war = no
        }

        bypass = {
            OR = {
                c:PSY = {
                    has_land = no
                }
                c:PSY = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                province_id = 3333
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.14 }
            # event chain
            
            show_as_tooltip = {

                custom_tooltip = me_fezzani_14.a.tt
        
                add_treasury = -50
            }
        }
    }

    fezzani_mission_01_task_15 = { # an eastern capital prep to colonize
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_09 }

        allow = {
            owns = 8128
            hidden:p:8128 = {
                num_of_used_building_slots >= 7
                num_of_fortress_building >= 2
                has_building = forum_building
                has_building = library_building
                has_building = population_building
            }
        }

        highlight = {
            scope:province = {
                province_id = 8128
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.15 }
            
            show_as_tooltip = {
                add_innovation = 4
                p:8128 = {
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
            }
        }
    }

    fezzani_mission_01_task_17 = { # the land of the makae
        icon = "task_political"
        potential = { tag = GAR }
        requires = { fezzani_mission_01_task_11 }

        allow = {
            owns = 8220
            hidden:p:8220 = {
                minor_province_basic_building_trigger = yes
            }
            owns = 8222
            hidden:p:8222 = {
                minor_province_basic_building_trigger = yes
            }
            owns = 8217
            hidden:p:8217 = {
                minor_province_basic_building_trigger = yes
            }
            owns = 8226
            hidden:p:8226 = {
                minor_province_basic_building_trigger = yes
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8220
                    province_id = 8222
                    province_id = 8217
                    province_id = 8226
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.17 }
            # check if BASE has_owner , if not colonize it for money
            
            show_as_tooltip = {
                add_4_free_province_investments = yes
                p:8218 = {
                    add_permanent_province_modifier = {
                        name = makaean_infrastructure
                    }
                }
            }
        }
    }

    # Task 18 is common

    # Task 19 is common 

    # Task 20 is the unification one

    # Task 21 is common

    ########################################
    # Psyllia Specific 101 - 200
    ########################################

    fezzani_mission_01_task_101 = { # The Nasamonian Overlords
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = {  }
        allow = {
            treasury >= 50
        }

        bypass = {
            c:PSY = {
                is_subject = no
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.101 }

            show_as_tooltip = {
                # Send the nasamonians money in exchange for pops to help with future missions colonizing
                # nasamonia will "spread" word among their people that there is land available in the psyllian lands
                # add migration growth and pop promotion
                custom_tooltip = fezzani_mission_01_task_101_tt
            }
        }
    }

    fezzani_mission_01_task_102 = { # The Capital Port
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            p:3333 = {
                has_city_status = yes
                num_of_port_building >= 3
            }
        }

        highlight = {
            scope:province = {
                province_id = 3333
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.102 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = psyllia_capital_port
                }
                create_unit = {
                    navy = yes
                    #add_subunit = mega_galley
                    add_subunit = octere
                    add_subunit = trireme
                    add_subunit = trireme
                    add_subunit = trireme
                }
                add_centralization = 10
            }
        }
    }

    fezzani_mission_01_task_103 = { # The coast
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            hidden:p:3337 = {
                has_building = port_building
            }
            hidden:p:3335 = {
                has_building = port_building
            }
            hidden:p:3336 = {
                has_building = basic_settlement_infratructure_building
            }
            hidden:p:3334 = {
                has_building = latifundia_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 3335
                    province_id = 3336
                    province_id = 3334
                    province_id = 3337
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.103 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = psyllian_coast
                }
                add_centralization = 10
            }
        }
    }

    fezzani_mission_01_task_104 = { # Mediterranean Exploration
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_21 }
        allow = {
            treasury >= 550
            custom_tooltip = {
                text = fezzani_mission_01_task_104_tt
                any_navy = {
                    any_sub_unit = {
                        count >= 20
                    }
                    has_commander = yes
                }
            }
        }

        highlight = {
        }

        duration = 365

        on_start = {
            custom_tooltip = fezzani_mission_01_task_104_tt.a
            trigger_event = { id = me_fezzani.104 }
        }

        on_completion = { 

        show_as_tooltip = {
        }
        }
    }

    fezzani_mission_01_task_105 = { # Colonize to the right
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_101 }
        allow = {
            trigger_if = {
                limit = { is_ai = no }

                OR = {
                    hidden:p:3337 = {
                        has_building = port_building
                    }
                    owns = 3338
                }
            }
            trigger_if = { # AI Handholding
                limit = { is_ai = yes }

                treasury >= 65
            }
        }

        # realistically this should not be owned by any other nation
        #bypass = {
        #    p:3338 = {
        #        has_owner = yes
        #    }
        #}

        highlight = {
            scope:province = {
                province_id = 3338
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.105 }

            show_as_tooltip = {
                p:3338 = {
                    set_owned_by = root
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
                add_centralization = 10
            }
        }
    }

    fezzani_mission_01_task_106 = { # Colonize to the left
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_101 }
        allow = {
            trigger_if = {
                limit = { is_ai = no }

                OR = {
                    AND = {
                        p:3333 = {
                            free_building_slots = 0
                        }
                        p:3332 = {
                            free_building_slots = 0
                            has_building = basic_settlement_infratructure_building # Farming settlement
                        }
                    }
                    owns = 3330
                }
            }
            trigger_if = { # AI Handholding
                limit = { is_ai = yes }
                
                treasury >= 65
            }
        }

        # realistically this should not be owned by any other nation
        #bypass = {
        #    p:3330 = {
        #        has_owner = yes
        #    }
        #}

        highlight = {
            scope:province = {
                province_id = 3330
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.106 }

            show_as_tooltip = {
                p:3330 = {
                    set_owned_by = root
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                    create_state_pop = slaves
                }
                add_centralization = 10
            }
        }
    }

    fezzani_mission_01_task_107 = { # cold war
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_106 }
        allow = {
            owns = 3330
        }

        bypass = {
            c:MKA = {
                has_land = no
            }
        }

        duration = 60

        highlight = {
            scope:province = {
                province_id = 3330
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.107 }

            custom_tooltip = fezzani_mission_01_task_107_tt

            show_as_tooltip = {
                c:PSY = {
                    declare_war_with_wargoal = {
                        war_goal = conquer_wargoal 
                        province = c:MKA.capital_scope
                        target = MKA
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_108 = { # the spoils of war - colonizing more
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_107 }
        allow = {
            trigger_if = {
                limit = { is_ai = no }
                owns_area = psyllia_area
                owns_area = zamzam_area
                owns_area = soffegin_area
            }
            trigger_if = {
                limit = { is_ai = yes }
                
                treasury >= 150
            }
        }

        bypass = {
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 3326
                    province_id = 3327
                    province_id = 3329
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.108 }

            show_as_tooltip = {
                add_military_experience = 25
                p:3326 = {
                    set_owned_by = root
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
                p:3327 = {
                    set_owned_by = root
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
                p:3329 = {
                    set_owned_by = root
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
                
                area:syrtis_area = {
                    add_provincial_claim_effect = yes
                }
                add_centralization = 20
            }
        }
    }

    fezzani_mission_01_task_109 = { # phazania
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_107 }
        allow = {
            owns_area = girgiri_area
        }

        bypass = {
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = phazania_area
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.109 }

            show_as_tooltip = {
                add_4_free_province_investments = yes
                area:phazania_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_110 = { # the nasamonians
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_107 fezzani_mission_01_task_114 }
        allow = {
            owns = 8142
            owns_area = psyllia_area
            c:MHY = {
                has_land = no
            }
            c:NAS = {
                OR = {
                    owns = 8137
                    owns = 8138
                }
            }
        }

        bypass = {
            c:NAS = {
                has_land = no # just in case
            }
        }

        highlight = {
            scope:province = {
                province_id = 8142
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.110 }

            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_110_tt
            }
        }
    }

    fezzani_mission_01_task_111 = { # the garamantes
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_110 fezzani_mission_01_task_108 }
        allow = {
            owns_area = area:syrtis_area
            owns_area = area:nasamonia_area
        }

        bypass = {
            c:GAR = {
                has_land = no # just in case
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = syrtis_area
                    is_in_area = nasamonia_area
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.111 }

            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_111_tt
                hidden_effect = { 
                    c:GAR = { 
                        every_owned_province = { 
                            add_claim = root 
                        } 
                    } 
                }
            }
        }
    }

    # 112 is the same as 21 which is the makean gold task

    fezzani_mission_01_task_113 = { # The Expedition
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_104 }
        allow = {
            custom_tooltip = {
                text = fezzani_mission_01_task_113_tt
                OR = {
                    owns_or_subject_owns = 1471
                    owns_or_subject_owns = 471
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 1471
                    province_id = 471
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.113 }

            show_as_tooltip = {
            }
        }
    }

    fezzani_mission_01_task_114 = { # fortifying the east
        icon = "task_conquest"
        potential = { tag = PSY }
        requires = { fezzani_mission_01_task_105 }
        allow = {
            owns = 3339
            hidden:p:3339 = {
                has_building = fortress_building
            }
        }

        highlight = {
            scope:province = {
                province_id = 3339
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.114 }

            show_as_tooltip = {
                add_country_modifier = {
                    name = psyllia_defense
                }
                p:3339 = {
                    add_permanent_province_modifier = {
                        name = coastal_fortifications
                    }
                }
                
            }
        }
    }

    ########################################
    # Nasamonian Specific 201 - 300
    ########################################

    fezzani_mission_01_task_201 = { # The Nasamonian Kingdom
        icon = "task_conquest"
        potential = { tag = NAS }
        requires = {  }
        allow = {
            political_influence >= 50
            treasury >= 75
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.201 }

            show_as_tooltip = {
                add_political_influence = -50
                add_treasury = -75

                p:8128 = {
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
                add_2_free_province_investments = yes
                add_centralization = 15
                add_country_modifier = {
                    name = kingdom_of_nasamonia
                }
            }
        }
    }

    fezzani_mission_01_task_202 = { # The psyllian subjects
        icon = "task_conquest"
        potential = { 
            tag = NAS
            is_ai = no
        }
        requires = { fezzani_mission_01_task_201 }
        allow = {
            treasury >= 75
            manpower >= 3

            c:PSY = {
                has_land = yes
                opinion = {
                    target = c:NAS
                    value >= 150
                }
            }
            c:PSY.current_ruler = {
                is_friend = root.current_ruler
            }
        }

        highlight = {
        }

        on_completion = { 
            add_treasury = -75
            add_manpower = -3
            trigger_event = { id = me_fezzani.202 }

            show_as_tooltip = {
                add_centralization = 10
                c:NAS = {
                    release_subject = c:PSY
                }
                c:NAS = {
                    make_subject = {
                        target = c:PSY
                        type = feudatory
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_203 = { # The mhy
        icon = "task_conquest"
        potential = { 
            tag = NAS
        }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            hidden:p:8137 = {
                hidden:p:8137.state = {
                    calc_true_if = {
                        amount >= 1
                        state_improvement_civic_trigger = yes
                        state_improvement_oratory_trigger = yes
                        state_improvement_religious_trigger = yes
                    }
                }
            }
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.203 }

            show_as_tooltip = {
                add_military_experience = 15

                area:syrtis_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_204 = { # The mhy dates
        icon = "task_conquest"
        potential = { 
            tag = NAS
        }
        requires = { fezzani_mission_01_task_203 }
        allow = {
            owns_area = syrtis_area
            p:8142 = {
                has_building = basic_settlement_infratructure_building
            }
            p:8144 = {
                has_building = basic_settlement_infratructure_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8142
                    province_id = 8144
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.204 }

            show_as_tooltip = {

                add_innovation = 1

                add_centralization = 20

                add_country_modifier = {
                    name = date_trade
                }
            }
        }
    }

    fezzani_mission_01_task_205 = { # the Rival tribes
        icon = "task_conquest"
        potential = { 
            tag = NAS
        }
        requires = { fezzani_mission_01_task_203 }
        allow = {
            owns_area = syrtis_area
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.205 }

            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_205_tt
                hidden_effect = {
                    c:GAR = {
                        every_owned_province = {
                            add_claim = root
                        }
                    }
                    c:MKA = {
                        every_owned_province = {
                            add_claim = root
                        }
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_206 = { # the garamantes farms
        icon = "task_conquest"
        potential = {
            OR = {
                tag = NAS
                tag = PHZ
            }
        }
        requires = { 
            fezzani_mission_01_task_205 # Nas
            fezzani_mission_01_task_507 # PHZ
        }
        allow = {
            owns = 8152
            hidden:p:8152 = {
                has_building = basic_settlement_infratructure_building
            }
            owns = 8164
            hidden:p:8164 = {
                has_building = basic_settlement_infratructure_building
            }
            owns = 8175
            hidden:p:8175 = {
                has_building = basic_settlement_infratructure_building
            }
            owns = 8161
            hidden:p:8161 = {
                has_building = basic_settlement_infratructure_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8152
                    province_id = 8164
                    province_id = 8175
                    province_id = 8161
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.206 }

            show_as_tooltip = {

                add_centralization = 20

                add_country_modifier = {
                    name = garamantian_farmlands
                }
            }
        }
    }

    fezzani_mission_01_task_207 = { # the nasamonian capital
        icon = "task_conquest"
        potential = { 
            tag = NAS
        }
        requires = { fezzani_mission_01_task_19 }
        allow = {
            hidden:p:8128 = {
                has_building = fortress_building
                has_building = forum_building
                has_building = theathre_building
                has_building = population_building
                has_building = commerce_building
                has_building = library_building
            }
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.207 }

            show_as_tooltip = {

                add_centralization = 20

                add_country_modifier = {
                    name = nasamonian_capital
                }
            }
        }
    }

    fezzani_mission_01_task_208 = { # the phazania
        icon = "task_conquest"
        potential = { 
            tag = NAS
        }
        requires = { fezzani_mission_01_task_205 }
        allow = {
            owns_area = girgiri_area
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.208 }

            show_as_tooltip = {

                add_military_experience = 15

                area:phazania_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_209 = { # the fezzani horsemen ?
        icon = "task_conquest"
        potential = { 
            tag = NAS
        }
        requires = { fezzani_mission_01_task_201 }
        allow = {
            trigger_if = {
                limit = { is_ai = no }

                owns = 8130
                hidden:p:8130 = {
                    has_construction = no
                    has_building = latifundia_building
                }
                hidden:p:8133 = {
                    has_construction = no
                    has_building = latifundia_building
                }
            }
            trigger_if = {
                limit = { is_ai = yes }

                treasury >= 100
                political_influence >= 50
            }

        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8130
                    province_id = 8133
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.209 }

            show_as_tooltip = {
                p:8130 = {
                    add_permanent_province_modifier = {
                        name = horse_production
                    }
                }
    
                p:8133 = {
                    add_permanent_province_modifier = {
                        name = horse_production
                    }
                }
                add_country_modifier = {
                    name = fezzani_horsemen
                }
            }
        }
    }


    ########################################
    # Machylia Specific 301 - 400
    ########################################

    # 301 is common between the MHY and MKA since they are both macean

    fezzani_mission_01_task_302 = { # our macean brothers
        icon = "task_political"
        potential = { 
            tag = MHY
        }
        requires = { fezzani_mission_01_task_301 }
        allow = { 
            treasury >= 50
         }

         bypass = {
            c:MKA = { 
                alliance_with = root 
            }
         }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.302 }

            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_302_tt
                # add_alliance = c:MKA
            }
        }
    }

    fezzani_mission_01_task_303 = { # Building up the nation
        icon = "task_economical"
        potential = { 
            tag = MHY
        }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            hidden:p:8144 = {
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            hidden:p:8145 = {
                has_building = slave_mine_building # mine
            }
         }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.303 }

            show_as_tooltip = {
                add_centralization = 15
                p:8142 = {
                    set_city_status = city
                    add_building_level = population_building
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
            }
        }
    }

    fezzani_mission_01_task_304 = { # Surrounded by hostile tribes
        icon = "task_conquest"
        potential = { 
            tag = MHY
        }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            political_influence >= 25
         }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.304 }

            show_as_tooltip = {
                add_political_influence = -25
                p:8168 = {
                    add_claim = ROOT
                }
                p:8128 = {
                    add_claim = ROOT
                }

                add_country_modifier = {
                    name = dug_in
                }
            }
        }
    }

    fezzani_mission_01_task_305 = { # the garamantes farms - remade for the machylians/phazanians since the nasamonians use this as a pre-req for the final formation
        icon = "task_conquest"
        potential = { 
            tag = MHY
            tag = PHZ
        }
        requires = { 
            fezzani_mission_01_task_304 # MHY
            fezzani_mission_01_task_506 # PHZ
        }
        allow = {
            owns = 8152
            hidden:p:8152 = {
                has_building = basic_settlement_infratructure_building
            }
            owns = 8164
            hidden:p:8164 = {
                has_building = basic_settlement_infratructure_building
            }
            owns = 8175
            hidden:p:8175 = {
                has_building = basic_settlement_infratructure_building
            }
            owns = 8161
            hidden:p:8161 = {
                has_building = basic_settlement_infratructure_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8152
                    province_id = 8164
                    province_id = 8175
                    province_id = 8161
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.305 }

            show_as_tooltip = {

                add_centralization = 20

                add_country_modifier = {
                    name = garamantian_farmlands
                }
            }
        }
    }

    fezzani_mission_01_task_306 = { # the makaen subjects
        icon = "task_diplomatic"
        potential = { 
            tag = MHY
        }
        requires = { fezzani_mission_01_task_302 }
        allow = {
            owns = 8128
            owns = 8168
        }

        bypass = {
            OR = {
                c:MKA = {
                    has_land = no
                }
                c:MKA = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8128
                    province_id = 8168
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.306 }

            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_306_tt
            }
        }
    }

    fezzani_mission_01_task_307 = { # the coast
        icon = "task_expansion"
        potential = { 
            tag = MHY
        }
        requires = { fezzani_mission_01_task_304 }
        allow = {
            owns_or_subject_owns_area = syrtis_area
            owns_area = nasamonia_area
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.307 }
            # TODO an event chain where if MHY is your subject, then seize land at the cost of loyalty

            show_as_tooltip = {
                
                area:psyllia_area = {
                    add_provincial_claim_effect = yes
                }
                
                area:tripolitania_orientalis_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_308 = { # the makean land - we need this to border/claim phazania
        icon = "task_battle"
        potential = { 
            tag = MHY
        }
        requires = { fezzani_mission_01_task_302 fezzani_mission_01_task_304 }
        allow = {
            owns_area = syrtis_area
            owns_area = zamzam_area
            owns_area = soffegin_area
            owns_area = girgiri_area
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = syrtis_area
                    is_in_area = zamzam_area
                    is_in_area = soffegin_area
                    is_in_area = girgiri_area
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.308 }

            show_as_tooltip = {
                
                area:phazania_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }


    ########################################
    # Machylia Specific 401 - 500
    ########################################
    

    fezzani_mission_01_task_401 = { # the machylians - feudatory
        icon = "task_conquest"
        potential = { 
            tag = MKA
        }
        requires = { fezzani_mission_01_task_301 }
        allow = {
            trigger_if = {
                limit = { is_ai = no }

                c:MHY.current_ruler = {
                    is_friend = root.current_ruler
                }
            }
            trigger_if = {
                limit = { is_ai = yes }
                
                c:MHY = {
                    has_land = yes
                    opinion = {
                        target = c:MKA
                        value >= 150
                    }
                }
            }
        }

        bypass = { # bypass if they are a subject of us already somehow or do not exist
            OR = {
                c:MHY = {
                    has_land = no
                }
                c:MHY = {
                    is_subject_of = root
                }
            }
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.401 }

            # todo event chain

            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_401_tt
            }
        }
    }

    fezzani_mission_01_task_402 = { # the girigiri capital 
        icon = "task_conquest"
        potential = { 
            tag = MKA
        }
        requires = { fezzani_mission_01_task_301 }
        allow = {
            hidden:p:8219 = {
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            hidden:p:8215 = {
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
            hidden:p:8212 = {
                has_building = basic_settlement_infratructure_building # Farming settlement
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8219
                    province_id = 8215
                    province_id = 8212
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.402 }

            show_as_tooltip = {

                add_centralization = 20

                p:8218 = {
                    set_city_status = city
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }

                add_country_modifier = {
                    name = makean_livestock
                }
            }
        }
    }

    fezzani_mission_01_task_403 = { # the phazania
        icon = "task_conquest"
        potential = { 
            tag = MKA
        }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            political_influence >= 20
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.403 }

            show_as_tooltip = {
                add_political_influence = -20
                add_2_free_province_investments = yes
                area:phazania_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_404 = { # the pheasants
        icon = "task_conquest"
        potential = { 
            tag = MKA
        }
        requires = { fezzani_mission_01_task_403 }
        allow = {
            owns_area = phazania_area
            hidden:p:8233 = {
                has_building = fortress_building
                has_building = foundry_building
                has_building = theathre_building
                has_building = temple_building
                num_of_library_building >= 2
            }
        }

        highlight = {
            scope:province = {
                province_id = 8233
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.404 }

            show_as_tooltip = {
                add_centralization = 20
                add_innovation = 2
                add_2_free_province_investments = yes
                p:8233 = {
                    add_permanent_province_modifier = {
                        name = pheasant_integration
                    }
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
            }
        }
    }

    fezzani_mission_01_task_405 = { # the psyllians
        icon = "task_conquest"
        potential = { 
            tag = MKA
        }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            hidden:p:8196.state = {
                calc_true_if = {
                    amount >= 2
                    state_improvement_civic_trigger = yes
                    state_improvement_oratory_trigger = yes
                    state_improvement_religious_trigger = yes
                }
            }
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.405 }

            show_as_tooltip = {
                area:psyllia_area = {
                    add_provincial_claim_effect = yes
                }
                area:tripolitania_orientalis_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_406 = { # the Nasamonian Land
        icon = "task_conquest"
        potential = { 
            tag = MKA
        }
        requires = { fezzani_mission_01_task_405 fezzani_mission_01_task_401 }
        allow = {
            OR = { # Just to make sure we have a border with the nasamonians to annex land
                AND = {
                    owns_area = syrtis_area
                }
                AND = {
                    owns_area = tripolitania_orientalis_area
                    p:8143 = {
                        owner = c:NAS
                    }
                }
            }
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.406 }

            show_as_tooltip = {
                area:nasamonia_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_407 = { # the desert trek
        icon = "task_conquest"
        potential = { 
            tag = MKA
        }
        requires = { fezzani_mission_01_task_406 }
        allow = {
            owns_area = syrtis_area
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.407 }

            show_as_tooltip = {
                area:shatti_area = {
                    add_provincial_claim_effect = yes
                }
                area:hayaa_area = {
                    add_provincial_claim_effect = yes
                }
                area:murzuq_area = {
                    add_provincial_claim_effect = yes
                }
                area:himka_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }


    ########################################
    # Phazania Specific 501 - 600
    ########################################


    fezzani_mission_01_task_501 = { # the Pheasants
        icon = "task_conquest"
        potential = { 
            tag = PHZ
        }
        requires = {  }
        allow = {
            political_influence >= 25
            treasury >= 50
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.501 }

            show_as_tooltip = {
                add_political_influence = -25
                add_treasury = -50

                add_country_modifier = {
                    name = pheasant_beginning
                }
            }
        }
    }

    fezzani_mission_01_task_502 = { # desert OAsis
        icon = "task_conquest"
        potential = { 
            tag = PHZ
        }
        requires = { fezzani_mission_01_task_501 }
        allow = {
            hidden:p:8233 = {
                free_building_slots = 0
                has_construction = no
            }
        }

        highlight = {
            scope:province = {
                province_id = 8233
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.502 }

            show_as_tooltip = {

                add_centralization = 25
                add_innovation = 3
                add_4_free_province_investments = yes

                p:8233 = {
                    add_permanent_province_modifier = {
                        name = desert_oasis_capital
                    }
                }
            }
        }
    }

    fezzani_mission_01_task_503 = { # the MAkeans
        icon = "task_conquest"
        potential = { 
            tag = PHZ
        }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            
        }

        highlight = {
            scope:province = {
                province_id = 8218
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.503 }

            show_as_tooltip = {
                p:8218 = {
                    add_claim = root
                }
            }
        }
    }

    fezzani_mission_01_task_504 = { # alliances
        icon = "task_conquest"
        potential = { 
            tag = PHZ
        }
        requires = { fezzani_mission_01_task_02 }
        allow = {
            
        }

        highlight = {
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.504 }
            # todo event chain where we reach out to carthage
        }
    }

    fezzani_mission_01_task_505 = { # psyllia
        icon = "task_conquest"
        potential = { 
            tag = PHZ
        }
        requires = { fezzani_mission_01_task_503 }
        allow = {
            owns_area = girgiri_area
            owns_area = soffegin_area
            owns_area = zamzam_area
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = zamzam_area
                    is_in_area = soffegin_area
                    is_in_area = girgiri_area
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.505 }

            show_as_tooltip = {
                area:psyllia_area = {
                    add_provincial_claim_effect = yes
                }
                area:tripolitania_orientalis_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_506 = { # the western fezzani tribes
        icon = "task_conquest"
        potential = { 
            tag = PHZ
        }
        requires = { fezzani_mission_01_task_503 }
        allow = {
            owns_area = girgiri_area
            owns_area = soffegin_area
            owns_area = zamzam_area
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = zamzam_area
                    is_in_area = soffegin_area
                    is_in_area = girgiri_area
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.506 }

            show_as_tooltip = {

                add_military_experience = 25

                area:syrtis_area = {
                    add_provincial_claim_effect = yes
                }
                area:nasamonia_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_507 = { # the last tribe
        icon = "task_conquest"
        potential = { 
            tag = PHZ
        }
        requires = { fezzani_mission_01_task_503 }
        allow = {
            owns_area = syrtis_area
            owns_area = nasamonia_area
        }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = syrtis_area
                    is_in_area = nasamonia_area
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.507 }

            show_as_tooltip = {

                add_military_experience = 25

                area:shatti_area = {
                    add_provincial_claim_effect = yes
                }
                area:hayaa_area = {
                    add_provincial_claim_effect = yes
                }
                area:murzuq_area = {
                    add_provincial_claim_effect = yes
                }
                area:himka_area = {
                    add_provincial_claim_effect = yes
                }
            }
        }
    }

    fezzani_mission_01_task_508 = { # The mhy dates - remaking for the phazania due to other pre-reqs
        icon = "task_conquest"
        potential = { 
            tag = PHZ
        }
        requires = { fezzani_mission_01_task_502 }
        allow = {
            owns_area = syrtis_area
            hidden:p:8142 = {
                has_building = basic_settlement_infratructure_building
            }
            hidden:p:8144 = {
                has_building = basic_settlement_infratructure_building
            }
        }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8142
                    province_id = 8144
                }
            }
        }

        on_completion = { 
            trigger_event = { id = me_fezzani.204 } # same event

            show_as_tooltip = {

                add_innovation = 1

                add_centralization = 20

                add_country_modifier = {
                    name = date_trade
                }
            }
        }
    }



    ################################################################################
    # Final Formation of fezzan - common to all
    ################################################################################
    fezzani_mission_01_task_20 = { # a desert Rose
        icon = "task_heracles"
        potential = {
            OR = {
                tag = GAR
                tag = PSY
                tag = NAS
                tag = MHY
                tag = MKA
                tag = PHZ
            }
        }

        requires = { 
            fezzani_mission_01_task_14 fezzani_mission_01_task_19 # Garamantes
            fezzani_mission_01_task_111 # Psyllia
            fezzani_mission_01_task_208 fezzani_mission_01_task_206 # Nasamonians
            fezzani_mission_01_task_407 # Makeans

        }

        final = yes

        allow = {
            owns_region = fezzan_region
        }

        highlight = {
            scope:province = {
                is_in_region = fezzan_region
            }
        }

        on_completion = {
            trigger_event = { id = me_fezzani.20 }
            
            show_as_tooltip = {
                custom_tooltip = fezzani_mission_01_task_20_tt
            }
        }
    }


} # last