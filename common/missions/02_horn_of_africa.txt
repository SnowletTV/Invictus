02_horn_of_africa = {
    header = "kush_mission_header"
    icon = "seleukid_3"

    repeatable = no
    chance = {
		factor = 5
	}

    potential = {
        has_completed_mission = 01_horn_of_africa
        NOT = { has_variable = african_mission_cooldown }
    }

    on_potential = {
        if = {
            limit = {
                NOT = {
                    has_variable = arabian_culture_points
                }
            }
            set_variable = {
                name = arabian_culture_points
                value = 0
            }
        }
        if = {
            limit = {
                NOT = {
                    has_variable = indian_culture_points
                }
            }
            set_variable = {
                name = indian_culture_points
                value = 0
            }
        }
        if = {
            limit = {
                NOT = {
                    has_variable = african_culture_points
                }
            }
            set_variable = {
                name = african_culture_points
                value = 0
            }
        }
    }

    abort = {
		ai_mission_back_out_trigger = yes
	}

    on_start = {
        start_mission_ai_effect = yes
        set_variable = african_mission_cooldown
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = african_mission_cooldown
            days = 7300
        }
    }
    on_completion = {
		complete_mission_effect = yes
        show_as_tooltip = {
            custom_tooltip = culture_points_arabian_tt
            custom_tooltip = culture_points_indian_tt
            custom_tooltip = culture_points_african_tt
        }
	}

    02_horn_of_africa_task_start = {
        icon = "task_diplomatic"

        duration = 180

        on_start = {
            trigger_event = {
                id = me_horn_of_africa.26
                days = { 60 80 }
            }
            trigger_event = {
                id = me_horn_of_africa.27
                days = { 90 120 }
            }
            trigger_event = {
                id = me_horn_of_africa.28
                days = { 130 160 }
            }
        }

        on_completion = {
            trigger_event = me_horn_of_africa.29
            custom_tooltip = culture_points_info_tt
            custom_tooltip = culture_points_arabian_tt
            custom_tooltip = culture_points_indian_tt
            custom_tooltip = culture_points_african_tt
        }
    }

    02_horn_of_africa_task_1 = { # Fortified Port of Sarapis
        icon = "task_expansion"

        highlight = {
            scope:province = {
                province_id = 7216
            }
        }

        allow = {
            hidden:p:7216 = {
                has_city_status = yes
            }
        }

        requires = { 02_horn_of_africa_task_start } 

        on_completion = {
            trigger_event = me_horn_of_africa.30
            show_as_tooltip = {
                arabian_culture_point_effect = yes
            }
            p:7216 = {
                add_building_level = port_building
                add_province_modifier = {
                    name = port_of_sarapis_city_mod
                    duration = -1
                }
            }
        }
    }

    02_horn_of_africa_task_2 = {
        icon = "task_diplomatic"
        requires = { 02_horn_of_africa_task_1 }

        highlight = {
            scope:province = {
                province_id = 7216
            }
        }

        allow = {
            owns_
            trigger_if = {
                limit = {
                    has_variable = increased_arabian_point_cost_var
                }
                custom_tooltip = {
                    text = 3_culture_points_arabian_tt
                    var:arabian_culture_points >= 3
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 2_culture_points_arabian_tt
                    var:arabian_culture_points >= 2
                }
            }
            has_military_bonus = arabian_path_8
            p:7216 = {
                num_of_port_building > 3
                hidden:state = {
                    calc_true_if = {
                        amount >= 2 
                        state_improvement_military_trigger = yes
                        state_improvement_civic_trigger = yes
                        state_improvement_oratory_trigger = yes
                        state_improvement_religious_trigger = yes
                    }
                }
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.31
            set_variable = increased_indian_point_cost_var
            p:7216 = {
                add_province_modifier = {
                    name = macrobian_souq_sarapis_mod
                    duration = -1
                }
            }
            show_as_tooltip = {
                arabian_culture_point_effect = yes
                custom_tooltip = increased_indian_points_needed_tt
            }
        }
    }

    02_horn_of_africa_task_3 = {
        icon = "task_expansion"
        duration = 180
        requires = { 02_horn_of_africa_task_2 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 7202
                    province_id = 4955
                    province_id = 8867
                }
            }
        }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_arabian_point_cost_var
                }
                custom_tooltip = {
                    text = 4_culture_points_arabian_tt
                    var:arabian_culture_points >= 4
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 3_culture_points_arabian_tt
                    var:arabian_culture_points >= 3
                }
            }
            treasury >= 150
        }
        
        on_completion = {
            current_ruler = {
                add_corruption = 5
            }
            trigger_event = me_horn_of_africa.32
            p:7202 = {
                add_province_modifier = {
                    name = pirate_haven_modifier
                    duration = -1
                }
                add_claim = root
            }
            p:4955 = {
                add_province_modifier = {
                    name = pirate_haven_modifier
                    duration = -1
                }
                add_claim = root
            }
            p:8867 = {
                add_province_modifier = {
                    name = pirate_haven_modifier
                    duration = -1
                }
                add_claim = root
            }
            show_as_tooltip = {
                arabian_culture_point_effect = yes
                add_treasury = -150
            }
        }
    }

    02_horn_of_africa_task_4 = {
        icon = "task_political"
        duration = 1825
        requires = { 02_horn_of_africa_task_2 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 4662
                    province_id = 4666
                    province_id = 4674
                    province_id = 4676
                    province_id = 8852
                    province_id = 7575
                    province_id = 4615
                    province_id = 704
                    province_id = 729
                    province_id = 4721
                    province_id = 8815
                    province_id = 8824
                    province_id = 8831
                    province_id = 8837
                    province_id = 7209
                    province_id = 8867
                    province_id = 7199
                    province_id = 7212
                    province_id = 7202
                }
            }
        }

        allow = {
            treasury >= 500
            hidden:p:4662 = {
                has_building = fortress_building
            }
            hidden:p:4666 = {
                has_building = fortress_building
            }
            hidden:p:4674 = {
                has_building = fortress_building
            }
            hidden:p:4676 = {
                has_building = fortress_building
            }
            hidden:p:8852 = {
                has_building = fortress_building
            }
            hidden:p:7575 = {
                has_building = fortress_building
            }
            hidden:p:4615 = {
                has_building = fortress_building
            }
            hidden:p:704 = {
                has_building = fortress_building
            }
            hidden:p:729 = {
                has_building = fortress_building
            }
            hidden:p:4721 = {
                has_building = fortress_building
            }
            hidden:p:8815 = {
                has_building = fortress_building
            }
            hidden:p:8824 = {
                has_building = fortress_building
            }
            hidden:p:8831 = {
                has_building = fortress_building
            }
            hidden:p:8837 = {
                has_building = fortress_building
            }
            hidden:p:7209 = {
                has_building = fortress_building
            }
            hidden:p:8867 = {
                has_building = fortress_building
            }
            hidden:p:7199 = {
                has_building = fortress_building
            }
            hidden:p:7212 = {
                has_building = fortress_building
            }
            hidden:p:7202 = {
                has_building = fortress_building
            }
        }
        
        on_completion = {
            trigger_event = { id = south_arabia.86 }
            custom_tooltip = get_trade_roads_tt
            show_as_tooltip = {
                arabian_culture_point_effect = yes
            }
        }
    }

    02_horn_of_africa_task_5 = {
        icon = "task_apollo"

        requires = { 02_horn_of_africa_task_4 02_horn_of_africa_task_3 }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_arabian_point_cost_var
                }
                custom_tooltip = {
                    text = 6_culture_points_arabian_tt
                    var:arabian_culture_points >= 6
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 5_culture_points_arabian_tt
                    var:arabian_culture_points >= 5
                }
            }
            OR = {
                custom_tooltip = {
                    text = zoro_conversion_tt
                    any_pantheon_deity = {
                        count >= 2
                        deity_religion = zoroaster
                    }  
                }
                custom_tooltip = {
                    text = mithra_conversion_tt
                    any_pantheon_deity = {
                        count >= 2
                        deity_religion = mithra_religion
                    }
                }
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.34
            show_as_tooltip = {
                arabian_culture_point_effect = yes
                add_innovation = 3
                custom_tooltip = arm_we_can_convert_tt 
            }
        }
    }

    02_horn_of_africa_task_6 = { # start indian influences
        icon = "task_athena"

        requires = { 02_horn_of_africa_task_start }

        allow = {
            treasury >= 250
            p:6915 = {
                num_goods_produced >= 3
            }
            p:6900 = {
                num_goods_produced >= 3
            }
            p:6971 = {
                num_goods_produced >= 3
            }
            p:6920 = {
                num_goods_produced >= 3
            }
        }

        highlight = {
            scope:province = { 
                OR = {
                    province_id = 6915 
                    province_id = 6900 
                    province_id = 6971 
                    province_id = 6920 
                }   
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.35
            show_as_tooltip = {
                indian_culture_point_effect = yes
            }
            add_treasury = -250
            p:6915 = {
                add_province_modifier = {
                    name = macrobian_indian_diamond_cities
                    duration = -1
                }
            }
            p:6900 = {
                add_province_modifier = {
                    name = macrobian_indian_diamond_cities
                    duration = -1
                }
            }
            p:6971 = {
                add_province_modifier = {
                    name = macrobian_indian_diamond_cities
                    duration = -1
                }
            }
            p:6920 = {
                add_province_modifier = {
                    name = macrobian_indian_diamond_cities
                    duration = -1
                }
            }
        }
    }

    02_horn_of_africa_task_7 = {
        icon = "task_durga"

        requires = { 02_horn_of_africa_task_6 }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = north_tambapamni_area 
                    is_in_area = south_tambapamni_area
                    is_in_area = pandiya_area 
                    is_in_area = keralaputa_area
                    is_in_area = malayas_area
                    is_in_area = south_satiyaputa_area 
                    is_in_area = koda_area
                }
            }
        }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_indian_point_cost_var
                }
                custom_tooltip = {
                    text = 3_culture_points_indian_tt
                    var:indian_culture_points >= 3
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 2_culture_points_indian_tt
                    var:indian_culture_points >= 2
                }
            }
            custom_tooltip = {
                text = macrobian_territories_in_southern_india_tooltip
                macrobian_territories_in_southern_india_current >= macrobian_territories_in_southern_india_total
                    region:cyrenaica_region = {
                        NOT = {
                        any_region_province = {
                            owner = root
                            has_construction = yes
                        }
                    }
                }                
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.36
            set_variable = increased_arabian_point_cost_var
            show_as_tooltip = {
                indian_culture_point_effect = yes
                custom_tooltip = increased_arabian_points_needed_tt
                add_country_modifier = {
                    name = indian_presence_macrobian
                    duration = -1
                }
            }
        }
    }

    02_horn_of_africa_task_8 = {
        icon = "task_political"
        duration = 180
        requires = { 02_horn_of_africa_task_7 }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_indian_point_cost_var
                }
                custom_tooltip = {
                    text = 4_culture_points_indian_tt
                    var:indian_culture_points >= 4
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 3_culture_points_indian_tt
                    var:indian_culture_points >= 3
                }
            }
            treasury >= 150
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.37
            show_as_tooltip = {
                indian_culture_point_effect = yes
                add_treasury = -150
            }
        }
    }

    02_horn_of_africa_task_9 = {
        icon = "task_shiva"

        requires = { 02_horn_of_africa_task_7 }

        allow = {
            custom_tooltip = {
                text = hindu_conversion_tt
                any_pantheon_deity = {
                    count >= 2
                    deity_religion = hindu
                }
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.38
            show_as_tooltip = {
                indian_culture_point_effect = yes
            }
            soft_change_religion_effect = {
                RELIGION = hindu
            }
        }
    }

    02_horn_of_africa_task_10 = {
        icon = "task_religion"

        requires = { 02_horn_of_africa_task_9 02_horn_of_africa_task_8 }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_indian_point_cost_var
                }
                custom_tooltip = {
                    text = 5_culture_points_indian_tt
                    var:indian_culture_points >= 5
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 6_culture_points_indian_tt
                    var:indian_culture_points >= 6
                }
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.39
            show_as_tooltip = {
                indian_culture_point_effect = yes
                add_innovation = 3
                soft_change_religion_effect = {
                    RELIGION = roman_pantheon
                }
            }
        }
    }

    02_horn_of_africa_task_11 = { # start native purism
        icon = "task_diplomatic"
        duration = 365

        allow = {
            treasury >= 250
            p:7532 = {
                num_goods_produced >= 3
            }
            p:7526 = {
                num_goods_produced >= 3
            }
            p:7523 = {
                num_goods_produced >= 3
            }
            p:7522 = {
                num_goods_produced >= 3
            }
        }

        highlight = {
            scope:province = { 
                OR = {
                    province_id = 7532 
                    province_id = 7526 
                    province_id = 7523 
                    province_id = 7522 
                }   
            }
        }

        requires = { 02_horn_of_africa_task_start }
        
        on_completion = {
            trigger_event = me_horn_of_africa.40
            show_as_tooltip = {
                african_culture_point_effect = yes
            }
            add_treasury = -250
            p:7532 = {
                add_province_modifier = {
                    name = macrobian_trade_goods
                    duration = -1
                }
            }
            p:7526 = {
                add_province_modifier = {
                    name = macrobian_trade_goods
                    duration = -1
                }
            }
            p:7523 = {
                add_province_modifier = {
                    name = macrobian_trade_goods
                    duration = -1
                }
            }
            p:7522 = {
                add_province_modifier = {
                    name = macrobian_trade_goods
                    duration = -1
                }
            }
        }
    }

    02_horn_of_africa_task_12 = {
        icon = "task_calm"
        duration = 1825
        requires = { 02_horn_of_africa_task_11 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 7519
                    province_id = 7520  
                    province_id = 7506
                    province_id = 7521
                    province_id = 8731  
                    province_id = 7541
                    province_id = 7542
                    province_id = 7543
                    province_id = 7544 
                    province_id = 7545
                    province_id = 7514
                    province_id = 7508
                    province_id = 7505 
                    province_id = 7506  
                } 
            }
        }

        allow = {
            treasury >= 500
            p:7519 = {
                is_importing_trade_good = stone
                fort_level >= 2
                num_of_port_building >= 2
                num_of_commerce_building >= 3
                has_no_ongoing_construction = yes
            }
            p:7506 = {
                is_importing_trade_good = stone
                fort_level >= 2
                num_of_military_building >= 2
                num_of_commerce_building >= 3
                has_no_ongoing_construction = yes
            }
            trigger_if = {
                limit = {
                    has_variable = increased_indian_point_cost_var
                }
                custom_tooltip = {
                    text = _4_culture_points_indian_tt
                    var:indian_culture_points < 4
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = _3_culture_points_indian_tt
                    var:indian_culture_points < 3
                }
            }
            trigger_if = {
                limit = {
                    has_variable = increased_arabian_point_cost_var
                }
                custom_tooltip = {
                    text = _4_culture_points_arabian_tt
                    var:arabian_culture_points < 4
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = _3_culture_points_arabian_tt
                    var:arabian_culture_points < 3
                }
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.41
            show_as_tooltip = {
                african_culture_point_effect = yes
            }
            add_treasury = -500
            custom_tooltip = macrobian_highland_road_tt
            hidden_effect = {
                p:7519 = { add_road_towards = p:7520 }
                p:7520 = { add_road_towards = p:7521 }
                p:7520 = { add_road_towards = p:8731 }
                p:8731 = { add_road_towards = p:7541 }
                p:7541 = { add_road_towards = p:7542 }
                p:7542 = { add_road_towards = p:7543 }
                p:7543 = { add_road_towards = p:7544 }
                p:7544 = { add_road_towards = p:7545 }
                p:7545 = { add_road_towards = p:7514 }
                p:7514 = { add_road_towards = p:7508 }
                p:7508 = { add_road_towards = p:7505 }
                p:7505 = { add_road_towards = p:7506 }
            }
        }
    }

    02_horn_of_africa_task_13 = {
        icon = "task_religion"

        requires = { 02_horn_of_africa_task_12 }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_indian_point_cost_var
                }
                custom_tooltip = {
                    text = _3_culture_points_indian_tt
                    var:indian_culture_points < 3
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = _2_culture_points_indian_tt
                    var:indian_culture_points < 2
                }
            }
            trigger_if = {
                limit = {
                    has_variable = increased_arabian_point_cost_var
                }
                custom_tooltip = {
                    text = _3_culture_points_arabian_tt
                    var:arabian_culture_points < 3
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = _2_culture_points_arabian_tt
                    var:arabian_culture_points < 2
                }
            }
            religious_unity >= 0.75
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.42
            show_as_tooltip = {
                african_culture_point_effect = yes
                add_country_modifier = {
                    name = enforced_unity 
                    duration = 9125 # 25 years
                }
            }
        }
    }

    02_horn_of_africa_task_14 = {
        icon = "task_expansion"

        requires = { 02_horn_of_africa_task_12 }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_indian_point_cost_var
                }
                custom_tooltip = {
                    text = _2_culture_points_indian_tt
                    var:indian_culture_points < 2
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = _1_culture_points_indian_tt
                    var:indian_culture_points < 1
                }
            }
            trigger_if = {
                limit = {
                    has_variable = increased_arabian_point_cost_var
                }
                custom_tooltip = {
                    text = _2_culture_points_arabian_tt
                    var:arabian_culture_points < 2
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = _1_culture_points_arabian_tt
                    var:arabian_culture_points < 1
                }
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.43
            show_as_tooltip = {
                african_culture_point_effect = yes
            }
        }
    }

    02_horn_of_africa_task_15 = {
        icon = "task_happiness"

        requires = { 02_horn_of_africa_task_14 02_horn_of_africa_task_13 }

        allow = {
            custom_tooltip = {
                text = 5_culture_points_africa_tt
                var:african_culture_points >= 5
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.44
            show_as_tooltip = {
                african_culture_point_effect = yes
                add_innovation = 2
            }
        }
    }

    # start of military

    02_horn_of_africa_task_16 = { 
        icon = "task_economical"

        duration = 365

        allow = {
            custom_tooltip = {
                text = macrobian_frankincense_and_myrrh_tt
                saba_trade_goods_svalue >= 15
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.45
            add_treasury = 500
        }
    }

    02_horn_of_africa_task_17 = { 
        icon = "task_calm"

        requires = { 02_horn_of_africa_task_16 } 

        requires = { 02_horn_of_africa_task_start }

        highlight = {
            scope:province = { 
                owner = root
                OR = {
                    trade_goods = incense
                    trade_goods = myrrh
                    trade_goods = spices
                }
            }
        } 

        allow = {
            custom_tooltip = {
                text = macrobian_90_trade_goods_value_tt
                saba_trade_goods_svalue >= arabia_punt_trade_goods_svalue2
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.46
            add_country_modifier = {
                name = macrobian_arabian_trade_modifier
                duration = -1
            }
        }
    }

    02_horn_of_africa_task_18 = { 
        icon = "task_expansion"

        requires = { 02_horn_of_africa_task_17 } 

        highlight = {
            scope:province = {
                OR = {
                    is_in_region = cappadocia_pontica_region
                    is_in_region = cappadocia_region
                }
            }
        }

        allow = {
            owns_or_subject_owns_region = cappadocia_pontica_region
            owns_or_subject_owns_region = cappadocia_region
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.47
            show_as_tooltip = {
                add_treasury = 500
                add_military_experience = 25
            }
        }
    }

    02_horn_of_africa_task_19 = { 
        icon = "task_political"

        requires = { 02_horn_of_africa_task_17 } 

        allow = {
            trigger_if = {
                limit = {
                    is_ai = no
                }
                custom_tooltip = {
                    text = macrobian_securing_neigh_tt
                    root.country_population >= 1000 
                }
            }
            trigger_else = {
                country_population >= 1000
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.48
            show_as_tooltip = {
                add_innovation = 1
                add_research = {
                    technology = military_tech
                    value = 20
                }
                add_research = {
                    technology = civic_tech
                    value = 20
                }
                add_research = {
                    technology = oratory_tech
                    value = 20
                }
                add_research = {
                    technology = religious_tech
                    value = 20
                }
            }
        }
    }

    02_horn_of_africa_task_20 = { 
        icon = "task_conquest"
        duration = 90
        requires = { 02_horn_of_africa_task_18 }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_indian_point_cost_var
                }
                custom_tooltip = {
                    text = 3_culture_points_indian_tt
                    var:indian_culture_points >= 3
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 2_culture_points_indian_tt
                    var:indian_culture_points >= 2
                }
            }
            trigger_if = {
                limit = {
                    var:indian_culture_points >= 4
                }
                military_experience >= 25
            }
            trigger_else = {
                military_experience >= 50
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.49
        }
    }

    02_horn_of_africa_task_21 = { 
        icon = "task_diplomatic"

        requires = { 02_horn_of_africa_task_18 }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_arabian_point_cost_var
                }
                custom_tooltip = {
                    text = 3_culture_points_arabian_tt
                    var:arabian_culture_points >= 3
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 2_culture_points_arabian_tt
                    var:arabian_culture_points >= 2
                }
            }
            trigger_if = {
                limit = {
                    var:arabian_culture_points >= 4
                }
                military_experience >= 25
            }
            trigger_else = {
                military_experience >= 50
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.50
        }
    }

    02_horn_of_africa_task_22 = {
        icon = "task_expansion"
        duration = 90
        requires = { 02_horn_of_africa_task_31 } 

        highlight = {
            scope:province = {
                province_id = 988
            }
        }

        duration = 180

        on_start = { #
            # flavour event about lake van monster/vishaps (african dragons)
            trigger_event = {
                id = me_horn_of_africa.52
                days = { 100 120 }
            }
            # flavour event about the van cat
            trigger_event = {
                id = me_horn_of_africa.51
                days = { 30 60 }
            }
        }

        allow = {
            custom_tooltip = {
                text = 2_culture_points_africa_tt
                var:african_culture_points >= 2
            }
            hidden:p:988 = {
                has_building = fortress_building
                is_state_capital = yes
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.53
            show_as_tooltip = {
                african_culture_point_effect = yes
            }
        }
    }

    02_horn_of_africa_task_23 = {
        icon = "task_diplomatic"

        requires = { 02_horn_of_africa_task_22 } 

        highlight = {
            scope:province = {
                this = root.capital_scope
            }
        }

        allow = {
            capital_scope = {
                num_of_fortress_building >= 15 # this is the number required to get the achievement
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.54
            show_as_tooltip = {
                add_2_free_province_investments = yes
            }
        }
    }

    02_horn_of_africa_task_24 = {
        icon = "task_conquest"

        requires = { 02_horn_of_africa_task_17 }

        highlight = {
            scope:province = {
                OR = {
                    is_in_region = syria_region
                    is_in_region = assyria_region
                    is_in_area = cilicia_pedias_area
                    is_in_area = cilicia_trachea_area
                }
            }
        }

        allow = {
            owns_or_subject_owns_region = syria_region
            owns_or_subject_owns_region = assyria_region
            owns_or_subject_owns_area = cilicia_pedias_area
            owns_or_subject_owns_area = cilicia_trachea_area
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.55
        }
    }

    02_horn_of_africa_task_25 = {
        icon = "task_heracles"

        final = yes

        requires = { 02_horn_of_africa_task_18 02_horn_of_africa_task_24 }

        allow = {
            custom_tooltip = {
                text = 2_culture_points_africa_tt
                var:african_culture_points >= 2
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.56
        }
    }

    # flavour 

    02_horn_of_africa_task_26 = { 
        icon = "task_economical"
        duration = 90
        requires = { 02_horn_of_africa_task_start } 

        duration = 365

        allow = {
            war = no
            political_influence >= 15
        }
        
        on_completion = {
            add_political_influence = -15
            trigger_event = me_horn_of_africa.57
            show_as_tooltip = {
            }
        }
    }

    02_horn_of_africa_task_27 = { 
        icon = "task_diplomatic"

        requires = { 02_horn_of_africa_task_start } 

        duration = 365

        on_start = {
            trigger_event = {
                id = me_horn_of_africa.58
                days = { 90 120 }
            }
        }

        allow = {
            political_influence >= 50
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.59
            show_as_tooltip = {
            }
        }
    }

    02_horn_of_africa_task_28 = { 
        icon = "task_conquest"

        requires = { 02_horn_of_africa_task_27 }

        allow = {
            current_ruler = {
                has_trait = orontid
            }
            custom_tooltip = {
                text = orontes_aqueduct_tt
                country_aqueduct_count >= 25
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.60
            show_as_tooltip = {
                arabian_culture_point_effect = yes
            }
        }
    }

    02_horn_of_africa_task_29 = { 
        icon = "task_calm"

        requires = { 02_horn_of_africa_task_27 } 

        duration = 365

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_arabian_point_cost_var
                }
                custom_tooltip = {
                    text = 4_culture_points_arabian_tt
                    var:arabian_culture_points >= 4
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 3_culture_points_arabian_tt
                    var:arabian_culture_points >= 3
                }
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.61
            show_as_tooltip = {
                arabian_culture_point_effect = yes
                add_political_influence = -50
                current_ruler = {
                    add_bloodline_effect = { BLOODLINE = achaemenid }
                }
            }
        }
    }

    02_horn_of_africa_task_30 = { 
        icon = "task_political"

        requires = { 02_horn_of_africa_task_26 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 4662
                    province_id = 4666
                    province_id = 4674
                    province_id = 4676
                    province_id = 8852
                }
            }
        }

        allow = {
            p:4662 = {
                has_city_status = yes
                num_of_commerce_building >= 3
            }
            p:4666 = {
                has_city_status = yes
                num_of_used_building_slots >= 6
                has_construction = no
            }
            p:4674 = {
                has_city_status = yes
                num_of_used_building_slots >= 6
                has_construction = no
            }
            p:4676 = {
                has_city_status = yes
                num_of_used_building_slots >= 6
                has_construction = no
            }
            p:8852 = {
                has_city_status = yes
                num_of_used_building_slots >= 6
                has_construction = no
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.62
            p:4662 = {
                add_permanent_province_modifier = {
                    name = arabian_city
                    duration = -1
                }
            }
            p:4666 = {
                add_permanent_province_modifier = {
                    name = arabian_city
                    duration = -1
                }
            }
            p:4674 = {
                add_permanent_province_modifier = {
                    name = arabian_city
                    duration = -1
                }
            }
            p:4676 = {
                add_permanent_province_modifier = {
                    name = arabian_city
                    duration = -1
                }
            }
            p:8852 = {
                add_permanent_province_modifier = {
                    name = arabian_city
                    duration = -1
                }
            }
            show_as_tooltip = {
                arabian_culture_point_effect = yes
            }
        }
    }

    02_horn_of_africa_task_31 = { 
        icon = "task_diplomatic"

        requires = { 02_horn_of_africa_task_26 }

        allow = {
            custom_tooltip = {
                text = saba_admin_tt
                any_character = {
                    count >= 2
                    is_head_of_family = yes
                    from_ruler_family = no
                    loyalty >= 66
                }
            }
            custom_tooltip = {
                text = 3_culture_points_africa_tt
                var:african_culture_points >= 3
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.63
            show_as_tooltip = { # todo option to switch to Urartu
                african_culture_point_effect = yes
                add_political_influence = 50
                add_stability = 10
                add_military_experience = 25
            }
        }
    }

    02_horn_of_africa_task_32 = { 
        icon = "task_atlas"

        requires = { 02_horn_of_africa_task_31 }

        duration = 730 # 2 years

        allow = { 
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.64
            show_as_tooltip = {
                african_culture_point_effect = yes
            }
        }
    }

    02_horn_of_africa_task_33 = { 
        icon = "task_artemis"

        requires = { 02_horn_of_africa_task_22 }

        allow = {
            political_influence >= 25
            OR = {
                trigger_if = {
                    limit = {
                        has_variable = increased_arabian_point_cost_var
                    }
                    custom_tooltip = {
                        text = 4_culture_points_arabian_tt
                        var:arabian_culture_points >= 4
                    }
                }
                trigger_else = {
                    custom_tooltip = {
                        text = 3_culture_points_arabian_tt
                        var:arabian_culture_points >= 3
                    }
                }
                custom_tooltip = {
                    text = 3_culture_points_africa_tt
                    var:african_culture_points >= 3
                }
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.65
            show_as_tooltip = {
                add_political_influence = -25
                custom_tooltip = xerxes_inscription_tt
            }
        }
    }

    02_horn_of_africa_task_34 = { 
        icon = "task_religion"

        requires = { 02_horn_of_africa_task_29 }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_indian_point_cost_var
                }
                custom_tooltip = {
                    text = _3_culture_points_indian_tt
                    var:indian_culture_points < 3
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = _2_culture_points_indian_tt
                    var:indian_culture_points < 2
                }
            }
            custom_tooltip = {
                text = _2_culture_points_africa_tt
                var:african_culture_points < 2
            }
            custom_tooltip = {
                    text = arabian_conversion_tt
                    any_pantheon_deity = {
                        count >= 2
                        deity_religion = arabian_pantheon
                    }  
                }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.66
            show_as_tooltip = {
                arabian_culture_point_effect = yes
                soft_change_religion_effect = {
                RELIGION = arabian_pantheon
            }
            }
        }
    }

    02_horn_of_africa_task_35 = { 
        icon = "task_calm"

        requires = { 02_horn_of_africa_task_start } 

        duration = 180

        allow = {
            custom_tooltip = {
                text = macrobian_integrate_indian_culture_tt
                any_integrated_culture = {
                    OR = {
                        is_culture = pandyan
                        is_culture = lankan
                        is_culture = cheran
                        is_culture = tamil
                    }
                }
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.67
            show_as_tooltip = {
                indian_culture_point_effect = yes
            }
        }
    }

    02_horn_of_africa_task_36 = { 
        icon = "task_diplomatic"

        requires = { 02_horn_of_africa_task_35 } 

        highlight = {
            scope:province = {
                this = root.capital_scope
            }
        }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_indian_point_cost_var
                }
                custom_tooltip = {
                    text = 3_culture_points_indian_tt
                    var:indian_culture_points >= 3
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 2_culture_points_indian_tt
                    var:indian_culture_points >= 2
                }
            }
            treasury >= 150
            capital_scope = {
                num_of_library_building >= 3
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.68
            show_as_tooltip = {
                indian_culture_point_effect = yes
                add_treasury = -150
                capital_scope = {
                    add_building_level = library_building
                }
            }
        }
    }

    02_horn_of_africa_task_37 = { 
        icon = "task_heracles"

        requires = { 02_horn_of_africa_task_35 } 

        highlight = {
            scope:province = {
                this = root.capital_scope
            }
        }

        allow = {
            trigger_if = {
                limit = {
                    has_variable = increased_indian_point_cost_var
                }
                custom_tooltip = {
                    text = 4_culture_points_indian_tt
                    var:indian_culture_points >= 4
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 3_culture_points_indian_tt
                    var:indian_culture_points >= 3
                }
            }
            trigger_if = {
                limit = {
                    has_variable = increased_arabian_point_cost_var
                }
                custom_tooltip = {
                    text = _4_culture_points_arabian_tt
                    var:arabian_culture_points < 4
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = _3_culture_points_arabian_tt
                    var:arabian_culture_points < 3
                }
            }
            custom_tooltip = {
                text = _3_culture_points_africa_tt
                var:african_culture_points < 3
            }
            custom_tooltip = {
                text = 8_military_indian_macrobian_tt
                any_character = {
                    has_culture_group = indian
                    has_tech_office_of = military_tech
                    martial >= 8
                }
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.69
            show_as_tooltip = {
                custom_tooltip = unlock_indian_kingdom_mil_trads_tt
            }
        }
    }

    02_horn_of_africa_task_38 = { 
        icon = "task_diplomatic"

        requires = { 02_horn_of_africa_task_26 } 

        highlight = {
            scope:province = {
                this = root.capital_scope
            }
        }

        allow = {
            capital_scope = {
                num_of_used_building_slots >= 10
                total_population >= 60
                trigger_if = {
                    limit = { has_construction = yes }
                    has_construction = no
                }
            }
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.70
            show_as_tooltip = {
                capital_scope = {
                    if = {
                        limit = {
                            NOT = { has_province_rank = city_metropolis }
                        }
                        set_city_status = city_metropolis
                    }
                }
            }
        }
    }

    02_horn_of_africa_task_39 = { 
        icon = "task_economical"

        requires = { 02_horn_of_africa_task_38 }

        allow = {
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.71
        }
    }

    02_horn_of_africa_task_40 = { 
        icon = "task_diplomatic"

        requires = { 02_horn_of_africa_task_38 }

        allow = {
            
        }
        
        on_completion = {
            trigger_event = me_horn_of_africa.72
            
        }
    }
}



