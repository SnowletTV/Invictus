numidian_mission_01 = {
    header = "mission_image_general" # SPECIAL FIELD - Sets top picture for the mission
    icon = "general_3" # SPECIAL FIELD - Sets icon for the mission

    repeatable = no # SPECIAL FIELD - Sets if a mission can be done once or several times

    chance = {
        factor = 50000
        } # SPECIAL FIELD - Sets the chances of a mission appearing in your list of available missions

    potential = {
        NOT = { has_variable = numidian_mission_cooldown }
        OR = {
            tag = MSS
            tag = MAU
        } # TRIGGER FIELD - Sets the conditions for the mission to appear in your list
        is_subject = no # must not be a subject
    }
    on_start = {
        save_scope_as = me_numidian_scope
        start_mission_ai_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is started

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = numidian_mission_cooldown
            days = 1 #7300
            }
    } # EFFECT FIELD - These effects are run when the mission is aborted

    abort = {
        ai_mission_back_out_trigger = yes
    }

    on_completion = {
        complete_mission_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is completed



    numidian_mission_01_task_01 = { # task 1 - The Numidian Crown - tribe to monarchy common to all
        icon = "task_political"

        allow = {
            stability >= 50
            centralization > 95
        }

        bypass = { is_monarchy = yes }

        on_completion = {
            trigger_event = { id = me_numidian.1 }
            add_political_influence = 100
            ###     The following was taken directly from the tribal reform mission
            change_government = despotic_monarchy       
            switch_government_type_event_clearup_effect = yes
            hidden_effect = {
                current_ruler.family = {
                    save_scope_as = monarchy_family
                }
            }
            if = {
                limit = {
                    exists = scope:monarchy_family
                    scope:monarchy_family = {
                        any_family_member = {
                            is_adult = yes
                            trigger_if = {
                                limit = {
                                    root = {
                                        gender_equality = no
                                    }
                                }
                                is_male = yes
                            }
                            has_any_office = no
                        }
                    }
                }
                custom_tooltip = grant_offices_monarchy_reform_tt
                hidden_effect = {
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_foreign_minister
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = charisma
                                        }
                                    }
                                }
                                give_office = office_foreign_minister
                            }
                        }
                    }
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_marshal
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = martial
                                        }
                                    }
                                }
                                give_office = office_marshal
                            }
                        }
                    }
                    if = {
                        limit = {
                            scope:monarchy_family = {
                                any_family_member = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                            }
                            office_is_empty = office_high_priest_monarchy
                        }
                        scope:monarchy_family = {
                            random_family_member = {
                                limit = {
                                    is_adult = yes
                                    trigger_if = {
                                        limit = {
                                            root = {
                                                gender_equality = no
                                            }
                                        }
                                        is_male = yes
                                    }
                                    has_any_office = no
                                    is_general = no
                                    is_admiral = no
                                    is_governor = no
                                    has_tech_office = no
                                }
                                weight = {
                                    modifier = {
                                        factor = {
                                            value = 1
                                            add = zeal
                                        }
                                    }
                                }
                                give_office = office_high_priest_monarchy
                            }
                        }
                    }
                }
            }
        }
    }

    numidian_mission_01_task_02 = { # task 2 - the first steps
        icon = "task_battle"

        allow = {
            political_influence >= 15
        }

        duration = 90

        on_start = {
            add_political_influence = -15
            trigger_event = { id = me_numidian.2 }
        }

        on_completion = {
            trigger_event = { id = me_numidian.3 }
        }
    }

    numidian_mission_01_task_03 = { # An unlikely alliance MSS
        icon = "task_diplomatic"
        potential = { tag = MSS } # MSS Specific

        allow = {
            current_ruler = {
                is_friend = c:CAR.current_ruler
            }

            c:CAR = { # Carthage's opinion of MSS is greater than 175
                opinion = { target = c:MSS value >= 150 }
                alliance_with = c:MSS
            }

            c:MSY = { 
                is_subject_of = c:CAR
            }
        }

        bypass = {
            c:MSY = {
                has_land = no
            }
        }

        on_completion = {

            trigger_event = { id = me_numidian.5 }

            if = {
                limit = {
                    c:MSY = { is_subject_of = c:CAR }
                }
                c:CAR = { release_subject = c:MSY }
            }

            c:MSS = {
                make_subject = {
                    target = c:MSY
                    type = client_state
                }
            }

            add_country_modifier = {
                name = numidian_overlord
                duration = 3650
            }
        }
    }

    numidian_mission_01_task_04 = { # A Tribal Union MSS
        icon = "task_diplomatic"
        potential = { tag = MSS } # MSS specific
        requires = { numidian_mission_01_task_03 }

        allow = {
            hidden:c:MSY = {
                is_subject_of = root
                opinion = { target = c:MSS value >= 190 }
            }
        }

        duration = 730

        on_start = {
            trigger_event = { id = me_numidian.4 }
        }

        on_completion = {
            trigger_event = { id = me_numidian.6 }
            custom_tooltip = numidian_mission_01_task_04_tt
        }
    }

    numidian_mission_01_task_05 = { # The rival tribe common to all
        icon = "task_conquest"
        requires = { numidian_mission_01_task_02 }

        highlight = {
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MSS
                    }
                }
                scope:province = {
                    OR = {
                        is_in_area = jedi_area
                        is_in_area = saharan_atlas_area
                    }
                }
            }
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MAU
                    }
                }
                scope:province = {
                    OR = {
                        is_in_area = upper_moulouya_area
                        is_in_area = tadla_area
                    }
                }
            }           
        }

        allow = {
            political_influence >= 25
            trigger_if = {
                limit = {
                    tag = MSS
                }
                owns_area = jedi_area
                owns_area = saharan_atlas_area
            }
            trigger_if = {
                limit = {
                    tag = MAU
                }
                owns_area = upper_moulouya_area
                owns_area = tadla_area
                # owning rutubis_area means fighting carthage which might not be feasible now
            }
        }

        on_completion = {
            custom_tooltip = numidian_mission_01_task_05_tt
            show_as_tooltip = {
                add_political_influence = -25
                add_country_modifier = {
                    name = numidian_rival
                    duration = 1095
                }
            }
            trigger_event = { id = me_numidian.7 }
        }
    }

    numidian_mission_01_task_06 = { # Building up the Capital
        icon = "task_economical"
        requires = { numidian_mission_01_task_02 }

        allow = {
            trigger_if = {
                limit = {
                    tag = MSS
                }
                hidden:c:MSS.capital_scope = {
                    has_city_status = yes
                    free_building_slots = 0
                    has_construction = no
                }
            }

            trigger_if = {
                limit = {
                    tag = MAU
                }
                hidden:c:MAU.capital_scope = {
                    has_city_status = yes
                    free_building_slots = 0
                    has_construction = no
                }
            }
        }

        on_completion = {
            add_centralization = 25
            if = {
                limit = {
                    tag = MSS
                }
                p:3086 = {
                    add_province_modifier = {
                        name = thriving_capital
                        duration = -1
                    }
                }
            }
            if = {
                limit = {
                    tag = MAU
                }
                p:3067 = {
                    add_province_modifier = {
                        name = thriving_capital
                        duration = -1
                    }
                }
            }
        }
    }

    numidian_mission_01_task_07 = { # building mines
        icon = "task_economical"
        requires = { numidian_mission_01_task_06 }

        highlight = {
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MSS
                    }
                }
                scope:province = {
                    OR = {
                        province_id = 3089
                        province_id = 3107
                        province_id = 3113
                        province_id = 3130
                    }
                }
            }
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MAU
                    }
                }
                scope:province = {
                    OR = {
                        province_id = 3082
                        province_id = 3081
                        province_id = 3079
                        province_id = 3076
                        province_id = 3077
                    }
                }
            }           
        }

        allow = {
            trigger_if = {
                limit = {
                    tag = MSS
                }
                hidden:p:3089 = {
                    has_building = slave_mine_building
                }
                hidden:p:3107 = {
                    has_building = slave_mine_building
                }
                hidden:p:3113 = {
                    has_building = slave_mine_building
                }
                hidden:p:3130 = {
                    has_building = slave_mine_building
                }
            }

            trigger_if = {
                limit = {
                    tag = MAU
                }
                hidden:p:3082 = {
                    has_building = slave_mine_building
                }
                hidden:p:3081 = {
                    has_building = slave_mine_building
                }
                hidden:p:3079 = {
                    has_building = slave_mine_building
                }
                hidden:p:3076 = {
                    has_building = slave_mine_building
                }
                hidden:p:3077 = {
                    has_building = slave_mine_building
                }
            }
        }

        on_completion = {
            add_centralization = 15
            add_country_modifier = {
                name = thriving_mines
                duration = -1
            }
        }
    }

    numidian_mission_01_task_08 = { # breadbasket of the nation
        icon = "task_calm"
        requires = { numidian_mission_01_task_06 }

        highlight = {
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MSS
                    }
                }
                scope:province = {
                    OR = {
                        province_id = 3142
                        province_id = 3131
                        province_id = 3102
                        province_id = 3101
                        province_id = 3100
                    }
                }
            }
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MAU
                    }
                }
                scope:province = {
                    OR = {
                        province_id = 8322
                        province_id = 8396
                        province_id = 8321
                        province_id = 8318
                        province_id = 3078
                        province_id = 3074
                        province_id = 3071
                    }
                }
            }           
        }

        allow = {
            trigger_if = {
                limit = {
                    tag = MSS
                }
                hidden:p:3142 = {
                    has_building = basic_settlement_infratructure_building
                }
                hidden:p:3131 = {
                    has_building = basic_settlement_infratructure_building
                }
                hidden:p:3102 = {
                    has_building = basic_settlement_infratructure_building
                }
                hidden:p:3101 = {
                    has_building = basic_settlement_infratructure_building
                }
                hidden:p:3100 = {
                    has_building = basic_settlement_infratructure_building
                }
            }
            trigger_if = {
                limit = {
                    tag = MAU
                }
                hidden:p:8322 = {
                    has_building = basic_settlement_infratructure_building
                }
                hidden:p:8396 = {
                    has_building = basic_settlement_infratructure_building
                }
                hidden:p:8321 = {
                    has_building = basic_settlement_infratructure_building
                }
                hidden:p:8318 = {
                    has_building = basic_settlement_infratructure_building
                }
                hidden:p:3078 = {
                    has_building = basic_settlement_infratructure_building
                }
                hidden:p:3074 = {
                    has_building = basic_settlement_infratructure_building
                }
                hidden:p:3071 = {
                    has_building = basic_settlement_infratructure_building
                }
            }
        }

        on_completion = {
            add_centralization = 25
            add_country_modifier = {
                name = breadbasket_of_numidia
                duration = -1
            }
        }
    }

    numidian_mission_01_task_09 = { # Horse
        icon = "task_economical"

        allow = {
            trigger_if = {
                limit = {
                    tag = MSS # 3140 
                }
                custom_tooltip = {
                    text = numidian_horses_produced_task9_tooltip
                    numidian_horses_produced_task9_current >= numidian_horses_produced_task9_total
                }
            }
            trigger_if = {
                limit = {
                    tag = MAU # 3067 or 8317
                }
                custom_tooltip = {
                    text = numidian_horses_produced_task9a_tooltip
                    numidian_horses_produced_task9a_current >= numidian_horses_produced_task9_total
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_numidian.12 }
            add_country_modifier = {
                name = numidian_equestrians
                duration = -1
            }
        }
    }


    numidian_mission_01_task_10 = { # More Claims on other tribes
        icon = "task_expansion"
        requires = { numidian_mission_01_task_02 }

        highlight = {
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MSS
                    }
                }
                scope:province = {
                    OR = {
                        is_in_area = jedi_area
                        is_in_area = saharan_atlas_area
                    }
                }
            }
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MAU
                    }
                }
                scope:province = {
                    OR = {
                        is_in_area = upper_moulouya_area
                        is_in_area = tadla_area
                    }
                }
            }           
        }

        allow = {
            political_influence >= 50
            trigger_if = {
                limit = {
                    tag = MSS 
                }
                AND = {
                    owns_area = jedi_area
                    owns_area = saharan_atlas_area
                }
            }
            trigger_if = {
                limit = {
                    tag = MAU 
                }
                AND = {
                    owns_area = upper_moulouya_area
                    owns_area = tadla_area
                    # owns_area = rutubis_area # might not be feasible to annex land from carthage at this point
                }
            }
        }

        on_completion = {
            add_political_influence = -50
            trigger_event = { id = me_numidian.8 }
        }
    }

    numidian_mission_01_task_11 = { # Building up others land
        icon = "task_conquest"
        requires = { numidian_mission_01_task_05 }

        highlight = {
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MSS
                    }
                }
                scope:province = {
                    OR = {
                        province_id = 3067
                        province_id = 3071
                    }
                }
            }
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MAU
                    }
                }
                scope:province = {
                    OR = {
                        province_id = 3086
                        province_id = 3107
                    }
                }
            }           
        }

        allow = {
            trigger_if = {
                limit = {
                    tag = MSS 
                }
                owns = 3067
                hidden:p:3067 = {
                    has_city_status = yes
                    free_building_slots = 0
                    has_construction = no
                }
                owns = 3071
                hidden:p:3071 = {
                    has_building = basic_settlement_infratructure_building
                }
                c:MAU = {
                    OR = {
                        has_land = no
                        is_subject_of = c:MSS
                    }
                }
            }
            trigger_if = {
                limit = {
                    tag = MAU 
                }
                owns = 3086
                hidden:p:3086 = {
                    has_city_status = yes
                    free_building_slots = 0
                    has_construction = no
                }
                owns = 3107
                hidden:p:3107 = {
                    has_building = slave_mine_building
                }
                c:MSS = {
                    OR = {
                        has_land = no
                        is_subject_of = c:MAU
                    }
                }
            }
        }

        on_completion = {
            add_political_influence = 30
            show_as_tooltip = {
                add_country_modifier = {
                    name = numidian_goodwill
                    duration = -1
                }
            }
            trigger_event = { id = me_numidian.9 }
        }
    }

    numidian_mission_01_task_12 = { # Fortifying our land
        icon = "task_battle"
        requires = { numidian_mission_01_task_10 }

        highlight = {
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MSS
                    }
                }
                scope:province = {
                    OR = {
                        province_id = 3135
                        province_id = 3111
                    }
                }
            }
            trigger_if = {
                limit = {
                    ROOT = {
                        tag = MAU
                    }
                }
                scope:province = {
                    OR = {
                        province_id = 3075
                        province_id = 6486
                        province_id = 8323
                    }
                }
            }           
        }

        allow = {
            trigger_if = {
                limit = {
                    tag = MSS 
                }
                hidden:p:3135 = {
                    has_building = fortress_building
                }
                hidden:p:3111 = {
                    has_building = fortress_building
                }
            }
            trigger_if = {
                limit = {
                    tag = MAU 
                }
                hidden:p:3075 = {
                    has_building = fortress_building
                }
                hidden:p:6486 = {
                    has_building = fortress_building
                }
                hidden:p:8323 = {
                    has_building = fortress_building
                }
            }
        }

        on_completion = {
            add_centralization = 15
            add_country_modifier = {
                name = numidian_fortifications
                duration = -1
            }
        }
    }

    numidian_mission_01_task_13 = { # Fight with Carthage
        icon = "task_diplomatic"
        requires = { numidian_mission_01_task_05 }      

        allow = {
            trigger_if = {
                limit = {
                    tag = MSS 
                }
                c:MAU = {
                    OR = {
                        has_land = no
                        is_subject_of = c:MSS
                    }
                }
            }
            trigger_if = {
                limit = {
                    tag = MAU 
                }
                c:MSS = {
                    OR = {
                        has_land = no
                        is_subject_of = c:MAU
                    }
                }
            }
        }

        on_completion = {
            trigger_event = { id = me_numidian.13 }
            add_military_experience = 50
            custom_tooltip = numidian_mission_01_task_13_tt
            hidden_effect = {
                region:numidia_region = {
                    every_region_province = { add_claim = ROOT }
                }
            }
        }
    }

    numidian_mission_01_task_14 = { # Tributary to Client State
        icon = "task_diplomatic"
        potential = { 
            is_ai = no
            tag = MAU
            exists = c:SOC 
            exists = current_ruler #triggers error if not checked, because APPARENTLY the game sometimes do not find the current ruler, or check that in dead countries ?
        }
        requires = { numidian_mission_01_task_15 }

        bypass = {
            c:SOC = { has_land = no }
        }
        
        highlight = {
            scope:province = {
                has_owner = yes
                owner = c:SOC
            }
        }

        allow = {
            current_ruler = {
                is_friend = c:SOC.current_ruler
            }
            c:SOC = { # Socosia's opinion of MAU is greater than 190
                opinion = { target = c:MAU value >= 190 }
                c:SOC = { is_subject_of = c:MAU }
            }
            political_influence >= 150
        }

        on_completion = {

            add_political_influence = -150

            trigger_event = { id = me_numidian.10 }

            if = {
                limit = {
                    c:SOC = { is_subject_of = c:MAU }
                }
                c:MAU = { release_subject = c:SOC }
            }

            c:MAU = {
                make_subject = {
                    target = c:SOC
                    type = client_state
                }
            }

            add_country_modifier = {
                name = numidian_overlord
                duration = 3650
            }
        }
    }

    numidian_mission_01_task_15 = { # Allies
        icon = "task_diplomatic"
        potential = { 
            tag = MAU 
            is_ai = no
        }

        bypass = {
            c:ASA = { # Hastaia
                has_land = no
            }
            c:CRM = { # Karmoia
                has_land = no
            }
            c:COD = { # Kartubaia
                has_land = no
            }
        }
        
        highlight = {
            OR = {
                scope:province = {
                    has_owner = yes
                    owner = c:ASA
                }
                scope:province = {
                    has_owner = yes
                    owner = c:CRM
                }
                scope:province = {
                    has_owner = yes
                    owner = c:COD
                }
            }
        }

        allow = {
            c:ASA = { # Hastaia
                alliance_with = c:MAU
                #opinion = { target = c:MAU value >= 100 }
            }
            c:CRM = { # Karmoia
                alliance_with = c:MAU
                #opinion = { target = c:MAU value >= 100 }
            }
            c:COD = { # Kartubaia
                alliance_with = c:MAU
                #opinion = { target = c:MAU value >= 100 }
            }
        }

        on_completion = {
            trigger_event = { id = me_numidian.14 }
            add_country_modifier = {
                name = alliance_network
            }
        }
    }

    numidian_mission_01_task_16 = { # Controlling the Straits
        icon = "task_expansion"
        requires = { numidian_mission_01_task_13 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 3067
                    province_id = 1347
                }
            }          
        }

        allow = {
            owns = 3061
            hidden:p:3061 = {
                num_of_commerce_building >= 3
                num_of_port_building >= 2
                has_building = fortress_building
            }
            owns = 1347
            hidden:p:1347 = {
                has_building = fortress_building
            }
        }

        on_completion = {
            trigger_event = { id = me_numidian.15 }
            create_unit = {
                navy = yes
                location = 3061
                add_subunit = trireme
                add_subunit = trireme
                add_subunit = trireme
                add_subunit = trireme
                add_subunit = trireme
                add_subunit = trireme
                add_subunit = trireme
                add_subunit = trireme
                add_subunit = trireme
            }
            add_country_modifier = {
                name = pillars_of_hercules
                duration = -1
            }
        }
    }

    numidian_mission_01_task_17 = { # Own all of Numidia
        icon = "task_conquest"
        requires = { numidian_mission_01_task_13 }

        highlight = {
            scope:province = {
                is_in_region = numidia_region
            }
        }

        allow = {
            owns_or_subject_owns_region = numidia_region
        }

        on_completion = {
            trigger_event = { id = me_numidian.16 }
            custom_tooltip = numidian_mission_01_task_17_tt
            hidden_effect = {
                region:africa_region = {
                    every_region_province = { add_claim = ROOT }
                }
                region:fezzan_region = {
                    every_region_province = { add_claim = ROOT }
                }
            }
            add_innovation = 4
            random_owned_province = {
                while = {
                    count = 5
                    limit = {
                        total_population < population_cap
                    }
                    define_pop = {
                        type = freemen
                        culture = root.culture
                        religion = root.religion
                    }
                }
            }
        }
    }

    numidian_mission_01_task_18 = { # African Trade Ports
        icon = "task_happiness"
        requires = { numidian_mission_01_task_17 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 3256
                    province_id = 3245
                }
            }          
        }

        allow = {
            owns_or_subject_owns_region = africa_region
            owns = 3256
            hidden:p:3256 = {
                num_of_port_building >= 3
                num_of_commerce_building >= 2
                has_building = fortress_building
                has_building = court_building
                has_building = foundry_building
                has_building = workshop_building
            }
            owns = 3245
            hidden:p:3245 = {
                num_of_port_building >= 3
                num_of_commerce_building >= 2
                has_building = fortress_building
                has_building = population_building
                has_building = foundry_building
            }
        }

        on_completion = {
            add_country_modifier = {
                name = punic_trade
                duration = -1
            }
        }
    }

    numidian_mission_01_task_19 = { # Into Fezzan
        icon = "task_diplomatic"
        requires = { numidian_mission_01_task_17 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8168
                    province_id = 8233
                    is_in_region = fezzan_region
                }
            }          
        }

        allow = {
            owns_or_subject_owns_region = fezzan_region
            owns = 8168
            hidden:p:8168 = {
                has_building = forum_building
                has_building = foundry_building
                has_building = commerce_building
                has_building = workshop_building
                has_building = fortress_building
            }
            owns = 8233
            hidden:p:8233 = {
                num_of_workshop_building >= 2
                has_building = foundry_building
                has_building = fortress_building
            }
        }

        on_completion = {
            trigger_event = { id = me_numidian.17 }
            add_country_modifier = {
                name = fezzani_influence
                duration = 3650
            }
        }
    }

    numidian_mission_01_task_20 = { # The Punic Cities
        icon = "task_economical"
        requires = { numidian_mission_01_task_07 numidian_mission_01_task_08 numidian_mission_01_task_13 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 3116
                    province_id = 3225
                    province_id = 3227
                    province_id = 3121
                }
            }          
        }

        allow = {
            owns = 3116
            p:3116 = {
                num_of_port_building >= 2
                has_building = forum_building
                has_building = foundry_building
                has_building = commerce_building
                has_building = workshop_building
                has_building = fortress_building
            }
            owns = 3225
            p:3225 = {
                has_building = workshop_building
                has_building = forum_building
                has_building = foundry_building
                has_building = commerce_building
                has_building = port_building
            }
            owns = 3227
            p:3227 = {
                num_of_military_building >= 3
                has_building = forum_building

            }
            owns = 3121
            p:3121 = {
                has_building = temple_building
                has_building = theathre_building
                num_of_library_building >= 2
            }
        }

        on_completion = {
            add_country_modifier = {
                name = punic_influence
                duration = 3650
            }
        }
    }

    numidian_mission_01_task_21 = { # Into Atlas
        icon = "task_atlas"
        requires = { numidian_mission_01_task_12 }

        highlight = {
            scope:province = {
                is_in_region = mauretainia_region
            }          
        }

        allow = {
            owns_or_subject_owns_region = mauretainia_region
            political_influence >= 50
        }

        on_completion = {
            trigger_event = { id = me_numidian.18 }
            add_political_influence = -50
            custom_tooltip = numidian_mission_01_task_21_tt
            hidden_effect = {
                region:atlas_region = {
                    every_region_province = { add_claim = ROOT }
                }
            }
        }
    }

    numidian_mission_01_task_22 = { # Atlas Infrastructure
        icon = "task_economical"
        requires = { numidian_mission_01_task_21 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8329
                    province_id = 8367
                    province_id = 8370
                    province_id = 8358
                    province_id = 8365
                    province_id = 8366
                    province_id = 8362
                }
            }
        }

        allow = {
            owns_or_subject_owns_region = atlas_region
            owns = 8329
            hidden:p:8329 = {
                has_building = slave_mine_building
            }
            owns = 8367
            hidden:p:8367 = {
                has_building = slave_mine_building
            }
            owns = 8370
            hidden:p:8370 = {
                has_building = slave_mine_building
            }
            owns = 8358
            hidden:p:8358 = {
                has_building = basic_settlement_infratructure_building
            }
            owns = 8365
            hidden:p:8365 = {
                has_building = basic_settlement_infratructure_building
            }
            owns = 8366
            hidden:p:8366 = {
                has_building = basic_settlement_infratructure_building
            }
            owns = 8362
            hidden:p:8332 = {
                has_building = basic_settlement_infratructure_building
            }

        }

        on_completion = {
            p:8365 = {
                add_permanent_province_modifier = { name = atlas_resurgence }
            }
            p:8332 = {
                add_permanent_province_modifier = { name = atlas_resurgence }
            }
            p:8366 = {
                add_permanent_province_modifier = { name = atlas_resurgence }
            }
        }
    }


    numidian_mission_01_task_23 = { # The numidian empire
        icon = "task_battle"
        requires = { numidian_mission_01_task_18 numidian_mission_01_task_19 }
        final = yes

        highlight = {
            scope:province = {
                OR = {
                    is_in_region = mauretainia_region
                    is_in_region = numidia_region
                    is_in_region = fezzan_region
                    is_in_region = atlas_region
                    is_in_region = africa_region
                }
            }
        }


        allow = {
            owns_or_subject_owns_region = mauretainia_region
            owns_or_subject_owns_region = numidia_region
            owns_or_subject_owns_region = fezzan_region
            owns_or_subject_owns_region = atlas_region
            owns_or_subject_owns_region = africa_region
        }

        on_completion = {
            trigger_event = { id = me_numidian.19 }
            change_country_name = "NUMIDIAN_EMPIRE"
            if = {
                limit = {
                    NOT = { government = imperium }
                }
                change_government = imperium
            }
            add_country_modifier = {
                name = numidian_empire
                duration = -1
            }
        }
    }

    numidian_mission_01_task_24 = { # The numidian commanders
        icon = "task_conquest"
        requires = { numidian_mission_01_task_09 }

        allow = {
            #have a legion with a commander with 10 martial
            trigger_if = {
                limit = {
                    any_governorships = { has_legion_trigger = yes }
                }
                custom_tooltip = {
                    text = numidian_mission_01_task_24_tt
                    any_legion = {
                        any_legion_commander = {
                            martial > 10
                        }
                    }
                }
            }
            trigger_else = {
                limit = {
                    any_governorships = { has_legion_trigger = no }
                }
                custom_tooltip = {
                    text = numidian_mission_01_task_24_tt
                    num_of_ships >= 9999999
                }
            }
        }

        on_completion = {
            trigger_event = me_numidian.11
            show_as_tooltip = {
                add_country_modifier = {
                    name = numidian_commanders
                    duration = -1
                }
                ordered_character = {
                    limit = {
                        is_general = yes
                        is_ruler = no
                    }
                    order_by = martial
                    max = 4
                    add_martial = 1
                }
            }
        }
    }

    numidian_mission_01_task_25 = { # sardinian foothold
        icon = "task_battle"
        requires = { numidian_mission_01_task_17 numidian_mission_01_task_20 }

        allow = {
            num_of_ships >= 35
        }

        on_completion = {
            trigger_event = { id = me_numidian.20 }
            area:sardinia_meridionalis = {
                add_provincial_claim_effect = yes
            }
            area:sardinia_septentrionalis = {
                add_provincial_claim_effect = yes
            }
            area:corsica_area = {
                add_provincial_claim_effect = yes
            }
        }
    }

    numidian_mission_01_task_26 = { # cities of atlas
        icon = "task_conquest"
        requires = { numidian_mission_01_task_20 numidian_mission_01_task_21 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 8260
                    province_id = 8291
                    province_id = 8331
                }
            }
        }

        allow = {
            hidden:p:8260 = {
                has_city_status = yes
                has_building = forum_building
                has_building = foundry_building
                has_building = commerce_building
                has_building = workshop_building
            }
            hidden:p:8291 = {
                has_city_status = yes
                has_building = theathre_building
                has_building = foundry_building
                has_building = commerce_building
                has_building = temple_building
            }
            hidden:p:8331 = {
                has_city_status = yes
                has_building = population_building
                has_building = foundry_building
                has_building = aqueduct_building
                has_building = library_building
            }
        }

        on_completion = {
            random_owned_province = {
                limit = { 
                    is_in_region = atlas_region
                    has_city_status = yes
                }
                while = {
                    count = 8
                    limit = {
                        total_population < population_cap
                    }
                    define_pop = {
                        type = citizen
                        culture = root.culture
                        religion = root.religion
                    }
                }
            }
        }
    }
}