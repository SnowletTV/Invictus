paropamisadae_missions_1_independence = {
    header = "mission_image_seleukid"
    icon = "persia_3"

    repeatable = no
    chance = 1000

    potential = {
        NOT = { has_variable = mission_cooldown_var }
        tag = PRM
    }

    abort = {}
    on_start = {
        start_mission_ai_effect = yes
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {}
    paropamisadae_missions_1_independence_task_1 = { # Secure Succession
        icon = "task_happiness"
        requires = { paropamisadae_missions_1_independence_task_4 }
        allow = {
            diplomatic_stance = trading_stance
        }
        on_completion = {
            trigger_event = me_paropamisadae_independence.1
            show_as_tooltip = {
                add_country_modifier = {
                    name = open_for_trade
                    duration = -1
                }
            }
        }
    }
    paropamisadae_missions_1_independence_task_2 = { # Training the Next Generation
        icon = "task_religion"
        requires = { paropamisadae_missions_1_independence_task_3 }
        allow = {
            treasury >= 100
            custom_tooltip = {
                OR = {
                    any_character = {
                        has_tech_office_of = military_tech
                        martial >= 10
                    }
                    any_character = {
                        has_tech_office_of = civic_tech
                        finesse >= 10
                    }
                    any_character = {
                        has_tech_office_of = oratory_tech
                        charisma >= 10
                    }
                    any_character = {
                        has_tech_office_of = religious_tech
                        zeal >= 10
                    }
                }
                text = "any_character_has_good_stuff_ct"
            }
            custom_tooltip = {
                OR = {
                    any_character = {
                        OR = {
                            has_office = office_high_priest_monarchy
                            has_office = office_augur
                            has_office = office_high_priest
                        }
                        zeal >= 7
                    }
                    any_character = {
                        OR = {
                            has_office = office_steward
                            has_office = office_tribune_of_the_treasury
                            has_office = office_magistrate
                        }
                        finesse >= 7
                    }
                    any_character = {
                        OR = {
                            has_office = office_master_of_the_guard
                            has_office = office_tribune_of_the_soldiers
                            has_office = office_bodyguard
                        }
                        martial >= 7
                    }
                    any_character = {
                        OR = {
                            has_office = office_foreign_minister
                            has_office = office_praetor
                            has_office = office_arbitrator
                        }
                        charisma >= 7
                    }
                }
                text = "we_have_smart_offices_ct"
            }
        }
        on_completion = {
            trigger_event = me_paropamisadae_independence.2
            show_as_tooltip = {
                hidden_effect = {
                    every_character = {
                        limit = {
                            OR = {
                                from_ruler_family = yes
                                is_head_of_family = yes
                            }
                        }
                        every_child = {
                            limit = { age < 13 }
                            add_zeal = 2
                            add_martial = 2
                            add_charisma = 2
                            add_finesse = 2
                        }
                    }
                }
                custom_tooltip = "we_get_kids_smart_tt"
            }
        }
    }
    paropamisadae_missions_1_independence_task_3 = { # Fit for a King
        icon = "task_political"
        highlight = {
            scope:province = {
                OR = {
                    province_id = 6558
                    province_id = 6611
                    province_id = 6614
                    province_id = 6642
                    province_id = 6625
                }
            }
        }
        allow = {
            p:6558 = {
                state_loyalty >= 90
            }
            p:6558.state = {
               OR = {
                    state_improvement_military_trigger = yes 
                    state_improvement_civic_trigger = yes
                    state_improvement_oratory_trigger = yes
                    state_improvement_religious_trigger = yes 
                } 
            }
            p:6642.state = {
                calc_true_if = {
                    amount >= 2
                    state_improvement_military_trigger = yes 
                    state_improvement_civic_trigger = yes
                    state_improvement_oratory_trigger = yes
                    state_improvement_religious_trigger = yes 
                }
            }
        }
        requires = { paropamisadae_missions_1_independence_task_3 }
        on_completion = {
            trigger_event = me_paropamisadae_independence.3
            show_as_tooltip = {
                custom_tooltip = "fit_for_a_king_ct"
                add_2_free_province_investments = yes
            }
        }
    }
    paropamisadae_missions_1_independence_task_4 = { # A Strong Dynasty
        icon = "task_diplomatic"
        allow = {
            OR = {
                custom_tooltip = {
                    any_character = {
                        is_primary_heir = yes
                        has_trait = oxyartid
                        hidden:is_alive = yes
                    }
                    text = any_heir_oxyartid
                }
                current_ruler = char:291
            }
        }
        requires = { paropamisadae_missions_1_independence_task_3 }
        bypass = {
            current_ruler = {
                NOT = { has_trait = oxyartid }
            }
        }
        on_completion = {
            trigger_event = me_paropamisadae_independence.4
            show_as_tooltip = {
                add_stability = 5
                add_country_modifier = {
                    name = oxyartid_dynasty
                    duration = 3650
                }
            }
        }
    }
    paropamisadae_missions_1_independence_task_5 = { # Distant Diadochi
        icon = "task_conquest"
        allow = {
            political_influence >= 50
        }
        requires = { paropamisadae_missions_1_independence_task_4 }
        highlight = {
            scope:province = {
                AND = {
                    is_in_area = aria_area
                    owner = ROOT
                }
            }
        }
        on_completion = {
            trigger_event = me_paropamisadae_independence.5
            show_as_tooltip = {
                if = {
                    limit = {
                        is_subject_of = c:SEL
                    }
                    add_political_influence = -50
                    c:SEL = {
                        release_subject = ROOT
                        add_opinion = {
                            target = ROOT
                            modifier = unruly_satrapy
                        }
                    }
                    area:aria_area = {
                        every_area_province = {
                            limit = {
                                owner = ROOT
                            }
                            add_claim = c:SEL
                        }
                    }
                }
            }
        }
    }
    paropamisadae_missions_1_independence_task_6 = { # Eastern Trade
        icon = "task_atlas"
        requires = { paropamisadae_missions_1_independence_task_1 }
        highlight = {
            scope:province = {
                trade_goods = silk
            }
        }
        allow = {
            hidden:capital_scope.state = {
                trade_good_surplus = {
                    target = silk
                    value >= 3
                }
            }
        }
        on_completion = {
            trigger_event = me_paropamisadae_independence.6
            show_as_tooltip = {
                add_country_modifier = {
                    name = imports_from_east
                    duration = -1
                }
            }
        }
    }
    paropamisadae_missions_1_independence_task_7 = { # Southern Trade
        icon = "task_durga"
        requires = { paropamisadae_missions_1_independence_task_1 }
        highlight = {
            scope:province = {
                OR = {
                    trade_goods = papyrus
                    trade_goods = sugar
                    trade_goods = spices
                    trade_goods = elephants
                    trade_goods = dye
                }
            }
        }
        allow = {
            capital_scope = {
                calc_true_if = {
                    amount >= 2
                    is_importing_trade_good = papyrus
                    is_importing_trade_good = sugar
                    is_importing_trade_good = spices
                    is_importing_trade_good = elephants
                    is_importing_trade_good = dye
                }
            }
        }
        on_completion = {
            trigger_event = me_paropamisadae_independence.7
            show_as_tooltip = {
                custom_tooltip = indification_tt
                hidden = {
                    area:sattagydia_area = {
                        every_area_province = {
                            random_list = {
                                3 = { spread_religion_in_province = { RELIGION = buddhism }}
                                1 = { spread_religion_in_province = { RELIGION = jainism }}
                                1 = { spread_religion_in_province = { RELIGION = ajivika }}
                                1 = { spread_religion_in_province = { RELIGION = hindu }}
                            }
                        }
                    }
                    p:6611 = {
                        create_state_pop = freemen
                        create_state_pop = freemen
                        create_state_pop = freemen
                        create_state_pop = freemen
                        create_state_pop = freemen
                        create_state_pop = freemen
                    }
                }
                custom_tooltip = 7_gandharans_in_capital_tt
                hidden_effect = {
                    p:6611 = {
                        while = {
                            count = 7
                            limit = {
                                any_pops_in_province = {
                                    pop_culture = bactrian
                                    pop_type = freemen
                                }
                            }
                            random_pops_in_province = {
                                limit = {
                                    pop_culture = bactrian
                                    pop_type = freemen
                                }
                                set_pop_culture = gandhari
                                set_pop_religion = buddhism
                            }
                        }
                    }
                }
            }
        }
    }
    paropamisadae_missions_1_independence_task_8 = { # Western Trade
        icon = "task_apollo"
        requires = { paropamisadae_missions_1_independence_task_1 }
        highlight = {
            scope:province = {
                OR = {
                    is_in_region = persis_region
                    is_in_region = ariana_region
                    is_in_region = parthia_region
                    is_in_region = mesopotamia_region
                }
                is_state_capital = yes
            }
        }
        allow = {
            OR = {
                trigger_if = {
                    limit = { any_country = { tag = SEL }}
                    exports_to = SEL
                }
                trigger_if = {
                    limit = { any_country = { tag = ARS }}
                    exports_to = ARS
                }
                trigger_if = {
                    limit = { any_country = { tag = CAM }}
                    exports_to = CAM
                }
                trigger_if = {
                    limit = { any_country = { tag = PES }}
                    exports_to = PES
                }
                trigger_if = {
                    limit = { any_country = { tag = PAR }}
                    exports_to = PAR
                }
                trigger_if = {
                    limit = { any_country = { tag = PTH }}
                    exports_to = PTH
                }
            }
        }
        on_completion = {
            trigger_event = me_paropamisadae_independence.8
            show_as_tooltip = {
                add_country_modifier = {
                    name = exports_to_west
                    duration = -1
                }
            }
        }
    }
    paropamisadae_missions_1_independence_task_9 = { # The Next Step
        icon = "task_expansion"
        requires = { paropamisadae_missions_1_independence_task_5 }
        allow = {}
        on_completion = {
            trigger_event = me_paropamisadae_independence.9
            show_as_tooltip = {
                custom_tooltip = "choices_for_paropam_ct"
            }
            set_variable = prm_macedon_missions_unlocked
        }
        final = yes
    }
    paropamisadae_missions_1_independence_task_10 = { # Mountains of Metal
        icon = "task_economical"
        requires = { paropamisadae_missions_1_independence_task_2 }
        highlight = {
            scope:province = {
                OR = {
                    province_id = 6631
                    province_id = 6628
                    province_id = 6621
                    province_id = 6625
                }
            }
        }
        allow = {
            calc_true_if = {
                amount >= 4
                p:6631 = { num_goods_produced >= 2 }
                p:6628 = { num_goods_produced >= 2 }
                p:6621 = { num_goods_produced >= 2 }
                p:6625 = { num_goods_produced >= 2 }
            }
        }
        on_completion = {
            trigger_event = me_paropamisadae_independence.10
            show_as_tooltip = {
                every_neighbour_country = {
                    add_country_modifier = {
                        name = too_much_gold
                        duration = 1095
                    }
                    trigger_event = me_paropamisadae_independence.101
                }
                add_country_modifier = {
                    name = too_much_gold
                    duration = 1095
                }
                custom_tooltip = we_get_goods_in_3_years_tt
                add_country_modifier = {
                    name = mountain_of_gold
                    duration = -1
                }
            }
        }
    }
    paropamisadae_missions_1_independence_task_11 = { # A Royal Army
        icon = "task_battle"
        requires = { paropamisadae_missions_1_independence_task_10 paropamisadae_missions_1_independence_task_13 }
        allow = {
            military_experience >= 50
        }
        on_completion = {
            trigger_event = me_paropamisadae_independence.11
            show_as_tooltip = {
                add_military_experience = -50
                change_law = work_for_the_best
            }
        }
    }
    paropamisadae_missions_1_independence_task_12 = { # Land of Lapis
        icon = "task_economical"
        requires = { paropamisadae_missions_1_independence_task_2 }
        highlight = {
            scope:province = {
                province_id = 6611
            }
        }
        allow = {
            p:6611 = {
                num_goods_produced >= 2
            }
        }
        on_completion = {
            trigger_event = me_paropamisadae_independence.12
            show_as_tooltip = {
                p:6611 = {
                    add_province_modifier = {
                        name = lapis_trade_mod
                        duration = -1
                    }
                }
                add_country_modifier = {
                    name = lapis_trade_national_mod
                    duration = -1
                }
            }
        }
    }
    paropamisadae_missions_1_independence_task_13 = { # Ensure Grain Supply
        icon = "task_political"
        requires = { paropamisadae_missions_1_independence_task_2 }
        allow = {
            trigger_if = {
                limit = {
                    any_owned_province = {
                        has_food_trade_good_trigger = yes
                    }
                }
                custom_tooltip = {
                    any_owned_province = {
                        limit = {
                            has_food_trade_good_trigger = yes
                        }
                        has_building = basic_settlement_infratructure_building
                    }
                    text = has_food_ct
                }
            }
            custom_tooltip = {
                any_owned_province = {
                    has_building = population_building
                }
                text = have_granary_ct
            }
            calc_true_if = {
                amount >= 2
                hidden:p:6558.state = {
                    trade_good_surplus = {
                        target = grain
                        value >= 2
                    }
                }
                hidden:p:6611.state = {
                    trade_good_surplus = {
                        target = grain
                        value >= 2
                    }
                }
                hidden:p:6639.state = {
                    trade_good_surplus = {
                        target = grain
                        value >= 1
                    }
                }
            }
        }
        on_completion = {
            trigger_event = me_paropamisadae_independence.13
            show_as_tooltip = {
                add_country_modifier = {
                    name = well_supplied_armies
                    duration = -1
                }
            }
        }
    }
    paropamisadae_missions_1_independence_task_14 = { # Center of the Silk Road
        icon = "task_zeus_cornucopia"
        requires = { paropamisadae_missions_1_independence_task_6 paropamisadae_missions_1_independence_task_7 paropamisadae_missions_1_independence_task_8 }
        allow = {}
        on_completion = {
            trigger_event = me_paropamisadae_independence.13
            show_as_tooltip = {
                add_country_modifier = {
                    name = silk_road_center
                    duration = -1
                }
            }
        }
    }
}