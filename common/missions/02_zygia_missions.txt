zygia_missions = {
    header = "alis_ubbo_mission_image"
	icon = "alis_ubbo_mission_icon"

    repeatable = no
    chance = 1000

    potential = {
        tag = ZGY
        NOT = { has_variable = mission_cooldown_var }
    }

    abort = {
        ai_mission_back_out_trigger = yes
    }

    on_start = {
        start_mission_ai_effect = yes
        add_country_modifier = {  
	        name = zygian_ambitions
	        duration = 3650 # 10 years
	    }
    }

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }

    on_completion = {
        complete_mission_effect = yes
        add_4_free_province_investments = yes 
        add_innovation = 2
        current_ruler = {
       		add_charisma = 1
       	}
    }

    zygia_missions_task_1 = { # Pontic Piracy
        icon = "task_battle"
        
        bypass = {
            
        }

        allow = {
            trigger_if = {
                limit = {
                    is_tribal = yes
                }
                has_country_modifier = assemble_raiding_party_button_modifier
            }
            diplomatic_stance = trading_stance
            capital_scope = {
                governor_policy = local_autonomy
            }
            treasury >= 50
            manpower >= 5
        }

        highlight = {
	
		}

        on_completion = {
            trigger_event = me_zygia.1 # Solving issue with indivdual port / chance to get a pirate fleet?
            add_treasury = -50
            add_manpower = -5
            add_political_influence = 50
            add_aggressive_expansion = 10
            add_military_experience = 10
            current_ruler = {
                add_corruption = 10
            }
            add_country_modifier = {
                name = zygian_piracy
                duration = -1
            }
            p:4567 = {
                add_building_level = port_building
                add_permanent_province_modifier = {
                    name = zygian_pirate_haven_modifier
                    duration = -1
                }
            }
            p:4563 = {
                add_province_modifier = {
                    name = zygian_pirates
                    duration = -1
                }
            }
            p:4557 = {
                add_province_modifier = {
                    name = zygian_pirates
                    duration = -1
                }
            }
            p:4544 = {
                add_province_modifier = {
                    name = zygian_pirates
                    duration = -1
                }
            }
            p:1738 = {
                add_province_modifier = {
                    name = zygian_pirates
                    duration = -1
                }
            }
            p:1720 = {
                add_province_modifier = {
                    name = zygian_pirates
                    duration = -1
                }
            }
        }
    }

    zygia_missions_task_2 = { # Relations with the Heniochi
        icon = "task_diplomatic"
        duration = 365
        
        bypass = {
            c:HNY = {
                has_land = no
            }
        }

        allow = {
            political_influence >= 25
            c:HNY = {
                opinion = {
                    target = root
                    value >= 40
                }
                current_ruler = {
                    is_friend = root.current_ruler
                }
            }
        }

        highlight = {
			scope:province = {
                OR = {
                    AND = {
                        exists = c:HNY
                        exists = owner
                        owner = c:HNY
                    }
                }
            }
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            add_political_influence = -25
            custom_tooltip = zygia_missions_task_2_tt
        }
    }

    zygia_missions_task_3 = { # Zygian Outposts
        requires = {zygia_missions_task_1}
        icon = "task_expansion"
        
        bypass = {
            
        }

        allow = {
            political_influence >= 50
            manpower >= 7
            treasury >= 150
            job_holder:office_magistrate = {
                loyalty >= 65
                finesse >= 10
            }
        }

        highlight = {
			scope:province = {
                OR = {
                    province_id = 1738
                    province_id = 4533
                    province_id = 1726
                    province_id = 1730
                }
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            add_treasury = 150
            add_manpower = -7
            add_political_influence = -50
            p:1738 = {
                set_owned_by = root
                while = {
                    count = 3
                    define_pop = {
                        type = freemen
                        culture = root.culture
                        religion = root.religion
                    }
                }
            }
            p:4533 = {
                set_owned_by = root
                while = {
                    count = 3
                    define_pop = {
                        type = freemen
                        culture = root.culture
                        religion = root.religion
                    }
                }
            }
            p:1726 = {
                set_owned_by = root
                while = {
                    count = 3
                    define_pop = {
                        type = freemen
                        culture = root.culture
                        religion = root.religion
                    }
                }
            }
            p:1730 = {
                set_owned_by = root
                while = {
                    count = 3
                    define_pop = {
                        type = freemen
                        culture = root.culture
                        religion = root.religion
                    }
                }
            }
        }
    }

    zygia_missions_task_4 = { # Nikopsian Trade
        icon = "task_economical"
        requires = {zygia_missions_task_1}
        
        bypass = {
            
        }

        allow = {
            has_law = coin_minting_law
            hidden:p:4567 = {
                has_city_status = yes
                is_holy_site = yes
                has_building = commerce_building 
                has_building = town_hall_building
                province_income > 0.1
                has_no_ongoing_construction = yes
            }
            p:4567.state = {
                trade_routes >= 5
            }
        }

        highlight = {
			scope:province = {
				province_id = 4567
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            p:4567 = {
                while = {
                    count = 3
                    define_pop = {
                        type = freemen
                        culture = root.culture
                        religion = root.religion
                    }
                }
                add_permanent_province_modifier = {
                    name = nikposis_merchants
                }
                add_building_level = port_building
                add_building_level = foundry_building
                change_province_name = "Nikopsis"
            }
            add_2_free_province_investments = yes
            add_innovation = 2
            add_research = {
                technology = civic_tech
                value = 15
            }
        }
    }

    zygia_missions_task_5 = { # The Region of Zyx
        icon = "task_political"
        requires = {zygia_missions_task_2}
        
        bypass = {
            
        }

        allow = {
            custom_tooltip = {
                text = zygia_missions_task_5_tt
                owns_or_subject_owns = 4567
                owns_or_subject_owns = 4568
                owns_or_subject_owns = 1745
                owns_or_subject_owns = 1743
                owns_or_subject_owns = 1742
                owns_or_subject_owns = 7600
                owns_or_subject_owns = 7616
                owns_or_subject_owns = 7608
                owns_or_subject_owns = 7614
                owns_or_subject_owns = 7615
                owns_or_subject_owns = 7610
                owns_or_subject_owns = 7609
                owns_or_subject_owns = 7620
                owns_or_subject_owns = 7611
                owns_or_subject_owns = 7619
                owns_or_subject_owns = 7606
                owns_or_subject_owns = 7607 
            } 
        }

        highlight = {
			scope:province = {
                OR = {
                    province_id = 4567
                    province_id = 4568
                    province_id = 1745
                    province_id = 1743
                    province_id = 1742
                    province_id = 7600
                    province_id = 7616
                    province_id = 7608
                    province_id = 7614
                    province_id = 7615
                    province_id = 7610
                    province_id = 7609
                    province_id = 7620
                    province_id = 7611
                    province_id = 7619
                    province_id = 7606
                    province_id = 7607
                }
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            add_centralization = 30
            current_ruler = {
                add_nickname = OF_ZYX
            }
            change_country_name = LAND_OF_ZYX
            add_political_influence = 30
            add_2_free_province_investments = yes
        }
    }

    zygia_missions_task_6 = { # Khabzism
        icon = "task_religion"
        requires = {zygia_missions_task_2}
        
        bypass = {
            
        }

        allow = {
            
        }

        highlight = {
			scope:province = {
				is_in_area = sinkat_area # CHANGE !!!!!!!!!!!
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            
        }
    }

    zygia_missions_task_7 = { # Raiding the Hypanis
        icon = "task_battle"
        requires = {zygia_missions_task_3}
        prevented_by = { zygia_missions_task_9 }
        
        bypass = {
            
        }

        allow = {
            custom_tooltip = {
                text = zygia_missions_task_7_tt
                any_navy = {
                    any_sub_unit = {
                        count >= 15
                        sub_unit_type = liburnian
                    }
                    has_commander = yes
                }
            }
        }

        highlight = {
			scope:province = {
				province_id = 4563
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            p:4563 = {
                set_owned_by = root
                add_city_smoke_effect = yes
                while = {
                    count = 4
                    random_pops_in_province = {
                        limit = {
                            NOT = { pop_type = nobles }
                            NOT = { pop_type = citizen }
                        }
                        kill_pop = yes
                    }
                } 
            }
        }
    }

    zygia_missions_task_8 = { # Hard Mountain Horses
        icon = "task_artemis"
        requires = {zygia_missions_task_4}
        
        bypass = {
            
        }

        allow = {
            
        }

        highlight = {
			scope:province = {
				province_id = 7616
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            
        }
    }

    zygia_missions_task_9 = { # The Western Maeotis
        icon = "task_zeus_cornucopia"
        requires = {zygia_missions_task_4 zygia_missions_task_5}
        
        bypass = {
            
        }

        allow = {
            owns_or_subject_owns_area = maeotia_minores_area
            owns_or_subject_owns_area = bosproranum_area
        }

        highlight = {
			scope:province = {
                OR = {
                    is_in_area = maeotia_minores_area
                    is_in_area = bosproranum_area
                } 
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            
        }
    }

    zygia_missions_task_10 = { # Zygian Federation
        icon = "task_political"
        requires = {zygia_missions_task_5}
        
        bypass = {
            
        }

        allow = {
            
        }

        highlight = {

		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            change_government = tribal_federation
        }
    }

    zygia_missions_task_11 = { # Worshiping Narts
        icon = "task_athena"
        requires = {zygia_missions_task_6}
        
        bypass = {
            
        }

        allow = {
            
        }

        highlight = {
			scope:province = {
				is_in_area = sinkat_area # CHANGE !!!!!!!!!!!
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            
        }
    }

    zygia_missions_task_12 = { # The Lady of Flowering Waters
        icon = "task_calm"
        requires = {zygia_missions_task_9 zygia_missions_task_11}
        
        bypass = {
            
        }

        allow = {
            
        }

        highlight = {
			scope:province = {
				is_in_area = sinkat_area # CHANGE !!!!!!!!!!!
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            
        }
    }

    zygia_missions_task_13 = { # Zichia
        icon = "task_heracles"
        requires = {zygia_missions_task_10}
        prevented_by = { zygia_missions_task_14 }
        final = yes
        
        bypass = {
            
        }

        allow = {
            owns_or_subject_owns_area = maeotia_minores_area
            owns_or_subject_owns_area = bosproranum_area
            owns_or_subject_owns_area = abasgoi_area
            owns_or_subject_owns_area = alania_area
            owns_or_subject_owns_area = tanaissa_area
            owns_or_subject_owns_area = sattara_area
        }

        highlight = {
			scope:province = {
                OR = {
                    is_in_area = maeotia_minores_area
                    is_in_area = bosproranum_area
                    is_in_area = abasgoi_area
                    is_in_area = alania_area
                    is_in_area = tanaissa_area
                    is_in_area = sattara_area
                } 
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            change_government = aristocratic_monarchy
            change_country_name = ZICHIA
            change_country_color = francia_blue_color
            area:taurica_area = {
                add_provincial_claim_effect = yes
            }
            area:maeotia_area = {
                add_provincial_claim_effect = yes
            }
            area:colchis_area = {
                add_provincial_claim_effect = yes
            }
            area:suaneti_area = {
                add_provincial_claim_effect = yes
            }
            area:alania_proper_area = {
                add_provincial_claim_effect = yes
            }
        }
    }

    zygia_missions_task_14 = { # Kingdom of the Narts
        icon = "task_atlas"
        requires = {zygia_missions_task_11}
        prevented_by = { zygia_missions_task_13 }
        final = yes
        
        bypass = {
            
        }

        allow = {
            
        }

        highlight = {
			scope:province = {
				is_in_area = sinkat_area # CHANGE !!!!!!!!!!!
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            
        }
    }

    zygia_missions_task_15 = { # The Golden Tree
        icon = "task_apollo"
        requires = {zygia_missions_task_10}
        
        bypass = {
            
        }

        allow = {
            
        }

        highlight = {
			scope:province = {
				is_in_area = sinkat_area # CHANGE !!!!!!!!!!!
			}
		}

        on_completion = {
            trigger_event = me_zygia.1 # _________
            
        }
    }
}