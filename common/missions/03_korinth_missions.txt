korinth_missions = {
    header = "mission_image_athens"
    icon = "cde_greek_market_declaration"

    repeatable = no
    chance = 1000

    potential = {
		tag = KOR
        NOT = { has_variable = kor_mission_cooldown_var }
    }

    abort = {}
    on_start = {
        start_mission_ai_effect = yes
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = kor_mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {
        add_4_free_province_investments = yes
    }
    korinth_missions_task_1 = { # Eyes on Korkyra
        icon = "task_battle"
        
        highlight = {
            scope:province = {
                OR = {
                    province_id = 470
                }
            }
        }

        duration = 30

        allow = {
            political_influence >= 20
        }
        on_completion = {
            trigger_event = me_korinth.1
            show_as_tooltip = {
            add_political_influence = -20
            p:470 = {
                add_claim = root
                }
            }
        }
    }
    korinth_missions_task_2 = { # Phaecian Conquest
		requires = { korinth_missions_task_1 }
        icon = "task_diplomatic"

        highlight = {
            scope:province = {
                OR = {
                    province_id = 470
                }
            }
        }

        allow = {
            owns = 470
        }
        on_completion = {
            trigger_event = me_korinth.2
        }
    }
    korinth_missions_task_3 = { # Machinations of War
        icon = "task_athena"
        allow = {
            current_ruler = {
                has_trait = silver_tongued
            }
            treasury >= 80
        }
        on_completion = {
            trigger_event = me_korinth.3
            show_as_tooltip = {
            add_country_modifier = {
                name = korinth_mercenaries
                duration = 3650
                }
            }
        }
    }
    korinth_missions_task_4 = { #Holy Prostitutes of Aphrodite
        requires = { korinth_missions_task_12 }
        icon = "task_happiness"

        duration = 60 
        
        highlight = {
            scope:province = {
                OR = {
                    province_id = 418
                }
            }
        }

        allow = {
            invention = global_unrest_inv_2
            hidden:p:418.state = {
                has_state_modifier = state_improvement_religious
            }
        }
        on_completion = {
            trigger_event = me_korinth.4
            show_as_tooltip = {
                create_country_treasure = {
                    key = aphrodite_hoplimense_icon
                    icon = aphrodite_hoplimense_icon
                    modifier = {
                        local_manpower_modifier = 0.05
                        local_population_growth = 0.05
                    }
                }
                p:418 = {
                    add_province_modifier = {
                        name = blessing_of_aphrodite
                        duration = 1460
                    }
                }
            }
        }
    }
    korinth_missions_task_5 = { #Our Loyal Friends and Allies
        requires = { korinth_missions_task_3 }
        icon = "task_artemis"
        
        allow = {
            custom_tooltip = {
                OR = {
                    any_country = {
                        tag = AIG
                        alliance_with = ROOT
                    }
                }
                text = "korinth_ally_tt"
            }
        }
        on_completion = {
            trigger_event = me_korinth.5
            custom_tooltip = korinth_local_allies
            show_as_tooltip = {
                every_country = {
                    limit = {
                        NOT = {
                            tag = ELI
                        }
                        OR = {
                            capital_scope = { is_in_area = achaea_area }
                        }
                        alliance_with = ROOT
                        this.culture.culture_group = culture_group:hellenic
                    }
                    add_opinion = {
                        modifier = korinth_friends
                        target = THIS
                    }
                    reverse_add_opinion = {
                        target = ROOT
                        modifier = korinth_friends
                    }
                }
            }
        }
    }
    korinth_missions_task_6 = { #Crushing Athens
        requires = { korinth_missions_task_2 korinth_missions_task_5}
        icon = "task_dying_gaul"

        allow = {
            c:ATH = {
                num_of_provinces = 0
            }
            owns = 416
        }

        on_completion = {
            trigger_event = me_korinth.6
            custom_tooltip = korinth_athens_subjugated
        }
    }
    korinth_missions_task_7 = { #Potidean Aid
        requires = { korinth_missions_task_6 }
        icon = "task_diplomatic"
        duration = 180
        allow = {
            current_date > 458.1.1
        }
        on_start = {
            trigger_event = me_korinth.7
        }
        on_completion = {
            trigger_event = me_korinth.31
            show_as_tooltip = {
            custom_tooltip = korinth_potidea_task_tt
            }
        }
    }
    korinth_missions_task_8 = { #Theban Threat
        requires = { korinth_missions_task_6 }
        icon = "task_conquest"
        highlight = {
            scope:province = { is_in_area = boeotia_area }
        }
        allow = {
            custom_tooltip = {
				text = boeotia_conquer_tt
				any_owned_province = {
					count >= 6 #75% - count this
					OR = {
        				is_in_area = boeotia_area
					}
					owned_or_subject_owned = root
				}
			}
        }
        on_completion = {
            trigger_event = me_korinth.8
            custom_tooltip = korinth_conquered_boeotia_tt
        }
    }
    korinth_missions_task_9 = { #Negiotiating with Sparta
        requires = { korinth_missions_task_6 }
        icon = "task_diplomatic"
        allow = {
            alliance_with = c:SPA
            hidden:c:SPA = {
                opinion = {
                    target = c:KOR
                    value >= 150
                }
            }
        }
        on_completion = {
            trigger_event = me_korinth.9
            show_as_tooltip = {
            add_country_modifier = {
                name = spartan_ally
                duration = 3650
            }
            }
        }
    }
    #korinth_missions_task_10 = { # Controlling The Boot
    #    requires = { korinth_missions_task_2 }
    #    icon = "task_expansion"
    #
#
 #       highlight = {
  #          scope:province = {
   #             OR = {
    #                province_id = 63
     #               province_id = 64
      #              province_id = 65
       #         }
        #    }
        #}
#
        #allow = {
 #           owns_or_subject_owns = 63
  #          owns_or_subject_owns = 64
   #         owns_or_subject_owns = 65
    #    }
    #    on_completion = {
    #        trigger_event = me_korinth.10
    #        custom_tooltip = korinth_italiote_vassals
     #   }
    #}
    #korinth_missions_task_11 = { #Siceliote Restoration
    #    requires = { korinth_missions_task_10 }
    #    icon = "task_diplomatic"
    #    highlight = {
    #        scope:province = {
   #             OR = {
    #                province_id = 82
    #                province_id = 80
    #            }
    #        }
    #    }
#
    #    allow = {
    #        owns_or_subject_owns = 82
    #        owns_or_subject_owns = 80
    #    }
    #    on_completion = {
    #        trigger_event = me_korinth.11
    #        custom_tooltip = korinth_italiote_vassals
    #    }
   # }
    korinth_missions_task_12 = { #Expanding the Akrokorinthos
        icon = "task_economical"

        highlight = {
            scope:province = {
                OR = {
                    province_id = 418
                }
            }
        }

        duration = 365
        
        allow = {
            treasury >= 100
            hidden:p:418.state = {
                has_state_modifier = state_improvement_military
            }  
        }
        on_completion = {
            trigger_event = me_korinth.12
            show_as_tooltip = {
            add_treasury = -100
            }
        }
    }
    korinth_missions_task_13 = { #Improving the Diolkos
        requires = { korinth_missions_task_12 }
        icon = "task_political"

        highlight = {
            scope:province = {
                OR = {
                    province_id = 418
                }
            }
        }

        duration = 180

        allow = {
            political_influence >= 50
            hidden:p:418 = {
                has_building = commerce_building
            }
        }
        on_completion = {
            trigger_event = me_korinth.13
            add_political_influence = -50
            show_as_tooltip = {
                p:418 = {
                    add_province_modifier = {
                        name = improved_diolkos
                        duration = -1
                    }
                }
            }
        }
    }
    korinth_missions_task_14 = { #Achaean Investments
        requires = { korinth_missions_task_12 }
        icon = "task_political"
        highlight = {
            scope:province = { is_in_area = achaea_area }
        }
        allow = {
        custom_tooltip = {
			text = "korinth_achaea_investment_tt"
			area:achaea_area = {
				any_area_province = {
					count >= 5
                   	has_owner = yes
					free_building_slots < 1
					owner = root
				}
			}
        }
        }
        on_completion = {
            trigger_event = me_korinth.14
            show_as_tooltip = {
                add_2_free_province_investments = yes
                random_owned_province = {
				    limit = { 
					    is_in_area = achaea_area 
					    free_building_slots < 1
				    }
				    add_province_modifier = {
					    name = developed_achaea
					    duration = -1
                    }
				}
            }
        }   
    }
    korinth_missions_task_15 = { #Consulting the Oracle at Dodona
        requires = { korinth_missions_task_2 }
        icon = "task_religion"
        duration = 30
        highlight = {
            scope:province = {
                OR = {
                    province_id = 425
                }
            }
        }

        allow = {
            political_influence >= 50 
        }
        on_completion = {
            trigger_event = me_korinth.15
            add_political_influence = -50
        }
    }
    korinth_missions_task_16 = { #Korinthian Legion
        requires = { korinth_missions_task_3 }
        icon = "task_heracles"
        allow = {
            #Have a legion
            trigger_if = {
                limit = {
                    capital_scope.governorship = { has_legion_trigger = yes }
                    any_unit = { legion = ROOT.capital_scope.governorship.legion }
                }
                custom_tooltip = {
                    text = bithynia_missions_task_17_tooltip
                    any_legion = {
                        any_legion_unit = {
                            unit_size >= 10
                        }
                    }
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = bithynia_missions_task_17_tooltip
                    num_of_ships >= 1000000 #Random impossible trigger so no error log pain
                }
            }
        }
        on_completion = {
            trigger_event = me_korinth.16
            show_as_tooltip = {
            add_military_experience = 20
                add_country_modifier = {
                    name = korinthian_legion
                    duration = -1
                }
            }
        }
    }
    #korinth_missions_task_17 = {
    ##    requires = { korinth_missions_task_16 }
   #     icon = "task_expansion"
    #    allow = {
#
    #    }
    #    on_completion = {
    #        trigger_event = me_korinth.17
   #         show_as_tooltip = {
    #        
    #        }
    #    }
   # }
    korinth_missions_task_18 = { # The Gilded City
        requires = { korinth_missions_task_13 korinth_missions_task_14 korinth_missions_task_4 }
        icon = "task_zeus_cornucopia"
        allow = {
			has_monthly_income >= 25
            p:418 = {
                civilization_value >= 60
            }
		}
        on_completion = {
            trigger_event = me_korinth.18
            show_as_tooltip = {
                current_ruler = {
                    add_finesse = 2
                    add_trait = midas_touched
                }
                p:418={
                add_province_modifier = {
                    name = gilded_korinth
                    duration = -1
                }
            }
            }
        }
    }
    #korinth_missions_task_19 = {
    #    requires = { korinth_missions_task_10 }
    #    icon = "task_expansion"
    #    allow = {}
    #    on_completion = {
    #        trigger_event = me_korinth.19
    #        show_as_tooltip = {
    #
#
    #        }
    #    }
    #}
    korinth_missions_task_20 = { #Hegemon of Greece
        requires = { korinth_missions_task_7 korinth_missions_task_8 korinth_missions_task_9 }
        icon = "task_political"
    
        allow = {
            has_variable = korinthian_hegemony_var
            custom_tooltip = korinth_hegemony_enacted    
        }
        on_completion = {
            trigger_event = me_korinth.20
            show_as_tooltip = {
            add_military_experience = 80
            add_stability = 20
            }
        }
    }
    korinth_missions_task_21 = { #Bureaucratic Matters
        icon = "task_political"

        duration = 60
        
        allow = {
            has_senate_approval >= 0.6 
        }
        on_completion = {
            trigger_event = me_korinth.21
            show_as_tooltip = {
                add_country_modifier = {
                    name = korinth_laws
                    duration = 1825
                }
            }
        }
    }
    korinth_missions_task_22 = { #Oligarchical ways
        requires = { korinth_missions_task_21 }
        prevented_by = { korinth_missions_task_23 }

		potential = {
			NOT = {
				has_variable = korinth_tyranny_path
			}
		}
        icon = "task_political"
        allow = {
            has_law = republican_election_2
        }
        on_completion = {
            trigger_event = me_korinth.22
            show_as_tooltip = {
            add_stability = 20
            add_party_approval = {
                party_type = oligarchic_party
                value = 10
            }
            add_party_approval = {
                party_type = traditionalist_party
                value = 5
            }
            }
        }
    }
    korinth_missions_task_23 = { #Past Glories
        requires = { korinth_missions_task_21 }

        prevented_by = { korinth_missions_task_22 }

		potential = {
			NOT = {
				has_variable = korinth_oligarchy_path
			}
		}
        icon = "task_apollo"
        allow = {
            stability >=60 
            current_ruler = {
                popularity >= 90 
            }
        }
        on_completion = {
            trigger_event = me_korinth.23
            show_as_tooltip = {
            change_government = tyranny
            add_tyranny = 20
            add_political_influence = 60    
            }
        }
    }
    korinth_missions_task_24 = {
        requires = { korinth_missions_task_22 }
        prevented_by = { korinth_missions_task_23 }
        icon = "task_calm"
        allow = {
            current_ruler = {
                corruption <= 10 
            }
            idea = idea_bribery
            has_law = republic_corruption_1
        }
        on_completion = {
            trigger_event = me_korinth.24
            show_as_tooltip = {
                add_country_modifier = {
                    name = reduced_corruption
                    duration = 7300
                }
            }
        }
    }
    korinth_missions_task_25 = { #Bread and Circuses
        requires = { korinth_missions_task_23 }
        prevented_by = { korinth_missions_task_22 }
        icon = "task_happiness"
        allow = {
            p:418.state = {
                has_state_food >= 500
                is_importing_trade_good = grain
                is_importing_trade_good = wine
                is_importing_trade_good = fish
            } 
        }
        on_completion = {
            trigger_event = me_korinth.25
            show_as_tooltip = {
                add_stability = 10
                current_ruler = {
                    add_popularity = 20
                }
                add_party_approval = {
                    party_type = traditionalist_party
                    value = 5
                }
                add_party_approval = {
                    party_type = democratic_party
                    value = 5
                }
                add_party_approval = {
                    party_type = oligarchic_party
                    value = 5
                }
            }
        }
    }
    korinth_missions_task_26 = {
        requires = { korinth_missions_task_25 }
        prevented_by = { korinth_missions_task_22 }
        icon = "task_atlas"
        allow = {
            num_of_provinces >= 40
        }
        on_completion = {
            trigger_event = me_korinth.26
            show_as_tooltip = {
            change_government = aristocratic_monarchy
            current_ruler = {
                add_character_modifier = {
                    name = king_of_korinthos
                    duration = -1
                }
                add_trait = sisyphos
                }
            }
        }
    }
    korinth_missions_task_27 = {
        requires = { korinth_missions_task_24 }
        prevented_by = { korinth_missions_task_23 }
        icon = "task_heracles"
        allow = {}
        on_completion = {
            trigger_event = me_korinth.27
            show_as_tooltip = {
                add_political_influence = 100
                add_country_modifier = {
                    name = rule_of_few
                    duration = -1
                }
            }
        }
    }
    #korinth_missions_task_28 = {
    #    requires = { korinth_missions_task_9 }
    #    icon = "task_heracles"
    #    allow = {}
    #    on_completion = {
    #        trigger_event = me_korinth.28
    #        show_as_tooltip = { 
    #        }
   #     }
    #}
}
