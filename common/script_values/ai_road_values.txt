road_building_junction_search_depth = 15

territory_depth_level_svalue = {
    value = var:territory_depth_level
}

# Requires country capital saved as scope:target_province
state_priority_for_road_building = {
    value = 2000000000 # 2 billions
    if = {
        limit = {
            is_capital_state = no
        }
        ordered_state_province = {
            limit = {
                territory_is_junction_of_its_area = yes
            }
            # There shouldn't ever be more than one junction per area, but for safety it's deterministic by ID
            order_by = territory_priority_by_id
            position = 0
            check_range_bounds = no

            subtract = {
                value = distance_from_province
                multiply = 50000
            }

            subtract = territory_priority_by_id
        }
    }
}

# Reverse of ordering by province_id, assume 50000 of IDs for complete safety
territory_priority_by_id = {
    value = 50000
    subtract = province_id
}

territory_priority_for_road_building = {
    value = territory_priority_by_id
    if = {
        limit = {
            has_road_towards = scope:current_road_territory
        }
        add = 1000000
    }
    if = {
        limit = {
            has_city_status = yes
        }
        add = 500000
    }
    if = {
        limit = {
            has_less_depth_than_current_territory = yes
        }
        add = 100000
    }
}

num_of_state_territories_svalue = {
    value = 0
    every_state_province = {
        add = 1
    }
}

territory_priority_for_junction = {
    value = territory_priority_by_id
}

state_priority_for_junction = {
    value = num_of_state_territories_svalue
    multiply = 50000
    add = capital_scope.territory_priority_by_id
}

num_of_roads_towards_neighbors = {
    value = 0
    every_neighbor_province = {
        limit = {
            has_road_towards = prev
        }
        add = 1
    }
}

ai_country_build_roads_price = {
    if = {
        limit = {
            has_local_variable = ai_country_build_roads_price_cached
        }
        value = local_var:ai_country_build_roads_price_cached
    }
    else = {
        if = {
            limit = {
                has_military_bonus = latin_roman_path_4
            }
            if = {
                limit = {
                    any_unit = {
                        ai_unit_qualifies_for_building_roads = yes
                        has_reduced_roadbuilding_cost = yes
                    }
                }
                value = 10
                multiply = {
                    value = 1.00
                    add = modifier:build_roads_engineers_cost_modifier
                }
            }
            else = {
                value = 25
                multiply = {
                    value = 1.00
                    add = modifier:build_roads_cost_modifier
                }
            }
        }
        else = {
            if = {
                limit = {
                    any_unit = {
                        ai_unit_qualifies_for_building_roads = yes
                        has_reduced_roadbuilding_cost = yes
                    }
                }
                value = 10
                multiply = {
                    value = 1.00
                    add = modifier:build_roads_engineers_cost_modifier
                }
            }
            else = {
                value = 50
                multiply = {
                    value = 1.00
                    add = modifier:build_expensive_roads_cost_modifier
                }
            }
        }
        min = 0
    }
}

ai_country_build_1_road_price = {
    value = ai_country_build_roads_price
}
ai_country_build_10_roads_price = {
    value = ai_country_build_roads_price
    multiply = 10
}