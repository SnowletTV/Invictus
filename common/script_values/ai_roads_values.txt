ai_country_build_roads_price = {
    if = {
        limit = {
            has_local_variable = ai_country_build_roads_price_cached
        }
        value = local_var:ai_country_build_roads_price_cached
    }
    else = {
        if = {
            limit = {
                has_military_bonus = latin_roman_path_4
            }
            if = {
                limit = {
                    any_unit = {
                        ai_unit_qualifies_for_building_roads = yes
                        has_reduced_roadbuilding_cost = yes
                    }
                }
                value = 10
                multiply = {
                    value = 1.00
                    add = modifier:build_roads_engineers_cost_modifier
                }
            }
            else = {
                value = 25
                multiply = {
                    value = 1.00
                    add = modifier:build_roads_cost_modifier
                }
            }
        }
        else = {
            if = {
                limit = {
                    any_unit = {
                        ai_unit_qualifies_for_building_roads = yes
                        has_reduced_roadbuilding_cost = yes
                    }
                }
                value = 10
                multiply = {
                    value = 1.00
                    add = modifier:build_roads_engineers_cost_modifier
                }
            }
            else = {
                value = 50
                multiply = {
                    value = 1.00
                    add = modifier:build_expensive_roads_cost_modifier
                }
            }
        }
        min = 0
    }
}

ai_country_build_1_road_price = {
    value = ai_country_build_roads_price
}

ai_country_build_10_roads_price = {
    value = ai_country_build_roads_price
    multiply = 10
}

ai_wartime_fund_and_1_road = {
    value = ai_wartime_fund_desired
    add = ai_country_build_1_road_price
}

ai_wartime_fund_and_10_roads = {
    value = ai_wartime_fund_desired
    add = ai_country_build_10_roads_price
}

ai_wartime_fund_and_planned_roads = {
    value = ai_wartime_fund_desired
    add = cumulated_cost_of_planned_roads
}

cumulated_cost_of_planned_roads = {
    every_in_local_list = {
        variable = already_processed_territories
        limit = {
            has_non_empty_variable_list = {
                name = will_have_road_towards
            }
        }
        every_in_list = {
            variable = will_have_road_towards
            add = scope:road_building_country.ai_country_build_roads_price
        }
    }
}

road_building_junction_search_depth = 15

territory_depth_level_svalue = {
    value = var:territory_depth_level
}

# Requires country capital saved as scope:target_province
state_priority_for_road_building = {
    if = {
        limit = {
            is_capital_state = yes
        }
        value = 0 # 2 billions
    }
    else = {
        value = 0
        ordered_state_province = {
            limit = {
                territory_is_junction_of_its_area = yes
            }
            # There shouldn't ever be more than one junction per area, but for safety it's deterministic by ID
            order_by = territory_priority_by_id
            position = 0
            check_range_bounds = no

            add = territory_priority_by_distance_from_capital
        }
    }
}

# Reverse of ordering by province_id, assume 50000 of IDs for complete safety
territory_priority_by_id = {
    value = 50000
    subtract = province_id
}

territory_priority_for_road_building = {
    value = territory_priority_by_id
    if = {
        limit = {
            has_road_towards = scope:current_road_territory
        }
        add = 1000000
    }
    if = {
        limit = {
            has_city_status = yes
        }
        add = 500000
    }
    if = {
        limit = {
            has_less_depth_than_current_territory = yes
        }
        add = 100000
    }
}

area_priority_for_road_building = {
    value = 0
    every_area_state = {
        limit = {
            interland_eligible_for_road_building = yes
            owned_by_road_builder_or_permasubject = yes
        }
        if = {
            limit = {
                state_junction_has_any_roads = yes
            }
            add = 1000000
        }
        if = {
            limit = {
                has_less_depth_than_current_interland = yes
            }
            add = 100000
        }
    }
}

# Requires country capital saved as scope:target_province
territory_priority_by_distance_from_capital = {
    value = {
        value = distance_from_province
        multiply = 50000
    }

    add = territory_priority_by_id
}

state_priority_by_distance_from_capital = {
    value = capital_scope.territory_priority_by_distance_from_capital
}

num_of_state_territories_svalue = {
    value = 0
    every_state_province = {
        add = 1
    }
}

territory_priority_for_junction = {
    value = territory_priority_by_id
}

state_priority_by_area_territory_ids = {
    value = 0
    area = {
        every_area_province = {
            add = province_id
        }
    }
}

interland_priority_by_depth_level = {
    value = capital_scope.var:interland_depth_level
    multiply = 50000

    add = capital_scope.territory_priority_by_id
}

interland_area_priority_by_depth_level = {
    value = 0
    every_area_state = {
        limit = {
            capital_scope = {
                has_variable = interland_depth_level
            }
        }
        add = interland_priority_by_depth_level
    }
}

area_priority_by_territory_ids = {
    value = 0
    every_area_province = {
        add = province_id
    }
}

state_priority_for_junction = {
    value = num_of_state_territories_svalue
    multiply = 50000
    add = capital_scope.territory_priority_by_id
}

num_of_roads_towards_neighbors = {
    value = 0
    every_neighbor_province = {
        limit = {
            has_road_towards = prev
        }
        add = 1
    }
}

interland_depth_level_svalue = {
    if = {
        limit = {
            exists = capital_scope
            capital_scope = {
                has_variable = interland_depth_level
            }
        }
        value = capital_scope.var:interland_depth_level
    }
    else = {
        value = -1
    }
}

num_already_processed_interlands = {
    value = 0
    if = {
        limit = {
            has_non_empty_local_variable_list = {
                name = already_processed_interlands
            }
        }
        every_in_local_list = {
            variable = already_processed_interlands
            add = 1
        }
    }
}

thresholds_for_roads_to_governorship = {
    # 10% of country territories
    value = scope:road_building_country.num_of_territories_svalue
    multiply = 0.10
    # But not too much
    max = 30
}