ai_wartime_fund_desired = {
    value = modifier:max_mercenary_stacks
    multiply = {
        value = 100
        multiply = {
            value = 1.00
            add = modifier:recruit_mercenary_cost_modifier
        }
        # Some money to pay mercenary wages
        if = {
            limit = {
                rank = great_power
            }
            add = 150
        }
        else_if = {
            limit = {
                rank = major_power
            }
            add = 100
        }
        else_if = {
            limit = {
                rank = regional_power
            }
            add = 70
        }
        else = {
            add = 50
        }
    }

    # Round to 2 digits
    multiply = 100
    round = yes
    divide = 100
    
    min = 0
}

ai_wartime_fund_current = {
    if = {
        limit = {
            has_variable = ai_wartime_fund
        }
        value = var:ai_wartime_fund
        min = 0

        # Round to 2 digits
        multiply = 100
        round = yes
        divide = 100
    }
    else = {
        value = 0
    }
}

ai_wartime_fund_withdraw = {
    if = {
        limit = {
            treasury >= ai_wartime_fund_desired
        }
        value = 0
    }
    else = {
        value = ai_wartime_fund_desired
        subtract = treasury

        # Round to 2 digits
        multiply = 100
        round = yes
        divide = 100

        max = ai_wartime_fund_current
    }
}

ai_wartime_fund_missing = {
    value = ai_wartime_fund_desired
    subtract = ai_wartime_fund_current
    min = 0
}

ai_wartime_fund_deposit = {
    if = {
        limit = {
            treasury > 0
        }
        value = ai_wartime_fund_missing

        max = {
            value = treasury
            divide = 2
        }

        # Round to 2 digits
        multiply = 100
        round = yes
        divide = 100

        multiply = -1
    }
    else = {
        value = 0
    }
}

ai_wartime_fund_potential = {
    value = treasury
    add = ai_wartime_fund_current
}

ai_wartime_fund_to_build = {
    value = ai_wartime_fund_potential
    subtract = 150 # Just above the average priced buildings
}

num_mercenaries_employed_svalue = {
    value = 0
    every_character = {
        limit = {
            is_mercenary = yes
        }
        add = 1
    }
}