# Turdetanians
turdetanian_mission_01_sons_baetica_inv_variable_cleanup_effect = {
	if = {
		limit = {
			has_variable = punic_priest_character_scope_variable
		}
		remove_variable = punic_priest_character_scope_variable
	}
	if = {
		limit = {
			has_variable = turdetanian_republic_variable
		}
		remove_variable = turdetanian_republic_variable
	}
	if = {
		limit = {
			has_variable = turdetanian_monarchy_variable
		}
		remove_variable = turdetanian_monarchy_variable
	}
	if = {
		limit = {
			has_variable = turdetanian_expansion_variable
		}
		remove_variable = turdetanian_expansion_variable
	}
	if = {
		limit = {
			has_variable = turdetanian_commerce_variable
		}
		remove_variable = turdetanian_commerce_variable
	}
	if = {
		limit = {
			has_variable = turdetanian_victim_scope_variable
		}
		remove_variable = turdetanian_victim_scope_variable
	}
}

turdetanian_mission_02_heirs_tartessia_inv_variable_cleanup_effect = {
	if = {
		limit = {
			has_variable = turdetanian_multilingual_bronzes_variable
		}
		remove_variable = turdetanian_multilingual_bronzes_variable
	}
	if = {
		limit = {
			has_variable = olisipo_territory_variable
		}
		remove_variable = olisipo_territory_variable
	}
	if = {
		limit = {
			has_variable = phokaia_territory_variable
		}
		remove_variable = phokaia_territory_variable
	}
	if = {
		limit = {
			has_variable = cancho_roano_progress
		}
		remove_variable = cancho_roano_progress
	}
}

turdetanian_mission_03_conquerors_inv_variable_cleanup_effect = {
	if = {
		limit = {
			has_variable = free_religion_conversion
		}
		remove_variable = free_religion_conversion
	}
}

# Gadir
gadir_mission_01_beyond_pillars_inv_variable_cleanup_effect = {
	
}

# Aletes' Adventure
aletes_apotheosis_status = {
	if = {
		limit = { has_variable = aletes_apotheosis_progress }
		if = {
			limit = {
				has_variable = aletes_apotheosis_progress
				var:aletes_apotheosis_progress <= 4
			}
			custom_tooltip = aletes_prestige_level_1
		}
		else_if = {
			limit = {
				has_variable = aletes_apotheosis_progress
				AND = {
					var:aletes_apotheosis_progress > 4
					var:aletes_apotheosis_progress <= 8
				}
			}
			custom_tooltip = aletes_prestige_level_2
		}
		else_if = {
			limit = {
				has_variable = aletes_apotheosis_progress
				AND = {
					var:aletes_apotheosis_progress > 8
					var:aletes_apotheosis_progress <= 12
				}
			}
			custom_tooltip = aletes_prestige_level_3
		}
		else_if = {
			limit = {
				has_variable = aletes_apotheosis_progress
				AND = {
					var:aletes_apotheosis_progress > 12
					var:aletes_apotheosis_progress <= 16
				}
			}
			custom_tooltip = aletes_prestige_level_4
		}
		else_if = {
			limit = {
				has_variable = aletes_apotheosis_progress
				var:aletes_apotheosis_progress > 16
			}
			custom_tooltip = aletes_prestige_level_5
		}
	}
	else = {
		custom_tooltip = aletes_adventure_not_set
	}
}

aletes_mastiania_setup_effect = {
	change_government = despotic_monarchy
	change_country_tag = MST
	change_country_flag = ALETES_MASTIANIA_FLAG
	change_country_color = aletes_country_color
	if = {
		limit = {
			NOT = {
				primary_culture = bastetanian
			}
		}
		set_primary_culture_cleanup_effect = {
			NEW_PRIMARY_CULTURE = bastetanian
			MAKE_OLD_CULTURE_INTEGRATED = yes
		}
	}
	set_country_religion = animism
	set_country_heritage = aletes_heritage
	change_country_name = ALETES_MASTIANIA_NAME
	change_country_adjective = ALETES_MASTIANIA_ADJECTIVE
	add_treasury = 500
	add_political_influence = 75
	add_manpower = 8
	add_stability_effect = yes
}

aletes_moves_mastiania_effect = {
	employer = { save_scope_as = aletes_origin_country_scope }
	remove_all_positions = yes
	move_country =  scope:aletes_mastiania_scope
	if = {
		limit = {
			NOT = { has_religion = animism }
		}
		set_character_religion = animism
	}
	hidden_effect = {
		remove_character_modifier = foreign_citizen
		set_home_country = scope:aletes_mastiania_scope
		if = {
			limit = { is_minor_character = no }
			family = { 
				save_scope_as = aletes_family_scope
				move_family = scope:aletes_mastiania_scope
			}
			scope:aletes_family_scope = {
				every_family_member = {
					limit = {
						is_ruler = no
						prisoner = no
						employer = scope:aletes_origin_country_scope
					}
					move_country = scope:aletes_mastiania_scope
					remove_character_modifier = foreign_citizen
					set_home_country = scope:aletes_mastiania_scope
				}
			}
			scope:aletes_family_scope = {
				every_family_member = {
					limit = {
						NOT = { has_religion = animism }
						employer = scope:aletes_mastiania_scope
					}
					set_character_religion = animism
				}
			}
		}
		if = {
			limit = { THIS = scope:aletes_character }
			employer = { create_family = scope:aletes_character }
		}
		if = {
			limit = {
				is_married = yes
				spouse = {
					prisoner = no
					employer = scope:aletes_origin_country_scope
				}
			}
			spouse = {
				remove_all_positions = yes
				move_country = scope:aletes_mastiania_scope
				remove_character_modifier = foreign_citizen
				set_home_country = scope:aletes_mastiania_scope
				set_as_minor_character = this
				if = {
					limit = {
						NOT = { has_religion = animism }
					}
					set_character_religion = animism
				}
			}
		}
		if = {
			limit = {
				num_of_children > 0
				any_child = {
					prisoner = no
					employer = scope:aletes_origin_country_scope

				}
			}
			every_child = {
				limit = {
					prisoner = no
					employer = scope:aletes_origin_country_scope
				}
				remove_all_positions = yes
				move_country = scope:aletes_mastiania_scope
				remove_character_modifier = foreign_citizen
				set_home_country = scope:aletes_mastiania_scope
				if = {
					limit = {
						NOT = { has_religion = animism }
					}
					set_character_religion = animism
				}
				if = {
					limit = {
						OR = {
							is_minor_character = yes 
							NOT = { family = scope:aletes_character.family }
						}
					}
					set_family = scope:aletes_character.family
				}
			}
		}
		if = {
			limit = {
				NOT = {	this = scope:aletes_character }
				OR = {
					is_minor_character = yes 
					NOT = { family = scope:aletes_character.family }
				}
			}
			set_family = scope:aletes_character.family
		}
		ordered_character = {
			limit = {
				loyalty >= 60
				NOT = { has_religion = animism }
				is_ruler = no
				from_ruler_family = no
			}
			max = 6
			order_by = prominence
			check_range_bounds = no
			set_character_religion = animism
		}
	}
}

aletes_family_generation_effect = { # Not Used
	#$FAMILY_CANDIDATE$ is the saved scope that creates the family
	scope:$FAMILY_CANDIDATE$  = {
		ROOT = {
			create_family = PREV
			#hidden_effect = { set_home_country = ROOT }
		}
		custom_tooltip = family_acceptance_custom_tooltip
	}
	hidden_effect = {
		#To determine starting prestige we look at the least prestigious other family:
		ordered_family = {
			order_by = prestige
			limit  = { NOT = { THIS = scope:$FAMILY_CANDIDATE$.family } }
			position = end
			save_scope_as = poor_family
		}
		scope:$FAMILY_CANDIDATE$.family = {
			add_prestige = {
				value = scope:poor_family.prestige
				subtract = 50
				min = 200
			}
		}
		#Now to populate the new Family:
		if = { #Any existing close relatives need to be joined to the family.
			limit = {
				any_character = {
					is_minor_character = yes
					is_close_relative = scope:$FAMILY_CANDIDATE$
				}
			}
			every_character = {
				limit = {
					is_minor_character = yes
					is_close_relative = scope:$FAMILY_CANDIDATE$
				}
				set_family = scope:$FAMILY_CANDIDATE$.family
				if = {
					limit = { has_character_modifier = foreign_citizen }
					remove_character_modifier = foreign_citizen
				}
				if = {
					limit = { prisoner = yes }
					ROOT = { release_prisoner = { target = PREV } }
				}
				set_home_country = ROOT
			}
		}
		ordered_character = { #Clients are now added.
			check_range_bounds = no
			max = 7
			order_by = power_base
			limit = {
				prisoner = no
				is_mercenary = no
				NOT = { has_variable = olympic_attendee }
				NOT = { has_variable = pyrrhus_travelling }
				is_minor_character = yes
				trigger_if = {
					limit = { exists = scope:family_candidate_1 }
					NOT = { THIS = scope:family_candidate_1 }
				}
				trigger_if = {
					limit = { exists = scope:family_candidate_2 }
					NOT = { THIS = scope:family_candidate_2 }
				}
				trigger_if = {
					limit = { exists = scope:family_candidate_3 }
					NOT = { THIS = scope:family_candidate_3 }
				}
				trigger_if = {
					limit = { exists = scope:family_candidate_4 }
					NOT = { THIS = scope:family_candidate_4 }
				}
				NOT = { age > scope:$FAMILY_CANDIDATE$.age } #Sorry, no seniors.
				is_ruler = no #Never the ruler.
				citizenship_restrictions_trigger = yes
			}
			set_family = scope:$FAMILY_CANDIDATE$.family
			adapt_family_name = yes
			set_home_country = ROOT
			add_character_modifier = {
				name = adopted_into_great_family
				duration = -1
			}
			if = {
				limit = { has_character_modifier = foreign_citizen }
				remove_character_modifier = foreign_citizen
			}
		}
		if = {
			limit = { scope:$FAMILY_CANDIDATE$.family = { num_of_members <= 8 } }
			while = {
				limit = { scope:$FAMILY_CANDIDATE$.family = { num_of_members <= 8 } }
				create_character = {
					family = scope:$FAMILY_CANDIDATE$.family
					religion = scope:$FAMILY_CANDIDATE$.religion
					culture = scope:$FAMILY_CANDIDATE$.culture
				}
			}
		}
	}
}

mastiania_foundation_ping_effect = {
	every_country = {
 		limit = {
 			is_ai = no
 			trigger_if = {
 				limit = { exists = scope:aletes_mastiania_scope }
 				NOT = { THIS = scope:aletes_mastiania_scope }
 			}
 			trigger_if = {
 				limit = { exists = scope:aletes_mastiania_scope.overlord }
 				NOT = { THIS = scope:aletes_mastiania_scope.overlord }
 			}
 			NOT = { THIS = ROOT }
 			OR = {
	 			country_culture_group = iberia
	 			capital_scope = {
	 				OR = {
	 					is_in_region = baetica_region
	 					is_in_region = contestania_region
	 					is_in_region = tarraconensis_region
	 					is_in_region = gallaecia_region
	 					is_in_region = lusitania_region
	 					is_in_region = transalpine_gaul_region
	 					is_in_region = numidia_region
	 					is_in_region = mauretainia_region
	 					is_in_region = africa_region
	 				}
	 			}
	 		}
 		}
 		trigger_event = { 
 			id = flavor_mat.66
 			days = 10
 		}
 	}
}

seize_aletes_wealth_effect = {
	add_treasury  = {
		value = scope:aletes_character.wealth
		multiply = 1
	}
	scope:aletes_character = {
		add_gold = {
			value = 0
			subtract = wealth
		}
	}
	scope:aletes_character = {
		if = {
			limit = { num_holdings_owned > 0 }
			custom_tooltip = flavor_mat.67.tooltip.d
			hidden_effect = {
				if = { # Give holdings to the ruler
					limit = { 
						exists = scope:aletes_jailer 
						NOT = {
							scope:aletes_jailer = root
						}
					}
					while = {
						limit = { num_holdings_owned > 0 }
						random_holdings = { save_scope_as = holding_transfer }
						remove_holding = scope:holding_transfer
						scope:aletes_jailer = { add_holding = scope:holding_transfer }
					}
				}
			}
		}
	}
}

aletes_adventure_main_variable_cleanup_effect = {
	if = {
		limit = {
			has_variable = aletes_exploration_progress
		}
		remove_variable = aletes_exploration_progress
	}
	if = {
		limit = {
			has_variable = aletes_apotheosis_secured
		}
		remove_variable = aletes_apotheosis_secured
	}
	if = {
		limit = {
			has_variable = aletes_apotheosis_progress
		}
		remove_variable = aletes_apotheosis_progress
	}
}

aletes_adventure_event_variable_cleanup_effect = {
	if = {
		limit = {
			has_variable = aletes_already_married
		}
		remove_variable = aletes_already_married
	}
	if = {
		limit = {
			char:558 = {
				has_variable = aletes_very_displeased
			}
		}
		char:558 = {
			remove_variable = aletes_very_displeased
		}
	}
	if = {
		limit = {
			char:558 = {
				has_variable = imprisoned_manually
			}
		}
		char:558 = {
			remove_variable = imprisoned_manually
		}
	}
	if = {
		limit = {
			any_family = {
				has_variable = aletes_wife_family_flag
			}
		}
		random_family = {
			limit = { has_variable = aletes_wife_family_flag }
			remove_variable = aletes_wife_family_flag
		}
	}
}

aletes_adventure_good_loyalty_cleanup_effect = {
	if = {
		limit = {
			scope:aletes_character = {
				has_loyalty = granted_holding_l
			}
		}
		scope:aletes_character = {
			remove_loyalty = granted_holding_l
		}
	}
	if = {
		limit = {
			scope:aletes_character = {
				has_loyalty = objective_holding_granted
			}
		}
		scope:aletes_character = {
			remove_loyalty = objective_holding_granted
		}
	}
	if = {
		limit = {
			scope:aletes_character = {
				has_loyalty = aletes_attended_games_loyalty
			}
		}
		scope:aletes_character = {
			remove_loyalty = aletes_attended_games_loyalty
		}
	}
	if = {
		limit = {
			scope:aletes_character = {
				has_loyalty = aletes_married_into_family_loyalty
			}
		}
		scope:aletes_character = {
			remove_loyalty = aletes_married_into_family_loyalty
		}
	}
	if = {
		limit = {
			scope:aletes_character = {
				has_loyalty = aletes_friendly_ruler_loyalty
			}
		}
		scope:aletes_character = {
			remove_loyalty = aletes_friendly_ruler_loyalty
		}
	}
}

aletes_adventure_setting_government_effect = {
	# Tribal Governments
	if = {
		limit = { government = tribal_chiefdom }
		set_variable = mastia_was_tribal_chiefdom
	}
	if = {
		limit = { government = tribal_kingdom }
		set_variable = mastia_was_tribal_kingdom
	}
	if = {
		limit = { government = tribal_federation }
		set_variable = mastia_was_tribal_federation
	}
	# Monarchical Governments
	if = {
		limit = { government = despotic_monarchy }
		set_variable = mastia_was_despotic_monarchy
	}
	if = {
		limit = { government = aristocratic_monarchy }
		set_variable = mastia_was_aristocratic_monarchy
	}
	if = {
		limit = { government = stratocratic_monarchy }
		set_variable = mastia_was_stratocratic_monarchy
	}
	if = {
		limit = { government = theocratic_monarchy }
		set_variable = mastia_was_theocratic_monarchy
	}
	if = {
		limit = { government = plutocratic_monarchy }
		set_variable = mastia_was_plutocratic_monarchy
	}
	if = {
		limit = { government = imperium }
		set_variable = mastia_was_imperium
	}
	if = {
		limit = { government = imperial_cult }
		set_variable = mastia_was_imperial_cult
	}
	# Republican Governments
	if = {
		limit = { government = aristocratic_republic }
		set_variable = mastia_was_aristocratic_republic
	}
	if = {
		limit = { government = theocratic_republic }
		set_variable = mastia_was_theocratic_republic
	}
	if = {
		limit = { government = oligarchic_republic }
		set_variable = mastia_was_oligarchic_republic
	}
	if = {
		limit = { government = democratic_republic }
		set_variable = mastia_was_democratic_republic
	}
	if = {
		limit = { government = plutocratic_republic }
		set_variable = mastia_was_plutocratic_republic
	}
	if = {
		limit = { government = athenian_republic }
		set_variable = mastia_was_athenian_republic
	}
	if = {
		limit = { government = dictatorship }
		set_variable = mastia_was_dictatorship
	}
	# Invictus Governments
	if = {
		limit = { government = spartan_monarchy }
		set_variable = mastia_was_spartan_monarchy
	}
	if = {
		limit = { government = spartan_imperium }
		set_variable = mastia_was_spartan_imperium
	}
	if = {
		limit = { government = spartan_imperial_cult }
		set_variable = mastia_was_spartan_imperial_cult
	}
	if = {
		limit = { government = judean_empire }
		set_variable = mastia_was_judean_empire
	}
	if = {
		limit = { government = steppe_horde }
		set_variable = mastia_was_steppe_horde
	}
	if = {
		limit = { government = punic_republic }
		set_variable = mastia_was_punic_republic
	}
}

aletes_adventure_changing_government_effect = {
	# Tribal Governments
	if = {
		limit = { has_variable = mastia_was_tribal_chiefdom }
		remove_variable = mastia_was_tribal_chiefdom
		scope:aletes_origin_country_scope = { change_government = tribal_chiefdom }
	}
	if = {
		limit = { has_variable = mastia_was_tribal_kingdom }
		remove_variable = mastia_was_tribal_kingdom
		scope:aletes_origin_country_scope = { change_government = tribal_kingdom }
	}
	if = {
		limit = { has_variable = mastia_was_tribal_federation }
		remove_variable = mastia_was_tribal_federation
		scope:aletes_origin_country_scope = { change_government = tribal_federation }
	}
	# Monarchical Governments
	if = {
		limit = { has_variable = mastia_was_despotic_monarchy }
		remove_variable = mastia_was_despotic_monarchy
		scope:aletes_origin_country_scope = { change_government = despotic_monarchy }
	}
	if = {
		limit = { has_variable = mastia_was_aristocratic_monarchy }
		remove_variable = mastia_was_aristocratic_monarchy
		scope:aletes_origin_country_scope = { change_government = aristocratic_monarchy }
	}
	if = {
		limit = { has_variable = mastia_was_stratocratic_monarchy }
		remove_variable = mastia_was_stratocratic_monarchy
		scope:aletes_origin_country_scope = { change_government = stratocratic_monarchy }
	}
	if = {
		limit = { has_variable = mastia_was_theocratic_monarchy }
		remove_variable = mastia_was_theocratic_monarchy
		scope:aletes_origin_country_scope = { change_government = theocratic_monarchy }
	}
	if = {
		limit = { has_variable = mastia_was_plutocratic_monarchy }
		remove_variable = mastia_was_plutocratic_monarchy
		scope:aletes_origin_country_scope = { change_government = plutocratic_monarchy }
	}
	if = {
		limit = { has_variable = mastia_was_imperium }
		remove_variable = mastia_was_imperium
		scope:aletes_origin_country_scope = { change_government = imperium }
	}
	if = {
		limit = { has_variable = mastia_was_imperial_cult }
		remove_variable = mastia_was_imperial_cult
		scope:aletes_origin_country_scope = { change_government = imperial_cult }
	}
	# Republican Governments
	if = {
		limit = { has_variable = mastia_was_aristocratic_republic }
		remove_variable = mastia_was_aristocratic_republic
		scope:aletes_origin_country_scope = { change_government = aristocratic_republic }
	}
	if = {
		limit = { has_variable = mastia_was_theocratic_republic }
		remove_variable = mastia_was_theocratic_republic
		scope:aletes_origin_country_scope = { change_government = theocratic_republic }
	}
	if = {
		limit = { has_variable = mastia_was_oligarchic_republic }
		remove_variable = mastia_was_oligarchic_republic
		scope:aletes_origin_country_scope = { change_government = oligarchic_republic }
	}
	if = {
		limit = { has_variable = mastia_was_democratic_republic }
		remove_variable = mastia_was_democratic_republic
		scope:aletes_origin_country_scope = { change_government = democratic_republic }
	}
	if = {
		limit = { has_variable = mastia_was_plutocratic_republic }
		remove_variable = mastia_was_plutocratic_republic
		scope:aletes_origin_country_scope = { change_government = plutocratic_republic }
	}
	if = {
		limit = { has_variable = mastia_was_athenian_republic }
		remove_variable = mastia_was_athenian_republic
		scope:aletes_origin_country_scope = { change_government = athenian_republic }
	}
	if = {
		limit = { has_variable = mastia_was_dictatorship }
		remove_variable = mastia_was_dictatorship
		scope:aletes_origin_country_scope = { change_government = dictatorship }
	}
	# Invictus Governments
	if = {
		limit = { has_variable = mastia_was_spartan_monarchy }
		remove_variable = mastia_was_spartan_monarchy
		scope:aletes_origin_country_scope = { change_government = spartan_monarchy }
	}
	if = {
		limit = { has_variable = mastia_was_spartan_imperium }
		remove_variable = mastia_was_spartan_imperium
		scope:aletes_origin_country_scope = { change_government = spartan_imperium }
	}
	if = {
		limit = { has_variable = mastia_was_spartan_imperial_cult }
		remove_variable = mastia_was_spartan_imperial_cult
		scope:aletes_origin_country_scope = { change_government = spartan_imperial_cult }
	}
	if = {
		limit = { has_variable = mastia_was_judean_empire }
		remove_variable = mastia_was_judean_empire
		scope:aletes_origin_country_scope = { change_government = judean_empire }
	}
	if = {
		limit = { has_variable = mastia_was_steppe_horde }
		remove_variable = mastia_was_steppe_horde
		scope:aletes_origin_country_scope = { change_government = steppe_horde }
	}
	if = {
		limit = { has_variable = mastia_was_punic_republic }
		remove_variable = mastia_was_punic_republic
		scope:aletes_origin_country_scope = { change_government = punic_republic }
	}
}