ai_hire_mercenaries = {
    if = {
        limit = {
            has_global_variable = game_rule_ai_custom_mercenary_recruitment
            is_ai = yes
            war = yes
            ai_is_facing_comparable_threat = yes
            num_free_mercenary_slots_svalue > 0
            exists = c:MER
        }
        save_scope_as = hiring_country
        scope:hiring_country.capital_scope = {
            save_scope_as = target_province
        }

        c:MER = {
            ordered_character = {
                limit = {
                    country_can_hire_mercenary = yes
                    country_should_hire_mercenary = yes
                }
                order_by = ai_mercenary_priority
                position = 0
                check_range_bounds = no

                change_mercenary_employer = scope:hiring_country
                scope:hiring_country = {
                    pay_price = recruit_mercenary
                }
            }
        }

        clear_saved_scope = target_province
        clear_saved_scope = hiring_country
    }
}