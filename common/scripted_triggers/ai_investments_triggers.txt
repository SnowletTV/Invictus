state_has_permanent_trade_routes = {
    trigger_if = {
        limit = {
            is_capital_state = yes
            owner = {
                has_mid_economic_policy = income_commerce
            }
        }
        trade_routes > 2
    }
    trigger_else = {
        trade_routes > 0
    }
}

ai_can_make_investment_in_this_state = {
    # Either the state is under the limit, or there are no states under the limit
    OR = {
        local_var:any_state_is_below_limit = 0
        current_state_investments_plus_1 <= ai_investments_allowed_per_state
    }
}

ai_can_make_state_investment_military = {
    # Validity conditions from the investment button
    invest_in_state_button_is_valid = {
        type = military
    }
    # Once per state
    NOT = {
        has_state_modifier = state_improvement_military
    }
}

ai_can_make_state_investment_civic = {
    # Validity conditions from the investment button
    invest_in_state_button_is_valid = {
        type = civic
    }
    # Only if >=50% of territories is close to population limit
    any_state_province = {
        percent >= 0.50
        total_population >= 90_percent_of_population_cap
    }
}

ai_can_make_state_investment_oratory = {
    # Oratory investment is allowed only if the state has trade routes from other sources anyways.
    # The reason is AI trading is very performance intensive, can't give trade routes to everyone.
    state_has_permanent_trade_routes = yes
    # Validity conditions from the investment button
    invest_in_state_button_is_valid = {
        type = oratory
    }
    # You don't need more trade routes if you are not using existing ones
    unused_trade_routes < 1
}

ai_can_make_state_investment_religious = {
    # Validity conditions from the investment button
    invest_in_state_button_is_valid = {
        type = religious
    }
    # Only if has multiple cities almost full on building slots
    any_state_province = {
        count >= 2
        has_city_status = yes
        free_building_slots <= 1
    }
}

ai_can_make_state_investment_military_SPA = {
    # Validity conditions from the investment button
    invest_in_state_button_is_valid = {
        type = civic
    }
    # It's very good, get one oratory investment if can and then spam this
    OR = {
        has_state_modifier = state_improvement_oratory
        ai_can_make_state_investment_oratory = no
    }
    any_state_province = {
        has_city_status = yes
    }
}

ai_can_make_state_investment_religious_SPA = {
    # Validity conditions from the investment button
    invest_in_state_button_is_valid = {
        type = religious
    }
}