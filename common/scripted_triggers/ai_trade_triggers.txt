state_has_low_food = {
    trigger_if = {
        limit = {
            state_monthly_food_income < 0
        }
        state_food_percent <= 0.50
    }
    trigger_else = {
        state_food_percent <= 0.20
    }
}

# Only if enough trade routes to get both the bonus and some grain
ai_should_try_to_get_capital_bonus = {
    trigger_if = {
        limit = {
            trade_good_surplus = {
                target = $goods$
                value = { 1 1 }
            }
        }
        unused_trade_routes >= 3
    }
    trigger_else_if = {
        limit = {
            trade_good_surplus = {
                target = $goods$
                value <= 0
            }
        }
        unused_trade_routes >= 4
    }
    trigger_else = {
        always = no
    }
}

can_reset_state_trade_routes = {
    OR = {
        NOT = {
            has_global_variable = ai_applied_trade_routes_reset
        }
        global_var:ai_applied_trade_routes_reset < 1
    }

    trade_routes >= 4
    unused_trade_routes <= 1
    
    OR = {
        # For capital state bonuses from import
        AND = {
            is_capital_state = yes
            owner = {
                rank >= major_power
            }
        }
        state_food_percent <= 0.20
    }
}