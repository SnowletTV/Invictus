country_decisions = {

    #Release Thessalian League
    restore_thessalian_league = {
        
        potential = {
            num_of_cities >= 25 #regional power
#            OR = {
#                country_culture_group = hellenic
#                 religion = roman_pantheon
#            }
            any_owned_province = {
                    OR = {
                        is_in_area = thessaly_area
                    }
                }
            NOT = {
                tag = THL
            }
            NOT = {
                tag = EPI
            }
            NOT = {
                tag = SPA
            }
            NOT = {
                tag = MAC
            }   
            NOT = {
                has_variable = restored_thessalian_league
            }         
        }

        highlight = {
            scope:province = { is_in_area = thessaly_area }
        }

        allow = {
            custom_tooltip = {
                text = thessalian_league_not_exists
                NOT = {
                    any_country = {
                        num_of_cities >= 1
                        tag = THL
                    }
                }
            }
            owns_or_subject_owns_area = thessaly_area
        }
        
        effect = {
            custom_tooltip = thessalian_league_tooltip
            hidden_effect = {
                 random_owned_province = {
                    limit = { is_in_area = thessaly_area }
                    create_country = {
                        name = {
                            name = THESSALIAN_LEAGUE
                            adjective = THESSALY_ADJECTIVE
                        }
                        change_country_flag = THESSALY_FLAG
                        change_country_tag = THL
                        change_country_color = thessalian_color                        
                        if = {
                            limit = {
                                NOT = {
                                    primary_culture = thessalian
                                }
                            }
                            set_primary_culture_cleanup_effect = {
                                NEW_PRIMARY_CULTURE = thessalian
                                MAKE_OLD_CULTURE_INTEGRATED = yes
                            }
                        }
                        save_scope_as = thessaly_scope
                    }
                }
                every_owned_province = {
                    limit = { is_in_area = thessaly_area }
                    set_owned_by = scope:thessaly_scope
                }
                make_subject = {
                    target = scope:thessaly_scope
                    type = feudatory
                }
                area:thessaly_area = {
                    ordered_area_province = {
                        limit = {
                            OR = {
                                province_id = 394
                                province_id = 389
                                province_id = 390
                            }
                        }
                        order_by = total_population
                        save_scope_as = thessaly_cap_scope
                    }
                }
                scope:thessaly_scope = { set_capital = scope:thessaly_cap_scope }
                scope:thessaly_scope = {
                capital_scope = {
                    create_state_pop = nobles
                    create_state_pop = nobles
                }
                random_owned_province = {
                    create_state_pop = nobles
                }
                random_owned_province = {
                    create_state_pop = nobles
                }
                random_owned_province = {
                    create_state_pop = nobles
                }
                random_owned_province = {
                    create_state_pop = nobles
                }
                random_owned_province = {
                    create_state_pop = nobles
                }
                add_4_free_province_investments = yes
                capital_formable_small_effect = yes
                formable_capital_modifier_normal_effect = yes
                    add_manpower = 5
                    add_treasury = 300
                    add_opinion = {
                        target = root
                        modifier = opinion_liberated_us
                    }
                    add_country_modifier = { name = me_gre_2_self_government_cmod }                    
                }
            c:THL = {
                trigger_event = { 
                    id = fix_thessalian_league 
                }
            }            
            }    
            add_country_modifier = {
                name = me_epi_3_4_cmod_2
                duration = -1
            }
            set_variable = restored_thessalian_league          
        }
        ai_will_do = {
            base = 1
            }
        }

# Form the Thessalian League
    form_thessalian_league = {
        
        potential = {
            num_of_cities >= 1
            num_of_cities <= 24
            capital_scope = {
                is_in_area = thessaly_area
            }
            NOT = {
                tag = THL
            }
        }
        highlight = {
            scope:province = {
                OR = {
                    province_id = 390 #Pherai
                    province_id = 389 #Larissa
                    province_id = 394 #Pharsalos
                }
            }
        }
        
        allow = {
            custom_tooltip = {
                text = thessalian_league_not_exists
                NOT = {
                    any_country = {
                        num_of_cities >= 1
                        tag = THL
                    }
                }
            }
            can_form_nation_trigger = yes
            owns_or_subject_owns = 390 #Pherai
            owns_or_subject_owns = 389 #Larissa
            owns_or_subject_owns = 394 #Pharsalos
        }        
        highlight = {
            scope:province = {
                OR = {
                    province_id = 390 #Pherai
                    province_id = 389 #Larissa
                    province_id = 394 #Pharsalos
                }
            }
        }
        
        effect = {
            custom_tooltip = "tier_1_formable_tooltip"
            change_country_name = THESSALIAN_LEAGUE
            hidden_effect = {
                change_country_adjective = THESSALY_ADJECTIVE
                change_country_tag = THL
                change_country_color = thessalian_color
                change_country_flag = THESSALY_FLAG
                if = {
                    limit = {
                        NOT = {
                            primary_culture = thessalian
                        }
                    }
                    set_primary_culture_cleanup_effect = {
                        NEW_PRIMARY_CULTURE = thessalian
                        MAKE_OLD_CULTURE_INTEGRATED = yes
                    }
                }
                trigger_event = {#does not work. will delete once I figure out how to switch the culture properly
                    id = fix_thessalian_league
                }            
            }
                area:thessaly_area = {
                    every_area_province = {
                        limit = {
                            owner = { 
                                is_ai = yes
                                num_of_cities < 6
                            }
                        }
                        set_owned_by = root
                    }
                }
            capital_scope = {
                capital_formable_medium_effect = yes
                formable_capital_modifier_normal_effect = yes
            }
            add_2_free_province_investments = yes
        }
        
        ai_will_do = {
            base = 1000
        }
    }


} 