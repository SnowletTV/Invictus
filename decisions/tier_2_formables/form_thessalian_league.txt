country_decisions = {

    #Release Thessalian League
    restore_thessalian_league = {
        potential = {
            num_of_cities >= 25 #regional power
            any_owned_province = {
                    OR = {
                        is_in_area = thessaly_area
                    }
                }
            NOT = {
                tag = THL
            }
            NOT = {
                tag = EPI
            }
            NOT = {
                tag = SPA
            }
            NOT = {
                tag = MAC
            }   
            NOT = {
                has_variable = restored_thessalian_league
            }         
        }

        highlight = {
            scope:province = { is_in_area = thessaly_area }
        }

        allow = {
            custom_tooltip = {
                text = thessalian_league_not_exists
                NOT = {
                    any_country = {
                        num_of_cities >= 1
                        tag = THL
                    }
                }
            }
            owns_or_subject_owns_area = thessaly_area
        }
        
        effect = {
            custom_tooltip = thessalian_league_tooltip
            trigger_event = {
                id = thessalian_league_0.1
            }
            current_ruler = {
                add_trait = equestrian
            }
            add_country_modifier = {
                name = mac_archon
                duration = 3650
            }               
            set_variable = {
                name = restored_thessalian_league                        
                }    
            }
        ai_will_do = {
            base = 1000
            }
        }
        
 # Form the Thessalian League
    form_thessalian_league = {
        potential = {
            OR = {
                primary_culture = euboean
                primary_culture = aetolian
                primary_culture = thessalian
                 AND = {
                     capital_scope = {
                         is_in_area = thessaly_area
                     }
                     num_of_cities <= 15
                 }
            }            
            NOR = {
                tag = THL
                tag = MAC
            }
            NOR = {
                is_tier_2_formable_trigger = yes
                is_endgame_tag_trigger = yes
            }            
        }
        highlight = {
            scope:province = {
                OR = {
                    province_id = 390 #Pherai
                    province_id = 389 #Larissa
                    province_id = 394 #Pharsalos
                }
            }
        }
        
        allow = {
            custom_tooltip = {
                text = thessalian_league_not_exists
                NOT = {
                    any_country = {
                        num_of_cities >= 1
                        tag = THL
                    }
                }
            }
            can_form_nation_trigger = yes
             if = {
                limit = { is_ai = no }
                custom_tooltip = {
                    any_country_culture = {
                        is_culture = thessalian
                        has_pop_type_right = nobles
                    }               
                    text = caria_citizen_nobles_tooltip
                } 
            }
            owns_or_subject_owns = 390 #Pherai
            owns_or_subject_owns = 389 #Larissa
            owns_or_subject_owns = 394 #Pharsalos         
        }        
        highlight = {
            scope:province = {
                OR = {
                    province_id = 390 #Pherai
                    province_id = 389 #Larissa
                    province_id = 394 #Pharsalos
                }
            }
        }
        
        effect = {
            custom_tooltip = "tier_1_formable_tooltip"
            change_country_name = THESSALIAN_LEAGUE
            hidden_effect = {
                change_country_adjective = THESSALY_ADJECTIVE
                change_country_tag = THL
                change_country_color = thessalian_color
                change_country_flag = THESSALY_FLAG
                set_country_heritage = thessalian_league_heritage              
            }
            custom_tooltip = thessalian_culture_tooltip
                hidden_effect = {
                while = {
                   count = 25
                   random_pops_in_province = {
                       limit = {
                           OR = {
                               pop_type = nobles
                               pop_type = citizen
                               pop_type = freemen
                           }
                            NOT = { pop_culture = thessalian }
                       }
                            set_pop_culture = thessalian
                   }
                }
            }    
            custom_tooltip = thessalian_character_culture_tooltip
                if = {
                    limit = {
                        NOT = { primary_culture = thessalian }
                    }
                    set_primary_culture_cleanup_effect = {
                        NEW_PRIMARY_CULTURE = thessalian
                        MAKE_OLD_CULTURE_INTEGRATED = yes
                    }
                }
                current_ruler = {
                add_trait = equestrian
                    if = {
                        limit = {
                            NOT = { has_culture = thessalian }
                        }
                        set_culture = thessalian
                    }
                }
                hidden_effect = {
                    current_ruler.family = {
                        every_family_member = {
                            limit = {
                                employer = ROOT
                                NOT = { has_culture = thessalian }
                            }
                            set_culture = thessalian
                        }
                    }
                ordered_character = {
                    limit = {
                        loyalty >= 50
                        NOT = { has_culture = thessalian }
                        is_ruler = no
                        from_ruler_family = no
                    }
                    max = 10
                    order_by = prominence
                    set_culture = thessalian
                }
            }               
                area:thessaly_area = {
                    every_area_province = {
                        limit = {
                            owner = { 
                                is_ai = yes
                                num_of_cities < 6
                            }
                        }
                        set_owned_by = root
                    }
                }
            capital_scope = {
                capital_formable_medium_effect = yes
                formable_capital_modifier_normal_effect = yes
            }
            add_2_free_province_investments = yes
        }
        
        ai_will_do = {
            base = 1000
        }
    }
}    