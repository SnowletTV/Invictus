namespace = alis_ubbo_intro

alis_ubbo_intro.1 = { #tagswitch event as Carthage
	
	type = country_event
	title = "alis_ubbo_intro.1.t"
	desc = "alis_ubbo_intro.1.desc"
	picture = alis_ubbo_punic_ship_city

	trigger = {
		is_ai = no
		NOT = {
			has_global_variable = alis_ubbo_created
		}
	}

	immediate = {
		set_global_variable = alis_ubbo_created
		p:1319 = {
			add_to_list = new_country_province_list
		}
	}

	option = {
		name = alis_ubbo_intro.1.a
		ai_chance = {
			base = 100
		}
		custom_tooltip = alis_ubbo_intro_01_release_as_subject_tt
		hidden_effect = {
			p:1319 = {
				create_country = {
					name = {
						name = "OLS"
						adjective = "OLS_ADJ"
					}
					change_country_tag = OLS
					change_country_flag = OLS
					change_country_color = alis_ubbo_color
					if = {
						limit = {
							NOT = {
								primary_culture = carthaginian
							}
						}
						set_primary_culture_cleanup_effect = {
							NEW_PRIMARY_CULTURE = carthaginian
							MAKE_OLD_CULTURE_INTEGRATED = yes
						}
					}
					set_country_religion = carthaginian_pantheon
					change_government = plutocratic_monarchy
					add_treasury = 50.0
					save_scope_as = allis_ubbo_scope
				}
			}
			make_subject = {
				target = scope:allis_ubbo_scope
				type = feudatory
			}
		}
	}

	option = {
		name = alis_ubbo_intro.1.b
		custom_tooltip = alis_ubbo_intro.1.bt
		trigger = {
			is_ai = no
		}
		ai_chance = {
			base = 0
		}
		switch_player_country_effect = { # Switch to Allis Ubbo
            NEW_NAME = OLS
            NEW_ADJECTIVE = OLS_ADJ
            NEW_GOVERNMENT = plutocratic_monarchy
            NEW_COLOR = alis_ubbo_color 
            NEW_RELIGION = carthaginian_pantheon
            NEW_CULTURE = carthaginian
            NEW_FLAG = OLS
            NEW_TAG = OLS
            NEW_HERITAGE = allis_ubbo_heritage
            OLD_COUNTRY_COLOR = carthage_color
            OLD_COUNTRY_NAME = CAR
            OLD_COUNTRY_ADJ = CAR_ADJ
            OLD_COUNTRY_FLAG = CAR
            OLD_COUNTRY_HERITAGE = carthaginian_heritage
            OLD_COUNTRY_CULTURE = carthaginian
            OLD_COUNTRY_RELIGION = carthaginian_pantheon
            OLD_TAG = CAR
        }
	}
}

alis_ubbo_intro.4 = { #hidden event
	type = country_event
	hidden = yes

	trigger = {
		NOT = {
			has_global_variable = alis_ubbo_created
		}
		p:1319.owner = {
			OR = {
				country_culture_group = celt_iberia
				country_culture_group = iberia
			}
		}
	}

	immediate = {
		p:1319.owner = { save_scope_as = alis_ubbo_tribe }
		p:1319.owner = {
			trigger_event = {
				id = alis_ubbo_intro.2
			}
		}
	}
}

alis_ubbo_intro.2 = { #Punic Purchase
	type = country_event
	title = "alis_ubbo_intro.2.t"
	desc = "alis_ubbo_intro.2.desc"
	picture = alis_ubbo_punic_ship_city
    left_portrait = current_ruler
    right_portrait = scope:alis_ubbo_punic.current_ruler

	trigger = {
		OR = {
			country_culture_group = celt_iberia
			country_culture_group = iberia
		}
	}

	immediate = {
		random_country = {
			limit = {
				primary_culture = carthaginian
				is_subject = no
			}
			save_scope_as = alis_ubbo_punic
		}
	}

	option = {
		name = alis_ubbo_intro.2.a
		custom_tooltip = alis_ubbo_intro.2.at		
		add_treasury = 50.0
		hidden_effect = {
		    p:1319 = {
				establish_city_effect = yes
	            define_pop = {
	                type = nobles
	                culture = carthaginian
	                religion = carthaginian_pantheon
	            }
	            define_pop = {
	                type = nobles
	                culture = carthaginian
	                religion = carthaginian_pantheon
	            }
	            define_pop = {
	                type = citizen
	                culture = carthaginian
	                religion = carthaginian_pantheon
	            }
	            define_pop = {
	                type = citizen
	                culture = carthaginian
	                religion = carthaginian_pantheon
	            } 
			}	
		}	
		scope:alis_ubbo_punic = {
			trigger_event = {
				id = alis_ubbo_intro.3
			}
		}
		ai_chance = {
			factor = 90
		}
	}

	option = {
		name = alis_ubbo_intro.2.b
		custom_tooltip = alis_ubbo_intro.2.bt
		ai_chance = {
			factor = 10
		}		
	}
}

alis_ubbo_intro.3 = { #Alis Ubbo
	type = country_event
	title = "alis_ubbo_intro.3.t"
	desc = "alis_ubbo_intro.3.desc"
	picture = alis_ubbo_punic_ship_city
    left_portrait = current_ruler
    right_portrait = scope:alis_ubbo_tribe.current_ruler

	option = {
		name = alis_ubbo_intro.3.a
		custom_tooltip = alis_ubbo_intro.3.at		
		set_global_variable = alis_ubbo_created
		add_treasury = -50.0
		hidden_effect = {
			p:1319 = {
				create_country = {
					name = {
						name = "OLS"
						adjective = "OLS_ADJ"
					}
					change_country_tag = OLS
					change_country_flag = OLS
					change_country_color = alis_ubbo_color
					set_country_heritage = punic_heritage
					set_country_religion = carthaginian_pantheon					
					capital_scope = {
						change_province_name = "'Alitz 'Oppon"				
					}					
					if = {
						limit = {
							NOT = {
								primary_culture = carthaginian
							}
						}
						set_primary_culture_cleanup_effect = {
							NEW_PRIMARY_CULTURE = carthaginian
							MAKE_OLD_CULTURE_INTEGRATED = yes
						}
					}
	                every_character = {
	                    limit = {
	                        NOT = { has_culture = carthaginian }
	                    }
	                    set_culture = carthaginian
						set_character_religion = carthaginian_pantheon
	                }					
					set_country_religion = carthaginian_pantheon
					change_government = plutocratic_monarchy
					add_treasury = 50.0
					save_scope_as = allis_ubbo_country
				}
			}
			scope:alis_ubbo_tribe = {
				add_truce = {
					target = scope:allis_ubbo_country
					duration = 3650	#10 years
				}
				add_truce = {
					target = scope:alis_ubbo_punic
					duration = 3650	#10 years
				}				
			}
			make_subject = {
				target = scope:allis_ubbo_country
				type = tributary
			}
		}
		ai_chance = {
			factor = 60
		}
	}

	option = {
		name = alis_ubbo_intro.3.b
		custom_tooltip = alis_ubbo_intro.3.bt
		ai_chance = {
			factor = 40
		}		
	}

	option = {
		name = alis_ubbo_intro.3.c
		custom_tooltip = alis_ubbo_intro.3.ct
		trigger = {
			is_ai = no
			tag = CAR
		}
		set_global_variable = alis_ubbo_created
		switch_player_country_effect = { # may not work
            NEW_NAME = OLS
            NEW_ADJECTIVE = OLS_ADJ
            NEW_GOVERNMENT = plutocratic_monarchy
            NEW_COLOR = alis_ubbo_color 
            NEW_RELIGION = carthaginian_pantheon
            NEW_CULTURE = carthaginian
            NEW_FLAG = OLS
            NEW_TAG = OLS
            NEW_HERITAGE = allis_ubbo_heritage
            OLD_COUNTRY_COLOR = carthage_color
            OLD_COUNTRY_NAME = CAR
            OLD_COUNTRY_ADJ = CAR_ADJ
            OLD_COUNTRY_FLAG = CAR
            OLD_COUNTRY_HERITAGE = carthaginian_heritage
            OLD_COUNTRY_CULTURE = carthaginian
            OLD_COUNTRY_RELIGION = carthaginian_pantheon
            OLD_TAG = CAR
        }
		ai_chance = {
			factor = 0
		}		
	}
}