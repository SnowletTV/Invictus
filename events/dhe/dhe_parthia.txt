namespace = dhe_parthians

# Rise of Arsaces
dhe_parthians.1 = {
	type = country_event
	title = "dhe_parthians.1.t"
	desc = "dhe_parthians.1.desc"
	picture = steppe_cavalry
	
	left_portrait = current_ruler
	right_portrait = scope:arsaces_character

	trigger = {
		NOT = { has_global_variable = arsaces_is_here }
	}

	immediate = {
		set_global_variable = arsaces_is_here
		hidden_effect = {
			create_character = {
				culture = derbiccan
				religion = indo_iranian_religion
				age = 25
				first_name = "Arsaces"
				family_name = "Arsacid"
				save_scope_as = arsaces_character
				force_add_trait = tactician
				force_add_trait = disciplined
				force_add_trait = arsaces
				add_martial = 5
				add_charisma = 1
			}
			trigger_event = { ##Give Offsprings Traits
				id = bloodlines_setup_completion.1
			}
			new_family_generation_effect = { FAMILY_CANDIDATE = arsaces_character } #Scripted Effect that passes on the saved scope.
		}
	}

	option = {
		name = "dhe_parthians.1.a"
		set_as_ruler = scope:arsaces_character
		hidden_effect = {
			scope:arsaces_character = {
				add_gold = 900
			}
		}
		add_country_modifier = {
			name = rise_of_arsaces_cmod
			duration = 9125
		}
	}
}

#new dahae belligerency disaster thingy

dhe_parthians.2001 = {#mirrored dhe_diadochi.100 for other countries
	type = country_event
	title = "dhe_parthians.2000.t"
	desc = "dhe_parthians.2000.desc"
	
	picture = steppe_cavalry
	
	left_portrait = root.current_ruler
	right_portrait = p:1595.owner.current_ruler
	
	fire_only_once = yes
	
	immediate = {
		set_global_variable = triggered_parthian_horde
	}
	
	option = {
		name = dhe_parthians.2000.a
		custom_tooltip = dhe_parthians.2000.tt
		trigger = {
			NOT = {
				any_owned_province = {
					OR = {
						province_id = 1595
						province_id = 3435
					}
				}
			}
		}
	}
	option = {
		name = dhe_parthians.2000.b
		custom_tooltip = dhe_parthians.2000.tt
		trigger = {
			any_owned_province = {
				OR = {
					province_id = 1595
					province_id = 3435
				}
			}
		}
	}
}

dhe_parthians.2 = {
	type = province_event
	hidden = yes

	immediate = {
		p:3435 = {
			set_variable = {
				name = dahae_belligerency_var2
				value = dahae_belligerency_svalue3
			}
		}
		p:3435 = {
			set_variable = {
				name = dahae_belligerency_var3
				value = dahae_belligerency_svalue4
			}
		}
		if = {
			limit = {
				var:dahae_belligerency_var < 10000
				NOT = { has_global_variable = triggered_parthian_horde2 }
			}
			change_variable = {
				name = dahae_belligerency_var
				add = 10
			}
			change_variable = {
				name = dahae_belligerency_var
				add = var:dahae_belligerency_var2
			}
			change_variable = {
				name = dahae_belligerency_var
				add = var:dahae_belligerency_var3
			}
			if = {
				limit = {
					c:PAR = {
						has_land = yes
						is_subject = no
					}
				}
				change_variable = {
					name = dahae_belligerency_var
					add = 100
				}
			}
		}
		if = {
			limit = {
				var:dahae_belligerency_var < 10000
				NOT = { has_global_variable = triggered_parthian_horde2 }
			}
			trigger_event = {
				id = dhe_parthians.2
				days = 30
			}		
		}
		if = {
			limit = { var:dahae_belligerency_var >= 10000 }
			if = {
				limit = {
					any_country = {
						OR = {
							tag = SCA
							tag = PRN
							tag = ZNT
							tag = PSS
							tag = DHE
							tag = SA4						
						}
					}
				}
				ordered_country = {
					limit = {
						OR = {
							tag = SCA
							tag = PRN
							tag = ZNT
							tag = PSS
							tag = DHE
							tag = SA4						
						}
					}
					order_by = {
						every_owned_province = {
							limit = { owner = root }
							add = 1
						}
						every_subject = {
							every_owned_province = {
								add = 1
							}	
						}					
					}
					max = 1
					save_scope_as = target
					hidden_effect = {
						if = {
							limit = { is_ai = yes }
							region:sakia_region = {
								every_region_province = {
									limit = {
										owner = { 
											is_ai = yes
											is_subject_of = scope:target
										}
									}
									set_owned_by = scope:target
								}
							}
							region:parthia_region = {
								every_region_province = {
									limit = {
										owner = { 
											is_ai = yes
											is_subject_of = scope:target
										}
									}
									set_owned_by = scope:target
								}
							}
						}
					}
				}
			}
			else = {
				p:6657 = {
					create_country = {
						save_scope_as = target
						change_government = tribal_chiefdom	
						hidden_effect = {
							change_country_name = "DAHAE_NAME"
							change_country_adjective = "DAHAE_ADJECTIVE"
							change_country_color = "dahae_color"
							change_country_tag = DHE
							change_country_flag = DAHAE_FLAG
							if = {
								limit = {
									NOT = {
										primary_culture = derbiccan
									}
								}
								set_primary_culture_cleanup_effect = {
									NEW_PRIMARY_CULTURE = derbiccan
									MAKE_OLD_CULTURE_INTEGRATED = no
								}
							}
						}
					}					
				}
				every_province = {
					limit = {
						has_owner = yes
						OR = {
							dominant_province_culture = derbiccan
							is_in_area = dahaea_area
							is_in_area = parnia_area
							is_in_area = derbicca_area
							province_id = 6660
							province_id = 6776
							province_id = 6725
						}
					}
					set_owned_by = scope:target
				}
			}
			p:1595.owner = {
				save_scope_as = origin
				current_ruler = {
					save_scope_as = sel_rul
				}	
			}
			scope:target = {
				trigger_event = {
					id = dhe_parthians.3
					days = 1
				}
			}
		}
	}
}

dhe_parthians.3 = {#NS
	type = country_event
	title = "diadochi_flavor.100.t"
	desc = "diadochi_flavor.100.desc"
	
	picture = steppe_cavalry
	
	left_portrait = root.current_ruler
	right_portrait = scope:origin.current_ruler
	
	immediate = {
		set_global_variable = triggered_parthian_horde2	
	}
	
	option = {
		name = "diadochi_flavor.100.a"
		add_manpower = 20
		if = {
			limit = { 
				is_ai = yes 
			}
			every_province = {
				limit = {
					has_owner = yes
					owner = { 
						OR = {
							THIS = scope:origin
							is_subject_of = scope:origin
						}
						NOT = { THIS = c:PAR }
					}
					OR = {
						is_in_area = parthia_area
						province_id = 6664
						province_id = 7222
						province_id = 6556
						province_id = 6545
						province_id = 6663
						province_id = 6543
						province_id = 6542
						province_id = 6544
						province_id = 3464
						province_id = 3466
						province_id = 3465
						province_id = 3462
						province_id = 3451
						province_id = 3444
						province_id = 3467
						province_id = 3468
						province_id = 3469
						province_id = 3449
						province_id = 3455
						province_id = 3440
						province_id = 3438
						province_id = 3437
						province_id = 3436
						province_id = 3435
					}
				}
				set_owned_by = ROOT
			}
			if = { 
				limit = { 
					c:PAR = { 
						exists = no
						has_land = no 
					}
				}
				hidden_effect = {
					change_country_name = "PARTHIA_NAME"
					change_country_flag = PARTHIA_FORMABLE_FLAG_INV		#new flag
					every_character = {
						limit = {
							from_ruler_family = yes
						}
						set_culture = parthian
					}				
				}
				if = {
					limit = {
						NOT = {
							primary_culture = parthian
						}
					}
					set_primary_culture_cleanup_effect = {
						NEW_PRIMARY_CULTURE = parthian
						MAKE_OLD_CULTURE_INTEGRATED = yes
					}
				}
				if = {
					limit = {
						NOT = {
							capital_scope = {
								province_id = 6657
							}
						}
					}
					set_capital = 6657
					hidden_effect = {
						p:6657.state = {
							set_state_capital = 6657
						}
					}
					capital_scope = {
						establish_city_effect = yes
					}
				}
				capital_scope = {
					formable_capital_modifier_normal_effect = yes
				}
				hidden_effect = {
					change_country_adjective = "PARTHIA_ADJECTIVE"
					change_country_color =  "parthia_color"
					change_country_tag = PTH
					set_variable = scythian_traditions
				}
				add_research = {
					technology = military_tech
					value = 100
				}
				add_research = {
					technology = civic_tech
					value = 100
				}
				add_research = {
					technology = oratory_tech
					value = 100
				}
				add_research = {
					technology = religious_tech
					value = 100
				}
				if = {
					limit = { is_tribal = yes }
					change_government = despotic_monarchy
					switch_government_type_event_clearup_effect = yes
				}
				change_law = recruit_from_nobles
				add_3_free_province_investments = yes
				if = {
					limit = {
						is_ai = yes
						is_antagonist = no
					}
					set_antagonist = yes
				}
				if = {
					limit = {
						is_ai = yes
					}
					add_country_modifier = {
						name = parthian_death_lasers
						duration = 3650
					}
					add_treasury = 750
					add_manpower = 20
					create_unit = {
						navy = no
						location = p:6657
						while = {
							count = 6
							add_subunit = light_infantry
						}
						while = {
							count = 15
							add_subunit = horse_archers
						}
						while = {
							count = 5
							add_subunit = light_cavalry
						}                                                    
						add_food = 100
						add_morale = 2
					}
					create_unit = {
						navy = no
						location = p:6812
						while = {
							count = 6
							add_subunit = light_infantry
						}
						while = {
							count = 10
							add_subunit = horse_archers
						}
						while = {
							count = 3
							add_subunit = light_cavalry
						}                                                    
						add_food = 100
						add_morale = 2
					}			
				}
				trigger_event = me_parthia.7
				declare_war_with_wargoal = {
					war_goal = horde_conquest
					target = scope:origin
				}
			}
			scope:origin = {
				if = {
					limit = {
						is_ai = yes
					}
					add_manpower = -15
					add_stability = -10
					add_country_modifier = {
						name = parthian_attack_lasers
						duration = 3650
					}
					every_subject = { 
						limit = { is_ai = yes }
						add_stability = -10
						add_manpower = -10
						add_country_modifier = {
							name = parthian_attack_lasers
							duration = 3650
						}
					}
				}				
			}
		}
		if = {
			limit = {
				c:PAR = { 
					exists = yes
					has_land = yes 
				}
			}
			c:PAR = {
				trigger_event = dhe_parthians.4
			}
		}
		every_country = {
			limit = {
				NOT = {
					this = root
					this = c:PAR
				}
			}
			trigger_event = {
				id = dhe_parthians.300
			}
		}
	}
	
	option = {
		name = "diadochi_flavor.100.b"
		current_ruler = {
			add_popularity = -25
		}
		
		ai_chance = {
			factor = 0
		}
	}
	after = {
		if = {
			limit = {
				c:BAC = { 
					has_land = yes 
					has_subject_loyalty <= 33
				}
			}
			c:BAC = {
				trigger_event = {
					id = me_parthia.11
					days = { 7 14 }
				}
			}
			c:PRM = {
				trigger_event = {
					id = me_parthia.14
					days = { 7 14 }
				}
			}	
		}	
	}
}

dhe_parthians.4 = {
	type = country_event
	title = "dhe_parthians.4.t"
	desc = "dhe_parthians.4.desc"
	picture = steppe_cavalry
	
	immediate = {
		set_variable = {
			name = par_treasury
			value = ROOT.treasury
		}		
	}
	
	option = {
		name = dhe_parthians.4.a
		custom_tooltip = dhe_parthians.4.tt1
		trigger = {
			is_ai = no
		}
		hidden_effect = {
			set_player_country = scope:target
		}
		set_country_heritage = arsacid_dahae_heritage
		scope:target = {
			hidden_effect = {
				set_variable = pth_from_situation_var
				add_treasury = c:PAR.var:par_treasury
				every_province = {
					limit = {
						has_owner = yes
						owner = c:PAR
					}
					set_owned_by = scope:target
				}
				change_country_name = "PARTHIA_NAME"
				change_country_flag = PARTHIA_FORMABLE_FLAG_INV		#new flag
				every_character = {
					limit = {
						from_ruler_family = yes
					}
					set_culture = parthian
				}	
				if = {
					limit = {
						NOT = {
							primary_culture = parthian
						}
					}
					set_primary_culture_cleanup_effect = {
						NEW_PRIMARY_CULTURE = parthian
						MAKE_OLD_CULTURE_INTEGRATED = yes
					}
				}
				if = {
					limit = {
						NOT = {
							capital_scope = {
								province_id = 6657
							}
						}
					}
					set_capital = 6657
					hidden_effect = {
						p:6657.state = {
							set_state_capital = 6657
						}
					}
					capital_scope = {
						establish_city_effect = yes
					}
				}
				capital_scope = {
					formable_capital_modifier_normal_effect = yes
				}
				hidden_effect = {
					change_country_adjective = "PARTHIA_ADJECTIVE"
					change_country_color =  "parthia_color"
					change_country_tag = PTH
					set_variable = scythian_traditions
				}
				add_research = {
					technology = military_tech
					value = 100
				}
					add_research = {
					technology = civic_tech
					value = 100
				}
				add_research = {
					technology = oratory_tech
					value = 100
				}
				add_research = {
					technology = religious_tech
					value = 100
				}
				if = {
					limit = { is_tribal = yes }
					change_government = despotic_monarchy
					switch_government_type_event_clearup_effect = yes
				}
				change_law = recruit_from_nobles
				add_3_free_province_investments = yes
				trigger_event = me_parthia.7
				trigger_event = me_parthia.9				
			}
		}
	}
	
	option = {
		name = dhe_parthians.4.b
		custom_tooltip = dhe_parthians.4.tt2
		trigger = {
			is_ai = no
			has_variable = par_not_pth_var
		}
		add_stability = 25
		scope:target = {
			declare_war_with_wargoal = {
				war_goal = horde_conquest
				target = scope:origin
			}			
		}
		if = {
			limit = {
				is_subject = no
			}
			scope:target = {
				declare_war_with_wargoal = {
					war_goal = horde_conquest
					target = ROOT
				}
			}
		}
	}
	
	option = {
		name = dhe_parthians.4.a
		trigger = {
			is_ai = yes
		}
		scope:target = {
			hidden_effect = {
				every_province = {
					limit = {
						has_owner = yes
						owner = c:PAR
					}
					set_owned_by = scope:target
				}
				change_country_name = "PARTHIA_NAME"
				change_country_flag = PARTHIA_FORMABLE_FLAG_INV		#new flag
				every_character = {
					limit = {
						from_ruler_family = yes
					}
					set_culture = parthian
				}				
			}
			if = {
				limit = {
					NOT = {
						primary_culture = parthian
					}
				}
				set_primary_culture_cleanup_effect = {
					NEW_PRIMARY_CULTURE = parthian
					MAKE_OLD_CULTURE_INTEGRATED = yes
				}
			}
			if = {
				limit = {
					NOT = {
						capital_scope = {
							province_id = 6657
						}
					}
				}
				set_capital = 6657
				hidden_effect = {
					p:6657.state = {
						set_state_capital = 6657
					}
				}
				capital_scope = {
					establish_city_effect = yes
				}
			}
			capital_scope = {
				formable_capital_modifier_normal_effect = yes
			}
			hidden_effect = {
				change_country_adjective = "PARTHIA_ADJECTIVE"
				change_country_color =  "parthia_color"
				change_country_tag = PTH
				set_variable = scythian_traditions
			}
			add_research = {
				technology = military_tech
				value = 100
			}
				add_research = {
				technology = civic_tech
				value = 100
			}
			add_research = {
				technology = oratory_tech
				value = 100
			}
			add_research = {
				technology = religious_tech
				value = 100
			}
			if = {
				limit = { is_tribal = yes }
				change_government = despotic_monarchy
				switch_government_type_event_clearup_effect = yes
			}
			change_law = recruit_from_nobles
			add_3_free_province_investments = yes
		}
		if = {
			limit = {
				is_ai = yes
				is_antagonist = no
			}
			set_antagonist = yes
		}
		if = {
			limit = {
				is_ai = yes
			}
			add_country_modifier = {
				name = parthian_death_lasers
				duration = 3650
			}
			add_treasury = 750
			add_manpower = 20
			create_unit = {
				navy = no
				location = p:6657
				while = {
					count = 6
					add_subunit = light_infantry
				}
				while = {
					count = 15
					add_subunit = horse_archers
				}
				while = {
					count = 5
					add_subunit = light_cavalry
				}                                                    
				add_food = 100
				add_morale = 2
			}
			create_unit = {
				navy = no
				location = p:6812
				while = {
					count = 6
					add_subunit = light_infantry
				}
				while = {
					count = 10
					add_subunit = horse_archers
				}
				while = {
					count = 3
					add_subunit = light_cavalry
				}                                                    
				add_food = 100
				add_morale = 2
			}
			trigger_event = me_parthia.7
			declare_war_with_wargoal = {
				war_goal = horde_conquest
				target = scope:origin
			}			
		}
	}
}

dhe_parthians.5 = {#avoided dahae invasion
	type = country_event
	title = "dhe_parthians.5.t"
	desc = "dhe_parthians.5.desc"
	picture = steppe_cavalry
	
	option = {
		name = dhe_parthians.5.a
		custom_tooltip = dhe_parthians.5.tt
		set_global_variable = triggered_parthian_horde2
		if = {
			limit = {
				any_owned_province = {
					OR = {
						is_in_region = parthia_region
						is_in_region = mesopotamia_region
						is_in_region = media_region
						is_in_region = persis_region
						is_in_region = ariana_region
						is_in_region = bactriana_region
						is_in_region = sakia_region
					}					
				}
			}
			add_stability = 15
		}
	}	
}

dhe_parthians.6 = {#TODO DELETE
	type = country_event
	title = "dhe_parthians.5.t"
	desc = "dhe_parthians.6.desc"
	picture = steppe_cavalry
	
	option = {
		name = dhe_parthians.5.a
		p:3435 = {
			set_variable = {
				name = dahae_belligerency_var
				value = 9990
			}
#			trigger_event = dhe_parthians.2
		}
	}
	
	option = {
		name = dhe_parthians.5.a
		add_treasury = dahae_belligerency_svalue1
	}
	
	option = {
		name = dhe_parthians.5.a
		c:PSS = {
			trigger_event = dhe_bactria.5
		}
	}	
}