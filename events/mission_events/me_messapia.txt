namespace = me_messapia

me_messapia.1 = { # deal with war mission task
    type = country_event

    title = me_messapia_1_title
    desc = me_messapia_1_desc
    picture = interesting_histories_hellenic_city_rebuild

    option = {
        name = "me_messapia_1.a"
        custom_tooltip = me_messapia_1_tooltip
        if = {
            limit = {
                has_global_variable = lucania_lost_war # you win
            }
            add_stability = 5
            current_ruler = { # took the right decisions
                add_martial = 1
                add_charisma = 1
                add_popularity = 25
                add_character_experience = 8
                add_gold = 500
            }
            current_heir = { # heir learns new stuff
                add_martial = 1
                add_charisma = 1
                add_popularity = 25
                add_character_experience = 3
            }
        }
        if = {
            limit = {
                has_global_variable = tarentum_lost_war # you lose
            }
            # to recoup some of the losses
            add_country_modifier = {
                name = recovering_from_war_303
                duration = 3650 # 10 years
            }
            current_ruler = {
                add_popularity = -10
                add_trait = cautious
            }
        }
    }
}
me_messapia.200 = {
    type = country_event

    title = me_messapia_200_title
    desc = me_messapia_200_desc
    picture = celtic_chiefs

    option = {
        name = "me_messapia_200.a"
        custom_tooltip = messapia_marriage_good_tt
    }
    option = {
        trigger = { is_ai = no }
        name = "me_messapia_200.b"
        set_variable = we_say_no_messapia_var
        custom_tooltip = messapia_alliance_break_tt
    }
}
me_messapia.2 = {
    type = country_event

    title = me_messapia_2_title
    desc = me_messapia_2_desc
    picture = epirote_phalanx

    option = {
        name = "me_messapia_2.a"
        custom_tooltip = me_messapia_2_tooltip
        c:EPI = {
            random_character = {
                limit = {
                    NOT = { this = c:EPI.current_ruler.spouse }
                    has_trait = aeacidae
                    is_female = yes
                    age <= 28
                    age > 15
                }
                if = {
                    limit = { is_married = yes }
                    divorce_character = spouse
                }
                save_scope_as = marriage_partner
            }
        }
        current_ruler = {
            if = {
                limit = { is_married = yes }
                divorce_character = spouse
            }
            marry_character = scope:marriage_partner
        }
    }
    option = {
        exclusive = yes
        trigger = {
            c:EPI = {
                has_variable = we_say_no_messapia_var
            }
        }
        name = "me_messapia_2.b"
        add_opinion = {
            target = EPI
            modifier = broken_promise
        }
        custom_tooltip = me_messapia_2_tooltip
    }
}
me_messapia.3 = {
    type = country_event

    title = me_messapia_3_title
    desc = me_messapia_3_desc
    picture = interesting_histories_generic_market

    option = {
        name = "me_messapia_3.a"
        custom_tooltip = me_messapia_3_tooltip
        custom_tooltip = assimilate_pops_messapia_tt
        hidden_effect = {
            while = {
                count = 15
                random_owned_province = {
                    random_pops_in_province = {
                        limit = {
                            NOT = { pop_culture = ROOT.culture }
                        }
                        set_pop_culture = ROOT.culture
                    }
                }
            }
        }
        mission_claim_region_effect = { REGION = magna_graecia_region }
    }
}
me_messapia.4 = {
    type = country_event

    title = me_messapia_4_title
    desc = me_messapia_4_desc
    picture = interesting_histories_italic_hilltop

    option = {
        name = "me_messapia_4.a"
        custom_tooltip = me_messapia_4_tooltip
        add_political_influence = 50
        mission_claim_region_effect = { REGION = central_italy_region }
    }
}
me_messapia.5 = {
    type = country_event

    title = me_messapia_5_title
    desc = me_messapia_5_desc
    picture = interesting_histories_hellenic_dock

    option = {
        name = "me_messapia_5.a"
        custom_tooltip = me_messapia_5_tooltip
        mission_claim_region_effect = { REGION = greece_region }
        mission_claim_region_effect = { REGION = illyria_region }
    }
}
me_messapia.6 = {
    type = country_event

    title = me_messapia_6_title
    desc = me_messapia_6_desc
    picture = great_library

    option = {
        name = "me_messapia_6.a"
        custom_tooltip = me_messapia_6_tooltip
        add_research = {
            technology = military_tech
            value = 15
        }
        add_research = {
            technology = civic_tech
            value = 15
        }
        add_research = {
            technology = oratory_tech
            value = 15
        }
        add_research = {
            technology = religious_tech
            value = 15
        }
    }
}
me_messapia.7 = {
    type = country_event

    title = me_messapia_7_title
    desc = me_messapia_7_desc
    picture = council_country

    option = {
        name = "me_messapia_7.a"
        custom_tooltip = me_messapia_7_tooltip
        add_political_influence = -50
        add_country_modifier = {
            name = laws_and_litigations
            duration = 9125 #25 years
        }
    }
}
me_messapia.8 = {
    type = country_event

    title = me_messapia_8_title
    desc = me_messapia_8_desc
    picture = hellenic_marketplace

    option = { # grant them citizen rights
        name = "me_messapia_8.a"
        custom_tooltip = me_messapia_8_tooltip
        add_political_influence = 50
        ordered_country_culture = {
            limit = {
                culture.culture_group = culture_group:hellenic
                is_integrated = no
            }
            order_by = country_culture_pop_count
            set_country_culture_right = citizen
        }
        set_variable = mes_integrated_hellenes_var
    }

    option = { # enslave them all
        name = "me_messapia_8.b"
        custom_tooltip = me_messapia_8_tooltip
        custom_tooltip = mes_enslaved_hellenic_tt
        hidden_effect = {
            every_country_culture = {
                limit = {
                    culture.culture_group = culture_group:hellenic
                }
                set_country_culture_right = slaves
            }
        }
        add_treasury = 500
        set_variable = mes_enslaved_hellenes_var
    }
}
me_messapia.9 = {
    type = country_event

    title = me_messapia_9_title
    desc = me_messapia_9_desc
    picture = interesting_histories_italic_hilltop

    option = {
        name = "me_messapia_9.a"
        custom_tooltip = me_messapia_9_tooltip
        add_political_influence = 50
        ordered_country_culture = {
            limit = {
                culture.culture_group = culture_group:latin
                is_integrated = no
            }
            order_by = country_culture_pop_count
            set_country_culture_right = citizen
        }
        set_variable = mes_integrated_latins_var
    }

    option = {
        name = "me_messapia_9.b"
        custom_tooltip = me_messapia_9_tooltip
        custom_tooltip = mes_enslaved_latin_tt
        hidden_effect = {
            every_country_culture = {
                limit = {
                    culture.culture_group = culture_group:latin
                }
                set_country_culture_right = slaves
            }
        }
        add_treasury = 500
        set_variable = mes_enslaved_latins_var
    }
}
me_messapia.10 = {
    type = country_event

    title = me_messapia_10_title
    desc = me_messapia_10_desc
    picture = celtic_diplomacy

    option = {
        name = "me_messapia_10.a"
        custom_tooltip = me_messapia_10_tooltip
        add_political_influence = 50
        ordered_country_culture = {
            limit = {
                culture.culture_group = culture_group:illyrian_group
                NOT = {
                    is_integrated = yes
                }
                NOT = {
                    culture = culture:messapian
                }
            }
            order_by = country_culture_pop_count
            set_country_culture_right = citizen
        }
        set_variable = mes_integrated_trad_illyrians_var
    }

    option = {
        name = "me_messapia_10.b"
        custom_tooltip = me_messapia_10_tooltip
        custom_tooltip = mes_enslaved_illyrian_tt
        hidden_effect = {
            every_country_culture = {
                limit = {
                    culture.culture_group = culture_group:latin
                    NOT = {
                        culture = culture:messapian
                    }
                }
                set_country_culture_right = slaves
            }
        }
        add_treasury = 500
        set_variable = mes_enslaved_trad_illyrians_var
    }
}
me_messapia.11 = {
    type = country_event

    title = me_messapia_11_title
    desc = me_messapia_11_desc
    picture = celtic_religious_festival

    option = {
        name = "me_messapia_11.a"
        custom_tooltip = me_messapia_11_tooltip
        soft_change_religion_effect = {
            RELIGION = illyrian_pantheon
        }
        set_variable = wolf_cult_var
    }
}
me_messapia.12 = {
    type = country_event

    title = me_messapia_12_title
    desc = me_messapia_12_desc
    picture = greek_religious_rite

    option = {
        name = "me_messapia_12.a"
        custom_tooltip = me_messapia_12_tooltip
        add_country_modifier = {
            name = cult_of_zis
            duration = -1
        }
    }
}
me_messapia.13 = {
    type = country_event

    title = me_messapia_13_title
    desc = me_messapia_13_desc
    picture = religious_rite

    option = {
        name = "me_messapia_13.a"
        custom_tooltip = me_messapia_13_tooltip
        soft_change_religion_effect = {
            RELIGION = italic_pantheon
        }
    }
}
me_messapia.14 = {
    type = country_event

    title = me_messapia_14_title
    desc = me_messapia_14_desc
    picture = great_work_animals

    option = {
        name = "me_messapia_14.a"
        custom_tooltip = me_messapia_14_tooltip
        add_country_modifier = {
            name = messapian_religion
            duration = -1
        }
    }
}
me_messapia.15 = {
    type = country_event

    title = me_messapia_15_title
    desc = me_messapia_15_desc
    picture = religious_rite

    option = {
        name = "me_messapia_15.a"
        custom_tooltip = me_messapia_15_tooltip
        area:tarentum_area = {
            every_area_province = {
                spread_religion_in_province = {
                    RELIGION = roman_pantheon
                }
            }
        }
        area:cannae_area = {
            every_area_province = {
                spread_religion_in_province = {
                    RELIGION = roman_pantheon
                }
            }
        }
    }
    option = {
        name = "me_messapia_15.b"
        custom_tooltip = me_messapia_15_tooltip
        area:tarentum_area = {
            every_area_province = {
                spread_religion_in_province = {
                    RELIGION = italic_pantheon
                }
            }
        }
        area:cannae_area = {
            every_area_province = {
                spread_religion_in_province = {
                    RELIGION = italic_pantheon
                }
            }
        }
    }
    option = {
        name = "me_messapia_15.c"
        custom_tooltip = me_messapia_15_tooltip
        area:tarentum_area = {
            every_area_province = {
                spread_religion_in_province = {
                    RELIGION = illyrian_pantheon
                }
            }
        }
        area:cannae_area = {
            every_area_province = {
                spread_religion_in_province = {
                    RELIGION = illyrian_pantheon
                }
            }
        }
    }
}
me_messapia.16 = {
    type = country_event

    title = me_messapia_16_title
    desc = me_messapia_16_desc
    picture = interesting_histories_greek_port

    option = {
        name = "me_messapia_16.a"
        custom_tooltip = me_messapia_16_tooltip
        capital_scope = {
            add_permanent_province_modifier = {
                name = crossroads_of_adriatic
            }
        }
    }
}
me_messapia.17 = {
    type = country_event

    title = me_messapia_17_title
    desc = me_messapia_17_desc
    picture = diadochi_coronation

    option = {
        name = "me_messapia_17.a"
        custom_tooltip = me_messapia_17_tooltip
        ### Tells you who is integrated. if you are not integrated, then you got enslaved
        if = {
            limit = { # integrated all 3
                has_variable = mes_integrated_hellenes_var
                has_variable = mes_integrated_latins_var
                has_variable = mes_integrated_trad_illyrians_var
                any_country_culture = {
                    is_culture = athenian
                    is_integrated = yes
                }
            }
            change_government = athenian_republic
            add_country_modifier = {
                name = mes_gov_ath_cmod
                duration = -1
            }
        }
        else_if = {
            limit = { # integrated all 3
                has_variable = mes_integrated_hellenes_var
                has_variable = mes_integrated_latins_var
                has_variable = mes_integrated_trad_illyrians_var
            }
            change_government = democratic_republic
            add_country_modifier = {
                name = mes_gov_integrated_all_cmod
                duration = -1
            }
        }
        else_if = {
            limit = { # integrated hellenic and latin
                has_variable = mes_integrated_hellenes_var
                has_variable = mes_integrated_latins_var
                has_variable = mes_enslaved_trad_illyrians_var
            }
            change_government = plutocratic_republic
            add_country_modifier = {
                name = mes_gov_lat_hel_cmod
                duration = -1
            }
        }
        else_if = {
            limit = { # integrated hellenic and illyrian
                has_variable = mes_integrated_hellenes_var
                has_variable = mes_enslaved_latins_var
                has_variable = mes_integrated_trad_illyrians_var
            }
            change_government = theocratic_monarchy
            add_country_modifier = {
                name = mes_gov_hel_il_cmod
                duration = -1
            }
        }
        else_if = {
            limit = { # integrated latin and illyrian
                has_variable = mes_enslaved_hellenes_var
                has_variable = mes_integrated_latins_var
                has_variable = mes_integrated_trad_illyrians_var
            }
            change_government = theocratic_republic
            add_country_modifier = {
                name = mes_gov_lat_il_cmod
                duration = -1
            }
        }
        else_if = {
            limit = { # integrated latin
                has_variable = mes_enslaved_hellenes_var
                has_variable = mes_integrated_latins_var
                has_variable = mes_enslaved_trad_illyrians_var
            }
            change_government = aristocratic_republic
            add_country_modifier = {
                name = mes_gov_lat_cmod
                duration = -1
            }
        }
        else_if = {
            limit = { # integrated hellenic
                has_variable = mes_integrated_hellenes_var
                has_variable = mes_enslaved_latins_var
                has_variable = mes_enslaved_trad_illyrians_var
            }
            change_government = stratocratic_monarchy
            add_country_modifier = {
                name = mes_gov_hel_cmod
                duration = -1
            }
        }
        else_if = {
            limit = { # integrated illyrian
                has_variable = mes_enslaved_hellenes_var
                has_variable = mes_enslaved_latins_var
                has_variable = mes_integrated_trad_illyrians_var
            }
            change_government = oligarchic_republic
            add_country_modifier = {
                name = mes_gov_il_cmod
                duration = -1
            }
        }
        else_if = {
            limit = { # enslaved everyone
                has_variable = mes_enslaved_hellenes_var
                has_variable = mes_enslaved_latins_var
                has_variable = mes_enslaved_trad_illyrians_var
            }
            change_government = despotic_monarchy
            add_country_modifier = {
                name = mes_gov_enslaved_all_cmod
                duration = -1
            }
        }
    }
}
me_messapia.18 = {
    type = country_event

    title = me_messapia_18_title
    desc = me_messapia_18_desc
    picture = naval_battle

    option = {
        name = "me_messapia_18.a"
        custom_tooltip = me_messapia_18_tooltip
        add_stability = 10
        add_aggressive_expansion = -25
        random_owned_province = {
            limit = {
                num_of_port_building > 0 
            }
            owner = {
                create_unit = {
                    navy = yes
                    location = prev.prev
                    hidden_effect = {
                        add_subunit = tetrere
                        add_subunit = tetrere
                        add_subunit = tetrere
                        add_subunit = tetrere
                        add_subunit = hexere
                        add_subunit = hexere
                        add_subunit = hexere
                        add_subunit = hexere
                        add_subunit = octere # tbd if kept, I just added bcs it's neat to have
                    }
                }
            }
        }
    }
}
me_messapia.19 = {
    type = country_event

    title = me_messapia_19_title
    desc = me_messapia_19_desc
    picture = greek_siege

    option = {
        name = "me_messapia_19.a"
        custom_tooltip = me_messapia_19_tooltip
        custom_tooltip = access_greek_traditions_tt
        set_variable = persian_cap_greek_mil_trads_var # variable name is irrelevant
        mission_claim_region_effect = { REGION = macedonia_region }
    }
}
me_messapia.20 = {
    type = country_event

    title = me_messapia_20_title
    desc = me_messapia_20_desc
    picture = great_work_celebration

    option = {
        name = "me_messapia_20.a"
        custom_tooltip = me_messapia_20_tooltip
        change_country_name = "MAGNA_ILLYRIA_NAME"
        hidden_effect = {
            change_country_adjective = "MAGNA_ILLYRIA_ADJECTIVE"
            change_country_tag = 1MI
            change_country_color = magna_illyria_map_color
            change_country_flag = MAGNA_ILLYRIA_FLAG
        }
        capital_scope = {
            capital_formable_medium_effect = yes
            formable_capital_modifier_normal_effect = yes
        }
        hidden_effect = {
            region:magna_graecia_region = { formable_region_province_effect = yes }
        }
        add_4_free_province_investments = yes
        add_political_influence = 100
        custom_tooltip = cant_form_illyria_tt
    }
    option = {
        name = "me_messapia_20.b"
        custom_tooltip = me_messapia_20_tooltip
        change_country_name = "MAGNA_ILLYRIA_NAME_2"
        hidden_effect = {
            change_country_adjective = "MAGNA_ILLYRIA_ADJECTIVE"
            change_country_tag = 1MI
            change_country_color = magna_illyria_map_color
            change_country_flag = MAGNA_ILLYRIA_FLAG
        }
        capital_scope = {
            capital_formable_medium_effect = yes
            formable_capital_modifier_normal_effect = yes
        }
        hidden_effect = {
            region:magna_graecia_region = { formable_region_province_effect = yes }
        }
        add_4_free_province_investments = yes
        add_political_influence = 100
        custom_tooltip = cant_form_illyria_tt
    }
}
me_messapia.21 = {
    type = country_event

    title = me_messapia_21_title
    desc = me_messapia_21_desc
    picture = great_work_architect

    option = {
        name = "me_messapia_21.a"
        custom_tooltip = me_messapia_21_tooltip
        add_country_modifier = {
            name = messapian_identity
            duration = 18250
        }
    }
}
me_messapia.22 = {
    type = country_event

    title = me_messapia_22_title
    desc = me_messapia_22_desc
    picture = interesting_histories_greek_soldiers_pops

    option = {
        name = "me_messapia_22.a"
        custom_tooltip = me_messapia_22_tooltip
        add_aggressive_expansion = -5
        add_treasury = 250
    }
    option = {
        name = "me_messapia_22.b"
        custom_tooltip = me_messapia_22_tooltip
        add_treasury = 250
        set_capital = 56
    }
}
me_messapia.23 = { # Brothers by Blood
    type = country_event

    title = me_messapia_23_title
    desc = me_messapia_23_desc
    picture = diadochi_greek_royal_wedding

    option = {
        name = "me_messapia_23.a"
        custom_tooltip = me_messapia_23_tooltip
        if = {
            limit = {
                tag = MSP
            }
            make_subject = {
                target = c:APU
                type = feudatory
            }
        }
        else_if = {
            limit = {
                tag = APU
            }
            make_subject = {
                target = c:MSP
                type = feudatory
            }
        }
        capital_scope = { 
            create_state_pop = freemen
            create_state_pop = freemen  
        }
    }
}
me_messapia.24 = {
    type = country_event

    title = me_messapia_24_title
    desc = me_messapia_24_desc
    picture = looting_dishonor

    option = {
        name = "me_messapia_24.a"
        custom_tooltip = me_messapia_24_tooltip
        add_innovation = 2
        add_military_experience = 50
        current_ruler = {
            add_nickname = NICKNAME_DESTROYER
            hidden_effect = {
                if = {
                    limit = {
                        has_trait = tactically_inflexible
                    }
                    remove_trait = tactically_inflexible
                }
            }
            add_trait = original_thinker
            add_popularity = 25
        }
    }
}
me_messapia.25 = {
    type = country_event

    title = me_messapia_25_title
    desc = me_messapia_25_desc
    picture = farming

    option = {
        name = "me_messapia_25.a"
        custom_tooltip = me_messapia_25_tooltip
        custom_tooltip = sicily_grain_tt
        hidden_effect = {
            every_owned_province = {
                limit = {
                    OR = {
                        is_in_area = syracuse_area
                        is_in_area = east_sicily_area
                        is_in_area = west_sicily_area
                        #this = root.capital_scope # for testing since you don't start with sicily
                    }
                }
                add_permanent_province_modifier = {
                    name = sicilian_grain_messapia
                    duration = -1
                }
            }
        }
    }
}

me_messapia.26 = {
    type = country_event

    title = me_messapia_26_title
    desc = me_messapia_26_desc
    picture = romans_marching

    option = {
        name = "me_messapia_26.a"
        custom_tooltip = me_messapia_26_tooltip
        add_treasury = 500
        mission_claim_region_effect = { REGION = cisalpine_gaul_region }
        custom_tooltip = expand_statesmanship_tt
        hidden_effect = {
            every_character = {
                add_character_experience = 5
            }
        }
        current_ruler = {
            add_martial = 2
        }
        current_heir = {
            add_martial = 1
        }
    }
}
me_messapia.27 = {
    type = country_event

    title = me_messapia_27_title
    desc = me_messapia_27_desc
    picture = Event_massive_naval_battle

    option = {
        name = "me_messapia_27.a"
        custom_tooltip = me_messapia_27_tooltip
        add_country_modifier = {
            name = marulum_nostrum
            duration = -1
        }
    }
}

me_messapia.28 = {
    type = country_event

    title = me_messapia_28_title
    desc = me_messapia_28_desc
    picture = diadochi_battle_romans_celts_honor

    option = {
        name = "me_messapia_28.a"
        custom_tooltip = me_messapia_28_tooltip
        add_country_modifier = {
            name = lessons_from_war
            duration = -1
        }
    }
}

### Start of the war of 303 event chain

me_messapia.100 = { # triggers for Lucania, hidden
    type = country_event
    hidden = yes

    trigger = {
        tag = LCA
    }

    immediate = {
        c:LCA = {
            add_to_list = war_303_list
        }
        c:TAR = {
            add_to_list = war_303_list
            trigger_event = {
                id = me_messapia.102
                days = 121 # call Sparta ; 3 weeks after start of the war
            }
        }
        c:MSP = {
            trigger_event = {
                id = me_messapia.101
                days = 100 # from start
            }
        }
        c:APU = {
            trigger_event = {
                id = me_messapia.101
                days = 100 # from start
            }
        }
        c:SAM = {
            trigger_event = {
                id = me_messapia.101
                days = 100 # from start
            }
        }
    }
}

me_messapia.101 = {
    type = country_event
    title = me_messapia_101_title
    desc = me_messapia_101_desc
    left_portrait = c:MSP.current_ruler
    left_portrait = c:TAR.current_ruler
    left_portrait = c:APU.current_ruler

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    option = { # fight
        name = "me_messapia_101.a"
        custom_tooltip = war_303_tt_1
        add_war_exhaustion = 5
        add_to_list = war_303_list
    }

    option = { # surrender
        name = "me_messapia_101.b"
        custom_tooltip = war_303_tt_2
        add_political_influence = -50
        add_aggressive_expansion = 5
        if = {
            limit = {
                tag = SAM
                c:SAM = {
                    NOT = {
                        has_variable = samnium_doesnt_fight_var
                    }
                }
            }
            c:SAM = { set_variable = samnium_doesnt_fight_var }
        }
    }
}

me_messapia.102 = {
    type = country_event
    title = me_messapia_102_title
    desc = me_messapia_102_desc
    left_portrait = c:TAR.current_ruler
    left_portrait = c:SPA.current_ruler
    left_portrait = char:176 # Kleonymos

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    option = { # call sparta
        name = "me_messapia_102.a"
        custom_tooltip = war_303_tt_3
        c:SPA = {
            trigger_event = {
                id = me_messapia.103
                days = 8
            }
        }
    }

    option = { # Do not call sparta
        name = "me_messapia_102.b"
        trigger = {
            is_ai = no
        }
        trigger_event = {
            id = me_messapia.110 # Lucanian threat - Do we fight, do we surrender? We have not enough help ...
            days = 14
        }
    }
}

me_messapia.103 = { # Ping Sparta
    type = country_event
    title = me_messapia_103_title
    desc = me_messapia_103_desc
    left_portrait = c:TAR.current_ruler
    left_portrait = c:SPA.current_ruler
    left_portrait = char:176 # Kleonymos

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    option = { # help tarentum - send kleonymos
        name = "me_messapia_103.a"
        add_treasury = 250
        add_manpower = -4
        every_in_list = {
            list = war_303_list
            trigger_event = {
                id = me_messapia.104 # Sparta joins war
                days = 8
            }
        }
        
        ai_chance = {
            base = 100
        }
    }

    option = { # do not help
        name = "me_messapia_103.b"
        c:TAR = {
            add_opinion = {
                modifier = refused_help_spa_tar
                target = ROOT
            }
            ### SPARTA REFUSES TO JOIN - MORE EVENTS TO SIMULATE WAR. OUTCOME SKEWED IN LUCANIA/SAMNIUM FAVOUR
            trigger_event = {
                id = me_messapia.110 # Lucanian threat - Do we fight, do we surrender? We have not enough help ...
                days = 14
            }
        }
    }
}

me_messapia.104 = { # sparta joined
    type = country_event
    title = me_messapia_104_title
    desc = me_messapia_104_desc
    left_portrait = c:TAR.current_ruler
    left_portrait = c:SPA.current_ruler
    left_portrait = char:176 # Kleonymos

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    option = { #"great"
        name = "me_messapia_104.a"
        trigger = {
            OR = {
                tag = TAR
                tag = MSP
                tag = APU
            }
        }
        if = {
            limit = {
                tag = TAR
            }
            add_treasury = -250
            add_manpower = 4
        }
        add_war_exhaustion = -5
    }

    option = { 
        name = "me_messapia_104.b"
        trigger = {
            OR = {
                tag = SAM
                tag = LCA
            }
        }
        add_war_exhaustion = 5
    }

    option = { # give up
        name = "me_messapia_104.c"
        trigger = {
            OR = {
                tag = SAM
                tag = LCA
            }
        }
        if = {
            limit = {
                tag = SAM
            }
            set_global_variable = war_303_samnium_out
            trigger_event = {
                id = me_messapia.106
                days = 8
            }
        }
        else_if = { # War Leader - if give up, war ends
            limit = {
                tag = LCA
            }
            custom_tooltip = we_will_surrender_tt
            set_global_variable = war_303_end
            trigger_event = {
                id = me_messapia.107
                days = 8
            }
        }

        ai_chance = { # if samnium is a player to not fuck the player over
            modifier = {
                add = -100
                c:SAM = {
                    is_ai = no
                }
            }
            modifier = {
                add = 25
                c:MSP = { # if there's a player on Messapia, it should be more likely that the player wins.
                    is_ai = no
                }
            }
        }
    }
}

me_messapia.105 = { # Samnium Surrenders, Lucania does not
    type = country_event
    title = me_messapia_105_title
    desc = me_messapia_105_desc
    left_portrait = c:MSP.current_ruler
    left_portrait = c:TAR.current_ruler
    left_portrait = c:APU.current_ruler

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    trigger = {
        NOT = {
            has_global_variable = war_303_end
        }
    }

    immediate = {
        show_as_tooltip = {
            # HAS HAPPENED PEACE DEAL
            samnium_separate_peace_effect = yes
        }
    }

    option = { # great, samnium is out
        name = "me_messapia_105.a"
        trigger = {
            NOT = { tag = LCA }
        }
    }

    option = { # ally abandoned us
        name = "me_messapia_105.b"
        trigger = {
            tag = LCA
        }
        reverse_add_opinion = {
            modifier = refused_help_spa_tar # loced neutrally
            target = c:SAM
        }
        trigger_event = {
            id = me_messapia.109 # give up now that samnium left?
            days = 8
        }
    }
}

me_messapia.106 = { # Samnium peace deal, without lucania
    type = country_event
    hidden = yes

    trigger = {
        NOT = {
            has_global_variable = war_303_end
        }
    }

    immediate = {
        #SAMNIUM SCRIPTED PEACE DEAL
        samnium_separate_peace_effect = yes
        c:SAM = {
            remove_from_list = war_303_list
        }
        every_in_list = {
            list = war_303_list
            trigger_event = {
                id = me_messapia.105 # notif about samnium peace out
            }
        }
        remove_global_variable = war_303_samnium_out 
    }
}

me_messapia.107 = { # End of War if Lucania surrenders
    type = country_event
    hidden = yes

    trigger = {
        has_global_variable = war_303_end
    }

    immediate = {
        #LUCANIA SCRIPTED PEACE DEAL - Will end war
        lucania_surrenders_peace_effect = yes
        c:LCA = {
            remove_from_list = war_303_list
        }
        if = {
            limit = {
                has_global_variable = war_303_samnium_out
            }
            c:SAM = {
                remove_from_list = war_303_list
            }
            remove_global_variable = war_303_samnium_out # no longer needed after that
        }
        every_in_list = {
            list = war_303_list
            trigger_event = {
                id = me_messapia.108 # notif about samnium peace out
            }
        }
        remove_global_variable = war_303_end
        set_global_variable = lucania_lost_war # used in mission. yes, I know there are other variables already, but I don't want to fuck anything up
    }
}

me_messapia.108 = { # End of War Ping to others - tarentum/coalition win
    type = country_event
    title = me_messapia_108_title
    desc = me_messapia_108_desc
    left_portrait = c:MSP.current_ruler
    left_portrait = c:TAR.current_ruler
    left_portrait = c:APU.current_ruler

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    trigger = {
        has_global_variable = war_303_end
    }

    immediate = {
        show_as_tooltip = {
            # HAS HAPPENED PEACE DEAL
            lucania_surrenders_peace_effect = yes
        }
    }

    option = { # war won, great!
        name = "me_messapia_108.a"
        trigger = {
            NOT = { tag = SAM }
        }
    }

    option = { # ally surrendered even with our help, darn
        name = "me_messapia_108.b"
        trigger = {
            tag = SAM
        }
    }
}

me_messapia.109 = { # for Lucania, if Samnium gave up: surrender as well, or continue fighting?
    type = country_event
    title = me_messapia_109_title
    desc = me_messapia_109_desc
    left_portrait = c:MSP.current_ruler
    left_portrait = c:TAR.current_ruler
    left_portrait = c:APU.current_ruler

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    trigger = {
        has_global_variable = war_303_samnium_out
    }

    immediate = {
        custom_tooltip = war_303_samnoum_out_tt
    }

    option = { # surreneder as well
        name = "me_messapia_109.a"
        set_global_variable = war_303_end
        custom_tooltip = we_will_surrender_tt
        trigger_event = {
            id = me_messapia.107
            days = 8
        }
    }

    option = { # continue fighting alone
        name = "me_messapia_109.b"
        custom_tooltip = we_will_continue_fighting_tt
        # MORE EVENTS TO SIMULATE WAR. OUTCOME SKEWED IN TARENTUM ET AL'S FAVOUR
        hidden_effect = {
            random_list = {
                3 = { # -T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Lucania wins a big battle
                            id = me_messapia.112
                            days = { 21 35 }
                        }
                    }
                }
                10 = { # +T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Tarentum/Coalition wins a big battle
                            id = me_messapia.113
                            days = { 21 35 }
                        }
                    }
                }
                1 = { # -T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Tarentine Soldiers desert
                            id = me_messapia.114
                            days = { 21 35 }
                        }
                    }
                }
                5 = { # +T
                    trigger = {
                        c:SAM = {
                            is_in_list = war_303_list
                        }
                    }
                    if = {
                        limit = {
                            c:SAM = {
                                is_ai = no
                            }
                        }
                        trigger_event = { # Samnium leaves the war
                            id = me_messapia.115 # choice
                            days = { 21 35 }
                        }
                    }
                    else = {
                        set_global_variable = war_303_samnium_out
                        trigger_event = {
                            id = me_messapia.106
                            days = 8
                        }
                    }
                }
            }
        }
    }
}

me_messapia.110 = { # Lucanian Threat, if Sparta doesn't join. Pov tarentum (war leader)
    type = country_event
    title = me_messapia_110_title
    desc = me_messapia_110_desc
    left_portrait = c:MSP.current_ruler
    left_portrait = c:TAR.current_ruler
    left_portrait = c:APU.current_ruler

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    option = { # surreneder
        name = "me_messapia_110.a"
        custom_tooltip = we_will_surrender_tt
        set_global_variable = war_303_end
        war_303_coalition_surrender_effect = yes
        every_in_list = {
            list = war_303_list
            limit = {
                NOT = {
                    tag = TAR # triggered from TAR
                }
            }
            trigger_event = {
                id = me_messapia.111 # surrender info
            }
        }

        ai_chance = { # less likely if the player's involved
            modifier = {
                add = -25
                OR = {
                    c:MSP = {
                        is_ai = no
                    }
                    c:APU = {
                        is_ai = no
                    }
                }
            }
        }
    }

    option = { # continue fighting 
        name = "me_messapia_110.b"
        add_war_exhaustion = 5
        custom_tooltip = we_will_continue_fighting_tt
        # MORE EVENTS TO SIMULATE WAR. OUTCOME SKEWED IN LUCANIA ET AL'S FAVOUR
        hidden_effect = {
            random_list = {
                10 = { # -T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Lucania wins a big battle
                            id = me_messapia.112
                            days = { 21 35 }
                        }
                    }
                }
                3 = { # +T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Tarentum/Coalition wins a big battle
                            id = me_messapia.113
                            days = { 21 35 }
                        }
                    }
                }
                5 = { # -T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Tarentine Soldiers desert
                            id = me_messapia.114
                            days = { 21 35 }
                        }
                    }
                }
                1 = { # +T
                    trigger = {
                        c:SAM = {
                            is_in_list = war_303_list
                        }
                    }
                    if = {
                        limit = {
                            c:SAM = {
                                is_ai = no
                            }
                        }
                        c:SAM = {
                            trigger_event = { # Samnium leaves the war
                                id = me_messapia.115 # choice
                                days = { 21 35 }
                            }
                        }
                    }
                    else = {
                        set_global_variable = war_303_samnium_out
                        trigger_event = {
                            id = me_messapia.106
                            days = 8
                        }
                    }
                }
            }
        }
    }
}

me_messapia.111 = { # if Tarentum surrenders, info to all
    type = country_event
    title = me_messapia_111_title
    desc = me_messapia_111_desc
    left_portrait = c:MSP.current_ruler
    left_portrait = c:TAR.current_ruler
    left_portrait = c:APU.current_ruler

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    immediate = {
        show_as_tooltip = {
            war_303_coalition_surrender_effect = yes
        }
    }

    option = { # losers
        name = "me_messapia_111.a"
        trigger = {
            OR = {
                tag = APU
                tag = MSP
            }
        }
    }

    option = { # winners
        name = "me_messapia_111.b"
        trigger = {
            OR = {
                tag = SAM
                tag = LCA
            }
        }
    }
}

me_messapia.112 = { # Lucania wins a big battle
    type = country_event
    title = me_messapia_112_title
    desc = me_messapia_112_desc
    left_portrait = c:MSP.current_ruler
    left_portrait = c:TAR.current_ruler
    left_portrait = c:APU.current_ruler

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    option = { # losers -shit
        name = "me_messapia_112.a"
        trigger = {
            OR = {
                tag = APU
                tag = MSP
            }
        }
        add_war_exhaustion = 5
    }

    option = { # winners -yay
        name = "me_messapia_112.b"
        trigger = {
            OR = {
                tag = SAM
                tag = LCA
            }
        }
        add_political_influence = 10
    }

    option = { # tarentum -surrender
        name = "me_messapia_112.c"
        trigger = {
            tag = TAR
        }
        custom_tooltip = we_will_surrender_tt
        set_global_variable = war_303_end
        war_303_coalition_surrender_effect = yes
        every_in_list = {
            list = war_303_list
            limit = {
                NOT = {
                    tag = TAR # triggered from TAR
                }
            }
            trigger_event = {
                id = me_messapia.111 # surrender info
            }
        }
    }

    option = { # tarentum -continue fighting
        name = "me_messapia_112.d"
        trigger = {
            tag = TAR
        }
        add_war_exhaustion = 10
        custom_tooltip = we_will_continue_fighting_tt
        # MORE EVENTS TO SIMULATE WAR. OUTCOME SKEWED IN LUCANIA ET AL'S FAVOUR
        hidden_effect = {
            random_list = {
                10 = { # -T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Lucania wins a big battle
                            id = me_messapia.112
                            days = { 21 35 }
                        }
                    }
                }
                3 = { # +T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Tarentum/Coalition wins a big battle
                            id = me_messapia.113
                            days = { 21 35 }
                        }
                    }
                }
                5 = { # -T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Tarentine Soldiers desert
                            id = me_messapia.114
                            days = { 21 35 }
                        }
                    }
                }
                1 = { # +T
                    trigger = {
                        c:SAM = {
                            is_in_list = war_303_list
                        }
                    }
                    if = {
                        limit = {
                            c:SAM = {
                                is_ai = no
                            }
                        }
                        c:SAM = {
                            trigger_event = { # Samnium leaves the war
                                id = me_messapia.115 # choice
                                days = { 21 35 }
                            }
                        }
                    }
                    else = {
                        set_global_variable = war_303_samnium_out
                        trigger_event = {
                            id = me_messapia.106
                            days = 8
                        }
                    }
                }
            }
        }
    }
}

me_messapia.113 = { # Tarentum et al win a big battle
    type = country_event
    title = me_messapia_113_title
    desc = me_messapia_113_desc
    left_portrait = c:MSP.current_ruler
    left_portrait = c:TAR.current_ruler
    left_portrait = c:APU.current_ruler

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    option = { # winners
        name = "me_messapia_113.a"
        trigger = {
            OR = {
                tag = APU
                tag = MSP
                tag = TAR
            }
        }
        add_political_influence = 10
    }

    option = { # loser
        name = "me_messapia_113.b"
        trigger = {
            tag = SAM
        }
        add_war_exhaustion = 5
        trigger_event = { # Samnium leaves the war
            id = me_messapia.115 # choice
            days = 2
        }
    }

    option = { # lucania -surrender
        name = "me_messapia_113.c"
        trigger = {
            tag = LCA
        }
        custom_tooltip = we_will_surrender_tt
        set_global_variable = war_303_end
        trigger_event = {
            id = me_messapia.107
            days = 8
        }
    }

    option = { # lucania -continue fighting
        name = "me_messapia_113.d"
        trigger = {
            tag = LCA
        }
        add_war_exhaustion = 10
        custom_tooltip = we_will_continue_fighting_tt
        # MORE EVENTS TO SIMULATE WAR. OUTCOME SKEWED IN TARENTUM ET AL'S FAVOUR
        hidden_effect = {
            random_list = {
                3 = { # -T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Lucania wins a big battle
                            id = me_messapia.112
                            days = { 21 35 }
                        }
                    }
                }
                10 = { # +T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Tarentum/Coalition wins a big battle
                            id = me_messapia.113
                            days = { 21 35 }
                        }
                    }
                }
                1 = { # -T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Tarentine Soldiers desert
                            id = me_messapia.114
                            days = { 21 35 }
                        }
                    }
                }
                5 = { # +T
                    trigger = {
                        c:SAM = {
                            is_in_list = war_303_list
                        }
                    }
                    if = {
                        limit = {
                            c:SAM = {
                                is_ai = no
                            }
                        }
                        trigger_event = { # Samnium leaves the war
                            id = me_messapia.115 # choice
                            days = { 21 35 }
                        }
                    }
                    else = {
                        set_global_variable = war_303_samnium_out
                        trigger_event = {
                            id = me_messapia.106
                            days = 8
                        }
                    }
                }
            }
        }
    }
}

me_messapia.114 = { # Tarentine Soldiers Desert
    type = country_event
    title = me_messapia_114_title
    desc = me_messapia_114_desc
    left_portrait = c:MSP.current_ruler
    left_portrait = c:TAR.current_ruler
    left_portrait = c:APU.current_ruler

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    immediate = {
        add_manpower = -2
    }

    option = { # continue fighting
        name = "me_messapia_114.a"
        add_war_exhaustion = 5
        custom_tooltip = we_will_continue_fighting_tt
        # MORE EVENTS TO SIMULATE WAR. OUTCOME SKEWED IN LUCANIA ET AL'S FAVOUR
        hidden_effect = {
            random_list = {
                10 = { # -T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Lucania wins a big battle
                            id = me_messapia.112
                            days = { 21 35 }
                        }
                    }
                }
                3 = { # +T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Tarentum/Coalition wins a big battle
                            id = me_messapia.113
                            days = { 21 35 }
                        }
                    }
                }
                5 = { # -T
                    every_in_list = {
                        list = war_303_list
                        trigger_event = { # Tarentine Soldiers desert
                            id = me_messapia.114
                            days = { 21 35 }
                        }
                    }
                }
                1 = { # +T
                    trigger = {
                        c:SAM = {
                            is_in_list = war_303_list
                        }
                    }
                    if = {
                        limit = {
                            c:SAM = {
                                is_ai = no
                            }
                        }
                        c:SAM = {
                            trigger_event = { # Samnium leaves the war
                                id = me_messapia.115 # choice
                                days = { 21 35 }
                            }
                        }
                    }
                    else = {
                        set_global_variable = war_303_samnium_out
                        trigger_event = {
                            id = me_messapia.106
                            days = 8
                        }
                    }
                }
            }
        }
    }

    option = { # give up
        name = "me_messapia_114.b"
        name = "me_messapia_110.a"
        custom_tooltip = we_will_surrender_tt
        set_global_variable = war_303_end
        war_303_coalition_surrender_effect = yes
        every_in_list = {
            list = war_303_list
            limit = {
                NOT = {
                    tag = TAR # triggered from TAR
                }
            }
            trigger_event = {
                id = me_messapia.111 # surrender info
            }
        }
    }
}

me_messapia.115 = { # samnium can leave the war 
    type = country_event
    title = me_messapia_115_title
    desc = me_messapia_115_desc
    left_portrait = c:TAR.current_ruler
    left_portrait = c:MSP.current_ruler
    left_portrait = c:APU.current_ruler

    right_portrait = c:LCA.current_ruler
    right_portrait = c:SAM.current_ruler

    picture = greeks_marching

    option = { 
        name = "me_messapia_115.a"
        custom_tooltip = we_will_continue_fighting_tt
    }

    option = { # give up
        name = "me_messapia_115.b"
        set_global_variable = war_303_samnium_out
        trigger_event = {
            id = me_messapia.106
            days = 8
        }
        ai_chance = { # if lucania is a player to not fuck the player over
            modifier = {
                add = -100
                c:LCA = {
                    is_ai = no
                }
            }
        }
    }
}

# Extras
me_messapia.69 = {
    type = country_event
    title = taros_conquest_title
    desc = taros_conquest_desc
    picture = diadochi_treasury_plundered_honor

    immediate = {
        if = {
            limit = {
                p:56 = {
                    fort_level >= 0
                }
            }
            p:56 = { remove_building_level = fortress_building }
        }
    }

    option = {
        name = "taros_conquest.a"
        add_country_modifier = {
            name = occupied_tarentum
            duration = 3650
        }
        current_ruler = {
            add_popularity = popularity_huge
        }
        add_legitimacy = 10
        add_treasury = 200
        add_innovation = 1
    }
}